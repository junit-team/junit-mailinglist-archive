{
    "numMessagesInTopic": 9, 
    "nextInTime": 16891, 
    "senderId": "qSPVyLcRAjxpDiK5q8K6vAvK2mmAfaM54ZSrwvRtAKOspnp69QxdcCHd7JSH8Kdh3Slo328FF1F5lNEWu1Ms9WCNQ2ZeM3KTwNdkvBvG", 
    "systemMessage": true, 
    "subject": "Deep Equals of two JavaBeans", 
    "from": "&quot;wheelerpoker&quot; &lt;wheelerpoker@...&gt;", 
    "authorName": "wheelerpoker", 
    "msgSnippet": "I am trying to implement an assertion that does a deep equals of two POJOs vs. using the POJOs equals methods like assertEquals(Object, Object). The code is", 
    "msgId": 16890, 
    "rawEmail": "Return-Path: &lt;wheelerpoker@...&gt;\r\nReceived: (qmail 9088 invoked from network); 8 Jun 2006 21:38:54 -0000\r\nReceived: from unknown (66.218.66.218)\n  by m28.grp.scd.yahoo.com with QMQP; 8 Jun 2006 21:38:54 -0000\r\nReceived: from unknown (HELO n22a.bullet.scd.yahoo.com) (66.94.237.51)\n  by mta3.grp.scd.yahoo.com with SMTP; 8 Jun 2006 21:38:54 -0000\r\nReceived: from [66.218.66.58] by n22.bullet.scd.yahoo.com with NNFMP; 08 Jun 2006 21:35:13 -0000\r\nReceived: from [66.218.66.92] by t7.bullet.scd.yahoo.com with NNFMP; 08 Jun 2006 21:35:13 -0000\r\nX-Sender: wheelerpoker@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (qmail 1755 invoked from network); 8 Jun 2006 20:34:52 -0000\r\nReceived: from unknown (66.218.67.34)\n  by m27.grp.scd.yahoo.com with QMQP; 8 Jun 2006 20:34:52 -0000\r\nReceived: from unknown (HELO n8c.bullet.sc5.yahoo.com) (66.163.187.199)\n  by mta8.grp.scd.yahoo.com with SMTP; 8 Jun 2006 20:34:51 -0000\r\nReceived: from [66.163.187.121] by n8.bullet.sc5.yahoo.com with NNFMP; 08 Jun 2006 20:32:58 -0000\r\nReceived: from [66.218.69.1] by t2.bullet.sc5.yahoo.com with NNFMP; 08 Jun 2006 20:32:58 -0000\r\nReceived: from [66.218.66.75] by t1.bullet.scd.yahoo.com with NNFMP; 08 Jun 2006 20:32:58 -0000\r\nDate: Thu, 08 Jun 2006 20:32:56 -0000\r\nTo: junit@yahoogroups.com\r\nMessage-ID: &lt;e6a1ho+r9fo@...&gt;\r\nUser-Agent: eGroups-EW/0.82\r\nMIME-Version: 1.0\r\nContent-Type: text/plain; charset=&quot;ISO-8859-1&quot;\r\nContent-Transfer-Encoding: quoted-printable\r\nX-Mailer: Yahoo Groups Message Poster\r\nX-Yahoo-Newman-Property: groups-system\r\nX-eGroups-Msg-Info: 1:6:0:0\r\nFrom: &quot;wheelerpoker&quot; &lt;wheelerpoker@...&gt;\r\nSubject: Deep Equals of two JavaBeans\r\nX-Yahoo-Group-Post: member; u=229401621; y=A70Hem2BOXIoQ8W7UyskEsdvlqbuIxfQWZdaX-opuUxiRUrKLNmU\r\nX-Yahoo-Profile: wheelerpoker\r\nX-eGroups-Approved-By: mark_l_salter &lt;marksalter@...&gt; via web; 08 Jun 2006 21:35:12 -0000\r\n\r\nI am trying to implement an assertion that does a deep equals of two\nPOJOs =\r\nvs. using the POJOs&#39; equals methods like assertEquals(Object,\nObject). The =\r\ncode is below. It&#39;s kind of shakey and only works on\nproperties that are ma=\r\nps, collections, arrays, primitives, and beans\n(complex types). It attempts=\r\n to thwart infinite recursion from cycles\nby caching objects in a List and =\r\nperforming reference equality tests.\nI&#39;ve tried to make the code thread-saf=\r\ne, but it&#39;s probably not. Can\nyou look and comment?\n\n\nimport java.util.Arra=\r\nyList;\nimport java.util.Collection;\nimport java.util.Date;\nimport java.util=\r\n.Iterator;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Se=\r\nt;\n\nimport junit.framework.Assert;\n\nimport org.apache.commons.beanutils.Pro=\r\npertyUtils;\nimport org.apache.commons.logging.Log;\nimport org.apache.common=\r\ns.logging.LogFactory;\n\npublic final class AssertUtil extends Assert {\n\n    =\r\nprivate static final Log logger =3D LogFactory.getLog(AssertUtil.class);\n  =\r\n  /** for detecting cycles and preventing infinite recursive loop */\n    pr=\r\nivate static final List referenceCache =3D new ArrayList();\n    \n    privat=\r\ne AssertUtil() {\n        throw new UnsupportedOperationException(&quot;do not us=\r\ne&quot;);\n    }\n    \n    public static synchronized void assertDeepEquals(Object=\r\n expected,\nObject actual) {\n        logger.debug(&quot;assertDeepEquals called&quot;)=\r\n;\n        doAssertDeepEquals(null, expected, actual);\n        logger.debug(=\r\n&quot;clearing &quot; + referenceCache.size() + &quot; objects\nfrom reference cache&quot;);    =\r\n    \n        referenceCache.clear();\n    }\n    \n    private static void doA=\r\nssertDeepEquals(String name, Object\nexpected, Object actual) {\n        if (=\r\nreferenceAlreadyCached(expected)) {\n            logger.debug(&quot;cycle detecte=\r\nd on &quot; + expected);\n            return;\n        }\n        \n        if (expe=\r\ncted =3D=3D null) {\n            assertNull(&quot;expected &quot; + name + &quot; was null,=\r\n but actual was\nnot&quot;, actual);\n        } else if (expected !=3D null) {\n   =\r\n         assertNotNull(&quot;expected &quot; + name + &quot; was not null, but\nactual was&quot;=\r\n, actual);\n            \n            // both objects guaranteed not null fro=\r\nm now on\n            if (isSimpleProperty(expected)) {            \n        =\r\n        evaluateSimpleProperty(name, expected, actual);\n            } else =\r\n{ \n                referenceCache.add(expected);\n                if (isArra=\r\nyProperty(expected)) {                \n                    evaluateArrayPro=\r\nperty(name, (Object[])expected,\n(Object[])actual);            \n            =\r\n    } else if (isCollectionProperty(expected)) {            \n              =\r\n      evaluateCollectionProperty(name,\n(Collection)expected, (Collection)ac=\r\ntual);            \n                } else if (isMapProperty(expected)) {   =\r\n         \n                    evaluateMapProperty((Map)expected, (Map)actua=\r\nl); \n          \n                } else {\n                    evaluateComple=\r\nxProperty(expected, actual);            \n                }                \n=\r\n            }            \n        }        \n    }\n        \n    private stat=\r\nic void evaluateSimpleProperty(String name, Object\nexpected, Object actual)=\r\n {\n        logger.debug(name + &quot; [expected =3D &quot; + expected + &quot;, actual =3D=\r\n &quot;\n+ actual + &quot;]&quot;);\n        assertEquals(name + &quot; not equal&quot;, expected, act=\r\nual);        \n    }\n    \n    private static void evaluateArrayProperty(Stri=\r\nng name, Object[]\nexpected, Object[] actual) {        \n        if (expected=\r\n.length !=3D actual.length)\n            fail(&quot;not the same length&quot;);       =\r\n \n        for (int i=3D0; i&lt;expected.length; i++)\n            doAssertDeepE=\r\nquals(name + &quot;[&quot; + i + &quot;]&quot;, expected[i],\nactual[i]);\n    }\n    \n    private=\r\n static void evaluateCollectionProperty(String name,\nCollection expected, C=\r\nollection actual) {\n        evaluateArrayProperty(name, expected.toArray(),=\r\n actual.toArray());\n    }\n    \n    /** TODO perform a deep comparison of ea=\r\nch maps&#39; keys */\n    private static void evaluateMapProperty(Map expected, =\r\nMap actual) {\n        Set keys =3D expected.keySet();\n        if (!keys.equ=\r\nals(actual.keySet()))\n            fail(&quot;dissimilar keys&quot;);\n        \n       =\r\n for (Iterator i=3Dkeys.iterator(); i.hasNext();) {\n            Object key =\r\n=3D i.next();\n            doAssertDeepEquals(key.toString(), expected.get(k=\r\ney),\nactual.get(key));\n        }\n    }\n    \n    private static void evaluat=\r\neComplexProperty(Object expected,\nObject actual) {\n        Map expectedProp=\r\ns =3D null, actualProps =3D null;\n        try {\n            expectedProps =\r\n=3D PropertyUtils.describe(expected);\n            actualProps =3D PropertyU=\r\ntils.describe(actual);\n            // not to thrilled about this, better wa=\r\ny??\n            expectedProps.remove(&quot;class&quot;);\n            actualProps.remo=\r\nve(&quot;class&quot;);\n        } catch (Exception ex) {\n            ex.printStackTrac=\r\ne();\n            logger.error(ex);\n        }\n        \n        evaluateMapPr=\r\noperty(expectedProps, actualProps);        \n    }\n    \n    private static b=\r\noolean isSimpleProperty(Object o) {\n        return (\n        o instanceof C=\r\nharSequence || \n        o instanceof Number || \n        o instanceof Boolea=\r\nn || \n        o instanceof Date || \n        o instanceof Character);       =\r\n \n    }\n        \n    private static boolean isArrayProperty(Object o) {\n   =\r\n     return o.getClass().isArray();\n    }\n    \n    private static boolean i=\r\nsCollectionProperty(Object o) {\n        return (o instanceof Collection);\n =\r\n   }\n    \n    private static boolean isMapProperty(Object o) {\n        retu=\r\nrn (o instanceof Map);\n    }\n    \n    private static boolean referenceAlrea=\r\ndyCached(Object o) {\n        for (int i=3D0, n=3DreferenceCache.size(); i&lt;n=\r\n; i++) {\n            if (o =3D=3D referenceCache.get(i)) { \n               =\r\n return true;            \n            }\n        }\n        return false;\n   =\r\n }\n}\n\n\n\n\n\n\n\n", 
    "profile": "wheelerpoker", 
    "topicId": 16890, 
    "spamInfo": {
        "reason": "6", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 229401621, 
    "prevInTime": 16889, 
    "contentTrasformed": false, 
    "postDate": "1149798776", 
    "canDelete": false, 
    "nextInTopic": 16896, 
    "prevInTopic": 0, 
    "headers": {
        "messageIdInHeader": "PGU2YTFobytyOWZvQGVHcm91cHMuY29tPg=="
    }
}
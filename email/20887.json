{
    "numMessagesInTopic": 7, 
    "nextInTime": 20888, 
    "senderId": "MRUKjuDYOckvzd8OZz8PuOq2ezMN_gYkM_11eG_ixa0bPWyZmSIF36GXWXVsL8KFcZzCYn_LyXW3-6IlWdw2QKKzG88", 
    "systemMessage": false, 
    "subject": "Re: [junit] Running parallel tests in JUnit4.4+", 
    "from": "&quot;David Saff&quot; &lt;david@...&gt;", 
    "authorName": "David Saff", 
    "msgSnippet": "Daniel, Sorry for the long delay in responding. Right now, Kent and I are working on a solution that seems to be moving toward passing around an execution", 
    "msgId": 20887, 
    "profile": "dsaff", 
    "topicId": 20427, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 341876227, 
    "messageBody": "<div id=\"ygrps-yiv-1555085912\">Daniel,<br/>\n<br/>\nSorry for the long delay in responding.<br/>\n<br/>\nRight now, Kent and I are working on a solution that seems to be<br/>\nmoving toward passing around an execution strategy that runners can<br/>\nblindly submit Statements to, without knowing whether they will be run<br/>\non the spot, queued for future evaluation, or shipped off for<br/>\nexecution on a server in a wave-powered data center.  I expect<br/>\nsomething like that will crop up in 4.6, along with at least a default<br/>\nsingle-threaded implementation, and a thread pool implementation that<br/>\nattempts to maximize your local multi-core machine.<br/>\n<br/>\nRight now, we&#39;ve got the hood open, and engine pieces are laying all<br/>\naround on the pavement.  Once we get the hood closed again, I&#39;ll post<br/>\na snapshot.<br/>\n<br/>\n   David<br/>\n<br/>\nOn Thu, Jul 31, 2008 at 7:43 PM, Daniel Brolund<br/>\n&lt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:daniel.brolund@...\">daniel.brolund@...</a>&gt; wrote:<br/>\n<blockquote><span title=\"qreply\"> &gt; Hi David,<br/>\n&gt;<br/>\n&gt; The solution in my email proved unuseful for nested suites, since each<br/>\n&gt; suite needs its own &quot;thread pool&quot; ﻿(an ExecutorService). This leeds to<br/>\n&gt; resource starvation. The solution to that was to try to share the<br/>\n&gt; &quot;thread pool&quot;, and that ended in a static property/flag mess. It kind of<br/>\n&gt; worked, but it was (is) a mess.<br/>\n&gt;<br/>\n&gt; ﻿I found it a bit hard to get control over the execution, probably<br/>\n&gt; because of the recursive nature of the execution with run/runChildren,<br/>\n&gt; and when I tried to do just a little bit more I felt like I was<br/>\n&gt; reimplementing JUnit.<br/>\n&gt;<br/>\n&gt; AFAIKS, the structure of execution has changed a lot to the better in<br/>\n&gt; JUnit4.5 with the Statements, but in the parallelization case I&#39;m<br/>\n&gt; worried that this just encapsulates the recursion for the suites, e.g.:<br/>\n&gt;<br/>\n&gt; protected Statement childrenInvoker(final RunNotifier notifier) {<br/>\n&gt; return new Statement() {<br/>\n&gt; @Override<br/>\n&gt; public void evaluate() {<br/>\n&gt; runChildren(notifier);<br/>\n&gt; }};<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt; and it doesn&#39;t provide the means to get to the core blocks that we<br/>\n&gt; really want to parallelize.<br/>\n&gt;<br/>\n&gt; The next step might be that Statements (or some derivative thereof)<br/>\n&gt; are:<br/>\n&gt; * hierachial<br/>\n&gt; * traversable<br/>\n&gt; * dependable<br/>\n&gt;<br/>\n&gt; Then you can choose different traversers to either:<br/>\n&gt; 1. traverse the statement hierarchy and evaluate (current behavior)<br/>\n&gt; 2. ﻿traverse the statement hierarchy, resolve dependenices and execute<br/>\n&gt; in dependency order<br/>\n&gt; 3. 2) + ignore dependent tests<br/>\n&gt; 4. 1), 2) or 3) + parallelize execution<br/>\n&gt;<br/>\n&gt; Can you give me a reality check on this? I probably have missed some of<br/>\n&gt; your discussions around Statements.<br/>\n&gt;<br/>\n&gt; Cheers<br/>\n&gt; Daniel<br/>\n&gt;<br/>\n&gt; On Thu, 2008-07-31 at 11:47 -0400, David Saff wrote:<br/>\n&gt;&gt; Daniel,<br/>\n&gt;&gt;<br/>\n&gt;&gt; Per my earlier message, did this go anywhere? Thanks,<br/>\n&gt;&gt;<br/>\n&gt;&gt; David Saff<br/>\n&gt;&gt;<br/>\n&gt;&gt; On Thu, Apr 3, 2008 at 3:51 PM, James Abley &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:james.abley@...\">james.abley@...</a>&gt;<br/>\n&gt;&gt; wrote:<br/>\n&gt;&gt; &gt; On 03/04/2008, Daniel Brolund &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:daniel.brolund@...\">daniel.brolund@...</a>&gt; wrote:<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; Hi all,<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; I&#39;ve been looking around a bit for some sort of parallel execution<br/>\n&gt;&gt; of<br/>\n&gt;&gt; &gt;&gt; JUnit 4.4+ tests, but I didn&#39;t find much.<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; So, I tried a few things myself and came up with the two examples<br/>\n&gt;&gt; below;<br/>\n&gt;&gt; &gt;&gt; one is a parallel suite, and the other is for running parameterized<br/>\n&gt;&gt; test<br/>\n&gt;&gt; &gt;&gt; instances in parallel. It is almost too simple for me to really<br/>\n&gt;&gt; believe<br/>\n&gt;&gt; &gt;&gt; in it. ;-)<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; I would really like some feedback on it; things I&#39;ve missed, cases<br/>\n&gt;&gt; where<br/>\n&gt;&gt; &gt;&gt; it won&#39;t work etc.<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; ===========================================<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; package com.agical.junit;<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; import java.util.List;<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; import org.junit.internal.runners.InitializationError;<br/>\n&gt;&gt; &gt;&gt; import org.junit.runner.Runner;<br/>\n&gt;&gt; &gt;&gt; import org.junit.runner.notification.RunNotifier;<br/>\n&gt;&gt; &gt;&gt; import org.junit.runners.Suite;<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; public class ParallelSuite extends Suite {<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; public ParallelSuite(Class&lt;?&gt; klass) throws InitializationError {<br/>\n&gt;&gt; &gt;&gt; super(klass);<br/>\n&gt;&gt; &gt;&gt; }<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; public ParallelSuite(Class&lt;?&gt; klass, Class&lt;?&gt;[] annotatedClasses)<br/>\n&gt;&gt; &gt;&gt; throws InitializationError {<br/>\n&gt;&gt; &gt;&gt; super(klass, annotatedClasses);<br/>\n&gt;&gt; &gt;&gt; }<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; @Override<br/>\n&gt;&gt; &gt;&gt; protected void runChildren(final RunNotifier runNotifier) {<br/>\n&gt;&gt; &gt;&gt; final List&lt;Runner&gt; runners = getRunners();<br/>\n&gt;&gt; &gt;&gt; runRunnersInParallel(runNotifier, runners);<br/>\n&gt;&gt; &gt;&gt; }<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; public static void runRunnersInParallel(final RunNotifier<br/>\n&gt;&gt; &gt;&gt; runNotifier,<br/>\n&gt;&gt; &gt;&gt; final List&lt;Runner&gt; runners) {<br/>\n&gt;&gt; &gt;&gt; Thread[] threads = new Thread[runners.size()];<br/>\n&gt;&gt; &gt;&gt; for (int i = 0; i &lt; threads.length; i++) {<br/>\n&gt;&gt; &gt;&gt; final int index = i;<br/>\n&gt;&gt; &gt;&gt; threads[i] = new Thread(new Runnable() {<br/>\n&gt;&gt; &gt;&gt; public void run() {<br/>\n&gt;&gt; &gt;&gt; runners.get(index).run(runNotifier);<br/>\n&gt;&gt; &gt;&gt; }});<br/>\n&gt;&gt; &gt;&gt; threads[i].start();<br/>\n&gt;&gt; &gt;&gt; }<br/>\n&gt;&gt; &gt;&gt; for (int i = 0; i &lt; threads.length; i++) {<br/>\n&gt;&gt; &gt;&gt; try {<br/>\n&gt;&gt; &gt;&gt; threads[i].join();<br/>\n&gt;&gt; &gt;&gt; } catch (InterruptedException e) {<br/>\n&gt;&gt; &gt;&gt; throw new RuntimeException(&quot;Couldn&#39;t join thread<br/>\n&gt;&gt; &gt;&gt; nicely&quot;, e);<br/>\n&gt;&gt; &gt;&gt; }<br/>\n&gt;&gt; &gt;&gt; }<br/>\n&gt;&gt; &gt;&gt; }<br/>\n&gt;&gt; &gt;&gt; }<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; ===========================================<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; package com.agical.junit;<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; import java.util.List;<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; import org.junit.runner.Runner;<br/>\n&gt;&gt; &gt;&gt; import org.junit.runner.notification.RunNotifier;<br/>\n&gt;&gt; &gt;&gt; import org.junit.runners.Parameterized;<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; public class ParallelAndParameterized extends Parameterized {<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; public ParallelAndParameterized(Class&lt;?&gt; klass) throws Exception {<br/>\n&gt;&gt; &gt;&gt; super(klass);<br/>\n&gt;&gt; &gt;&gt; }<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; @Override<br/>\n&gt;&gt; &gt;&gt; protected void runChildren(final RunNotifier runNotifier) {<br/>\n&gt;&gt; &gt;&gt; final List&lt;Runner&gt; runners = getRunners();<br/>\n&gt;&gt; &gt;&gt; ParallelSuite.runRunnersInParallel(runNotifier, runners);<br/>\n&gt;&gt; &gt;&gt; }<br/>\n&gt;&gt; &gt;&gt; }<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; ===========================================<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; There is still some work needed to be done, but I would like to<br/>\n&gt;&gt; hear if<br/>\n&gt;&gt; &gt;&gt; I&#39;m totally on the wrong path.<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;&gt; Cheers<br/>\n&gt;&gt; &gt;&gt; Daniel<br/>\n&gt;&gt; &gt;&gt;<br/>\n&gt;&gt; &gt;<br/>\n&gt;&gt; &gt;<br/>\n&gt;&gt; &gt; Hi Daniel,<br/>\n&gt;&gt; &gt;<br/>\n&gt;&gt; &gt; Nice thinking. Did you consider using<br/>\n&gt;&gt; &gt; java.util.concurrent.CountDownLatch and maybe the Executor<br/>\n&gt;&gt; framework?<br/>\n&gt;&gt; &gt; That might better communicate the intention.<br/>\n&gt;&gt; &gt;<br/>\n&gt;&gt; &gt; Regards,<br/>\n&gt;&gt; &gt;<br/>\n&gt;&gt; &gt; James<br/>\n&gt;&gt; &gt;<br/>\n&gt;&gt; &gt; ------------------------------------<br/>\n&gt;&gt; &gt;<br/>\n&gt;&gt; &gt; Yahoo! Groups Links<br/>\n&gt;&gt; &gt;<br/>\n&gt;&gt; &gt;<br/>\n&gt;&gt; &gt;<br/>\n&gt;&gt; &gt;<br/>\n&gt;&gt;<br/>\n&gt;&gt;<br/>\n&gt;&gt;<br/>\n&gt;&gt;<br/>\n&gt;<br/>\n&gt; </span></blockquote></div>", 
    "prevInTime": 20886, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1221616419", 
    "canDelete": false, 
    "nextInTopic": 0, 
    "prevInTopic": 20734, 
    "headers": {
        "inReplyToHeader": "PDEyMTc1NDc3ODIuNjU1NS4yNDMuY2FtZWxAZGFuaWVsLXVidW50dT4=", 
        "messageIdInHeader": "PDRmN2RhNmI5MDgwOTE2MTg1M2w0ZDQxNzBjNmg0ZWVjNGRiMTQ1NDliNGVmQG1haWwuZ21haWwuY29tPg==", 
        "referencesHeader": "PDEyMDcyMzQ0NjEuMTgzNDcuNDAuY2FtZWxAZGFuaWVsLWt1YnVudHU+CSA8MjNmY2U4ZTYwODA0MDMxMjUxaDNlYTVmOGU4bjExZjM1MjRhYjg3OGViOWZAbWFpbC5nbWFpbC5jb20+CSA8NGY3ZGE2YjkwODA3MzEwODQ3djUzZmQ0YTA1bzg4NmNiNzc3NWRhMzI3YTVAbWFpbC5nbWFpbC5jb20+CSA8MTIxNzU0Nzc4Mi42NTU1LjI0My5jYW1lbEBkYW5pZWwtdWJ1bnR1Pg=="
    }
}
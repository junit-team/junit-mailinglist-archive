{
    "numMessagesInTopic": 8, 
    "nextInTime": 20601, 
    "senderId": "b6Q1CAwGuNjvGR-3Uu4PBz1G7DSHGAygaQWfEp6d5j6Lw9NrF7KtOQMMwvAZvICEBev_qmFJlJkVduKNGLcXhbMn1-Js7UV4yMXCLuPFsL9o", 
    "systemMessage": false, 
    "subject": "Re: [junit] Testing code that depends on today&#39;s date", 
    "from": "&quot;J. B. Rainsberger&quot; &lt;jbrains762@...&gt;", 
    "authorName": "J. B. Rainsberger", 
    "msgSnippet": "... I m surprised by this. In a typical web application, I d expect a design similar to this: 1. HTTP Request Handler gets current date from system clock or", 
    "msgId": 20600, 
    "profile": "nails762", 
    "topicId": 20590, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 282027414, 
    "messageBody": "<div id=\"ygrps-yiv-941879489\">On 2008-06-17, at 11:28 , Per Jacobsson wrote:<br/>\n<br/>\n<blockquote><span title=\"ireply\"> &gt; Hi,<br/>\n&gt; This has been annoying me for a while and I can&#39;t think of a clean  <br/>\n&gt; solution for it. Hope this makes sense: I have some code that  <br/>\n&gt; returns different results depending on what today&#39;s date is (the  <br/>\n&gt; number of days since a user first registered, etc). The simple  <br/>\n&gt; approach is to just create a new instance of java.util.Date whenever  <br/>\n&gt; I need to know the current date, but that tends to make both unit  <br/>\n&gt; and automated functional testing difficult.<br/>\n&gt;<br/>\n&gt; I&#39;m currently injecting today&#39;s date into the classes that need it,  <br/>\n&gt; and then the tests can just use a static date. It gets pretty ugly  <br/>\n&gt; though, a lot of times this date has to be dragged along deep into  <br/>\n&gt; the domain model.<br/>\n&gt;<br/>\n </span></blockquote>I&#39;m surprised by this. In a typical web application, I&#39;d expect a  <br/>\ndesign similar to this:<br/>\n<br/>\n1. HTTP Request Handler gets current date from system clock or HTTP  <br/>\nrequest header; calls application request handler (or Controller or  <br/>\nService), passing the current date<br/>\n<br/>\n2. Application request handler determines which model class to invoke;  <br/>\ncalls its business method, passing the current date<br/>\n<br/>\n3. You&#39;ve finished!<br/>\n<br/>\nBy step 3, I would imagine that model classes are passing the date  <br/>\naround, which I find quite normal. You might want to refactor in there  <br/>\na little, possibly by introducing a domain class that represents the  <br/>\nway you interpret that date.<br/>\n<blockquote><span title=\"ireply\"> &gt; An alternative would be to take the old school approach and have a  <br/>\n&gt; static factory that everything that needs to know today&#39;s date  <br/>\n&gt; calls, and allow the unit tests to override with a test date. Of  <br/>\n&gt; course, then you run into all the other issues that dependency  <br/>\n&gt; injection solves.<br/>\n&gt;<br/>\n </span></blockquote>I used to do this, and even contributed to the Virtual Clock paper,  <br/>\nbut I now favor passing the date around. I call it the Instantaneous  <br/>\nRequest pattern: the system pretends that the entire request happens  <br/>\nin an instant, by taking a snapshot of the clock upon receiving the  <br/>\nrequest, then passing the date along as needed.<br/>\n<br/>\nOf course, as I read the remaining messages in this thread, I might  <br/>\nhave difference advice for you. :)<br/>\n----<br/>\nJ. B. (Joe) Rainsberger :: <a rel=\"nofollow\" target=\"_blank\" href=\"http://www.jbrains.ca\">http://www.jbrains.ca</a><br/>\nYour guide to software craftsmanship<br/>\nJUnit Recipes: Practical Methods for Programmer Testing<br/>\n2005 Gordon Pask Award for contributions to Agile Software Practice</div>", 
    "prevInTime": 20599, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1213832195", 
    "canDelete": false, 
    "nextInTopic": 0, 
    "prevInTopic": 20598, 
    "headers": {
        "inReplyToHeader": "PDg2MEQ0N0Y4OTA0RjYwNDFBRUVFNTVGOUI2ODQ2NjdGMTYyRDQ2RUYwNUBFWENIQU5HRS1WUzEuZWhhcm1vbnkuY29tPg==", 
        "messageIdInHeader": "PDBDNUZENDg2LTU4MTktNEY0RC05MzEyLUI1MTM1NTQwRkY2N0BnbWFpbC5jb20+", 
        "referencesHeader": "PDg2MEQ0N0Y4OTA0RjYwNDFBRUVFNTVGOUI2ODQ2NjdGMTYyRDQ2RUYwNUBFWENIQU5HRS1WUzEuZWhhcm1vbnkuY29tPg=="
    }
}
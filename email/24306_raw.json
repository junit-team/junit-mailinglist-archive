{
    "numMessagesInTopic": 30, 
    "nextInTime": 24307, 
    "senderId": "ygRPhvQzBqr3blSVT_wWaWyDTIXC-bKiJlSZECjMH5F0HEUh0yYnTd-jhMgqc8UbFCmLAdzO9JOmmp6t6HgOKo3imxqr3apH", 
    "systemMessage": false, 
    "subject": "Re: [junit] Re: Feedback requested: Impending changes to RunListener", 
    "from": "Kevin Cooney &lt;kcooney@...&gt;", 
    "authorName": "Kevin Cooney", 
    "msgSnippet": "... The JSR-305 ThreadSafe annotation appears to have @Retention(RetentionPolicy.CLASS): ", 
    "msgId": 24306, 
    "rawEmail": "Return-Path: &lt;kcooney@...&gt;\r\nReceived: (qmail 58163 invoked by uid 7800); 12 Feb 2013 19:15:03 -0000\r\nX-Sender: kcooney@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nX-Received: (qmail 7751 invoked from network); 12 Feb 2013 18:26:41 -0000\r\nX-Received: from unknown (10.193.84.135)\n  by m1.grp.bf1.yahoo.com with QMQP; 12 Feb 2013 18:26:41 -0000\r\nX-Received: from unknown (HELO mail-ia0-f173.google.com) (209.85.210.173)\n  by mta1.grp.bf1.yahoo.com with SMTP; 12 Feb 2013 18:26:41 -0000\r\nX-Received: by mail-ia0-f173.google.com with SMTP id h37so345276iak.32\n        for &lt;junit@yahoogroups.com&gt;; Tue, 12 Feb 2013 10:26:40 -0800 (PST)\r\nX-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;\n        d=google.com; s=20120113;\n        h=x-received:mime-version:in-reply-to:references:from:date:message-id\n         :subject:to:content-type:x-gm-message-state;\n        bh=soOZ4FNtA6dkdu1uLo7odo/sOfqJBbBX9zWWcO7/K/I=;\n        b=cCHO2K0r6fLbTwAqT2j5SySw+r6Bfmgdu0TtwEsMdepvJBRP909cGVEVEDzx3Wv+ne\n         hFFozSnfljKgqBpxb3DbiNwM1y8rHcYJ7D3w0Qcztq3oAwLssD1y/2HSlKNzzud573C+\n         +j2X5mdh6lXrTTp6jUvHWjw1d7bAZIqfuirScWQMUQ5XFZYcyCTQkrv8SVI151gvzN9r\n         J8zo/fYC03+M+eItN7vRCW3I4DYgbVF2eBHT+EVmtBJnJtpkGEjYnO4RMoybGyYznzVq\n         8TjRW/4irFlxaYBj2dFGik57PIgR4Ca7mFLMSWYHGa5PVxAEYXjrqn+aofSHN8Alya+o\n         3/5Q==\r\nX-Received: by 10.50.185.229 with SMTP id ff5mr5289423igc.82.1360693600652;\n Tue, 12 Feb 2013 10:26:40 -0800 (PST)\r\nMIME-Version: 1.0\r\nX-Received: by 10.43.12.195 with HTTP; Tue, 12 Feb 2013 10:26:09 -0800 (PST)\r\nIn-Reply-To: &lt;kfcvhp+d4r1@...&gt;\r\nReferences: &lt;kfcvhp+d4r1@...&gt;\r\nDate: Tue, 12 Feb 2013 10:26:09 -0800\r\nMessage-ID: &lt;CAA3E+eX6MV=oZQVbXjimWVosZcDzzECwV=5QUG+pMLK7WXxCYA@...&gt;\r\nTo: junit@yahoogroups.com\r\nX-Gm-Message-State: ALoCoQlipW+GxarnkNysksAlFoEnpgyr4bziGJpAMcdBSsxbxraHkWXdmoVCNK7Et3iC8AuymU8oV/jk9bJ5m2SCI1CuUsSEfQvvKzBfk5Syb8DF7uLruAeMA2ImcIunYcC6XRJiyODog6pewafKY37GKE51+s25E53UPGRL8pgUxyxr5nCZ+nQZE1WqgLOiSHU7IQcqxqFz\r\nX-eGroups-Msg-Info: 1:12:0:0:0\r\nFrom: Kevin Cooney &lt;kcooney@...&gt;\r\nSubject: Re: [junit] Re: Feedback requested: Impending changes to RunListener\r\nX-Yahoo-Group-Post: member; u=475263748; y=RjkDvJrisPodjEv4EZLl01vEGEDDC-m8i5Xgp_5TEmOzXynOe7IQfFTMbkhsZdvVhZGpO04o9wYgPkI\r\nX-Yahoo-Profile: kevincooney2000\r\nContent-Type: text/plain\r\nContent-Transfer-Encoding: quoted-printable\r\nX-eGroups-Approved-By: dsaff &lt;david@...&gt; via email; 12 Feb 2013 19:15:03 -0000\r\n\r\nOn Tue, Feb 12, 2013 at 12:46 AM, sschroev &lt;stephan202@...&gt; wrote:\n\n&gt;=\r\n **\n&gt;\n&gt;\n&gt; At the risk of repeating myself: my only objection is with the pa=\r\nckage in\n&gt; which said annotation resides: net.jcip.annotations instead of\n&gt;=\r\n javax.annotation.concurrent.\n&gt;\nThe JSR-305 ThreadSafe annotation appears t=\r\no have\n@Retention(RetentionPolicy.CLASS):\n\nhttps://code.google.com/p/jsr-30=\r\n5/source/browse/trunk/ri/src/main/java/javax/annotation/concurrent/ThreadSa=\r\nfe.java\n\nDo you see something different in your version?\n\nHaving RetentionP=\r\nolicy.CLASS means it can only be read via bytecode-level\npost-processing, n=\r\not via reflection:\n\nhttp://stackoverflow.com/questions/3107970/annotations-=\r\nretention-policy\n\n\n&gt; But that argument can also be made in reverse. Hence m=\r\ny suggestion to\n&gt; inspect the annotation&#39;s simple name only.\n&gt;\nThat would o=\r\nnly work if the retention policy for your ThreadSafe annotation\nwas &quot;RUNTIM=\r\nE&quot;. So if we went with this approach, we would risk someone\nmaking a change=\r\n that they believe will allow their runner to be called\nconcurrently but wo=\r\nuld still result in the calls to their runner\nbeing synchronized.\n\n-- Kevin=\r\n\n\nThat also makes the licencing discussion mood, unless one wishes to depen=\r\nd\n&gt; on jcip-annotation to provide a &quot;default&quot; or &quot;preferred&quot; version of the=\r\n\n&gt; annotation. That&#39;s fine of course. :) Though then do please mark the\n&gt; d=\r\nependency : otherwise I have to start explicitly excluding it (I derive my\n=\r\n&gt; annotations from one of the FindBugs modules mentioned in an earlier emai=\r\nl;\n&gt; no need to duplicate classes on the classpath).\n&gt;\n&gt; Cheers,\n&gt; Stephan\n=\r\n&gt;\n&gt;\n&gt; --- In junit@yahoogroups.com, &quot;tibord47&quot; wrote:\n&gt; &gt;\n&gt; &gt; Hi all junit =\r\nguys,\n&gt; &gt;\n&gt; &gt; Let me turn back to the original problem.\n&gt; &gt;\n&gt; &gt; We knew tha=\r\nt it&#39;s a good idea to let the users to annotated a custom\n&gt; listener by @Th=\r\nreadSafe if it&#39;s really thread-safe.\n&gt; &gt;\n&gt; &gt; In every other case the given =\r\nlistener is wrapped in synchronized\n&gt; listener which is package private cla=\r\nss.\n&gt; &gt;\n&gt; &gt; I am convinced that we should not make synchronized listener pu=\r\nblic\n&gt; since this is our internal patch.\n&gt; &gt;\n&gt; &gt; The user may have whatever=\r\n thread-safe listener depending on\n&gt; implementation and still not having it=\r\n synchronized. Thus s/he can\n&gt; annotated the clas by @ThreadSafe.\n&gt; &gt; We ar=\r\ne synchronizing the listener&#39;s methods internally in the patch only\n&gt; becau=\r\nse the user&#39;s implementation is unknown -listener in not annotated yet.\n&gt; &gt;=\r\n\n&gt; &gt; Back to jcip-annotations license. Such library is under Creative Commo=\r\nns\n&gt; Attribution License (http://creativecommons.org/licenses/by/2.5).\n&gt; &gt;\n=\r\n&gt; &gt; If we use Maven dependency, we are free to share, distribute and\n&gt; tran=\r\nsmit.\n&gt; &gt; So there is no legal issue for the JUnit.\n&gt; &gt;\n&gt; &gt; Any objections =\r\nto this lincense?\n&gt; &gt;\n&gt; &gt; Thx, Tibor\n&gt; &gt;\n&gt; &gt;\n&gt; &gt;\n&gt; &gt; --- In junit@yahoogrou=\r\nps.com, &quot;sschroev&quot; wrote:\n&gt; &gt; &gt;\n&gt; &gt; &gt; I understand your concerns w.r.t. the=\r\n intended semantics of\n&gt; third-party @ThreadSafe annotations. For that reas=\r\non I could certainly get\n&gt; behind a differently-named annotation such as @C=\r\noncurrent. Adding one more\n&gt; annotation is cheap, after all ;)\n&gt; &gt; &gt;\n&gt; &gt; &gt; =\r\nCheers,\n&gt; &gt; &gt; Stephan\n&gt; &gt; &gt;\n&gt; &gt; &gt; --- In junit@yahoogroups.com, Kevin Coone=\r\ny wrote:\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; On Wed, Feb 6, 2013 at 10:06 AM, sschroev wrote:\n&gt;=\r\n &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; **\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; I like the idea, a lot!\n&gt;=\r\n &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; But would like to ask that only the *simple name* of the=\r\n\n&gt; annotation is\n&gt; &gt; &gt; &gt; &gt; considered, without regard for the package in wh=\r\nich it resides.\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; Interesting idea.\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; It look=\r\ns like Guice uses this strategy for @Nullable (\n&gt; &gt; &gt; &gt; https://code.google=\r\n.com/p/google-guice/wiki/UseNullable)\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; That would require us=\r\n to iterate through all of the class&#39;s\n&gt; annotations, vs\n&gt; &gt; &gt; &gt; a simple g=\r\netAnnotation() call, but listeners are not added and\n&gt; removed very\n&gt; &gt; &gt; &gt;=\r\n often.\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; This way one can:\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; 1. Use an a=\r\nlternative third-party annotation, such as\n&gt; &gt; &gt; &gt; &gt; javax.annotation.concu=\r\nrrent.ThreadSafe from libraries like\n&gt; &gt; &gt; &gt; &gt; com.google.code.findbugs:jsr=\r\n305:1.3.9 and\n&gt; &gt; &gt; &gt; &gt; com.google.code.findbugs:annotations:2.0.1.\n&gt; &gt; &gt; &gt;=\r\n &gt; 2. Define a private annotation, without adding _any_ additional\n&gt; depend=\r\nency.\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; Alternatively, we could add a JUnit-specific annota=\r\ntion (possibly\n&gt; named\n&gt; &gt; &gt; &gt; &quot;Concurrent&quot;) and you could annotate your cl=\r\nass with both\n&gt; annotations (ob\n&gt; &gt; &gt; &gt; meme: http://www.quickmeme.com/meme=\r\n/3svo5h/)\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; One reservation I have with using @ThreadSafe is =\r\nthat usually the\n&gt; &gt; &gt; &gt; jcip-annotations documents behavior (sure, it is u=\r\nsed by findbugs to\n&gt; find\n&gt; &gt; &gt; &gt; potential bugs, but that&#39;s validation bas=\r\ned on behavior documented in\n&gt; &gt; &gt; &gt; annotations). Here we are proposing us=\r\ning @ThreadSafe to modify\n&gt; behavior.\n&gt; &gt; &gt; &gt; Someone might not expect by s=\r\nimply adding an annotation to a class\n&gt; they are\n&gt; &gt; &gt; &gt; changing the behav=\r\nior of code that uses instances of the class.\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; I=\r\n use javax.annotation.concurrent.ThreadSafe quite a lot in my own\n&gt; code,\n&gt;=\r\n &gt; &gt; &gt; &gt; so (1) is quite important from my perspective. There are\n&gt; precede=\r\nnts for\n&gt; &gt; &gt; &gt; &gt; this approach: IIRC, Eclipse does something like this for=\r\n\n&gt; variations on\n&gt; &gt; &gt; &gt; &gt; @Nullable and @Nonnull, whereas (again, IIRC) Fi=\r\nndbugs handles two\n&gt; &gt; &gt; &gt; &gt; instances of @SuppressWarnings.\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; =\r\n&gt; &gt; &gt; Cheers,\n&gt; &gt; &gt; &gt; &gt; Stephan\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; --- In junit@=\r\nyahoogroups.com, Kevin Cooney wrote:\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; Hello, everyon=\r\ne\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; Short version: we are thinking of adding an optio=\r\nnal dependency\n&gt; from\n&gt; &gt; &gt; &gt; &gt; JUnit\n&gt; &gt; &gt; &gt; &gt; &gt; to jcip-annotations and a=\r\nre soliciting feedback.\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; A few people have noticed t=\r\nhat when you use ParallelComputer,\n&gt; you got\n&gt; &gt; &gt; &gt; &gt; poor\n&gt; &gt; &gt; &gt; &gt; &gt; per=\r\nformance because calls to registered RunListeners are\n&gt; synchronized. We\n&gt; =\r\n&gt; &gt; &gt; &gt; &gt; would like to fix this in the next release of JUnit.\n&gt; &gt; &gt; &gt; &gt; &gt;\n=\r\n&gt; &gt; &gt; &gt; &gt; &gt; In order to prevent affecting existing users, we are proposing\n=\r\n&gt; having an\n&gt; &gt; &gt; &gt; &gt; &gt; annotation that can be added to RunListener impleme=\r\nntations that\n&gt; can\n&gt; &gt; &gt; &gt; &gt; safely\n&gt; &gt; &gt; &gt; &gt; &gt; be called concurrently fro=\r\nm multiple threads. If a RunListener\n&gt; passed to\n&gt; &gt; &gt; &gt; &gt; a\n&gt; &gt; &gt; &gt; &gt; &gt; Ru=\r\nnNotifier is not annotated with this annotation, JUnit will\n&gt; wrap it\n&gt; &gt; &gt;=\r\n &gt; &gt; with\n&gt; &gt; &gt; &gt; &gt; &gt; a decorator that does synchronization.\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; =\r\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; We would appreciate feedback on this new annotation.\n=\r\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; We have two options:\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; a. Cre=\r\nate our own annotation for this\n&gt; &gt; &gt; &gt; &gt; &gt; b. Use ThreadSafe (\n&gt; &gt; &gt; &gt; &gt; &gt;=\r\n\n&gt; &gt; &gt; &gt; &gt;\n&gt; http://grepcode.com/file/repo1.maven.org/maven2/net.jcip/jcip-=\r\nannotations/1.0/net/jcip/annotations/ThreadSafe.java\n&gt; &gt; &gt; &gt; &gt; &gt; )\n&gt; &gt; &gt; &gt; =\r\n&gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; The advantages to option b are:\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; 1. =\r\nIt&#39;s a well-known annotation\n&gt; &gt; &gt; &gt; &gt; &gt; 2. Users that use JUnit can add th=\r\nis annotation to their\n&gt; thread-safe\n&gt; &gt; &gt; &gt; &gt; &gt; RunListener implementation=\r\ns today and get the benefits &quot;for\n&gt; free&quot; later.\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; No=\r\nte we can do this without requiring that all users of JUnit\n&gt; have the\n&gt; &gt; =\r\n&gt; &gt; &gt; &gt; jcip-annotations jar in their classpath as of JDK 1.5.0_06 (see\n&gt; &gt;=\r\n &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt;\n&gt; http://stackoverflow.com/questions/3567413/why-doesnt-=\r\na-missing-annotation-cause-a-classnotfoundexception-at-runtime\n&gt; &gt; &gt; &gt; &gt; ).=\r\n\n&gt; &gt; &gt; &gt; &gt; &gt; If jcip-annotations is not on the classpath then all RunListen=\r\ner\n&gt; &gt; &gt; &gt; &gt; &gt; implementations will be treated as not thread-safe.\n&gt; &gt; &gt; &gt; =\r\n&gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; As a specific example, the Maven Surefire plugin would use =\r\nthis\n&gt; &gt; &gt; &gt; &gt; dependency\n&gt; &gt; &gt; &gt; &gt; &gt; and include jcip-annotations.\n&gt; &gt; &gt; &gt;=\r\n &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; Currently, JUnit only depends on one third-party library\n&gt;=\r\n (Hamcrest). This\n&gt; &gt; &gt; &gt; &gt; &gt; has caused us some pain in the past when the =\r\nHamcrest code\n&gt; changed in\n&gt; &gt; &gt; &gt; &gt; ways\n&gt; &gt; &gt; &gt; &gt; &gt; that broke existing u=\r\nsers of JUnit. We believe this will not be\n&gt; an issue\n&gt; &gt; &gt; &gt; &gt; &gt; with jcip=\r\n-annotations because the JAR only contains annotations,\n&gt; not any\n&gt; &gt; &gt; &gt; &gt;=\r\n &gt; code.\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; One possible concern would be with other o=\r\npen source libraries\n&gt; that\n&gt; &gt; &gt; &gt; &gt; provide\n&gt; &gt; &gt; &gt; &gt; &gt; RunListener imple=\r\nmentations (they would need to add\n&gt; jcip-annotations to\n&gt; &gt; &gt; &gt; &gt; &gt; their =\r\ncompile-time classpath if they have thread-safe\n&gt; annotations, and\n&gt; &gt; &gt; &gt; =\r\n&gt; &gt; document this to their users).\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; Thoughts?\n&gt; &gt; &gt; =\r\n&gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; -- Kevin\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; [Non-text po=\r\nrtions of this message have been removed]\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt;\n&gt;=\r\n &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; [Non-text portions of this message have be=\r\nen removed]\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt;\n&gt; &gt;\n&gt;\n&gt;  \n&gt;\n\n\n[Non-text portions of this message =\r\nhave been removed]\n\n\n", 
    "profile": "kevincooney2000", 
    "topicId": 24274, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 475263748, 
    "prevInTime": 24305, 
    "contentTrasformed": false, 
    "postDate": "1360693569", 
    "canDelete": false, 
    "nextInTopic": 24313, 
    "prevInTopic": 24305, 
    "headers": {
        "inReplyToHeader": "PGtmY3ZocCtkNHIxQGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PENBQTNFK2VYNk1WPW9aUVZiWGppbVdWb3NaY0R6ekVDd1Y9NVFVRytwTUxLN1dYeENZQUBtYWlsLmdtYWlsLmNvbT4=", 
        "referencesHeader": "PGtmY3ZocCtkNHIxQGVHcm91cHMuY29tPg=="
    }
}
{
    "topicId": 23967, 
    "postDate": "1347274655", 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "from": "Brett Delle Grazie &lt;bdellegrazie@...&gt;", 
    "canDelete": false, 
    "replyTo": "LIST", 
    "senderId": "dHSOO7rCUymxtML22oE8k8WGMu4zPDVbRHHUG7Bd0TLCYrsThCetj-dOcB4iq9bym2N7SBKCUMp0Ov-2oYiNrpq0IzLNK2r3vywnkoj6Ggo", 
    "nextInTime": 23996, 
    "userId": 79191679, 
    "prevInTime": 23994, 
    "prevInTopic": 23992, 
    "headers": {
        "inReplyToHeader": "PGsyaTJrbitidnJrQGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PENBQ0xEMD03aC1nLXhKdXFHNFdPSD03NWZPNGJZbjdTUXBnWSs4X1ZlVWQ1Um15V1N5Z0BtYWlsLmdtYWlsLmNvbT4=", 
        "referencesHeader": "PENBT3BoZ0pEVD1BVGg4enVELVYtPW9SVjM1cFVGcDh3R2lXOW5CWG9OZTNqTnFhNnEyd0BtYWlsLmdtYWlsLmNvbT4JPGsyaTJrbitidnJrQGVHcm91cHMuY29tPg=="
    }, 
    "authorName": "Brett Delle Grazie", 
    "numMessagesInTopic": 12, 
    "msgSnippet": "... Except when using an IDE, there I just want to: (1) select an individual test and have that run in a Debugger. Or (2) select a suite or class hierarchy and", 
    "contentTrasformed": false, 
    "msgId": 23995, 
    "nextInTopic": 0, 
    "systemMessage": false, 
    "rawEmail": "Return-Path: &lt;brett.dellegrazie@...&gt;\r\nReceived: (qmail 14477 invoked by uid 7800); 10 Sep 2012 13:26:08 -0000\r\nX-Sender: brett.dellegrazie@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nX-Received: (qmail 63033 invoked from network); 10 Sep 2012 10:57:36 -0000\r\nX-Received: from unknown (98.137.34.46)\n  by m5.grp.sp2.yahoo.com with QMQP; 10 Sep 2012 10:57:36 -0000\r\nX-Received: from unknown (HELO mail-ob0-f182.google.com) (209.85.214.182)\n  by mta3.grp.sp2.yahoo.com with SMTP; 10 Sep 2012 10:57:36 -0000\r\nX-Received: by obbun3 with SMTP id un3so3388154obb.13\n        for &lt;junit@yahoogroups.com&gt;; Mon, 10 Sep 2012 03:57:35 -0700 (PDT)\r\nMIME-Version: 1.0\r\nX-Received: by 10.60.26.133 with SMTP id l5mr13880253oeg.60.1347274655844; Mon,\n 10 Sep 2012 03:57:35 -0700 (PDT)\r\nX-Received: by 10.76.69.168 with HTTP; Mon, 10 Sep 2012 03:57:35 -0700 (PDT)\r\nIn-Reply-To: &lt;k2i2kn+bvrk@...&gt;\r\nReferences: &lt;CAOphgJDT=ATh8zuD-V-=oRV35pUFp8wGiW9nBXoNe3jNqa6q2w@...&gt;\n\t&lt;k2i2kn+bvrk@...&gt;\r\nDate: Mon, 10 Sep 2012 11:57:35 +0100\r\nMessage-ID: &lt;CACLD0=7h-g-xJuqG4WOH=75fO4bYn7SQpgY+8_VeUd5RmyWSyg@...&gt;\r\nTo: junit@yahoogroups.com\r\nContent-Type: text/plain; charset=windows-1252\r\nContent-Transfer-Encoding: quoted-printable\r\nX-eGroups-Msg-Info: 1:12:0:0:0\r\nX-eGroups-From: Brett Delle Grazie &lt;brett.dellegrazie@...&gt;\r\nFrom: Brett Delle Grazie &lt;bdellegrazie@...&gt;\r\nReply-To: bdellegrazie@...\r\nSubject: Re: [junit] Re: Tests starting before Logback initialisation complete\n when run in parallel\r\nX-Yahoo-Group-Post: member; u=79191679\r\nX-eGroups-Approved-By: dsaff &lt;david@...&gt; via email; 10 Sep 2012 13:26:08 -0000\r\n\r\nOn 9 September 2012 13:38, hkaipe &lt;hkaipe@...&gt; wrote:\n&gt; --- In junit@=\r\nyahoogroups.com, C=C3=A9dric Beust =E2=99&quot; &lt;cedric@...&gt; wrote:\n&gt;&gt;\n&gt;&gt; On Thu=\r\n, Sep 6, 2012 at 10:38 AM, hkaipe &lt;hkaipe@...&gt; wrote:\n&gt;&gt;\n&gt;&gt; &gt; Surefire is y=\r\nour tool to organize which tests to run when and how.\n&gt;&gt;\n\nExcept when using=\r\n an IDE, there I just want to:\n(1) select an individual test and have that =\r\nrun in a Debugger. Or\n(2) select a suite or class hierarchy and have the ou=\r\ntput appear in\nthe JUnit window (and log window if appropriate) confirming =\r\nthings are\nstill working.\n\n&gt;&gt;\n&gt;&gt; Right, which is why I think a @BeforeSuite=\r\n annotation belongs to the\n&gt;&gt; testing framework, not the build tool. How wo=\r\nuld your build tool create a\n&gt;&gt; connection pool or an executor for your tes=\r\nts to use?\n\nAgree completely here, with the caveat that _most_ situations w=\r\nould\nprobably be catered for by @BeforeClass.\n\nQ: In multi-threaded mode: a=\r\nre multiple threads used to run the\n@BeforeClass code?\n\n&gt;&gt;\n&gt;&gt; --\n&gt;&gt; C=E9dri=\r\nc\n&gt;\n&gt; I can see value in a @BeforeSuite-annotation but in general I think t=\r\nest-suites should be administered by the build-tool. - In this case SureFir=\r\ne, which perhaps should support some suite/category-solution that can be ap=\r\nplied to many test-frameworks, not only JUnit.\n\nI agree partially here. Tes=\r\nts should easily selectable within an IDE,\nin particular I want to be able =\r\nto debug a specific test or run all\ntests with the same convenience that I =\r\ncan execute the debugger\nagainst the main project.\nUsing Maven + Surefire r=\r\nesults in added complexity that isn&#39;t really necessary.\nThis fails with the=\r\n IDE use case - IDE users quite often want to\nexecute a suite or all tests =\r\nor a particular set of tests simply by\ngrouping... then they want to debug =\r\nwithin that set.\n\n&gt;\n&gt; But Brett&#39;s particular problem is not limited to a te=\r\nst-suite or testing framework. It goes beyond testing. - He can accidently =\r\nencounter it whenever he starts up a multi-threaded JVM, therewith making J=\r\nVM-startup his problem domain. Therefore I think that using a javaagent wou=\r\nld be a good pattern and - yes - my build tool can do that ... - In the Sur=\r\nefire-configuration you specify an &quot;argLine&quot; for the JVM:\n\nI disagree here.=\r\n\nIn applications (web or console based) I can already control\nprogrammatica=\r\nlly how the logging apparatus is instantiated, meaning\nthis isn&#39;t an issue\n=\r\nfor me in the normal case. When using JUnit in parallel test mode I\ncan&#39;t c=\r\nontrol this at all\n\n&gt;\n&gt; &lt;plugin&gt;\n&gt; &lt;artifactId&gt;maven-surefire-plugin&lt;/artif=\r\nactId&gt;\n&gt; &lt;configuration&gt;\n&gt; &lt;argLine&gt; -javaagent:${localRepository}/path/to/=\r\nmyagent/1.0-SNAPSHOT/myagent-1.0-SNAPSHOT.jar &lt;/argLine&gt;\n&gt; &lt;/configuration&gt;=\r\n\n&gt; &lt;/plugin&gt;\n&gt;\n&gt; In the &quot;Premain-Class&quot; of &quot;myagent&quot; we can define JVM-wide=\r\n setup and/or tearDown - e.g.\n&gt;\n&gt; public class GlobalTearDown extends Threa=\r\nd\n&gt; {\n&gt; public static void premain(String args)\n&gt; {\n&gt; System.out.println(&quot;H=\r\nELLO FROM premain&quot;);\n&gt; Runtime.getRuntime().addShutdownHook(new GlobalTearD=\r\nown());\n&gt; }\n&gt;\n&gt; public void run()\n&gt; {\n&gt; System.out.println(&quot;TEAR-DOWN EXECU=\r\nTES HERE&quot;);\n&gt; }\n&gt; }\n&gt;\n&gt; Output from Maven/Surefire when &quot;GlobalTearDown&quot; is=\r\n used as &quot;Premain-Class&quot;:\n&gt; -----------------------------------------------=\r\n----------------------\n&gt; [surefire:test]\n&gt; Surefire report directory: /home=\r\n/me/projects/experiments/target/surefire-reports\n&gt; HELLO FROM premain\n&gt;\n&gt; -=\r\n------------------------------------------------------\n&gt;  T E S T S\n&gt; -----=\r\n--------------------------------------------------\n&gt; Running org.callbackpa=\r\nrams.experiments.DummyTest\n&gt; Tests run: 1, Failures: 0, Errors: 0, Skipped:=\r\n 0, Time elapsed: 0.029 sec\n&gt;\n&gt; Results :\n&gt;\n&gt; Tests run: 1, Failures: 0, Er=\r\nrors: 0, Skipped: 0\n&gt;\n&gt; TEAR-DOWN EXECUTES HERE\n&gt; -------------------------=\r\n--------------------------------------------\n&gt;\n&gt; I don&#39;t know how the &quot;Prem=\r\nain-Class&quot; should look to solve Brett&#39;s problem but I&#39;m quite sure the prob=\r\nlem can be elegantly solved with this pattern. - And his solution can perha=\r\nps be easily reused in other projects as well as outside of the testing act=\r\nivities.\n&gt;\n&gt; /Henrik\n&gt;\n\nI appreciate you&#39;ve gone to great lengths to propos=\r\ne a general &#39;fits\nall&#39; category of solution but I am concerned about the un=\r\nintended\nconsequences such\nbehaviour might introduce (there might be none a=\r\nnd I fully admit that\nI don&#39;t rightly know). I do know that this type of sh=\r\nutdown hook\nprocessing is the\nwrong solution for web applications (they sho=\r\nuld hook into the\ncontainer life-cycle for such tasks).\n\nEssentially we&#39;re =\r\ntalking about controlled initialisation and shutdown\nof an application usin=\r\ng whatever is the appropriate life-cycle. In\nthis context the\nlife-cycle is=\r\n the initialisation and shutdown of JUnit or whatever\ntesting framework bei=\r\nng used.\n\nContainers / Frameworks that support multi-threading usually have=\r\n a\nsingle-threaded initialisation and shutdown phases to enforce\ndeterminis=\r\ntic behaviour\nduring these critical phases before going into full mutli-thr=\r\neaded mode.\n\nWe are talking about a very specific case of behaviour which i=\r\ns\nultimately caused by parallel test execution without a guaranteed\ndetermi=\r\nnistic stable\ninitialisation phase. It boils down to the simple fact that t=\r\nhere is a\nuse case for something similar to:\n@BeforeAll / @AfterAll (or any=\r\n appropriate naming)\nThese should be executed serially rather than multi-th=\r\nreaded and\nconsidered &#39;reserved&#39; only for special global setup / tear-down\n=\r\noperations that must\nbe executed under single-threading conditions.\n\nWhat&#39;s=\r\n more, this should work out of the box with any IDE.\n\nAs David et. al. have=\r\n indicated already this is technically possible by using:\n(1) A common base=\r\n class and locking\nOR\n(2) Annotating all classes with a special rule and us=\r\ning locking\n\nThe problem with this solution is its logically in reverse. I =\r\nwould\nlike the startup / teardown behaviour applied automatically rather\nth=\r\nan me\nhaving to decorate classes accordingly or use a specific base class.\n=\r\nUse of a special Runner is possible I guess but would break in a IDE\n(which=\r\n typically uses its own runner).\n\nEssentially I guess this is a necessary s=\r\ntart-up &#39;aspect&#39;  - which I\nsuspect is, in the main, the idea you&#39;re propos=\r\ning by using a Java\nAgent\n\nIrrespective however, the discussion is most int=\r\neresting.\n\n-- \nBest Regards,\n\nBrett Delle Grazie\n\n", 
    "subject": "Re: [junit] Re: Tests starting before Logback initialisation complete when run in parallel"
}
{
    "numMessagesInTopic": 4, 
    "nextInTime": 5694, 
    "senderId": "G8ogU-zH4lIhIlnz8yBeP6_vFvxUqsjYubCMHs0Mp42MgSZ2KPCkIwzwt4JhMomGjIuw6itS0l5kzrOl9N6fO1Y4F04IZvIcg04", 
    "systemMessage": false, 
    "subject": "Re: Unit testing multithreaded network code", 
    "from": "&quot;weitzman_d&quot; &lt;weitzman_d@...&gt;", 
    "authorName": "weitzman_d", 
    "msgSnippet": "Thanks a lot so far.  I ve created MockServerSocket and now my code is able to reliably verify that a socket connection would be accept() ed by the", 
    "msgId": 5693, 
    "rawEmail": "Return-Path: &lt;weitzman_d@...&gt;\r\nReceived: (qmail 20524 invoked from network); 1 Sep 2002 19:01:28 -0000\r\nReceived: from unknown (66.218.66.216)\n  by m13.grp.scd.yahoo.com with QMQP; 1 Sep 2002 19:01:28 -0000\r\nReceived: from unknown (HELO n18.grp.scd.yahoo.com) (66.218.66.73)\n  by mta1.grp.scd.yahoo.com with SMTP; 1 Sep 2002 19:01:28 -0000\r\nX-eGroups-Return: weitzman_d@...\r\nReceived: from [66.218.67.164] by n18.grp.scd.yahoo.com with NNFMP; 01 Sep 2002 19:01:28 -0000\r\nX-Sender: weitzman_d@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (EGP: mail-8_1_0_1); 1 Sep 2002 18:49:21 -0000\r\nReceived: (qmail 3799 invoked from network); 1 Sep 2002 18:49:20 -0000\r\nReceived: from unknown (66.218.66.218)\n  by m10.grp.scd.yahoo.com with QMQP; 1 Sep 2002 18:49:20 -0000\r\nReceived: from unknown (HELO n14.grp.scd.yahoo.com) (66.218.66.69)\n  by mta3.grp.scd.yahoo.com with SMTP; 1 Sep 2002 18:49:20 -0000\r\nReceived: from [66.218.67.150] by n14.grp.scd.yahoo.com with NNFMP; 01 Sep 2002 18:49:20 -0000\r\nDate: Sun, 01 Sep 2002 18:49:18 -0000\r\nTo: junit@yahoogroups.com\r\nSubject: Re: Unit testing multithreaded network code\r\nMessage-ID: &lt;aktnfe+b5a0@...&gt;\r\nIn-Reply-To: &lt;F60avjrRZ1UbDBRArVc000002e5@...&gt;\r\nUser-Agent: eGroups-EW/0.82\r\nMIME-Version: 1.0\r\nContent-Type: text/plain; charset=ISO-8859-1\r\nContent-Length: 4210\r\nX-Mailer: Yahoo Groups Message Poster\r\nFrom: &quot;weitzman_d&quot; &lt;weitzman_d@...&gt;\r\nX-Yahoo-Group-Post: member; u=92631008\r\nX-Yahoo-Profile: weitzman_d\r\nX-eGroups-Approved-By: clarkware &lt;mike@...&gt; via web; 01 Sep 2002 19:01:23 -0000\r\n\r\nThanks a lot so far.  I&#39;ve created MockServerSocket and now my code \nis able to reliably verify that a socket connection would be accept()\ned by the ConnectionService at least.  I still can&#39;t think of a way \nto test that the accept()ed connection is then passed to the \nConnectionHandler (because of the slight delay after accepting).  I \nthink  you may have addressed that issue, but I&#39;m not quite sure what \nyou mean by\n\n&quot;This could be achieved by creating a wrapper on a socket in the real \ncode.  this wrapper simply has the responsibility to make connect() \ncalls to the  ConnectionService whenever a real socket connection is \nmade.&quot;\n\nSince you say &#39;in the real code&#39;, you must not be talking about a \nMockServerSocket.  Can you expand?\n\nThanks a lot.  I&#39;ve already improved the test tenfold.\n\nDavid Weitzman\n\n--- In junit@y..., &quot;Matthew Cooke&quot; &lt;mpcooke3@h...&gt; wrote:\n&gt; Hi.\n&gt; \n&gt; I have spent some time thinking about the problems involved with \ntesting \n&gt; multithreaded code. As we have had similar problems at work in the \npast.\n&gt; \n&gt; The problem is that the monitor-threads model in Java is fairly \neasy to \n&gt; understand to start with, but becomes difficult to apply safely in \nlarge \n&gt; scale systems. This problem is futher compounded by the fact that \nunit \n&gt; testing becomes difficult/impossible, either you test the threaded \nbehaviour \n&gt; and have horrible join() sleep() code or you ignore the threading \naspects. \n&gt; Even if you unit test everything the threading behaviour of a \nsystem is \n&gt; still not captured because the &#39;Unit Tests&#39; test Objects and \nparellelism is \n&gt; not contained within objects in the threading model.\n&gt; \n&gt; I am sure if java used the more modern CSP (Communicating \nSequential \n&gt; Processes) model then writing junit tests would be much simpler as \neach bit \n&gt; of code could be tested outside of a parrallel system. Eg, The \nparallelism \n&gt; would not be hidden inside an object or spread across multiple \nobjects. \n&gt; Hence Unit testing and Mock CSP Objects could easily be used.\n&gt; \n&gt; Anyway - I digress.\n&gt; \n&gt; I think how I would address the problems you are having by testing \n&gt; separately the socket connection code and the behavoiur you want \nthe \n&gt; ConnectionService to have.\n&gt; \n&gt; This could be achieved by creating a wrapper on a socket in the \nreal code. \n&gt; this wrapper simply has the responsibility to make connect() calls \nto the \n&gt; ConnectionService whenever a real socket connection is made.\n&gt; \n&gt; Now the tests on connectionService become non-threaded and non-\nnetwork \n&gt; related. calls made to connect should cause the mockFactory to \ncreate an \n&gt; object. A call to stopListening should cause the mockSocketWrapper \nto be \n&gt; asked to close.\n&gt; \n&gt; You could still test the &#39;real&#39; behaviour of the socket itself by \ntesting \n&gt; the socketWrapper although I wouldn&#39;t bother. I accept that some \nsimple \n&gt; wrappers on java libraries don&#39;t need testing becauase hopefully \nthey are \n&gt; not buggy ;)\n&gt; \n&gt; Matt.\n&gt; \n&gt; From: &quot;weitzman_d&quot; &lt;weitzman_d@y...&gt;\n&gt; Reply-To: junit@y...\n&gt; To: junit@y...\n&gt; Subject: [junit] Unit testing multithreaded network code\n&gt; Date: Thu, 29 Aug 2002 21:05:59 -0000\n&gt; \n&gt; I&#39;ve asked this question at javaranch.com, so I&#39;ll just provide an\n&gt; brief description here and point to the original question for anyone\n&gt; who wants to give it a shot (just reply on this list though).\n&gt; \n&gt; I&#39;m writing the beginnings of a multithreaded server, and I had to\n&gt; insert a lot of calls to Thread.sleep() in my unit testing code for\n&gt; it to pass.  Is there some good way to test multithreaded code that\n&gt; doesn&#39;t invole just waiting a few milliseconds and hoping that a \ntask\n&gt; finished?  I imagine that a better solution might involve calls to\n&gt; join() but tie the unit test closely to the particular \nimplementation.\n&gt; \n&gt; Anyway, here&#39;s the original question with my current, unsatisfactory\n&gt; test (although it doesn&#39;t have much of the code being tested - I\n&gt; didn&#39;t want to clutter the post.  I should add some.):\n&gt; \n&gt; http://saloon.javaranch.com/cgi-bin/ubb/ultimatebb.cgi?\n&gt; ubb=get_topic&f=9&t=001390\n&gt; \n&gt; \n&gt; \n&gt; \n&gt; \n&gt; \n&gt; _________________________________________________________________\n&gt; Chat with friends online, try MSN Messenger: \nhttp://messenger.msn.com\n\n\n\n", 
    "profile": "weitzman_d", 
    "topicId": 5689, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 92631008, 
    "prevInTime": 5692, 
    "contentTrasformed": false, 
    "postDate": "1030906158", 
    "canDelete": false, 
    "nextInTopic": 5702, 
    "prevInTopic": 5691, 
    "headers": {
        "inReplyToHeader": "PEY2MGF2anJSWjFVYkRCUkFyVmMwMDAwMDJlNUBob3RtYWlsLmNvbT4=", 
        "messageIdInHeader": "PGFrdG5mZStiNWEwQGVHcm91cHMuY29tPg=="
    }
}
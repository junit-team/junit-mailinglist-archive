{
    "numMessagesInTopic": 3, 
    "nextInTime": 2248, 
    "senderId": "YxpcTqCxxtbUfKdrsjx74N2GNBxgJnMkIHOWgndDth7c7hsX33vZu559TrscVzsj8xhiH_ToFqTZSkjvtNJ5i2aRe45hktd7U1CsCYI", 
    "systemMessage": false, 
    "subject": "cast exception during run time", 
    "from": "&quot;Dineshram&quot; &lt;dineshram@...&gt;", 
    "authorName": "Dineshram", 
    "msgSnippet": "I have to test the following java handler public class DailyListingSplitHandler extends StatsHandler { private Connection conn; private CallableStatement", 
    "msgId": 2247, 
    "topicId": 2247, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 0, 
    "messageBody": "<div id=\"ygrps-yiv-683205313\">I have to test the following java handler<br/>\n<br/>\npublic class DailyListingSplitHandler extends StatsHandler {<br/>\n<br/>\n    private Connection conn;<br/>\n    private CallableStatement cstmt;<br/>\n    private Statement stmt;<br/>\n    private ResultSet rs;<br/>\n    private String procCallStmt;<br/>\n    private String temp;<br/>\n    private String temp1;<br/>\n    private String temp2;<br/>\n    private int len;<br/>\n    private int len1;<br/>\n<br/>\n    private String next;<br/>\n<br/>\n<br/>\n  final static String className = DailyListingSplitHandler.class.getName();<br/>\n  final static Category CAT = Category.getInstance(className);<br/>\n  final static Category DB = Category.getInstance(className+&quot;.DB&quot;);<br/>\n<br/>\n<br/>\n    private String dateString;<br/>\n<br/>\n    public DailyListingSplitHandler (String next,<br/>\n                                          HttpServletRequest request,<br/>\n                                          HttpServletResponse response,<br/>\n                                          ServletContext context,<br/>\n                                          DatabaseObject dbobj) {<br/>\n        super (request, response, context, dbobj);<br/>\n        this.next = next;<br/>\n    }<br/>\n<br/>\n    public String processRequest() throws<br/>\n                ServletException, IOException {<br/>\n            //-------CAT.info(&quot;request from ip: &quot;+request.getRemoteAddr());<br/>\n            try {<br/>\n                conn = databaseObj.getConnection();<br/>\n            } catch (Exception se) {<br/>\n                DB.error(&quot;failed to get connection&quot;, se);<br/>\n            }<br/>\n<br/>\n            try<br/>\n            {<br/>\n                SimpleDateFormat simpleDateFormat = new<br/>\nSimpleDateFormat(&quot;yyyy-MM-dd&quot;);<br/>\n                java.util.Date date= new java.util.Date();<br/>\n                String dateString = simpleDateFormat.format(date);<br/>\n<br/>\n<br/>\n                com.nqb.ps.otcstats.HandlerSearchResultBean dailyResultBean<br/>\n=<br/>\n                                    new<br/>\ncom.nqb.ps.otcstats.HandlerSearchResultBean();<br/>\n                GregorianCalendar cal = new GregorianCalendar();<br/>\n                cal.setTime(new java.util.Date());<br/>\n                cal.roll(Calendar.DAY_OF_YEAR, -7);<br/>\n                java.util.Date fromDate = cal.getTime();<br/>\n                String fromdate = simpleDateFormat.format(fromDate);<br/>\n<br/>\n                procCallStmt = &quot;{call history_by_date(?,?,?)}&quot;;<br/>\n                DB.info(&quot;call<br/>\nhistory_by_date(&quot;+dateString+&quot;,&quot;+dateString+&quot;,L)&quot;);<br/>\n                try {<br/>\n                cstmt = conn.prepareCall(procCallStmt);<br/>\n                cstmt.setString(1, fromdate);<br/>\n                cstmt.setString(2, dateString);<br/>\n                cstmt.setString(3,&quot;L&quot;);<br/>\n                    rs = cstmt.executeQuery();<br/>\n                } catch(SQLException sqle) {<br/>\n                    DB.error(&quot;Failed to execute query&quot;, sqle);<br/>\n                    next = Links.ERROR_PAGE;<br/>\n                } catch(Exception e) {<br/>\n                    DB.error(&quot;general Exception while executing the query&quot;,<br/>\ne);<br/>\n                    next = Links.ERROR_PAGE;<br/>\n                }<br/>\n<br/>\n<br/>\n               while(rs.next())<br/>\n<br/>\n                {<br/>\n                    temp = (rs.getString(18) == null ||<br/>\nrs.getString(18).trim().equals(&quot;&quot;)) ? &quot;N/A&quot; :<br/>\n(rs.getString(18).startsWith(&quot;3&quot;)?<br/>\nrs.getString(18).substring(1):rs.getString(18));<br/>\n                    temp = temp.trim();<br/>\n                    len = temp.length();<br/>\n                    len1 = 0;<br/>\n                    while(!(temp.charAt(len1)==&#39;;&#39;)&&(len1 &lt; len-1))<br/>\n                    {<br/>\n                        len1++;<br/>\n                    }<br/>\n<br/>\n                    if(len1+1 == len)<br/>\n                    temp = (rs.getString(18) == null ||<br/>\nrs.getString(18).trim().equals(&quot;&quot;)) ? &quot;N/A&quot; :<br/>\n(rs.getString(18).startsWith(&quot;3&quot;)?<br/>\nrs.getString(18).substring(1):rs.getString(18));<br/>\n                    else<br/>\n                    temp = temp.substring(0,len1);<br/>\n<br/>\n                    String comp = rs.getString(16).trim();<br/>\n                    if(comp.equals(&quot;Unknown<br/>\nCompany&quot;)||comp.equals(&quot;Unmatched Company&quot;)||comp.equals(&quot;&quot;)||comp==null)<br/>\n                        comp = rs.getString(17);<br/>\n<br/>\n<br/>\n                    CAT.debug(&quot;creating bean HandlerSearchResultBeanRow<br/>\nusing parameters: null, &quot;+<br/>\n                                rs.getString(1)+<br/>\n                                &quot;,&quot;+<br/>\n                                ((rs.getString(3) == null ||<br/>\nrs.getString(3).trim().equals(&quot;&quot;)) ? &quot;N/A&quot; :<br/>\n(rs.getString(3).startsWith(&quot;3&quot;)?<br/>\nrs.getString(3).substring(1):rs.getString(3)))+<br/>\n                                &quot;,&quot;+<br/>\n                                ((rs.getString(4) == null ||<br/>\nrs.getString(4).trim().equals(&quot;&quot;)) ? &quot;N/A&quot; :<br/>\n(rs.getString(4).startsWith(&quot;3&quot;)?<br/>\nrs.getString(4).substring(1):rs.getString(4)))+<br/>\n                                &quot;,null,&quot;+<br/>\n                                comp+<br/>\n                                &quot;,null,null,null,null,null,null,&quot;+<br/>\n                                temp+<br/>\n<br/>\n&quot;,null,null,rs.getString(8),rs.getString(11),rs.getString(10),rs.getString(9<br/>\n)&quot;);<br/>\n<br/>\n                    dailyResultBean.addRow ( new<br/>\nHandlerSearchResultBeanRow(null,<br/>\n<br/>\nrs.getString(1),<br/>\n<br/>\n(rs.getString(3) == null || rs.getString(3).trim().equals(&quot;&quot;)) ? &quot;N/A&quot; :<br/>\n(rs.getString(3).startsWith(&quot;3&quot;)?<br/>\nrs.getString(3).substring(1):rs.getString(3)),<br/>\n<br/>\n(rs.getString(4) == null || rs.getString(4).trim().equals(&quot;&quot;)) ? &quot;N/A&quot; :<br/>\n(rs.getString(4).startsWith(&quot;3&quot;)?<br/>\nrs.getString(4).substring(1):rs.getString(4)),<br/>\n<br/>\nnull,comp,<br/>\n                                                                    null,<br/>\nnull, null,null,<br/>\n                                                                    null,<br/>\nnull,<br/>\n                                                                    temp,<br/>\n<br/>\nnull,rs.getString(2),null,null,null,rs.getString(8),rs.getString(11),rs.getS<br/>\ntring(10),rs.getString(9)));<br/>\n                }<br/>\n            dailyResultBean.sortRow1();<br/>\n            request.setAttribute(&quot;dsrb&quot;,dailyResultBean);<br/>\n            for (int iRow = 0; iRow &lt; dailyResultBean.getRowSize() ; ++iRow)<br/>\n{<br/>\n\t\t\t    com.nqb.ps.otcstats.HandlerSearchResultBeanRow row =<br/>\ndailyResultBean.getRow(iRow);<br/>\n\t\t\t    CAT.debug(&quot;Retrieved data: &quot;+row.getDate()+&quot;   &quot;+row.getOldSymbol()+<br/>\n&quot;   &quot;+row.getNewSymbol()+ &quot;   &quot;+row.getCompanyName()+ &quot;<br/>\n&quot;+row.getSecClass()+&quot;    &quot;);<br/>\n\t\t\t}<br/>\n<br/>\n            cstmt.close();<br/>\n            rs.close();<br/>\n            }<br/>\n            catch(SQLException e)<br/>\n            {<br/>\n                DB.error(&quot;problem closing the cstmt or resultset&quot;, e);<br/>\n                next = Links.ERROR_PAGE;<br/>\n            }<br/>\n            catch(Exception e)<br/>\n            {<br/>\n                CAT.error(&quot;general exception occured&quot;, e);<br/>\n                next = Links.ERROR_PAGE;<br/>\n            }<br/>\n        return next;<br/>\n        }<br/>\n}<br/>\n<br/>\n<br/>\n<br/>\n<br/>\nfor that I have written the following DailyListingSplitHandlerTest.java<br/>\nfile,<br/>\n<br/>\n<br/>\n<br/>\n<br/>\nimport java.io.*;<br/>\nimport java.sql.*;<br/>\nimport com.informix.jdbc.IfxDriver;<br/>\n<br/>\nimport java.util.*;<br/>\nimport java.lang.*;<br/>\nimport java.text.*;<br/>\n<br/>\nimport javax.servlet.*;<br/>\nimport javax.servlet.http.HttpServletRequest;<br/>\nimport javax.servlet.http.HttpServletResponse;<br/>\n<br/>\n<br/>\n//import com.nqb.ps.otcstats.*;<br/>\n//import com.pinksheets.util.db.*;<br/>\n<br/>\nimport junit.framework.Test;<br/>\nimport junit.framework.TestCase;<br/>\nimport junit.framework.TestSuite;<br/>\n<br/>\npublic class DailyListingSplitHandlerTest  extends TestCase{<br/>\n    String next;<br/>\n    RequestObject request;<br/>\n    ResponseObject response;<br/>\n    ContextObject context;<br/>\n    Connection conn;<br/>\n<br/>\n<br/>\n<br/>\n    public DailyListingSplitHandlerTest(String name) {<br/>\n        super(name);<br/>\n    }<br/>\n<br/>\n    protected void setUp() throws<br/>\n                ServletException, IOException {<br/>\n<br/>\n   com.pinksheets.util.db.DatabaseConnectionPool databaseConnectionPool =<br/>\nnull;<br/>\n   com.pinksheets.util.db.DatabaseObject dbObj = null;<br/>\n   RequestObject reqobj = new RequestObject();<br/>\n   ResponseObject resobj = new ResponseObject();<br/>\n   ContextObject conobj = new ContextObject();<br/>\n<br/>\n    try {<br/>\n\t\t\tdatabaseConnectionPool = new<br/>\ncom.pinksheets.util.db.DatabaseConnectionPool(<br/>\n&quot;com.informix.jdbc.IfxDriver&quot;,&quot;url&quot;,&quot;username&quot;,&quot;password&quot;,5,false );<br/>\n\t\t}<br/>\n\t\tcatch ( Exception e ) {<br/>\n\t\t\tSystem.out.println( &quot;Error while trying to connect to database. &quot;) ;<br/>\n\t\t}<br/>\n\ttry {<br/>\n<br/>\n    Connection connection =<br/>\nDriverManager.getConnection(&quot;jdbc:informix-sqli://10.53.9.83:1532/pinkstatsd<br/>\nb:INFORMIXSERVER=pstat1db&quot;,&quot;informix&quot;,&quot;eqsdb&quot;);<br/>\n<br/>\nconnection.setTransactionIsolation(Connection.TRANSACTION_READ_UNCOMMITTED);<br/>\n    dbObj = new com.pinksheets.util.db.DatabaseObject(connection);<br/>\n    }<br/>\n    catch(SQLException sqle) {<br/>\n        System.out.println(&quot;sql exception&quot; );<br/>\n<br/>\n    }<br/>\n    String act = &quot;&quot;;<br/>\n    com.nqb.ps.otcstats.handlers.DailyListingSplitHandler _bean;<br/>\n    System.out.println(&quot;blababaa&quot; + reqobj.getParameter(act));<br/>\n<br/>\n        _bean = new<br/>\ncom.nqb.ps.otcstats.handlers.DailyListingSplitHandler(&quot;Links.DAILY_LISTING_S<br/>\nPLIT_PAGE&quot;,(javax.servlet.http.HttpServletRequest)reqobj,(javax.servlet.http<br/>\n.HttpServletResponse)resobj,(ServletContext)conobj,dbObj);<br/>\n        String next = _bean.processRequest();<br/>\n        System.out.println(&quot;next is &quot; + next);<br/>\n<br/>\n    }<br/>\n<br/>\n    protected void tearDown() {<br/>\n<br/>\n    }<br/>\n<br/>\n\t\tpublic void testNumRecords() {<br/>\n\t\tint expectedcount = 18;<br/>\n\t\tint currentcount = 18;<br/>\n\t\tassertEquals(expectedcount,currentcount);<br/>\n\t\t}<br/>\n<br/>\n    public static void main(String[] args) {<br/>\n        String[] testCaseName =<br/>\n{DailyListingSplitHandlerTest.class.getName()};<br/>\n        junit.ui.TestRunner.main(testCaseName);<br/>\n    }<br/>\n<br/>\n  }<br/>\n<br/>\n<br/>\n<br/>\nI have hard coded expected count and currentcount in the testNumRecords to<br/>\nensure the top portion is working properly. The RequestObject,ResponseObject<br/>\nand ContexObject are implemented with dummy values as we can not pass<br/>\nHttpServletRequest and HttpServletResponse Objects while running the junit.<br/>\n<br/>\nIts compiling well. It complains during compilation If we do not explictly<br/>\ncast the RequestObject and ResponseObject with HttpServletRequest and<br/>\nHttpServletResponse respectively. So I have explicitly casted them.<br/>\n<br/>\nBut I am getting errors at the following line when I run the<br/>\nDailyListingSplitHandlerTest<br/>\n<br/>\n_bean = new<br/>\ncom.nqb.ps.otcstats.handlers.DailyListingSplitHandler(&quot;Links.DAILY_LISTING_S<br/>\nPLIT_PAGE&quot;,(javax.servlet.http.HttpServletRequest)reqobj,(javax.servlet.http<br/>\n.HttpServletResponse)resobj,(ServletContext)conobj,dbObj);<br/>\n<br/>\nThe error message is<br/>\n<br/>\njava.lang.ClassCastException: RequestObject \tat<br/>\nDailyListingSplitHandlerTest.setUp(DailyListingSplitHandlerTest.java:76)<br/>\n<br/>\n<br/>\nHelp..Help..Urgent.<br/>\n<br/>\nThanks in advance,<br/>\nDinesh</div>", 
    "prevInTime": 2246, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "996949567", 
    "canDelete": false, 
    "nextInTopic": 2248, 
    "prevInTopic": 0, 
    "headers": {
        "messageIdInHeader": "PDAwMDYwMWMxMWQxMiRlZTQ3NmUwMCRiMDhiNGVjMEBwaW5rc2hlZXRzLm5ldD4="
    }
}
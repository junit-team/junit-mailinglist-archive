{
    "topicId": 5689, 
    "postDate": "1030830561", 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "from": "&quot;Matthew Cooke&quot; &lt;mpcooke3@...&gt;", 
    "canDelete": false, 
    "replyTo": "LIST", 
    "senderId": "FPfusud1c66RrzOdLOEDcvNUzhl-D7IQjfWFZpoYpv_RkdaShXfS8Gg2kZrY8OKUoCj-ZSuPPgLskpLs49OIqJyulpDh6aRyPmyBSQk", 
    "nextInTime": 5692, 
    "userId": 78040954, 
    "prevInTime": 5690, 
    "prevInTopic": 5689, 
    "headers": {
        "messageIdInHeader": "PEY2MGF2anJSWjFVYkRCUkFyVmMwMDAwMDJlNUBob3RtYWlsLmNvbT4="
    }, 
    "authorName": "Matthew Cooke", 
    "numMessagesInTopic": 4, 
    "msgSnippet": "Hi. I have spent some time thinking about the problems involved with testing multithreaded code. As we have had similar problems at work in the past. The", 
    "contentTrasformed": false, 
    "msgId": 5691, 
    "nextInTopic": 5693, 
    "systemMessage": false, 
    "rawEmail": "Return-Path: &lt;mpcooke3@...&gt;\r\nReceived: (qmail 50375 invoked from network); 31 Aug 2002 21:51:19 -0000\r\nReceived: from unknown (66.218.66.216)\n  by m15.grp.scd.yahoo.com with QMQP; 31 Aug 2002 21:51:19 -0000\r\nReceived: from unknown (HELO n28.grp.scd.yahoo.com) (66.218.66.84)\n  by mta1.grp.scd.yahoo.com with SMTP; 31 Aug 2002 21:51:18 -0000\r\nX-eGroups-Return: mpcooke3@...\r\nReceived: from [66.218.67.128] by n28.grp.scd.yahoo.com with NNFMP; 31 Aug 2002 21:51:18 -0000\r\nX-Sender: mpcooke3@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (EGP: mail-8_1_0_1); 31 Aug 2002 21:49:22 -0000\r\nReceived: (qmail 50864 invoked from network); 31 Aug 2002 21:49:22 -0000\r\nReceived: from unknown (66.218.66.217)\n  by m11.grp.scd.yahoo.com with QMQP; 31 Aug 2002 21:49:22 -0000\r\nReceived: from unknown (HELO hotmail.com) (209.185.241.60)\n  by mta2.grp.scd.yahoo.com with SMTP; 31 Aug 2002 21:49:22 -0000\r\nReceived: from mail pickup service by hotmail.com with Microsoft SMTPSVC;\n\t Sat, 31 Aug 2002 14:49:22 -0700\r\nReceived: from 217.35.163.105 by lw3fd.law3.hotmail.msn.com with HTTP;\n\tSat, 31 Aug 2002 21:49:21 GMT\r\nTo: junit@yahoogroups.com\r\nBcc: \r\nSubject: Re: [junit] Unit testing multithreaded network code\r\nDate: Sat, 31 Aug 2002 22:49:21 +0100\r\nMime-Version: 1.0\r\nContent-Type: text/plain; format=flowed\r\nMessage-ID: &lt;F60avjrRZ1UbDBRArVc000002e5@...&gt;\r\nX-OriginalArrivalTime: 31 Aug 2002 21:49:22.0364 (UTC) FILETIME=[442D67C0:01C25138]\r\nFrom: &quot;Matthew Cooke&quot; &lt;mpcooke3@...&gt;\r\nX-Yahoo-Group-Post: member; u=78040954\r\nX-eGroups-Approved-By: clarkware &lt;mike@...&gt; via web; 31 Aug 2002 21:51:18 -0000\r\n\r\nHi.\n\nI have spent some time thinking about the problems involved with testing \nmultithreaded code. As we have had similar problems at work in the past.\n\nThe problem is that the monitor-threads model in Java is fairly easy to \nunderstand to start with, but becomes difficult to apply safely in large \nscale systems. This problem is futher compounded by the fact that unit \ntesting becomes difficult/impossible, either you test the threaded behaviour \nand have horrible join() sleep() code or you ignore the threading aspects. \nEven if you unit test everything the threading behaviour of a system is \nstill not captured because the &#39;Unit Tests&#39; test Objects and parellelism is \nnot contained within objects in the threading model.\n\nI am sure if java used the more modern CSP (Communicating Sequential \nProcesses) model then writing junit tests would be much simpler as each bit \nof code could be tested outside of a parrallel system. Eg, The parallelism \nwould not be hidden inside an object or spread across multiple objects. \nHence Unit testing and Mock CSP Objects could easily be used.\n\nAnyway - I digress.\n\nI think how I would address the problems you are having by testing \nseparately the socket connection code and the behavoiur you want the \nConnectionService to have.\n\nThis could be achieved by creating a wrapper on a socket in the real code. \nthis wrapper simply has the responsibility to make connect() calls to the \nConnectionService whenever a real socket connection is made.\n\nNow the tests on connectionService become non-threaded and non-network \nrelated. calls made to connect should cause the mockFactory to create an \nobject. A call to stopListening should cause the mockSocketWrapper to be \nasked to close.\n\nYou could still test the &#39;real&#39; behaviour of the socket itself by testing \nthe socketWrapper although I wouldn&#39;t bother. I accept that some simple \nwrappers on java libraries don&#39;t need testing becauase hopefully they are \nnot buggy ;)\n\nMatt.\n\nFrom: &quot;weitzman_d&quot; &lt;weitzman_d@...&gt;\nReply-To: junit@yahoogroups.com\nTo: junit@yahoogroups.com\nSubject: [junit] Unit testing multithreaded network code\nDate: Thu, 29 Aug 2002 21:05:59 -0000\n\nI&#39;ve asked this question at javaranch.com, so I&#39;ll just provide an\nbrief description here and point to the original question for anyone\nwho wants to give it a shot (just reply on this list though).\n\nI&#39;m writing the beginnings of a multithreaded server, and I had to\ninsert a lot of calls to Thread.sleep() in my unit testing code for\nit to pass.  Is there some good way to test multithreaded code that\ndoesn&#39;t invole just waiting a few milliseconds and hoping that a task\nfinished?  I imagine that a better solution might involve calls to\njoin() but tie the unit test closely to the particular implementation.\n\nAnyway, here&#39;s the original question with my current, unsatisfactory\ntest (although it doesn&#39;t have much of the code being tested - I\ndidn&#39;t want to clutter the post.  I should add some.):\n\nhttp://saloon.javaranch.com/cgi-bin/ubb/ultimatebb.cgi?\nubb=get_topic&f=9&t=001390\n\n\n\n\n\n\n_________________________________________________________________\nChat with friends online, try MSN Messenger: http://messenger.msn.com\n\n\n\n", 
    "subject": "Re: [junit] Unit testing multithreaded network code"
}
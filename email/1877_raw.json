{
    "topicId": 1855, 
    "postDate": "994855223", 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "from": "Charlie Woloszynski &lt;chw@...&gt;", 
    "canDelete": false, 
    "replyTo": "LIST", 
    "senderId": "iFAkfElY4j9R5JKRJXIrtuBfLL-59mlsKxt3pywePP8oLa25fT2MnsZo1mglDjlaN7HABApZopVXVUs8mWVq2dAKr3Blw2oCMLFox47Nnqg", 
    "nextInTime": 1878, 
    "userId": 0, 
    "prevInTime": 1876, 
    "prevInTopic": 1876, 
    "headers": {
        "messageIdInHeader": "PDNCNEM0OTM2LkQ1REUxQ0U1QGNsZWFybWV0cml4LmNvbT4=", 
        "referencesHeader": "PEMzODQzQkQxQjgzREQyMTE5RDc5MDAwMDkyQTdCQUQ0MDczMTVCOURAcGxhdGludW0uYWxsYWlyZS5jb20+"
    }, 
    "authorName": "Charlie Woloszynski", 
    "numMessagesInTopic": 11, 
    "msgSnippet": "Scott: Thanks for the explanation.  I think I better understand the issue.  I have hacked the excluded.properties file to fix this (for now).  Would it be ", 
    "contentTrasformed": false, 
    "msgId": 1877, 
    "nextInTopic": 1894, 
    "systemMessage": false, 
    "rawEmail": "Return-Path: &lt;chw@...&gt;\r\nX-Sender: chw@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (EGP: mail-7_2_0); 11 Jul 2001 12:41:09 -0000\r\nReceived: (qmail 60312 invoked from network); 11 Jul 2001 12:40:54 -0000\r\nReceived: from unknown (10.1.10.26) by l7.egroups.com with QMQP; 11 Jul 2001 12:40:54 -0000\r\nReceived: from unknown (HELO tahiti.clearmetrix.com) (209.10.165.115) by mta1 with SMTP; 11 Jul 2001 12:40:54 -0000\r\nReceived: from clearmetrix.com (ool-18be12d2.dyn.optonline.net [24.190.18.210]) by tahiti.clearmetrix.com (8.9.3/8.8.7) with ESMTP id IAA18399; Wed, 11 Jul 2001 08:40:53 -0400\r\nMessage-ID: &lt;3B4C4936.D5DE1CE5@...&gt;\r\nDate: Wed, 11 Jul 2001 08:40:23 -0400\r\nReply-To: chw@...\r\nOrganization: ClearMetrix, Inc.\r\nX-Mailer: Mozilla 4.72 [en] (WinNT; U)\r\nX-Accept-Language: en\r\nMIME-Version: 1.0\r\nTo: junit@yahoogroups.com\r\nSubject: Re: [junit] Class loader error with junit\r\nReferences: &lt;C3843BD1B83DD2119D79000092A7BAD407315B9D@...&gt;\r\nContent-Type: text/plain; charset=us-ascii\r\nContent-Transfer-Encoding: 7bit\r\nFrom: Charlie Woloszynski &lt;chw@...&gt;\r\n\r\nScott:\n\nThanks for the explanation.  I think I better understand the issue.  I have\nhacked the excluded.properties file to fix this (for now).  Would it be\nreasonable to think that JUnit should allow test cases to define their own\nexcluded list?\n\nIt certainly is better than excluding classes wholesale for all test cases in a\nproject, but it puts more burden on the developer to know what classes are\nstrictly support and not part of the testing infrastructure.\n\nCharlie\n\n\n\nScott Stirling wrote:\n\n&gt; The JUnit TestCaseClassLoader (the reloadable one) has a fundamental problem\n&gt; that results in frequent LinkageErrors under the following conditions:\n&gt;\n&gt; 1. You use the JUnit Swing UI.\n&gt;\n&gt; 2.  You use JAXP in your test cases or any classes referenced in your test\n&gt; cases, or even any &quot;instanceof&quot; expressions that reference JAXP classes.\n&gt; (By JAXP I mean the whole set of javax.* classes plus the org.w3c.dom.* and\n&gt; org.xml.sax.* classes)\n&gt;\n&gt; I can go into this in depth, but the bottom line problems are that JUnit\n&gt; loads classes from the same place as the JVM&#39;s system loader; the classpath.\n&gt; This necessitates the use of an exclusion list to filter out certain class\n&gt; names that either must be loaded by the system loader, or you would like to\n&gt; have loaded by the system loader.  The JUnit loader does not always delegate\n&gt; to the system loader when it should, particularly in the case of JAXP, which\n&gt; is a weird mix of classes whose names begin with the filtered &quot;javax.*&quot; and\n&gt; the unfiltered &quot;org.w3c.*&quot; and org.xml.*&quot;.\n&gt;\n&gt; JAXP is a special case because it is based on a set of javax.* classes.  All\n&gt; javax.* classes are excluded from the JUnit loader by default (in the\n&gt; default excluded.properties file) in junit.jar.  But JAXP, as shipped from\n&gt; Sun, comes with a bunch of other classes in org.w3c.* and org.xml.*.  The\n&gt; interesting thing is a direct dependency between javax.* classes and some\n&gt; other classes not in the usual exclusion list of com.sun.*, javax.*, etc.\n&gt;\n&gt; So what can happen, and frequently does when using the JUnit Swing UI with\n&gt; test cases or other classes, such as Log4J, that use JAXP, is that the JUnit\n&gt; class loader (properly) delegates javax.xml.* classes it &quot;sees&quot; to the\n&gt; system loader.  But then the system loader loads up a bunch of org.w3c.dom\n&gt; and/or org.xml.sax classes as the result of initializing and loading that\n&gt; JAXP class.  Later, if the JUnit loader comes across some org.w3c/xml class\n&gt; that it&#39;s never seen before, it tries to load it because the classname\n&gt; doesn&#39;t match one of the patterns in the exclude list.\n&gt;\n&gt; But it&#39;s already been loaded through the &quot;backdoor&quot; as the result of some\n&gt; other class loaded by the system loader (remember, the JVM keeps classes in\n&gt; their own namespace by identifying them by their fully qualified name plus\n&gt; the instance of their _defining_ (not initiating) loader, AND, the JVM will\n&gt; attempt to assign all unloaded classes referenced by a defined class to that\n&gt; defining class&#39;s loader).  The JVM&#39;s classresolver routine keeps track of\n&gt; all these class loading events and &quot;sees&quot; that the JUnit loader is\n&gt; attempting to define a class that has already been defined by the system\n&gt; loader.  That&#39;s wrong because according to the rules of loader constraints,\n&gt; JUnit should delegate this load to the system loader.\n&gt;\n&gt; You can hack around this (I did) by catching the LinkageError in\n&gt; TestCaseClassLoader&#39;s loadClass() method and then making a recovery call to\n&gt; findSystemClass() -- thereby delegating to the system loader after the fact\n&gt; (which is OK).  This hack only works some of the time, though, because now\n&gt; you can have the reverse problem where the JUnit loader loads a host of\n&gt; org.*.* classes, and then the system loader violates the loader contraints\n&gt; at some point when it tries to do exactly what I described above with JAXP\n&gt; because it doesn&#39;t ever delegate to its child (the JUnit loader).\n&gt; Inevitably, if your test cases use many JAXP and related XML classes, one or\n&gt; the other ClassLoader will end violating the constraints whatever you do.\n&gt;\n&gt; So the solution in the existing JUnit is to definitely add org.w3c.dom.* and\n&gt; org.xml.sax.* to your excluded.properties if you&#39;re using any JAXP stuff.\n&gt;\n&gt; What can we learn from this?  Well, one thing is that it&#39;s a good idea to\n&gt; have your custom class loaders load classes from repositories other than the\n&gt; system classpath.  Note that the JVM&#39;s built-in classloaders work that way\n&gt; (one for the jre/ext dirs, another for the java.class.path).\n&gt;\n&gt; Anyway, the excluded.properties fix is just a matter of time before it\n&gt; becomes standard in JUnit, since JAXP will be a standard part of the 1.4\n&gt; JDK.  It&#39;ll be just like having org.omg.* excluded.\n&gt;\n&gt; Scott Stirling\n&gt;\n&gt; -----Original Message-----\n&gt; From: chw@...\n&gt; To: junit@yahoogroups.com\n&gt; Sent: 7/10/01 10:43 PM\n&gt; Subject: [junit] Class loader error with junit\n&gt;\n&gt; Folks:\n&gt;\n&gt; I am using Junit (I am a newbie at it) with Log4j (which we use\n&gt; extensively) and I cannot seem to get the Log4j stuff initialized.\n&gt;\n&gt; When I put the DOMConfigurator.configure() call from Log4j in main(),\n&gt; it is apparently lost when the test cases are run (different class\n&gt; loader? causing the singleton functions to use a different set\n&gt; objects?)\n&gt;\n&gt; When I put the Log4j config stuff in the setUp(), I get the following.\n&gt;\n&gt; Any suggestions what the problem is and how to work around it?\n&gt;\n&gt; Thanks\n&gt;\n&gt; Charlie\n&gt;\n&gt; java.lang.LinkageError: Class org/xml/sax/InputSource violates loader\n&gt; constraints\n&gt;         at\n&gt; org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:\n&gt; 1169)\n&gt;         at\n&gt; org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:\n&gt; 1039)\n&gt;         at\n&gt; org.apache.log4j.xml.DOMConfigurator.configure(DOMConfigurator.java:11\n&gt; 97)\n&gt;         at\n&gt; com.clearmetrix.outreach.datamodel.VisitorExperienceSqlOperationTestCa\n&gt; se.setUp(VisitorExperienceSqlOperationTestCase.java:38)\n&gt;\n&gt; To unsubscribe from this group, send an email to:\n&gt; junit-unsubscribe@yahoogroups.com\n&gt;\n&gt;\n&gt; Your use of Yahoo! Groups is subject to\n&gt; http://docs.yahoo.com/info/terms/\n&gt;\n&gt; To unsubscribe from this group, send an email to:\n&gt; junit-unsubscribe@yahoogroups.com\n&gt;\n&gt;\n&gt; Your use of Yahoo! Groups is subject to http://docs.yahoo.com/info/terms/\n\n\n", 
    "subject": "Re: [junit] Class loader error with junit"
}
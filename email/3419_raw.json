{
    "numMessagesInTopic": 3, 
    "nextInTime": 3420, 
    "senderId": "gX7fKTN_K3pOF7VapWbgJT3MpHRf2MQl_OTxD-Tlv5ugv-T6kHbWbwHmr0ZAACtQ554ZI7pCQgTWgzfmNUtAEAQoHzVV215882AKNqcvlLw", 
    "systemMessage": false, 
    "subject": "RE: [junit] ClassCastException while calling EJB&#39;s from JUnit", 
    "from": "Scott Stirling &lt;sstirling@...&gt;", 
    "authorName": "Scott Stirling", 
    "msgSnippet": "I answered the same question on this list 7/16/01, which included a somewhat pedantic explanation of why this happens: Interestingly, calls to", 
    "msgId": 3419, 
    "rawEmail": "Return-Path: &lt;sstirling@...&gt;\r\nX-Sender: sstirling@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (EGP: mail-8_0_0_1); 3 Dec 2001 15:01:55 -0000\r\nReceived: (qmail 89107 invoked from network); 3 Dec 2001 15:01:55 -0000\r\nReceived: from unknown (216.115.97.172)\n  by m5.grp.snv.yahoo.com with QMQP; 3 Dec 2001 15:01:55 -0000\r\nReceived: from unknown (HELO uscamexcp005.allaire.com) (63.109.193.127)\n  by mta2.grp.snv.yahoo.com with SMTP; 3 Dec 2001 15:01:55 -0000\r\nReceived: by smtp.allaire.com with Internet Mail Service (5.5.2653.19)\n\tid &lt;XXYZYYS2&gt;; Mon, 3 Dec 2001 10:01:33 -0500\r\nMessage-ID: &lt;4F47DCFADC8DD5118D2B00508B952D960C3BB4@...&gt;\r\nTo: &quot;&#39;junit@yahoogroups.com&#39;&quot; &lt;junit@yahoogroups.com&gt;\r\nSubject: RE: [junit] ClassCastException while calling EJB&#39;s from JUnit\r\nDate: Mon, 3 Dec 2001 10:01:27 -0500 \r\nMIME-Version: 1.0\r\nX-Mailer: Internet Mail Service (5.5.2653.19)\r\nContent-Type: text/plain;\n\tcharset=&quot;iso-8859-1&quot;\r\nFrom: Scott Stirling &lt;sstirling@...&gt;\r\nX-Yahoo-Profile: jrun4\r\n\r\nI answered the same question on this list 7/16/01, which included a somewhat\npedantic explanation of why this happens:\n\nInterestingly, calls to javax.rmi.PortableRemoteObject are delegated to an\nimplementation of javax.rmi.CORBA.PortableRemoteObjectDelegate, which in\nSun&#39;s 1.3.1 JDK is com.sun.corba.se.internal.javax.rmi.PortableRemoteObject.\nThat doesn&#39;t explain anything -- I just thought it was just kinda\ninteresting how buried that reference was.\n\nAnyway, this is another problem inherent to JUnit&#39;s Swingui&#39;s\nTestCaseClassLoader architecture.  Similar to the LinkageErrors with JAXP\nand the org.xml and org.w3c classes, but with a different result here.\nWe&#39;ve seen it here with EJB lookups too, but we mostly use the Ant runner so\nit&#39;s not usually a problem.\n\nSo why a ClassCastException when you narrow() in a TestCase?  \n\nHere&#39;s John Pletka&#39;s test code:\n\nPoint point;\nPointHome pointHome;\n\n//The next line works in textui, but throws \n//ClassCastException in swingui\npointHome =\n(PointHome)PortableRemoteObject.narrow(ctx.lookup(&quot;base/PointHome&quot;),PointHom\ne.class);\n\nRecall that in Java 2 an object&#39;s class (aka &quot;runtime type&quot;) is identified\nin the JVM as &lt;fully-qualified-classname;definingClassLoaderInstance&gt; or\n&lt;C;L&gt;.  That is, the defining loader is part of the runtime name identifying\nthat class (there&#39;s a subtle distinction in Java between &#39;class&#39; and &#39;type&#39;\nI won&#39;t go into).  Also recall that the JVM will ask a class&#39;s defining\nloader to load all unloaded classes referenced by the classes it loads.\n\nMy hypothesis (I just tested it here and proved it) is that the ctx.lookup()\nreturns an object that was loaded through the JVM&#39;s system classloader\n(sun.misc.Launcher$AppClassLoader), but the PointHome.class type is loaded\nby JUnit&#39;s TestCaseClassLoader.  In the narrow, the two fully qualified\nclass names are the same, but the defining classloaders for the two are\ndifferent so you get the exception because the JVM doesn&#39;t see them as being\nthe same &lt;C;L&gt; class/type.\n\nThe solution would be to exclude your EJB&#39;s interface classes from being\nloaded by the JUnit custom class loader by adding them to the\nexcluded.properties in junit.jar.  Granted, not a very nice solution unless,\nperhaps, it were easier to modify the exclusion list.  I hear in JUnit 4.0\nthat one idea is to make it easy to define exclusions in TestCases\nthemselves.\n\nYou can find out more about which loader loaded which class by doing this:\n\nSystem.out.println(ctx.lookup(&quot;base/PointHome&quot;).getClass().getClassLoader())\n;\nSystem.out.println(PointHome.class.getClassLoader());\n\nI bet you&#39;ll find when using the Swing UI that the PointHome type is defined\nby the JUnit TestCaseClassLoader and the object returned from ctx.lookup()\nwas defined through the JVM&#39;s system class loader.  When using the textui\nthey&#39;ll both load through the system loader.\n\nScott Stirling\nJRun QA\nMacromedia\n\n&gt; -----Original Message-----\n&gt; From: steven.hale@... [mailto:steven.hale@...]\n&gt; Sent: Monday, December 03, 2001 8:30 AM\n&gt; To: junit@yahoogroups.com\n&gt; Subject: Re: [junit] ClassCastException while calling EJB&#39;s from JUnit\n&gt; \n&gt; \n&gt; \n&gt;  ... stumbled across the answer myself:\n&gt; \n&gt; the home and remote interfaces of the ejb should be added to \n&gt; the list of\n&gt; excluded classes in the excluded.properties file.\n&gt; \n&gt; (Jens Schumann posted the solution to this on the Orion \n&gt; interest group)\n&gt; \n&gt; \n&gt; According to the JUnit faq the solution to this problem is to &quot;use\n&gt; excluded.properties ...or turn off reloading&quot;.\n&gt; \n&gt; Turning off reloading works but isn&#39;t the best solution. I&#39;ve tried\n&gt; unsuccessfully to exclude various packages but so far no joy. \n&gt; Any ideas\n&gt; which packages have to be excluded for this to work? We&#39;re running WLS\n&gt; 6.0sp1.\n&gt; \n&gt; Steven Hale, wm-data\n\n", 
    "profile": "jrun4", 
    "topicId": 3414, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 0, 
    "prevInTime": 3418, 
    "contentTrasformed": false, 
    "postDate": "1007391687", 
    "canDelete": false, 
    "nextInTopic": 0, 
    "prevInTopic": 3417, 
    "headers": {
        "messageIdInHeader": "PDRGNDdEQ0ZBREM4REQ1MTE4RDJCMDA1MDhCOTUyRDk2MEMzQkI0QHNhbHNhLmFsbGFpcmUuY29tPg=="
    }
}
{
    "numMessagesInTopic": 29, 
    "nextInTime": 20674, 
    "senderId": "b0ynX2JgMOcrXtkWthbJmT-qbZ9fiWVBLlsPOa1ft82jKNQGqrfX-KlpYQGLSI3JxCEXlh45tUV-o1hM1po_eLnGBUG45O04m3q0lTUcGb45FIOHIPZAclNHiuOfxpg", 
    "systemMessage": false, 
    "subject": "Re: [junit] Re: Junit 3 suite setup tear down", 
    "from": "=?UTF-8?B?Q8OpZHJpYyBCZXVzdCDimZQ=?= &lt;cbeust@...&gt;", 
    "authorName": "Cédric Beust ♔", 
    "msgSnippet": "That s a lot of work and therefore a good candidate for a new feature: @BeforeSuite/@AfterSuite. -- Cédric ... [Non-text portions of this message have been", 
    "msgId": 20673, 
    "rawEmail": "Return-Path: &lt;cbeust@...&gt;\r\nX-Sender: cbeust@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nX-Received: (qmail 31553 invoked from network); 9 Jul 2008 22:45:33 -0000\r\nX-Received: from unknown (66.218.67.96)\n  by m46.grp.scd.yahoo.com with QMQP; 9 Jul 2008 22:45:33 -0000\r\nX-Received: from unknown (HELO smtp-out.google.com) (216.239.33.17)\n  by mta17.grp.scd.yahoo.com with SMTP; 9 Jul 2008 22:45:32 -0000\r\nX-Received: from spaceape23.eur.corp.google.com (spaceape23.eur.corp.google.com [172.28.16.75])\n\tby smtp-out.google.com with ESMTP id m69MjS1L026034\n\tfor &lt;junit@yahoogroups.com&gt;; Wed, 9 Jul 2008 23:45:28 +0100\r\nX-Received: from fg-out-1718.google.com (fgad23.prod.google.com [10.86.55.23])\n\tby spaceape23.eur.corp.google.com with ESMTP id m69MiRFP032748\n\tfor &lt;junit@yahoogroups.com&gt;; Wed, 9 Jul 2008 23:45:27 +0100\r\nX-Received: by fg-out-1718.google.com with SMTP id d23so1397934fga.5\n        for &lt;junit@yahoogroups.com&gt;; Wed, 09 Jul 2008 15:45:27 -0700 (PDT)\r\nMIME-Version: 1.0\r\nX-Received: by 10.86.63.19 with SMTP id l19mr7734313fga.60.1215643526666; Wed, \n\t09 Jul 2008 15:45:26 -0700 (PDT)\r\nIn-Reply-To: &lt;g534ku+ofst@...&gt;\r\nReferences: &lt;g51n8e+fu4r@...&gt; &lt;g534ku+ofst@...&gt;\r\nDate: Wed, 9 Jul 2008 15:45:26 -0700\r\nMessage-ID: &lt;b86b6a9c0807091545j77b726feha118ec648ba86227@...&gt;\r\nTo: junit@yahoogroups.com\r\nX-eGroups-Msg-Info: 1:12:0:0:0\r\nFrom: =?UTF-8?B?Q8OpZHJpYyBCZXVzdCDimZQ=?= &lt;cbeust@...&gt;\r\nSubject: Re: [junit] Re: Junit 3 suite setup tear down\r\nX-Yahoo-Group-Post: member; u=199443513; y=AlLepf10HVcecopgte6_RjVNujL_JHr4RlOpKE45ay1r\r\nX-Yahoo-Profile: cbeust\r\nContent-Type: text/plain; charset=ISO-8859-1\r\nContent-Transfer-Encoding: quoted-printable\r\n\r\nThat&#39;s a lot of work and therefore a good candidate for a new feature:\n@Bef=\r\noreSuite/@AfterSuite.\n\n-- \nC=E9dric\n\n\nOn Wed, Jul 9, 2008 at 12:47 PM, toal=\r\nexsmail &lt;toalexsmail@...&gt; wrote:\n\n&gt;   --- In junit@yahoogroups.com &lt;j=\r\nunit%40yahoogroups.com&gt;, &quot;lars&quot;\n&gt; &lt;lars.carlsson@...&gt; wrote:\n&gt; &gt;\n&gt; &gt; Hi\n&gt; &gt;=\r\n At my company we have alot of automated test cases and in all our\n&gt; &gt; suit=\r\ne we have a setup testcase and a teardown test case where we setup\n&gt; &gt; netw=\r\nork connection that takes some time and can not be done in every\n&gt; TC. ,\n&gt; =\r\n&gt; But i think that there should exist a suite setup and a teardown and\n&gt; &gt; =\r\nnot be in a setup/teardown TC.\n&gt; &gt; Are there any why of doing this or how c=\r\nould i best be solve this by\n&gt; &gt; extending TestSuite?\n&gt; &gt;\n&gt; &gt; Regards Lars\n=\r\n&gt; &gt;\n&gt; I think that there is some related thread on this topic, but never mi=\r\nnd.\n&gt;\n&gt; * There are @Before and @After annotation that are equivalent of us=\r\ne\n&gt; of setUp() and tearDown().\n&gt; * There are @BeforeClass and @AfterClass a=\r\nnnotation that are supposed\n&gt; to substitute the use of TestSuite. In fact, =\r\nthis method is called\n&gt; once per class. You can see on it as your TestSuite=\r\n was just a single\n&gt; class. AFAIK, there is no build in support for TestSui=\r\nte that is not\n&gt; so trivial.\n&gt;\n&gt; I had similar requirement, namely I wanted=\r\n to ensure that JDK 1.4+\n&gt; assert statement are on, I wanted to start JBoss=\r\n microcontainer at the\n&gt; beginning and shutdown it at the end.\n&gt;\n&gt; Lets sta=\r\nrt from the simplest one.\n&gt; * I wanted to ensure that JDK 1.4+ assert state=\r\nment are on.\n&gt; I created class with name BaseTestCase and all my test class=\r\nes\n&gt; inherits from it. In this class I put the following method:\n&gt;\n&gt; @Befor=\r\neClass\n&gt; public static void oneTimeSetup(){\n&gt; // do your one time set-up he=\r\nre!\n&gt; log.info(&quot;BaseTestCase.oneTimeSetup()&quot;);\n&gt; log.debug(&quot;Going to check =\r\nwhether asserts are enabled&quot;);\n&gt; boolean assertsEnabled =3D false;\n&gt; assert=\r\n (assertsEnabled =3D true); // Intentional side effect!!!\n&gt; if (!assertsEna=\r\nbled) {\n&gt; throw new AssertionError(&quot;Asserts must be enabled!&quot;);\n&gt; }\n&gt; }\n&gt; }=\r\n\n&gt;\n&gt; Because all my test classes inherit from BaseTestCase and has their\n&gt; =\r\nbase class BaseTestCase, it is guaranteed that first thing that will\n&gt; be r=\r\nun (beside JUnit itself) is oneTimeSetup() method.\n&gt;\n&gt; * I wanted to start =\r\nJBoss microcontainer at the beginning and shutdown\n&gt; it at the end.\n&gt;\n&gt; Eve=\r\nry test class inherit from some base test class, say\n&gt; BaseHelloWorldEJBTes=\r\nt (that eventually inherit from BaseTestCase). In\n&gt; BaseHelloWorldEJBTest t=\r\nhere is method\n&gt;\n&gt; @BeforeClass\n&gt; public static void setUpClass() throws Ex=\r\nception ;\n&gt;\n&gt; This method basically does the following:\n&gt;\n&gt; final Bootstrap=\r\n jbossInstance =3D Bootstrap.getInstance();\n&gt; if (!jbossInstance.isStarted(=\r\n)) {\n&gt; log.debug(&quot;starting JBoss microcontainer&quot;);\n&gt; jbossInstance.bootstra=\r\np();\n&gt; log.debug(&quot;JBoss microcontainer is up&quot;);\n&gt;\n&gt; log.debug(&quot;Going to dep=\r\nloy scanClasspath&quot;);\n&gt; deploy(scanClasspath);\n&gt; log.debug(&quot;End of deploy sc=\r\nanClasspath&quot;);\n&gt; ... &lt;HERE there is more code&gt;\n&gt; }\n&gt;\n&gt; Until now everything=\r\n is pretty straight-forward. But how can I stop\n&gt; JBoss when I finished tes=\r\nting? I don&#39;t want to stop it after every\n&gt; class, but after whole TestSuit=\r\ne is done. I didn&#39;t find something\n&gt; built-in, so I use ShutdownHook...\n&gt;\n&gt;=\r\n In the above setUpClass() mehtod in the place that noted as &quot;&lt;HERE\n&gt; there=\r\n is more code&gt;&quot; I have:\n&gt;\n&gt; log.debug(&quot;Now add hook to shutdown server&quot;);\n&gt;=\r\n Runtime.getRuntime().addShutdownHook(new Thread() {\n&gt; public void run() {\n=\r\n&gt; assert lRunnables!=3Dnull;\n&gt; Runnable runnable =3Dnull;\n&gt; String runnable=\r\nI =3D null;\n&gt; try {\n&gt; for(int i=3D0;i&lt;lRunnables.length;i++){\n&gt; runnable =\r\n=3D lRunnables[i];\n&gt; runnableI =3D &quot;runnable &quot;+i;\n&gt; log.debug(&quot;Going to run=\r\n &quot;+runnableI);\n&gt; if(runnable=3D=3Dnull){\n&gt; log.warn(runnableI+&quot; is null, sk=\r\nipping&quot;);\n&gt; } else {\n&gt; try {\n&gt; runnable.run();\n&gt; log.debug(runnableI+&quot; ends=\r\n run succesfully&quot;);\n&gt; }\n&gt; catch(Throwable e){log.error(runnableI+&quot; fails&quot;, =\r\ne);}\n&gt;\n&gt; }\n&gt; }\n&gt;\n&gt; }\n&gt;\n&gt; catch(Throwable e){\n&gt; log.error(&quot;This should never=\r\n happened. Some runnables Throwable\n&gt; (exception) propogates outside the lo=\r\nop&quot;, e);\n&gt; }\n&gt;\n&gt;\n&gt; synchronized (jbossInstance) {\n&gt; jbossInstance.shutdown(=\r\n);\n&gt; }\n&gt; String junitStatus =3D junitStatusOs.toString();\n&gt; log.debug(junit=\r\nStatus);\n&gt;\n&gt; }\n&gt; });\n&gt; I will talk about junitStatusPs a bit later. What is=\r\n actually is done\n&gt; here that in @BeforeClass that it is before running eve=\r\nry class, there\n&gt; is check whether JBoss is run or no. If it is run nothing=\r\n special is\n&gt; done. If it is not run, and this will be true only first time=\r\n this\n&gt; check will be done, JBoss is started and ShutDownHook is added. Tak=\r\ne a\n&gt; look on the JavaDoc on ShutDownHook, but basically, on the call on\n&gt; =\r\nSystem.exit() JVM will be run your hook. In that shutdown hook I make\n&gt; jbo=\r\nssInstance.shutdown().\n&gt;\n&gt; There is one issue here. One JBoss is shutting d=\r\nown it write some\n&gt; thing to the log. What is happen, that I see JUnit repo=\r\nrt (90000\n&gt; tested passes, 100 fails, and 10 ignored) and after this report=\r\n I see\n&gt; the output from shitting down process. This happen, because the\n&gt; =\r\nshutdown hook happens after last JUnit class finished to run.\n&gt; I found som=\r\ne work around. In the BaseTestCase I have:\n&gt; // the logger\n&gt; private static=\r\n final Log log =3D LogFactory.getLog(BaseTestCase.class);\n&gt; protected stati=\r\nc final OutputStream junitStatusOs =3D new\n&gt; ByteArrayOutputStream(16*1024)=\r\n;\n&gt;\n&gt; This junitStatusPs is actually passed to as PrintStream (instead\n&gt; Sy=\r\nstem.out) to the JUnit classes. Note, that I have\n&gt;\n&gt; String junitStatus =\r\n=3D junitStatusOs.toString();\n&gt; log.debug(junitStatus);\n&gt;\n&gt; as the last row=\r\n of the shutdown hook. This ensure, that I will see the\n&gt; output of the shu=\r\ntdown hook first, and the JUnit report will be the\n&gt; last rows in the stand=\r\nard output.\n&gt; And the last issue is:\n&gt;\n&gt; If I want to do some other thing I=\r\n just wrap it as lRunnables and pass\n&gt; to the method mentioned above. It is=\r\n looks like this:\n&gt;\n&gt; //we want to call cleanUp() method that ear applicati=\r\non calls\n&gt; //moment before we shutting down JBoss\n&gt; Runnable runnable =3D n=\r\new Runnable(){\n&gt; public void run() {\n&gt; try {\n&gt; cleanUp();\n&gt; }\n&gt; catch(Hello=\r\nWorldException e){\n&gt; log.error(&quot;Failed to cleanUp&quot;, e);\n&gt; }\n&gt; }\n&gt; };\n&gt;\n&gt; se=\r\ntUpClass(System.getProperty(&quot;user.dir&quot;) + &quot;/target/classes&quot;,\n&gt; runnable);\n&gt;=\r\n\n&gt; In order to shutdown JBoss we use\n&gt; @AfterClass\n&gt; public static void tea=\r\nrDownClass() throws Exception {\n&gt; log.info(&quot;one time tearDownClass()&quot;);\n&gt; u=\r\nndeploy();\n&gt; Bootstrap.getInstance().shutdown();\n&gt; }\n&gt;\n&gt;  \n&gt;\n\n\n[Non-text po=\r\nrtions of this message have been removed]\n\n\n", 
    "profile": "cbeust", 
    "topicId": 20668, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 199443513, 
    "prevInTime": 20672, 
    "contentTrasformed": false, 
    "postDate": "1215643526", 
    "canDelete": false, 
    "nextInTopic": 20675, 
    "prevInTopic": 20670, 
    "headers": {
        "inReplyToHeader": "PGc1MzRrdStvZnN0QGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PGI4NmI2YTljMDgwNzA5MTU0NWo3N2I3MjZmZWhhMTE4ZWM2NDhiYTg2MjI3QG1haWwuZ21haWwuY29tPg==", 
        "referencesHeader": "PGc1MW44ZStmdTRyQGVHcm91cHMuY29tPiA8ZzUzNGt1K29mc3RAZUdyb3Vwcy5jb20+"
    }
}
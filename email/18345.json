{
    "numMessagesInTopic": 4, 
    "nextInTime": 18346, 
    "senderId": "_URFUZiRIAgb_eZ5pv03I0GfumXguOschBCIGVtoEzNKHOGPjlBOHZsT5dNssjsKprDAJA3DxNB_WmZDqzglUU4uN_0WjmvVgTFPt4GP3rpl8mfq", 
    "systemMessage": false, 
    "subject": "Re: [junit] When code refuses to be mocked", 
    "from": "&quot;Joakim Ohlrogge&quot; &lt;joakim.ohlrogge@...&gt;", 
    "authorName": "Joakim Ohlrogge", 
    "msgSnippet": "Hi Wendy, Just a longshot: Does UniFile throw an exception when created using the default constructor? If that is the case you should be able to reproduce the ", 
    "msgId": 18345, 
    "profile": "j0hlrogge", 
    "topicId": 18341, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 261856052, 
    "messageBody": "<div id=\"ygrps-yiv-1007389917\">Hi Wendy,<br/>\n<br/>\nJust a longshot: Does UniFile throw an exception when created using the<br/>\ndefault constructor? If that is the case you should be able to reproduce the<br/>\nexact same failure without easymock by creating an instance of UniFile (if<br/>\nthe default constructor is protected in UniFile you may have to subclass it<br/>\nto reproduce the problem).<br/>\n<br/>\nAre there any constructors in UniFile that take arguments? I suspect you<br/>\nshould make EasyMock use one of those. I don&#39;t know how to do that in<br/>\nEasyMock but rMock also uses cglib and in rMock it looks like this:<br/>\n<br/>\nmock(SomeClass.class, new Object[]{&quot;constructorAgrument1&quot;, 4711});<br/>\n<br/>\nThe above is the equivalent to:<br/>\n<br/>\nnew SomeClass(&quot;constructorArgument1&quot;, 4711);<br/>\n<br/>\nI bet you can do the same in EasyMock.<br/>\n<br/>\nSome background: EasyMock uses CGLIB (same as RMock) in order to be able to<br/>\nmock classes. While mocking concrete classes can sometimes be convenient it<br/>\nis seldom worth the trouble. One nasty thing is what I suspect that you are<br/>\nexpericening: since mocking a class works by /subclassing/ the actual class<br/>\n/dynamically/ you can have sideeffects from the constructor of the mocked<br/>\nclass.<br/>\n<br/>\nI generally try to wrap my 3rd party API:s behind interfaces I own (create a<br/>\nvery thin wrapper exposing only what I need and use) and leave the testing<br/>\nof the wrapper to integration-tests. Mocks are most effective when<br/>\ndiscovering interfaces IMO. (That is the inverse of how I started using<br/>\nmocks, I mock between classes I own and test the &quot;edges&quot; of my system<br/>\nstatebased). I find that using mocks this way helps me discovering<br/>\ninterfaces, guide my design and focus on one thng at the time. If I want to<br/>\nisolate myself from a database or some other resource I generally use stubs<br/>\nand not dynamic mocks.<br/>\n<br/>\nJust my 2 cents for what they are worth.<br/>\nHope this helps!<br/>\n/J<br/>\n<br/>\n<br/>\n<br/>\n<br/>\n<blockquote><span title=\"qreply\"> On 11/12/06, Wendy Smoak &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:wsmoak@...\">wsmoak@...</a>&gt; wrote:<br/>\n&gt;<br/>\n&gt;   I&#39;m having trouble testing some code that sits on top of a 3rd party<br/>\n&gt; library.<br/>\n&gt;<br/>\n&gt; Think &quot;Spring JDBC&quot; only instead of JDBC, it&#39;s a proprietary API to an<br/>\n&gt; obscure database [1]. I&#39;m coming back to this project after several<br/>\n&gt; months, so if I&#39;m not making sense it&#39;s because I&#39;ve forgotten some<br/>\n&gt; details. Please point that out and I&#39;ll re-learn and clarify.<br/>\n&gt;<br/>\n&gt; Where I seem to have gotten stuck is that with EasyMock Class<br/>\n&gt; Extension, I tried this:<br/>\n&gt;<br/>\n&gt; // set up the mock UniFile<br/>\n&gt; ctrlUniFile = MockClassControl.createControl(UniFile.class, null, null);<br/>\n&gt; mockUniFile = (UniFile) ctrlUniSession.getMock();<br/>\n&gt;<br/>\n&gt; And I get:<br/>\n&gt;<br/>\n&gt; net.sf.cglib.core.CodeGenerationException:<br/>\n&gt; asjava.uniobjects.UniFileException--&gt;<br/>\n&gt; Cannot instantiate this object in this manner. Must use the UniSession<br/>\n&gt; object<br/>\n&gt;<br/>\n&gt; The UniSession object is analogous to a Connection. I&#39;m trying to<br/>\n&gt; avoid having to connect to the database to test the &#39;Spring UOJ&#39;<br/>\n&gt; framework code. All I need to know is that it called the read method<br/>\n&gt; on a UniFile, and got something back.<br/>\n&gt;<br/>\n&gt; The test class and stack trace are here:<br/>\n&gt; <a rel=\"nofollow\" target=\"_blank\" href=\"http://wiki.wsmoak.net/cgi-bin/wiki.pl?SpringUOJ/Test\">http://wiki.wsmoak.net/cgi-bin/wiki.pl?SpringUOJ/Test</a><br/>\n&gt;<br/>\n&gt; Any ideas, or do you see anything I&#39;m doing wrong?<br/>\n&gt;<br/>\n&gt; After this, it looks like I started to write concrete &#39;MockUniSession&#39;<br/>\n&gt; and &#39;MockUniFile&#39; classes. Before I continue down that path (or<br/>\n&gt; continue wandering aimlessly) I thought I&#39;d ask for help.<br/>\n&gt;<br/>\n&gt; [1] UniObjects for Java and IBM&#39;s UniData, respectively.<br/>\n&gt;<br/>\n&gt; Thanks,<br/>\n&gt; --<br/>\n&gt; Wendy<br/>\n&gt;<br/>\n&gt;  <br/>\n&gt;<br/>\n<br/>\n<br/>\n[Non-text portions of this message have been removed] </span></blockquote></div>", 
    "prevInTime": 18344, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1163458243", 
    "canDelete": false, 
    "nextInTopic": 0, 
    "prevInTopic": 18344, 
    "headers": {
        "inReplyToHeader": "PGFkYmE5NjE5MDYxMTEyMTMyMXUyMmZkNDU0MnI2YmMzY2I5OGIzZDRmMTg3QG1haWwuZ21haWwuY29tPg==", 
        "messageIdInHeader": "PGI5ZWU1ZTQxMDYxMTEzMTQ1MHg3ZTRkMDc4YXZhYTlkNzM3ZWYyNzVlYWYxQG1haWwuZ21haWwuY29tPg==", 
        "referencesHeader": "PGFkYmE5NjE5MDYxMTEyMTMyMXUyMmZkNDU0MnI2YmMzY2I5OGIzZDRmMTg3QG1haWwuZ21haWwuY29tPg=="
    }
}
{
    "topicId": 1943, 
    "postDate": "995318246", 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "from": "Scott Stirling &lt;sstirling@...&gt;", 
    "canDelete": false, 
    "replyTo": "LIST", 
    "senderId": "tIWYVgeSMdZoZQdf_9fIu1R2a0hnlJvOWTUwyJvJ3oIHvnXxDy5XZco_DPZRDixY5O-yLrjO3_cFk9mPxdjlzCw6ELrfEOuMj_-pb5_boHQ", 
    "nextInTime": 1950, 
    "userId": 0, 
    "prevInTime": 1948, 
    "prevInTopic": 1948, 
    "headers": {
        "messageIdInHeader": "PEM3QUJBMzE1MjA1Q0Q0MTE4Q0U2MDA1MDhCOTUyRDk2NTVGQjY1QHNhbHNhLmFsbGFpcmUuY29tPg=="
    }, 
    "authorName": "Scott Stirling", 
    "numMessagesInTopic": 9, 
    "msgSnippet": "Shoot -- always something wrong. This line: System.out.println(ctx.lookup( base/PointHome )); ...should say: ", 
    "contentTrasformed": false, 
    "msgId": 1949, 
    "nextInTopic": 1973, 
    "systemMessage": false, 
    "rawEmail": "Return-Path: &lt;sstirling@...&gt;\r\nX-Sender: sstirling@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (EGP: mail-7_2_0); 16 Jul 2001 21:18:26 -0000\r\nReceived: (qmail 97202 invoked from network); 16 Jul 2001 21:17:36 -0000\r\nReceived: from unknown (10.1.10.26) by l7.egroups.com with QMQP; 16 Jul 2001 21:17:36 -0000\r\nReceived: from unknown (HELO s0001exc0011.allaire.com) (63.109.193.187) by mta1 with SMTP; 16 Jul 2001 21:17:36 -0000\r\nReceived: by S0001EXC0011 with Internet Mail Service (5.5.2650.21) id &lt;MXX4N1WN&gt;; Mon, 16 Jul 2001 17:17:36 -0400\r\nMessage-ID: &lt;C7ABA315205CD4118CE600508B952D9655FB65@...&gt;\r\nTo: &quot;&#39;junit@yahoogroups.com&#39;&quot; &lt;junit@yahoogroups.com&gt;\r\nSubject: RE: [junit] ClassCastException only using swing/awt ui\r\nDate: Mon, 16 Jul 2001 17:17:26 -0400\r\nMIME-Version: 1.0\r\nX-Mailer: Internet Mail Service (5.5.2650.21)\r\nContent-Type: text/plain; charset=&quot;iso-8859-1&quot;\r\nFrom: Scott Stirling &lt;sstirling@...&gt;\r\n\r\nShoot -- always something wrong.\n\nThis line:\n\nSystem.out.println(ctx.lookup(&quot;base/PointHome&quot;));\n\n...should say:\n\nSystem.out.println(ctx.lookup(&quot;base/PointHome&quot;).getClass().getClassLoader())\n;\n\nSorry,\n\nScott Stirling\nJRun QA\nMacromedia\n\n&gt; -----Original Message-----\n&gt; From: Scott Stirling [mailto:sstirling@...]\n&gt; Sent: Monday, July 16, 2001 5:12 PM\n&gt; To: &#39;junit@yahoogroups.com&#39;\n&gt; Subject: RE: [junit] ClassCastException only using swing/awt ui\n&gt; \n&gt; \n&gt; Interestingly, calls to javax.rmi.PortableRemoteObject are \n&gt; delegated to an\n&gt; implementation of \n&gt; javax.rmi.CORBA.PortableRemoteObjectDelegate, which in\n&gt; Sun&#39;s 1.3.1 JDK is \n&gt; com.sun.corba.se.internal.javax.rmi.PortableRemoteObject.\n&gt; That doesn&#39;t explain anything -- I just thought it was just kinda\n&gt; interesting how buried that reference was.\n&gt; \n&gt; Anyway, this is another problem inherent to JUnit&#39;s Swingui&#39;s\n&gt; TestCaseClassLoader architecture.  Similar to the \n&gt; LinkageErrors with JAXP\n&gt; and the org.xml and org.w3c classes, but with a different result here.\n&gt; We&#39;ve seen it here with EJB lookups too, but we mostly use \n&gt; the Ant runner so\n&gt; it&#39;s not usually a problem.\n&gt; \n&gt; So why a ClassCastException when you narrow() in a TestCase?  \n&gt; \n&gt; Here&#39;s John Pletka&#39;s test code:\n&gt; \n&gt; Point point;\n&gt; PointHome pointHome;\n&gt; \n&gt; //The next line works in textui, but throws \n&gt; //ClassCastException in swingui\n&gt; pointHome =\n&gt; (PointHome)PortableRemoteObject.narrow(ctx.lookup(&quot;base/PointH\n&gt; ome&quot;),PointHom\n&gt; e.class);\n&gt; \n&gt; Recall that in Java 2 an object&#39;s class (aka &quot;runtime type&quot;) \n&gt; is identified\n&gt; in the JVM as \n&gt; &lt;fully-qualified-classname;definingClassLoaderInstance&gt; or\n&gt; &lt;C;L&gt;.  That is, the defining loader is part of the runtime \n&gt; name identifying\n&gt; that class (there&#39;s a subtle distinction in Java between \n&gt; &#39;class&#39; and &#39;type&#39;\n&gt; I won&#39;t go into).  Also recall that the JVM will ask a \n&gt; class&#39;s defining\n&gt; loader to load all unloaded classes referenced by the classes \n&gt; it loads.\n&gt; \n&gt; My hypothesis (I just tested it here and proved it) is that \n&gt; the ctx.lookup()\n&gt; returns an object that was loaded through the JVM&#39;s system classloader\n&gt; (sun.misc.Launcher$AppClassLoader), but the PointHome.class \n&gt; type is loaded\n&gt; by JUnit&#39;s TestCaseClassLoader.  In the narrow, the two fully \n&gt; qualified\n&gt; class names are the same, but the defining classloaders for \n&gt; the two are\n&gt; different so you get the exception because the JVM doesn&#39;t \n&gt; see them as being\n&gt; the same &lt;C;L&gt; class/type.\n&gt; \n&gt; The solution would be to exclude your EJB&#39;s interface classes \n&gt; from being\n&gt; loaded by the JUnit custom class loader by adding them to the\n&gt; excluded.properties in junit.jar.  Granted, not a very nice \n&gt; solution unless,\n&gt; perhaps, it were easier to modify the exclusion list.  I hear \n&gt; in JUnit 4.0\n&gt; that one idea is to make it easy to define exclusions in TestCases\n&gt; themselves.\n&gt; \n&gt; You can find out more about which loader loaded which class \n&gt; by doing this:\n&gt; \n&gt; System.out.println(ctx.lookup(&quot;base/PointHome&quot;));\n&gt; System.out.println(PointHome.class.getClassLoader());\n&gt; \n&gt; I bet you&#39;ll find when using the Swing UI that the PointHome \n&gt; type is defined\n&gt; by the JUnit TestCaseClassLoader and the object returned from \n&gt; ctx.lookup()\n&gt; was defined through the JVM&#39;s system class loader.  When \n&gt; using the textui\n&gt; they&#39;ll both load through the system loader.\n&gt; \n&gt; Scott Stirling\n&gt; JRun QA\n&gt; Macromedia\n&gt; \n&gt; &gt; -----Original Message-----\n&gt; &gt; From: Mike Lepine [mailto:mike.lepine@...]\n&gt; &gt; Sent: Monday, July 16, 2001 2:45 PM\n&gt; &gt; To: junit@yahoogroups.com\n&gt; &gt; Subject: RE: [junit] ClassCastException only using swing/awt ui\n&gt; &gt; \n&gt; &gt; \n&gt; &gt; Thank goodness. I did finally come to the same conclusion that the\n&gt; &gt; swingui.TestRunner was responsible (and not the JNDI code) for the\n&gt; &gt; ClassCastExceptions I was getting when retrieving an object \n&gt; &gt; from JNDI. I\n&gt; &gt; haven&#39;t looked through the TestRunner source to determine why \n&gt; &gt; this occurs\n&gt; &gt; but am also interested to know the answer.\n&gt; \n&gt; ------------------------ Yahoo! Groups Sponsor \n&gt; ---------------------~--&gt;\n&gt; Secure your servers with 128-bit SSL encryption! Grab your copy of\n&gt; VeriSign&#39;s FREE Guide &quot;Securing Your Web Site for Business.&quot; \n&gt; Get it now!\n&gt; http://www.verisign.com/cgi-bin/go.cgi?a=n094442340008000\n&gt; http://us.click.yahoo.com/6lIgYB/IWxCAA/yigFAA/NhFolB/TM\n&gt; --------------------------------------------------------------\n&gt; -------~-&gt;\n&gt; \n&gt; To unsubscribe from this group, send an email to:\n&gt; junit-unsubscribe@yahoogroups.com\n&gt;  \n&gt; \n&gt; Your use of Yahoo! Groups is subject to \nhttp://docs.yahoo.com/info/terms/ \n\n\n", 
    "subject": "RE: [junit] ClassCastException only using swing/awt ui"
}
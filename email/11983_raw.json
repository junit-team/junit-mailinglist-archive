{
    "numMessagesInTopic": 6, 
    "nextInTime": 11984, 
    "senderId": "D0MYN3OoPiv9tzSkHghiAjREVXdUhi48kb5QikBUuFgGzFTz02vUiaG49L08sRVs6NjpI0L1tNOoTicPxuLGbrDKdno", 
    "systemMessage": false, 
    "subject": "Re: [junit] Testing Spring/Hibernate", 
    "from": "jeff.nielsen@...", 
    "authorName": "jeff.nielsen@digitalfocus.com", 
    "msgSnippet": "We have a thorougly-unit-tested J2EE app that also uses Spring & Hibernate.  Here are a couple of recommendations. 1. Do most of your unit testing so that it", 
    "msgId": 11983, 
    "rawEmail": "Return-Path: &lt;jeff.nielsen@...&gt;\r\nX-Sender: jeff.nielsen@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (qmail 54786 invoked from network); 14 Sep 2004 19:13:57 -0000\r\nReceived: from unknown (66.218.66.217)\n  by m3.grp.scd.yahoo.com with QMQP; 14 Sep 2004 19:13:57 -0000\r\nReceived: from unknown (HELO host54a.simplicato.com) (207.99.47.54)\n  by mta2.grp.scd.yahoo.com with SMTP; 14 Sep 2004 19:13:57 -0000\r\nReceived: from localhost (localhost.simplicato.com [127.0.0.1])\n\tby host54a.simplicato.com (Postfix) with ESMTP id AF51010C016\n\tfor &lt;junit@yahoogroups.com&gt;; Tue, 14 Sep 2004 15:13:51 -0400 (EDT)\r\nReceived: from host54a.simplicato.com ([127.0.0.1])\n by localhost (host54a.simplicato.com [127.0.0.1]) (amavisd-new, port 10024)\n with ESMTP id 83305-07 for &lt;junit@yahoogroups.com&gt;;\n Tue, 14 Sep 2004 15:13:50 -0400 (EDT)\r\nReceived: from mail.digitalfocus.com (localhost.simplicato.com [127.0.0.1])\n\tby host54a.simplicato.com (Postfix) with SMTP id 6512A10C012\n\tfor &lt;junit@yahoogroups.com&gt;; Tue, 14 Sep 2004 15:13:50 -0400 (EDT)\r\nReceived: from 204.156.0.10\n        (SquirrelMail authenticated user jeff.nielsen@...)\n        by mail.host54a.simplicato.com with HTTP;\n        Tue, 14 Sep 2004 15:13:50 -0400 (EDT)\r\nMessage-ID: &lt;60915.204.156.0.10.1095189230.squirrel@...&gt;\r\nIn-Reply-To: &lt;ci53mf+2fav@...&gt;\r\nReferences: &lt;ci53mf+2fav@...&gt;\r\nDate: Tue, 14 Sep 2004 15:13:50 -0400 (EDT)\r\nTo: junit@yahoogroups.com\r\nUser-Agent: SquirrelMail/1.4.2\r\nMIME-Version: 1.0\r\nContent-Type: text/plain;charset=iso-8859-1\r\nContent-Transfer-Encoding: 8bit\r\nX-Priority: 3\r\nImportance: Normal\r\nX-Virus-Scanned: by amavisd-new at simplicato.com\r\nX-eGroups-Remote-IP: 207.99.47.54\r\nFrom: jeff.nielsen@...\r\nSubject: Re: [junit] Testing Spring/Hibernate\r\nX-Yahoo-Group-Post: member; u=65487161\r\nX-Yahoo-Profile: jeffreymads\r\n\r\nWe have a thorougly-unit-tested J2EE app that also uses Spring &\nHibernate.  Here are a couple of recommendations.\n\n1. Do most of your unit testing so that it is /independent/ of the\ndatabase.  Test all of the callers of the DAO--such as\nInvestorWebServices--using a MockHibernateFacade that returns the data you\nset up in the test.\n\n2. For testing the DAO operation itself (as in the example you give\nbelow), configure the test so that it /does not/ use the transaction\nmanager at all.  You could do this by having multiple versions of the\napplicationContext.xml as you suggest, but it is probably easier just to\ninstantiate the DAO &quot;by hand&quot; with setUp code in your test.  Just because\nyou are using the Hibernate container to hook up your objects in\nproduction doesn&#39;t mean that you can&#39;t do manual setup for unit testing.\n\n3. Testing that the transactions are working properly should be an\nentirely different test than making sure the DB updates work.  Here is an\nexample transaction test case, with the associated method that builds the\nSpring transaction manager.\n\npublic class CellServiceTxnTestDb extends TestCase {\n\n.    public void testTransactonRollback() throws Exception {\n.        CellServiceImpl impl = new CellServiceImpl() {\n.            protected void touchCampaignUpdateDate(Cell cell) {\n.                throw new RuntimeException(&quot;Campaign table update had a\nproblem!&quot;);\n.            }\n.        };\n.        impl.setHibernate(IntegrationLocator.getHibernate());\n\n.        CellService service = (CellService)\n.            ServiceLocator.createTxnProxy(impl, CellService.class);\n\n.        Cell cell = service.findByPrimaryKey(new Integer(-1));\n.        cell.setName(&quot;Trying to change the name&quot;);\n.        try {\n.            service.updateCellHeader(cell);\n.            fail(&quot;Testing the test&quot;);\n.        } catch (RuntimeException expected) {}\n\n.        cell = service.findByPrimaryKey(new Integer(-1));\n.        assertEquals(&quot;Should not change the name!!&quot;, &quot;Original&quot;,\ncell.getName());\n.    }\n.}\n\n.    /** Public so tests can use this method also */\n.    public static Object createTxnProxy(Object target, Class\ninterfaceClass) {\n.        if (txnManager == null) {\n.            // lazily load this\n.            txnManager = new HibernateTransactionManager(\n.                    IntegrationLocator.getSessionFactory());\n.        }\n.        TransactionProxyFactoryBean proxy = new\nTransactionProxyFactoryBean();\n.        proxy.setTransactionManager(txnManager);\n.        proxy.setTarget(target);\n.        proxy.setTransactionAttributes(getTxnProperties(interfaceClass));\n.        proxy.afterPropertiesSet();\n.        return proxy.getObject();\n.    }\n\n\n\n\nIn general, architect your system so that you can hook up the objects\nhowever you want for unit testing.  Then separate them through interfaces\nand test them one at a time.\n\n\nJeff Nielsen\nDigital Focus\nwww.digitalfocus.com\n\n&gt; Hi\n&gt;\n&gt; I am working a project with a contactor where we are using Spring and\n&gt; Hibernate (both which are new to me, and somewhat new to the\n&gt; contractor).\n&gt;\n&gt; Our app is a Swing client calling WebServices running in WebSphere.\n&gt; The Webservices uses a DAO object which extends the\n&gt; HibernateDaoSupport class provided by the Spring framework.\n&gt;\n&gt; Now according to the contractor, the way we have the transaction\n&gt; manager setup in our applicationContext.xml file\n&gt; using &quot;PROPAGATION_REQUIRED&quot; for our get/save/update/delete\n&gt; operations means that the &quot;commit&quot; of the transaction will only occur\n&gt; when the starting method is finished.\n&gt;\n&gt; So if we were to create a JUnit test:\n&gt;\n&gt; public void testUpdate()\n&gt; {\n&gt;         InvestorWebServices iws = new InvestorWebServices();\n&gt;         InvestorDTO identity = iws.getInvestorByPK(new Integer\n&gt; (7000011));\n&gt;         identity.setName(&quot;Bob);\n&gt;\n&gt;         iws.updateInvestor(identity);\n&gt; }\n&gt;\n&gt; He is telling me that the commit to the Db will not have happened\n&gt; until the testUpdate method has completed.\n&gt;\n&gt; As part of the test we want to be able to assert that the record in\n&gt; the db has indeed been updated so in our current situation we could\n&gt; not do that within the testUpdate method.\n&gt;\n&gt; I was wondering if anyone with more experience than us is doing\n&gt; similar testing with Spring/Hibernate and how are the doing such\n&gt; testing?\n&gt;\n&gt; On idea I have just briefly read about looked like it had different\n&gt; applicationContext.xml files, and so perhaps creating one for testing\n&gt; so that the commit occurs as soon as iws.updateInvestor(identity) is\n&gt; called and the assertion of the db can be then done after the call.\n&gt; Is that feasible?\n&gt;\n&gt; Thanks for any advice.\n&gt;\n&gt; Shane\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt; Yahoo! Groups Links\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n\n\n", 
    "profile": "jeffreymads", 
    "topicId": 11972, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 65487161, 
    "prevInTime": 11982, 
    "contentTrasformed": false, 
    "postDate": "1095189230", 
    "canDelete": false, 
    "nextInTopic": 12071, 
    "prevInTopic": 11972, 
    "headers": {
        "inReplyToHeader": "PGNpNTNtZisyZmF2QGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PDYwOTE1LjIwNC4xNTYuMC4xMC4xMDk1MTg5MjMwLnNxdWlycmVsQG1haWwuaG9zdDU0YS5zaW1wbGljYXRvLmNvbT4=", 
        "referencesHeader": "PGNpNTNtZisyZmF2QGVHcm91cHMuY29tPg=="
    }
}
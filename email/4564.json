{
    "numMessagesInTopic": 52, 
    "nextInTime": 4565, 
    "senderId": "zAP9jPFJoHjNU3EYjqtPbomMeb5lXVjBJONsCcbsAfpjXCKrm68HfmfDCQlbz505yBKNNLYArgBJ87bKhsn-vcuaq5stjMUzNlM", 
    "systemMessage": false, 
    "subject": "DynamicTestAll", 
    "from": "John Goodsen &lt;jgoodsen@...&gt;", 
    "authorName": "John Goodsen", 
    "msgSnippet": "While I m posting code, here s a nifty class that dynamically searches for all unit tests in your classpath and builds up the test suite for you on the fly...", 
    "msgId": 4564, 
    "profile": "jgoodsen", 
    "topicId": 3179, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 29621510, 
    "messageBody": "<div id=\"ygrps-yiv-513440816\">While I&#39;m posting code, here&#39;s a nifty class that<br/>\ndynamically searches for all unit tests in your<br/>\nclasspath and builds up the test suite for you<br/>\non the fly... saving you the need to manually<br/>\nupdate TestSuites whenever you add a TestCase<br/>\nto your project.  There are several variants of<br/>\nthis running around on the net also ... thanks<br/>\nfor putting up with a code post :-)<br/>\n<br/>\n-- <br/>\nJohn Goodsen           RADSoft / Rapid Software Delivery Specialists<br/>\n<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:jgoodsen@...\">jgoodsen@...</a>             eXtreme Java Internet Consultants<br/>\n<a rel=\"nofollow\" target=\"_blank\" href=\"http://www.radsoft.com\">http://www.radsoft.com</a>           Toll Free: 866-RADSOFT (723-7638)<br/>\n<br/>\n<br/>\n--------- DynamicTestAll.java --------------<br/>\n<br/>\nimport java.io.File;<br/>\nimport java.io.FileFilter;<br/>\nimport java.util.*;<br/>\nimport junit.framework.Test;<br/>\nimport junit.framework.TestCase;<br/>\nimport junit.framework.TestSuite;<br/>\nimport org.apache.log4j.Category;<br/>\n<br/>\npublic class DynamicTestAll {<br/>\n    private static final Category log = <br/>\nCategory.getInstance(DynamicTestAll.class);<br/>\n    private static final String CLASS_SUFFIX = &quot;.class&quot;;<br/>\n    private String testCasePrefix;<br/>\n<br/>\n    public DynamicTestAll() {<br/>\n        this(&quot;Test&quot;);<br/>\n    }<br/>\n<br/>\n    public DynamicTestAll(String testCasePrefix) {<br/>\n        this.testCasePrefix = testCasePrefix;<br/>\n    }<br/>\n<br/>\n    private String getTestCasePrefix() {<br/>\n        return testCasePrefix;<br/>\n    }<br/>\n<br/>\n    public Test suite() {<br/>\n        String classPathValue = System.getProperty(&quot;java.class.path&quot;);<br/>\n        String classPaths[] = parseClassPath(classPathValue);<br/>\n        return getAllTests(classPaths);<br/>\n    }<br/>\n<br/>\n    private String[] parseClassPath(String classPathValue) {<br/>\n        ArrayList paths = new ArrayList();<br/>\n        for (StringTokenizer tokenizer = new StringTokenizer(classPathValue, <br/>\nFile.pathSeparator); tokenizer.hasMoreTokens(); <br/>\npaths.add(tokenizer.nextToken())) ;<br/>\n        return (String[]) paths.toArray(new String[0]);<br/>\n    }<br/>\n<br/>\n    public Test getAllTests(String rootPaths[]) {<br/>\n        TestSuite suite = new TestSuite();<br/>\n        for (int i = 0; i &lt; rootPaths.length; i++)<br/>\n            suite.addTest(getAllTests(rootPaths[i]));<br/>\n<br/>\n        return suite;<br/>\n    }<br/>\n<br/>\n    public Test getAllTests(String rootPath) {<br/>\n        try {<br/>\n            File classPath = new File(rootPath);<br/>\n            if (!classPath.exists()) throw new <br/>\nIllegalArgumentException(&quot;Directory &quot; + classPath.getAbsolutePath() + &quot; does <br/>\nnot exist.&quot;);<br/>\n<br/>\n            Set classes = recursivelyFindEveryTestClassfile(classPath);<br/>\n            TestSuite suite = new TestSuite();<br/>\n            if (classes != null && classes.size() &gt; 0) {<br/>\n                for (Iterator it = classes.iterator(); it.hasNext();) {<br/>\n                    File classFile = (File) it.next();<br/>\n                    String className = classNameFromFile(classPath, <br/>\nclassFile);<br/>\n                    log.debug(&quot;Loading class: &quot; + className);<br/>\n                    if (className.endsWith(&quot;AllTests&quot;)) {<br/>\n                        System.err.println(&quot;WARNING: Remove &quot; + className + &quot; <br/>\nfrom the system now. - DynamicTestAll is being used instead.&quot;);<br/>\n                        continue;<br/>\n                    }<br/>\n                    try {<br/>\n                        Class testClass = Class.forName(className);<br/>\n                        if ((TestCase.class).isAssignableFrom(testClass)) <br/>\nsuite.addTest(new TestSuite(testClass));<br/>\n                    } catch (NoClassDefFoundError e) {<br/>\n                        log.warn(&quot;Skipping &quot; + className + &quot; due to <br/>\nNoClassDefFoundError&quot;);<br/>\n                    } catch (ClassNotFoundException e) {<br/>\n                        log.warn(&quot;Skipping &quot; + className + &quot; due to <br/>\nClassNotFoundException&quot;);<br/>\n                    }<br/>\n                }<br/>\n            }<br/>\n            return suite;<br/>\n        } catch (RuntimeException ex) {<br/>\n            ex.printStackTrace();<br/>\n            throw ex;<br/>\n        }<br/>\n    }<br/>\n<br/>\n    private String classNameFromFile(File classPath, File classFile) {<br/>\n        if (!classFile.getName().endsWith(CLASS_SUFFIX)) throw new <br/>\nIllegalArgumentException(&quot;Can only extract a className from a .class file&quot;);<br/>\n        String absolutePath = classFile.getAbsolutePath();<br/>\n        String relativePath = <br/>\nabsolutePath.substring(classPath.getAbsolutePath().length() + 1);<br/>\n        String className = relativePath.replace(File.separatorChar, &#39;.&#39;);<br/>\n        return className.substring(0, className.length() - <br/>\nCLASS_SUFFIX.length());<br/>\n    }<br/>\n<br/>\n    private Set recursivelyFindEveryTestClassfile(File dir) {<br/>\n<br/>\n        class ClassFileAndDirectoriesFilter implements FileFilter {<br/>\n            public boolean accept(File pathname) {<br/>\n                return pathname.getName().endsWith(CLASS_SUFFIX) || <br/>\npathname.isDirectory();<br/>\n            }<br/>\n        }<br/>\n<br/>\n        Set classFiles = new TreeSet();<br/>\n        if (dir.getName().endsWith(&quot;.jar&quot;)) {<br/>\n            log.warn(&quot;Not searching for TestsCases inside jar file <br/>\n&quot;.concat(String.valueOf(String.valueOf(dir.getAbsolutePath()))));<br/>\n            return classFiles;<br/>\n        }<br/>\n<br/>\n        if (!dir.isDirectory() || !dir.exists()) throw new <br/>\nIllegalArgumentException(dir.getAbsolutePath() + &quot; is not a directory or does <br/>\nnot exist.&quot;);<br/>\n<br/>\n        File files[] = dir.listFiles(new ClassFileAndDirectoriesFilter());<br/>\n        if (files == null) {<br/>\n            log.warn(&quot;listFiles() returned null on <br/>\n&quot;.concat(String.valueOf(String.valueOf(dir.getAbsolutePath()))));<br/>\n            return classFiles;<br/>\n        }<br/>\n        for (int i = 0; i &lt; files.length; i++) {<br/>\n            File file = files[i];<br/>\n            if (file.isDirectory()) {<br/>\n                classFiles.addAll(recursivelyFindEveryTestClassfile(file));<br/>\n                continue;<br/>\n            }<br/>\n            if (isTestCasefile(file)) {<br/>\n                log.debug(&quot;Adding file: &quot; + file.getAbsolutePath());<br/>\n                classFiles.add(file);<br/>\n            }<br/>\n        }<br/>\n<br/>\n        return classFiles;<br/>\n    }<br/>\n<br/>\n    private boolean isTestCasefile(File file) {<br/>\n        if (isInnerClass(file))<br/>\n            return false;<br/>\n        else<br/>\n            return file.getName().startsWith(getTestCasePrefix());<br/>\n    }<br/>\n<br/>\n    private static boolean isInnerClass(File file) {<br/>\n        String name = file.getName();<br/>\n        return name.indexOf(&quot;$&quot;) != -1;<br/>\n    }<br/>\n<br/>\n}</div>", 
    "prevInTime": 4563, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1017783651", 
    "canDelete": false, 
    "nextInTopic": 4565, 
    "prevInTopic": 4563, 
    "headers": {
        "inReplyToHeader": "PEY4OU9BbmpMR1hZQjFKNU5QQWswMDAwNGM2ZUBob3RtYWlsLmNvbT4=", 
        "referencesHeader": "PEY4OU9BbmpMR1hZQjFKNU5QQWswMDAwNGM2ZUBob3RtYWlsLmNvbT4="
    }
}
{
    "numMessagesInTopic": 12, 
    "nextInTime": 23792, 
    "senderId": "2KgKULg_yvJ0i_sR5yHRCjyeZ1EJmLRmnPaXgXnjsn05qenj-vw5PFLOqgTi7DnRoM1t_BonhNoeIG3BaA", 
    "systemMessage": false, 
    "subject": "Re: Runner for maven", 
    "from": "kristian@...", 
    "authorName": "kristian@rosenvold.com", 
    "msgSnippet": "maven-surefire now also supports concurrent forks, and they don t have any of the interaction problems you describe - as you know. Since surefire is an", 
    "msgId": 23791, 
    "rawEmail": "Return-Path: &lt;kristian@...&gt;\r\nX-Sender: kristian@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nX-Received: (qmail 12825 invoked from network); 5 Jan 2012 11:36:15 -0000\r\nX-Received: from unknown (98.137.35.161)\n  by m11.grp.sp2.yahoo.com with QMQP; 5 Jan 2012 11:36:15 -0000\r\nX-Received: from unknown (HELO n44d.bullet.mail.sp1.yahoo.com) (66.163.169.158)\n  by mta5.grp.sp2.yahoo.com with SMTP; 5 Jan 2012 11:36:15 -0000\r\nX-Received: from [69.147.65.149] by n44.bullet.mail.sp1.yahoo.com with NNFMP; 05 Jan 2012 11:36:15 -0000\r\nX-Received: from [98.137.34.155] by t9.bullet.mail.sp1.yahoo.com with NNFMP; 05 Jan 2012 11:36:15 -0000\r\nDate: Thu, 05 Jan 2012 11:36:14 -0000\r\nTo: junit@yahoogroups.com\r\nMessage-ID: &lt;je41ve+g5se@...&gt;\r\nIn-Reply-To: &lt;CAM21Rt8TrjSUsOZU4=3mdVvGA9LekMD5=9c2whoA0sYU7vLmLA@...&gt;\r\nUser-Agent: eGroups-EW/0.82\r\nMIME-Version: 1.0\r\nContent-Type: text/plain; charset=&quot;ISO-8859-1&quot;\r\nContent-Transfer-Encoding: quoted-printable\r\nX-Mailer: Yahoo Groups Message Poster\r\nX-Yahoo-Newman-Property: groups-compose\r\nX-eGroups-Msg-Info: 1:6:0:0:0\r\nFrom: kristian@...\r\nSubject: Re: Runner for maven\r\nX-Yahoo-Group-Post: member; u=403861045; y=_RGaStwbYe4sBMj61xaBvPS5S14yoFeE7piLjl3PQ7gy6rVvnA\r\nX-Yahoo-Profile: krosenvold\r\n\r\nmaven-surefire now also supports concurrent forks, and they don&#39;t have any =\r\nof the interaction problems you describe - as you know. Since surefire is a=\r\nn all-purpose runner, we try to support any &quot;sensible&quot; mode of execution, a=\r\nnd there are good use cases for both models of execution.\n\nYour first sugge=\r\nstion seems to work quite well, using the Computer I just wrap the created =\r\nrunner in another runner that attaches the testclass to the thread (and del=\r\negates on to the target Runner), which we pick up in reporting.\n\nSurefire d=\r\noes all the other stuff already, but I&#39;m thinking we might\nbe deprecating &quot;=\r\nboth&quot; mode threading support because it becomes \nsuch a pain to do correctl=\r\ny, at least it requires a tight collaboration between the RunListener and t=\r\nhe Computer.\n\n\nKristian\n\n--- In junit@yahoogroups.com, Dawid Weiss &lt;dawid.w=\r\neiss@...&gt; wrote:\n&gt;\n&gt; Hi Kristian,\n&gt; \n&gt; We had a similar issue. I was debati=\r\nng for a longer while if it makes sense\n&gt; to run parallel tests within the =\r\nsame VM. In many situations this speeds\n&gt; things a lot and has a nice memor=\r\ny conserving footprint but you cannot\n&gt; guarantee tests won&#39;t interact with=\r\n each other (in the simplest case via\n&gt; mutating system properties). Finall=\r\ny the decision was to do it like Apache\n&gt; Lucene did it -- split tests into=\r\n parallel slave VMs with repeatable suite\n&gt; execution order and sequential =\r\ntest execution within a single VM. This is\n&gt; implemented in an ANT task cal=\r\nled junit4 here.\n&gt; \n&gt; https://github.com/carrotsearch/randomizedtesting/tre=\r\ne/master/ant-junit4\n&gt; \n&gt; JUnit tests inside will give you a hint how to use=\r\n it, the code is still\n&gt; very fresh so documentation is scarce.\n&gt; \n&gt; Now...=\r\n this was a digression. Back to your question (because we did go that\n&gt; rou=\r\nte as well, only backed up), one possible solution to isolating\n&gt; sysout/sy=\r\nserrs of parallel tests in a single VM is:\n&gt; \n&gt; 1) isolate each suite (for =\r\n@BeforeClass/ @AfterClass hooks) into a separate\n&gt; thread which you have un=\r\nder control. This can be either a custom @Runner or\n&gt; a Computer, many ways=\r\n to achieve it.\n&gt; \n&gt; 2) write a PrintStream implementation that redirects t=\r\no a thread-local\n&gt; buffer. This gist implements a similar idea to demux mul=\r\ntiple thread\n&gt; streams so that each one&#39;s output appears on a single line; =\r\nyou&#39;ll get the\n&gt; idea I&#39;m sure.\n&gt; \n&gt; https://gist.github.com/1561833\n&gt; \n&gt; 3=\r\n) once you have the above the rest is easy: replace default\n&gt; System.out/Sy=\r\nstem.err (I assume no security manager is present or it allows\n&gt; such repla=\r\ncement), clear the buffer before suite, run your suite, flush the\n&gt; buffer.=\r\n The buffer&#39;s content will be your thread&#39;s output even though\n&gt; system.* a=\r\nre singletons.\n&gt; \n&gt; Like I said though -- I would consider using multiple j=\r\nvms for running\n&gt; parallel tests instead.\n&gt; \n&gt; Dawid\n&gt; \n&gt; On Wed, Jan 4, 20=\r\n12 at 7:51 AM, &lt;kristian@...&gt; wrote:\n&gt; \n&gt; &gt; **\n&gt; &gt;\n&gt; &gt;\n&gt; &gt; Sorry, I was doi=\r\nng just what I sometimes dislike of our own users ;)\n&gt; &gt;\n&gt; &gt; The real probl=\r\nem I want to solve is associating console output from a\n&gt; &gt; running thread =\r\nto a given test-case (for parallel runs). We have this\n&gt; &gt; fairly well cove=\r\nred already and we manage to capture everything that\n&gt; &gt; happens within a g=\r\niven test-case for that test-case.\n&gt; &gt;\n&gt; &gt; The real problem is that the Run=\r\nListener API does not demarcate\n&gt; &gt; test-classes properly, so I am unable t=\r\no distinguish console output\n&gt; &gt; happening in @AfterClass of one test with =\r\n@BeforeClass on the test-class on\n&gt; &gt; the same thread.\n&gt; &gt;\n&gt; &gt; This problem=\r\n has been in the corner of my eye for quite some time and I&#39;ve\n&gt; &gt; been try=\r\ning to find a decent angle to solve it from. I promise not to do\n&gt; &gt; anythi=\r\nng that is frowned upon, which is why I asked ;)\n&gt; &gt;\n&gt; &gt; Kristian\n&gt; &gt;\n&gt; &gt;\n&gt;=\r\n &gt; --- In junit@yahoogroups.com, Matthew Farwell &lt;matthew@&gt; wrote:\n&gt; &gt; &gt;\n&gt; =\r\n&gt; &gt; Kristian,\n&gt; &gt; &gt;\n&gt; &gt; &gt; In reading your original mail, I was also confuse=\r\nd as to what you wanted\n&gt; &gt; to\n&gt; &gt; &gt; achieve. Could you expand a little ple=\r\nase?\n&gt; &gt; &gt;\n&gt; &gt; &gt; Thanks.\n&gt; &gt; &gt;\n&gt; &gt; &gt; Matthew Farwell.\n&gt; &gt; &gt;\n&gt; &gt; &gt; Le 3 janv=\r\nier 2012 22:45, hkaipe &lt;hkaipe@&gt; a =C3=A9crit :\n&gt; &gt;\n&gt; &gt; &gt;\n&gt; &gt; &gt; &gt; **\n&gt; &gt; &gt; =\r\n&gt;\n&gt; &gt; &gt; &gt; Hi Kristian\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; Do you really want a transition from =\r\nRunListener?\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; To an outside observer - a JUnit Runner &quot;descr=\r\nibes&quot; its test-executions\n&gt; &gt; &gt; &gt; and reports their outcome to the RunNotif=\r\nier, which forward the info to\n&gt; &gt; &gt; &gt; RunListener, which is the interface =\r\nthat 3rd-party test-running\n&gt; &gt; &gt; &gt; applications (e.g. IDEs, Maven-Surefire=\r\n etc) are expected to use.\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; I have seen IDE-project test-ext=\r\nensions try to go beyond\n&gt; &gt; &gt; &gt; RunListener/RunNotifier and start to joggl=\r\ne with Runner internals (e.g.\n&gt; &gt; &gt; &gt; test-instance creation/setup, method-=\r\nexecutions etc) and the result is\n&gt; &gt; &gt; &gt; something I don&#39;t like much. It w=\r\norks for simple cases but with\n&gt; &gt; customized\n&gt; &gt; &gt; &gt; Runner-classes and ne=\r\nw JUnit-features (e.g. the introduction of\n&gt; &gt; &gt; &gt; JUnit-Rules) the result =\r\nis usually bad and it discourages the IDE users\n&gt; &gt; &gt; &gt; (i.e. the developer=\r\ns) from taking full advantage of JUnit!\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; However, Maven (ver=\r\nsions 2.0-2.2) and its Surefire-plugin has handled\n&gt; &gt; the\n&gt; &gt; &gt; &gt; JUnit-in=\r\ntegration wonderfully, as far as I know, so your post worries\n&gt; &gt; me a\n&gt; &gt; =\r\n&gt; &gt; little. What is it that you want to accomplish by moving away from the\n=\r\n&gt; &gt; &gt; &gt; successful(!) &quot;Junitcore+RunListener based approach&quot;?\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt;=\r\n &gt; Henrik\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; --- In junit@yahoogroups.com, kristian@ w=\r\nrote:\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; Hi,\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; I maintain the junit prov=\r\nider for maven-surefire, and I&#39;m looking\n&gt; &gt; into\n&gt; &gt; &gt; &gt; transitioning fro=\r\nm a Junitcore+RunListener based approach to an\n&gt; &gt; approach\n&gt; &gt; &gt; &gt; based o=\r\nn something like BlockJUnit4ClassRunner.\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; Unfortunately =\r\nI cannot subclass the BlockJUnit4ClassRunner since the\n&gt; &gt; &gt; &gt; client code =\r\nitself may need to do that, so I&#39;d somehow need to put &quot;my&quot;\n&gt; &gt; &gt; &gt; &gt; Runne=\r\nr in front of the client-supplied one, maybe something proxy\n&gt; &gt; like.\n&gt; &gt; =\r\n&gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; Anyone have any tips on this, maybe some existing code that=\r\n does\n&gt; &gt; this ?\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; Kristian\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt;\n&gt; &gt;=\r\n &gt; &gt;\n&gt; &gt; &gt;\n&gt; &gt; &gt;\n&gt; &gt; &gt; [Non-text portions of this message have been removed=\r\n]\n&gt; &gt; &gt;\n&gt; &gt;\n&gt; &gt;  \n&gt; &gt;\n&gt; \n&gt; \n&gt; [Non-text portions of this message have been =\r\nremoved]\n&gt;\n\n\n\n", 
    "profile": "krosenvold", 
    "topicId": 23785, 
    "spamInfo": {
        "reason": "6", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 403861045, 
    "prevInTime": 23790, 
    "contentTrasformed": false, 
    "postDate": "1325763374", 
    "canDelete": false, 
    "nextInTopic": 23792, 
    "prevInTopic": 23790, 
    "headers": {
        "inReplyToHeader": "PENBTTIxUnQ4VHJqU1VzT1pVND0zbWRWdkdBOUxla01ENT05YzJ3aG9BMHNZVTd2TG1MQUBtYWlsLmdtYWlsLmNvbT4=", 
        "messageIdInHeader": "PGplNDF2ZStnNXNlQGVHcm91cHMuY29tPg=="
    }
}
{
    "numMessagesInTopic": 5, 
    "nextInTime": 14054, 
    "senderId": "LcfxO8qdKvtCfpmT1khrzyJap-znE_jn8ua8c8458G_9yhVRvLD38BsPU3RFv6oLPuBw-cTdEN4apf59uXPryQFFhjw-BFm7hnPQ", 
    "systemMessage": false, 
    "subject": "Re: Using a Special Class Loader to test a Singleton", 
    "from": "&quot;Jeff Grigg&quot; &lt;jeffgrigg@...&gt;", 
    "authorName": "Jeff Grigg", 
    "msgSnippet": "... To directly answer your question:  You can t cast the object because it was created under a different class loader.  You can only interact with that class", 
    "msgId": 14053, 
    "profile": "jeffgrigg63132", 
    "topicId": 14046, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 139880894, 
    "messageBody": "<div id=\"ygrps-yiv-2112275360\">--- &quot;raycclough&quot; &lt;ray@a...&gt; wrote:<br/>\n<blockquote><span title=\"ireply\"> &gt; [...], I created a custom Class Loader, and use Reflection to<br/>\n&gt; create the object.  It works great (except, of course, where<br/>\n&gt; it doesn&#39;t).  The reflexively obtained constructor returns an<br/>\n&gt; object of type &#39;Object&#39;, which the debugger says has the<br/>\n&gt; correct underlying type, and it contains the correct data,<br/>\n&gt; but I cannot Cast it to the type it needs to be.  Any hint<br/>\n&gt; to what I&#39;m doing wrong?  Thanks for any advice you can give<br/>\n&gt; me on this.<br/>\n<br/>\n </span></blockquote>To directly answer your question:  You can&#39;t cast the object because <br/>\nit was created under a different class loader.  You can only <br/>\ninteract with that class through reflection.  You can&#39;t cast it to <br/>\ntypes or interfaces -- unless those classes were loaded by a common <br/>\nclass loader -- IE: the system class loader.<br/>\n<br/>\nI worked around this recently by loading the TestCase class itself <br/>\nunder the new class loader and calling the current test method on <br/>\nthe new instance, using reflection.  (And setting a flag so that the <br/>\nnew instance knew it was running under the new class loader.)<br/>\n<br/>\nA bit more detail:  The &quot;type&quot; of an instance, its identification, <br/>\nis the class name *PLUS* the the address of the ClassLoader instance <br/>\nthat loaded it.  That&#39;s how web servers keep applications separate <br/>\nfrom each other: They create one ClassLoader instance for each <br/>\nlogical application &quot;process&quot; they want to keep separate.<br/>\n<br/>\nQuestion:<br/>\nSince you&#39;re already using &#39;.setAccessible(true)&#39; already, why not <br/>\nuse reflection to replace the static singleton instance field?<br/>\n<br/>\n<blockquote><span title=\"qreply\"> &gt; [...]<br/>\n&gt;     SpecialClassLoader loader = new SpecialClassLoader();<br/>\n&gt;     Class ctlrClass = loader.findClass(\t\t\t<br/>\n&gt; &quot;rdyne_rdcs.comm_gateway.controller.DefaultGatewayController&quot;);<br/>\n&gt; \t\t\t\t\t\t\t\t<br/>\n&gt;     // instantiate the controller using reflection<br/>\n&gt;     Class[] paramTypes = { Reader.class };<br/>\n&gt;     Object[] args = {reader};    // contains the &quot;test data&quot;<br/>\n&gt; \t\t\t<br/>\n&gt;     Constructor constructor = <br/>\n&gt; ctlrClass.getDeclaredConstructor(paramTypes);<br/>\n&gt;     constructor.setAccessible(true);<br/>\n&gt;     Object o = constructor.newInstance(args);<br/>\n&gt; \t\t\t<br/>\n&gt;     //Method m = ctlrClass.getMethod(&quot;getController&quot;,paramTypes);<br/>\n&gt;     //m.setAccessible(true);<br/>\n&gt;     //Object o = m.invoke(null,args);<br/>\n&gt; \t\t\t<br/>\n&gt; // TODO  - Figure this out!!!!!!!!!!!!!!!!!!<br/>\n&gt; // unfortunately somehow the Object may not be cast to the required<br/>\n&gt; // class &quot;DefaultGatewayController&quot;, or even to its interface.<br/>\n&gt; // This is true whether the &quot;Constructor&quot; method or the &quot;Method&quot;<br/>\n&gt; // method is used.  <br/>\n&gt; <br/>\n&gt;     if ( DefaultGatewayController.class.isInstance(o) ) {<br/>\n&gt;         // &quot;o&quot; may safely be cast as a &quot;DefaultGatewayController&quot;<br/>\n&gt; \tSystem.out.println(&quot;YOWSA&quot;);<br/>\n&gt; \tctlr = (DefaultGatewayController)o;<br/>\n&gt;     } else {<br/>\n&gt; \tSystem.out.println(&quot;OHNO&quot;);<br/>\n&gt; \tSystem.out.println(&quot;Class: &quot; + o.getClass().getName());<br/>\n&gt;     }<br/>\n&gt; [...]<br/>\n&gt; <br/>\n&gt; This always goes thru the &quot;OHNO&quot; branch, although the output<br/>\n&gt; of the class name is what it should be to allow me to cast it.<br/>\n&gt; I&#39;m fairly new to JUnit, and I&#39;m really new to custom Class<br/>\n&gt; Loaders, but it seems to me that this should work easily and<br/>\n&gt; well. [...] </span></blockquote></div>", 
    "prevInTime": 14052, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1119962524", 
    "canDelete": false, 
    "nextInTopic": 14062, 
    "prevInTopic": 14051, 
    "headers": {
        "inReplyToHeader": "PGQ5cTU1Zis3NjVrQGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PGQ5cmdpcytqaml1QGVHcm91cHMuY29tPg=="
    }
}
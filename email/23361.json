{
    "numMessagesInTopic": 10, 
    "nextInTime": 23362, 
    "senderId": "sNIKeE2D4xaWChvHQXsxEaDRSkPjnmCeofJ1t2zgYGHa4AruU-EuvvdQn6zRzxWVU582XmfJFAAWo2KNYbWm93drAs86XkZ9pprVfovYlYrB3w", 
    "systemMessage": false, 
    "subject": "Re: [junit] Sometimes my tests fail, sometimes not - why?!", 
    "from": "Joakim Ohlrogge &lt;joakim.ohlrogge@...&gt;", 
    "authorName": "Joakim Ohlrogge", 
    "msgSnippet": "It seems from your later mails that you figured out the JUnit internals and eliminated the possibility of threading in JUnit. So, yes, as you know by now A", 
    "msgId": 23361, 
    "profile": "j0hlrogge", 
    "topicId": 23353, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 261856052, 
    "messageBody": "<div id=\"ygrps-yiv-2106415582\">It seems from your later mails that you figured out the JUnit internals and<br/>\neliminated the possibility of threading in JUnit. So, yes, as you know by<br/>\nnow A ends before B starts with the standard runner.<br/>\nIt seems like you ran into a race condition with the GC, the funny thing is<br/>\nthat many resources are closed in the finalize method so it happens that an<br/>\napplication that is sloppy with closing resources actually behaves properly<br/>\nmost of the time since the GC collects the resources and implicitly closes<br/>\nthem. Sometimes the GC is fast enough, sometimes not. When running unittests<br/>\nyou generally pound the code quite fast so its way more likely that you run<br/>\ninto this kind of problems in your tests than if you run the application<br/>\nunder normal conditions.<br/>\n<br/>\nI&#39;m happy you were able to solve your problem. Sounds like it was not a<br/>\nsimple one to find.<br/>\n<br/>\n<br/>\n-----------------------------------------------------<br/>\nJoakim Ohlrogge<br/>\nAgical AB<br/>\nV�sterl�nggatan 79, 2 tr<br/>\n111 29 Stockholm, SWEDEN<br/>\n<br/>\nMobile: +46-708-754004<br/>\nBlog: johlrogge.wordpress.com<br/>\nE-mail: <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:joakim.ohlrogge@...\">joakim.ohlrogge@...</a><br/>\n<br/>\n<br/>\n<blockquote><span title=\"qreply\"> On Wed, Mar 30, 2011 at 11:22 AM, Nils Wilhelm &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:murphy@...\">murphy@...</a>&gt;wrote:<br/>\n<br/>\n&gt;<br/>\n&gt;<br/>\n&gt; Hi Joakim,<br/>\n&gt;<br/>\n&gt; thanks for your mail.<br/>\n&gt;<br/>\n&gt; Am 30.03.2011 08:56, schrieb Joakim Ohlrogge:<br/>\n&gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt; I have had several issues when working with a the filesystem from unit<br/>\n&gt; &gt; tests. In theory you cannot expect the tests to be run sequencially as in<br/>\n&gt; &gt; test A has always run before test B (someone may request to run just<br/>\n&gt; &gt; one of<br/>\n&gt; &gt; them by rightclicking on the test in eclipse for instance) so that is<br/>\n&gt; &gt; a bad<br/>\n&gt; &gt; assumption. I don&#39;t think that is your problem in this case though. I<br/>\n&gt; &gt; don&#39;t<br/>\n&gt; &gt; know about all the magic that goes on with the filesystem behind the<br/>\n&gt; &gt; scenes<br/>\n&gt; &gt; but especially on windows I have seen issues when files are<br/>\n&gt; &gt; occationaly not<br/>\n&gt; &gt; deleted properly. I don&#39;t remember how I solved it but I would look for<br/>\n&gt; &gt; things like wether the files are properly closed and flushed before<br/>\n&gt; &gt; you try<br/>\n&gt; &gt; to delete them (could be a race condition where the the write stream is<br/>\n&gt; &gt; almost always GC:ed and closed in that process but sometimes not) that<br/>\n&gt; &gt; would<br/>\n&gt; &gt; lock the file for deletion occationall (when the the output stream has<br/>\n&gt; not<br/>\n&gt; &gt; yet been GC:ed). Make sure everything is explicitly closed.<br/>\n&gt; &gt; It has happened that I think everything looks fine but I have problems<br/>\n&gt; &gt; anyway. That is when I start imagining that there the issue is related to<br/>\n&gt; &gt; pounding on the filesystem too fast... I don&#39;t think that has ever<br/>\n&gt; &gt; been the<br/>\n&gt; &gt; case though but one gets paranoid.<br/>\n&gt; &gt;<br/>\n&gt; I don&#39;t expected test A to run before test B. But i am not sure if two<br/>\n&gt; tests can run at the same time or if one test runs, ends and after that<br/>\n&gt; the next tests starts. Can you give me an answer to this?<br/>\n&gt; As you said i will check if all streams are closed. Maybe this is the<br/>\n&gt; point.<br/>\n&gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt; In general when I have to tests against the file system I tend to to the<br/>\n&gt; &gt; setup a bit in reverse. I use an empty target directory and recusrively<br/>\n&gt; &gt; delete every file in it both in my setUp (@Before) and my tearDown<br/>\n&gt; &gt; (@After).<br/>\n&gt; &gt; This way, in case a run gets interupted midway and the directory is left<br/>\n&gt; &gt; dirty it is cleaned prior to the next run.<br/>\n&gt; &gt;<br/>\n&gt; I use the finally clause. I check if the created files exist and delete<br/>\n&gt; them. So the next test can expect the source and target folder to be empty.<br/>\n&gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt; This is not a JUnit issue in any case. In general avoid using the<br/>\n&gt; &gt; filesystem<br/>\n&gt; &gt; from your tests will spare you lots of grief. Perhaps most of what you<br/>\n&gt; &gt; want<br/>\n&gt; &gt; to test could be done in memory with<br/>\n&gt; &gt; ByteArrayOutputStream/ByteArrayInputStream and only touch the<br/>\n&gt; &gt; filesystem in<br/>\n&gt; &gt; that last case when you know everything works, you just want to see<br/>\n&gt; &gt; that you<br/>\n&gt; &gt; can replace ByteArrayInput/OutputStream with FileInputOutputStream.<br/>\n&gt; &gt; A neat sideeffect by coding this way is that it&#39;s very simple to change<br/>\n&gt; &gt; sources/targets (like reading from any URL instead of the filesystem) or<br/>\n&gt; &gt; filtering (like GZipping everything that is written to the target)<br/>\n&gt; &gt; which is<br/>\n&gt; &gt; not as elegant to do if you pass around File objects. By all means<br/>\n&gt; &gt; make your<br/>\n&gt; &gt; API able to take a filename/File instance but make usre that the first<br/>\n&gt; &gt; thing<br/>\n&gt; &gt; you do with it is creat a FileInputStream/FileOutputStream and pass it<br/>\n&gt; &gt; on to<br/>\n&gt; &gt; the next method (using try finally of course). By running in memory<br/>\n&gt; &gt; you are<br/>\n&gt; &gt; also better prepared to run tests in prallell etc.<br/>\n&gt; &gt;<br/>\n&gt; That&#39;s a good point. Thank&#39;s!<br/>\n&gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt; No rock solid advice in here but hopefully something that helps some...<br/>\n&gt; &gt; -----------------------------------------------------<br/>\n&gt; &gt; Joakim Ohlrogge<br/>\n&gt; &gt; Agical AB<br/>\n&gt; &gt; V�sterl�nggatan 79, 2 tr<br/>\n&gt; &gt; 111 29 Stockholm, SWEDEN<br/>\n&gt; &gt;<br/>\n&gt; &gt; Mobile: +46-708-754004<br/>\n&gt; &gt; Blog: johlrogge.wordpress.com<br/>\n&gt; &gt; E-mail: <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:joakim.ohlrogge@...\">joakim.ohlrogge@...</a> &lt;mailto:joakim.ohlrogge%40agical.se&gt;<br/>\n&gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt; On Tue, Mar 29, 2011 at 11:22 PM, Nils Wilhelm<br/>\n&gt; &gt; &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:murphy@...\">murphy@...</a> &lt;mailto:murphy%40planet-of-art.de&gt;&gt;wrote:<br/>\n&gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt; &gt; Hi there,<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; i have written a simple backup tool and 10 tests. They all have the<br/>\n&gt; same<br/>\n&gt; &gt; &gt; structure:<br/>\n&gt; &gt; &gt; 1. Create some test files and directories in an directory called<br/>\n&gt; &gt; &quot;source&quot;<br/>\n&gt; &gt; &gt; 2. Start the backup process (to backup the files/dirs in &quot;source&quot; to a<br/>\n&gt; &gt; &gt; directory called &quot;target&quot;)<br/>\n&gt; &gt; &gt; 3. Check whether all files in &quot;source&quot; exist also in &quot;target&quot;<br/>\n&gt; &gt; &gt; 4. Remove all files from the &quot;source&quot; and &quot;target&quot; directory so that<br/>\n&gt; the<br/>\n&gt; &gt; &gt; directories are empty for the next test.<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; If i execute the whole test set ten times, i have 6-7 successes and 3-4<br/>\n&gt; &gt; &gt; failures. The error messages say that files in the target directory<br/>\n&gt; &gt; &gt; could not be created or deleted (in the last step of the tests, see<br/>\n&gt; &gt; &gt; above) if there is a failure. One possibility i could think of is that<br/>\n&gt; &gt; &gt; the tests are not run sequentially, so they could have influence at<br/>\n&gt; each<br/>\n&gt; &gt; &gt; other. But as far as i know JUnit runs all tests in separate threads<br/>\n&gt; and<br/>\n&gt; &gt; &gt; those sequentially. Is that correct? Does anybody have any suggestions?<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; I use eclipse helios, JUnit 4.8.1, Java 1.6 and AspectJ<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; Best regards,<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; Nils<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; ------------------------------------<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; Yahoo! Groups Links<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt; [Non-text portions of this message have been removed]<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt;<br/>\n&gt; [Non-text portions of this message have been removed]<br/>\n&gt;<br/>\n&gt;  <br/>\n&gt;<br/>\n<br/>\n<br/>\n[Non-text portions of this message have been removed] </span></blockquote></div>", 
    "prevInTime": 23360, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1301503956", 
    "canDelete": false, 
    "nextInTopic": 23402, 
    "prevInTopic": 23360, 
    "headers": {
        "inReplyToHeader": "PDREOTJGNjRCLjMwMDAxMDNAcGxhbmV0LW9mLWFydC5kZT4=", 
        "messageIdInHeader": "PEFBTkxrVGlueldkdGhYPUNLRGdHR3FDOUVZMmM1VnVVPWllbzgxNkJYRU9zWUBtYWlsLmdtYWlsLmNvbT4=", 
        "referencesHeader": "PDREOTI0RDlFLjkwNjAzMDNAcGxhbmV0LW9mLWFydC5kZT4gPEFBTkxrVGlud2ZLTjZ4RXBUYzgyLWRQZkxGanhkdXU4elYydEEzMU4zQ3l1dkBtYWlsLmdtYWlsLmNvbT4gPDREOTJGNjRCLjMwMDAxMDNAcGxhbmV0LW9mLWFydC5kZT4="
    }
}
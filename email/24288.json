{
    "numMessagesInTopic": 30, 
    "nextInTime": 24289, 
    "senderId": "R7xzdECW5X_ocif-SNsY_mwnuCgrnBLtfI0JetbQx8Tj__sS6rxfJODC-G71A7cxvCk3K1wrLj6VQFrSkO7A6H4MVCsv", 
    "systemMessage": false, 
    "subject": "Re: [junit] Feedback requested: Impending changes to RunListener", 
    "from": "Bill Venners &lt;bill@...&gt;", 
    "authorName": "Bill Venners", 
    "msgSnippet": "Hi Kevin, I m about to board a plane, but I took a look at the code on the way to the airport. I wonder if you could serialize the events on a separate thread ", 
    "msgId": 24288, 
    "profile": "billvenners", 
    "topicId": 24274, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 416990097, 
    "messageBody": "<div id=\"ygrps-yiv-1113442344\">Hi Kevin,<br/>\n<br/>\nI&#39;m about to board a plane, but I took a look at the code on the way to the<br/>\nairport. I wonder if you could serialize the events on a separate thread<br/>\nthat is the only thread that writes to the RunListeners. Multiple threads<br/>\ncould deposit events in a concurrent collection. The lone dedicated thread<br/>\ncould take events out and one one thread write them to listeners. I do<br/>\nsomething like that in ScalaTest in this class:<br/>\n<br/>\n<a rel=\"nofollow\" target=\"_blank\" href=\"http://code.google.com/p/scalatest/source/browse/trunk/src/main/scala/org/scalatest/DispatchReporter.scala\">http://code.google.com/p/scalatest/source/browse/trunk/src/main/scala/org/scalatest/DispatchReporter.scala</a><br/>\n<br/>\nIn the case of RunNotifier, it is a bit more complicated because the<br/>\nlisteners to report to can change over time whereas in my case this is<br/>\nimmutable. But still I think you could use a similar technique. I&#39;m not<br/>\nfamiliar with what ParallelComputer is, so maybe this wouldn&#39;t work. But I<br/>\nthought I&#39;d suggest it.<br/>\n<br/>\nBill<br/>\n<br/>\n<blockquote><span title=\"qreply\"> On Wed, Feb 6, 2013 at 3:38 PM, Kevin Cooney &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:kcooney@...\">kcooney@...</a>&gt; wrote:<br/>\n<br/>\n&gt; **<br/>\n&gt;<br/>\n&gt;<br/>\n&gt; Currently the RunListener code stores the listeners in a synchronized list,<br/>\n&gt; and has a large synchronized block where it calls all of the listeners:<br/>\n&gt;<br/>\n&gt;<br/>\n&gt; <a rel=\"nofollow\" target=\"_blank\" href=\"https://github.com/junit-team/junit/blob/master/src/main/java/org/junit/runner/notification/RunNotifier.java#L54\">https://github.com/junit-team/junit/blob/master/src/main/java/org/junit/runner/notification/RunNotifier.java#L54</a><br/>\n&gt;<br/>\n&gt; -- Kevin<br/>\n&gt;<br/>\n&gt;<br/>\n&gt; On Wed, Feb 6, 2013 at 1:30 PM, Bill Venners <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:bill@...\">bill@...</a>&gt; wrote:<br/>\n&gt;<br/>\n&gt; &gt; Hi Kevin,<br/>\n&gt; &gt;<br/>\n&gt; &gt; Can you clarify what the performance issue was? Is the problem that you<br/>\n&gt; &gt; have events coming possibly in parallel via different threads, and you<br/>\n&gt; want<br/>\n&gt; &gt; to send them all to a user-specified RunListener? Because you don&#39;t know<br/>\n&gt; &gt; whether a RunListener is thread safe, currently you are serializing those<br/>\n&gt; &gt; events somehow that&#39;s slow?<br/>\n&gt; &gt;<br/>\n&gt; &gt; Bill<br/>\n&gt; &gt;<br/>\n&gt; &gt; On Wed, Feb 6, 2013 at 9:06 AM, Kevin Cooney <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:kcooney@...\">kcooney@...</a>&gt; wrote:<br/>\n&gt; &gt;<br/>\n&gt; &gt; &gt; **<br/>\n&gt;<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; Hello, everyone<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; Short version: we are thinking of adding an optional dependency from<br/>\n&gt; &gt; JUnit<br/>\n&gt; &gt; &gt; to jcip-annotations and are soliciting feedback.<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; A few people have noticed that when you use ParallelComputer, you got<br/>\n&gt; &gt; poor<br/>\n&gt; &gt; &gt; performance because calls to registered RunListeners are synchronized.<br/>\n&gt; We<br/>\n&gt; &gt; &gt; would like to fix this in the next release of JUnit.<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; In order to prevent affecting existing users, we are proposing having<br/>\n&gt; an<br/>\n&gt; &gt; &gt; annotation that can be added to RunListener implementations that can<br/>\n&gt; &gt; safely<br/>\n&gt; &gt; &gt; be called concurrently from multiple threads. If a RunListener passed<br/>\n&gt; to<br/>\n&gt; &gt; a<br/>\n&gt; &gt; &gt; RunNotifier is not annotated with this annotation, JUnit will wrap it<br/>\n&gt; &gt; with<br/>\n&gt; &gt; &gt; a decorator that does synchronization.<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; We would appreciate feedback on this new annotation.<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; We have two options:<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; a. Create our own annotation for this<br/>\n&gt; &gt; &gt; b. Use ThreadSafe (<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; <a rel=\"nofollow\" target=\"_blank\" href=\"http://grepcode.com/file/repo1.maven.org/maven2/net.jcip/jcip-annotations/1.0/net/jcip/annotations/ThreadSafe.java\">http://grepcode.com/file/repo1.maven.org/maven2/net.jcip/jcip-annotations/1.0/net/jcip/annotations/ThreadSafe.java</a><br/>\n&gt; &gt; &gt; )<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; The advantages to option b are:<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; 1. It&#39;s a well-known annotation<br/>\n&gt; &gt; &gt; 2. Users that use JUnit can add this annotation to their thread-safe<br/>\n&gt; &gt; &gt; RunListener implementations today and get the benefits &quot;for free&quot;<br/>\n&gt; later.<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; Note we can do this without requiring that all users of JUnit have the<br/>\n&gt; &gt; &gt; jcip-annotations jar in their classpath as of JDK 1.5.0_06 (see<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; <a rel=\"nofollow\" target=\"_blank\" href=\"http://stackoverflow.com/questions/3567413/why-doesnt-a-missing-annotation-cause-a-classnotfoundexception-at-runtime\">http://stackoverflow.com/questions/3567413/why-doesnt-a-missing-annotation-cause-a-classnotfoundexception-at-runtime</a><br/>\n&gt; &gt; &gt; ).<br/>\n&gt; &gt; &gt; If jcip-annotations is not on the classpath then all RunListener<br/>\n&gt; &gt; &gt; implementations will be treated as not thread-safe.<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; As a specific example, the Maven Surefire plugin would use this<br/>\n&gt; &gt; dependency<br/>\n&gt; &gt; &gt; and include jcip-annotations.<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; Currently, JUnit only depends on one third-party library (Hamcrest).<br/>\n&gt; This<br/>\n&gt; &gt; &gt; has caused us some pain in the past when the Hamcrest code changed in<br/>\n&gt; &gt; ways<br/>\n&gt; &gt; &gt; that broke existing users of JUnit. We believe this will not be an<br/>\n&gt; issue<br/>\n&gt; &gt; &gt; with jcip-annotations because the JAR only contains annotations, not<br/>\n&gt; any<br/>\n&gt; &gt; &gt; code.<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; One possible concern would be with other open source libraries that<br/>\n&gt; &gt; provide<br/>\n&gt; &gt; &gt; RunListener implementations (they would need to add jcip-annotations to<br/>\n&gt; &gt; &gt; their compile-time classpath if they have thread-safe annotations, and<br/>\n&gt; &gt; &gt; document this to their users).<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; Thoughts?<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; -- Kevin<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; [Non-text portions of this message have been removed]<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt; --<br/>\n&gt; &gt; Bill Venners<br/>\n&gt; &gt; Artima, Inc.<br/>\n&gt; &gt; <a rel=\"nofollow\" target=\"_blank\" href=\"http://www.artima.com\">http://www.artima.com</a><br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt; [Non-text portions of this message have been removed]<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt; ------------------------------------<br/>\n&gt; &gt;<br/>\n&gt; &gt; Yahoo! Groups Links<br/>\n&gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt;<br/>\n&gt; [Non-text portions of this message have been removed]<br/>\n&gt;<br/>\n&gt;  <br/>\n&gt;<br/>\n<br/>\n<br/>\n<br/>\n-- <br/>\nBill Venners<br/>\nArtima, Inc.<br/>\n<a rel=\"nofollow\" target=\"_blank\" href=\"http://www.artima.com\">http://www.artima.com</a><br/>\n<br/>\n<br/>\n[Non-text portions of this message have been removed] </span></blockquote></div>", 
    "prevInTime": 24287, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1360269345", 
    "canDelete": false, 
    "nextInTopic": 24289, 
    "prevInTopic": 24287, 
    "headers": {
        "inReplyToHeader": "PENBQTNFK2VXX1hxbTYxZ1BoekVOOFBTcDc5YUFqYkF4MVpDM3ByWmV4YzZ2ekdrOHVrQUBtYWlsLmdtYWlsLmNvbT4=", 
        "messageIdInHeader": "PENBT19SeWtwN01IUHpfPV85NDA1Ynkzb1dPRVJKcVIrZFBZV0xPPVk3cmhZd3A3M2Njd0BtYWlsLmdtYWlsLmNvbT4=", 
        "referencesHeader": "PENBQTNFK2VYcUY2RE5RYzByNUhla2oxZ0UtUHlCbnZqNF9UTmJWZ1JVbytFZWt4d2hqd0BtYWlsLmdtYWlsLmNvbT4JPENBT19SeWtvSjF2UXNrTkNrUnlaYkRpcVNpVU5fX0U4WWFZeldzc1RFaDdWR3gxdXVwd0BtYWlsLmdtYWlsLmNvbT4JPENBQTNFK2VXX1hxbTYxZ1BoekVOOFBTcDc5YUFqYkF4MVpDM3ByWmV4YzZ2ekdrOHVrQUBtYWlsLmdtYWlsLmNvbT4="
    }
}
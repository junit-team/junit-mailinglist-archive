{
    "numMessagesInTopic": 2, 
    "nextInTime": 10824, 
    "senderId": "tG8LFxJWOD6HO65Vrm3UxOlUggTii7DOVvH5Cbe6RPFwWX38pNQLi5KIAP8DiYkD9BWbh0Nc1ofNQuzsRImozEkHKzm55KMnb6IQ", 
    "systemMessage": false, 
    "subject": "Re: [junit] confused about database dependent tests", 
    "from": "Curt Sampson &lt;yahoo_sucks@...&gt;", 
    "authorName": "Curt Sampson", 
    "msgSnippet": "... You definitely need a test db; preferably one for each developer that can easily be reloaded to a default configuration. At my shop, every developer has", 
    "msgId": 10823, 
    "rawEmail": "Return-Path: &lt;yahoo_sucks@...&gt;\r\nX-Sender: yahoo_sucks@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (qmail 7258 invoked from network); 11 Apr 2004 09:20:03 -0000\r\nReceived: from unknown (66.218.66.217)\n  by m19.grp.scd.yahoo.com with QMQP; 11 Apr 2004 09:20:03 -0000\r\nReceived: from unknown (HELO platonic.cynic.net) (204.80.150.245)\n  by mta2.grp.scd.yahoo.com with SMTP; 11 Apr 2004 09:20:02 -0000\r\nReceived: from angelic.cynic.net (angelic-platonic.cvpn.cynic.net [198.73.220.226])\n\tby platonic.cynic.net (Postfix) with ESMTP\n\tid 24281C000; Sun, 11 Apr 2004 09:20:00 +0000 (UTC)\r\nReceived: from localhost (localhost [127.0.0.1])\n\tby angelic.cynic.net (Postfix) with ESMTP\n\tid 6B8EF8736; Sun, 11 Apr 2004 18:19:58 +0900 (JST)\r\nDate: Sun, 11 Apr 2004 18:19:58 +0900 (JST)\r\nX-X-Sender: cjs@...\r\nTo: mbil_99 &lt;mbil_99@...&gt;\r\nCc: junit@yahoogroups.com\r\nIn-Reply-To: &lt;c54gfi+3lvp@...&gt;\r\nMessage-ID: &lt;Pine.NEB.4.58.0404111744100.14289@...&gt;\r\nReferences: &lt;c54gfi+3lvp@...&gt;\r\nMIME-Version: 1.0\r\nContent-Type: TEXT/PLAIN; charset=US-ASCII\r\nX-eGroups-Remote-IP: 204.80.150.245\r\nFrom: Curt Sampson &lt;yahoo_sucks@...&gt;\r\nSubject: Re: [junit] confused about database dependent tests\r\nX-Yahoo-Group-Post: member; u=110189933\r\nX-Yahoo-Profile: cjstokyo\r\n\r\nOn Thu, 8 Apr 2004, mbil_99 wrote:\n\n&gt; So what do I do here, create a fake Customer in the production db?\n&gt; (Ideally have a test db where this isn&#39;t a problem?)\n\nYou definitely need a test db; preferably one for each developer that\ncan easily be reloaded to a &quot;default&quot; configuration. At my shop, every\ndeveloper has at least one database all to himself, and we have a script\ncalled &quot;LoadUnitTestDB&quot; which loads up schemas for all of our various\ndifferent databases (wiping out existing ones) and their test data. The\nunit tests that use databases run against these.\n\nI have a single class responsible for each table (or sometimes group of\ntables, if they&#39;re closely related) that does the grunt work of writing\nstuff to the tables, and reading them and creating objects. Say:\n\n    public class Gift {\n\tstatic void createGift(Connection con, int customerID, int giftTypeID);\n\tstatic Gift getGift(Connection con, int customerID);\n\t// Then the non-static methods for the gift object itself.\n    }\n\nThe unit tests for the above two static methods supply a connection to\nthe test database, and later check the database to see that the right\nthing was done. As a little bonus, all of the database unit tests start\na transaction before running the test and roll it back after they&#39;ve\nfinished checking the database, so the test databases are actually never\nchanged.\n\nIn the production system, I have a Repository responsible for dealing\nwith the connections and suchlike, and the business logic asks the\nrepository for the objects that it needs, and to do the database updates\nthat it ought to do. In the unit tests, the repository is replaced with\na mock object that pretends to do the database work.\n\nSo, here&#39;s the requirement.\n\n&gt; If &quot;Customer&quot;&#39;s last &quot;Order&quot; was greater than $100,\n&gt;     then record the fact that they are eligible to receive a gift\n&gt;     with their next order.\n\nNow I&#39;ve been thinking about this for about five minutes now, and\nI&#39;m having some problems with this. I think I just realized what\nit is: you&#39;ve already recorded this information! First, from this\nspecification, there&#39;s no need to store in the database that the\ncustomer is elegible for a gift; just look at the last order (presumably\nalso stored in the database) and you&#39;ll know. (Or I&#39;m missing some\nother information here.) Second there&#39;s no indication here of whose\nresponsibility this action is. A Customer? A Gift?\n\nSo let&#39;s change this to something more tractable for me; let&#39;s say it&#39;s\nan Order&#39;s responibility, on creation, for making sure that it knows\nthat the customer is eligible for a gift. In other words:\n\n    When a new order is created for a customer whose total for the\n    previous order was greater than $100, ask a gift manager for\n    a gift.\n\nSo let&#39;s try it:\n\n    class TestNewOrderIncludingGift_Customer extends Customer {\n\tpublic int getID() {\n\t    return 171431;\n\t}\n\tpublic Order getLastOrder() {\n\t    return new Order() {\n\t\tpublic DollarAmount getTotalAmount() {\n\t\t    return new DollarAmount(135, 23);\t// $135.23\n\t\t}\n\t    }\n\t}\n    }\n\n    class TestNewOrderIncludingGift_GiftManager extends GiftManager {\n\tpublic getGift(Customer customer) {\n\t    // Did it pass in the correct customer?\n\t    assertEquals(171431, customer.getID());\n\t    return new Gift(&quot;foobar&quot;);\n\t}\n    }\n\n    class TestNewOrderIncludingGift_Repository extends TestRepository {\n\tpublic GiftManager getGiftManager() {\n\t    return new TestNewOrderIncludingGift_GiftManager();\n\t}\n    }\n\n    public void testNewOrderIncludingGift() {\n\tEnvironment.setRepository(new TestNewOrderIncludingGift_Repository());\n\tOrder order\n\t    = Order.createOrder(new TestNewOrderIncludingGift_Customer());\n\tassertEquals(&quot;foobar&quot;, order.getGift().getType());\n    }\n\nJust in case the intended implemenation is not obvious:\n\n    class Order {\n\tprivate final Gift _gift;\n\n\tpublic static createOrder(Customer customer) {\n\t    DollarAmount last = customer.getLastOrder.getTotalAmount();\n\t    if (last.lessThanOrEqual(new DollarAmount(100, 00))) {\n\t\t_gift = null;\n\t    } else {\n\t\tGiftManager giftManager\n\t\t    = Environment.getRepository().getGiftManager();\n\t\t_gift = giftManager.getGift(customer);\n\t    }\n\t}\n\n\tpublic Gift getGift() {\n\t    return _gift;\n\t}\n    }\n\n(Though I&#39;m already thinking that it&#39;s probably the GiftManager&#39;s job to\nbe doing the calculation about whether a customer&#39;s last order warranted\na gift, rather than the new Order doing this.)\n\nBut anyway, you&#39;ve now made sure that the order made the appropriate\ncalls on the database objects without ever touching a database.\n\ncjs\n-- \nCurt Sampson  &lt;cjs@...&gt;   +81 90 7737 2974   http://www.NetBSD.org\n    Don&#39;t you know, in this new Dark Age, we&#39;re all light.  --XTC\n\n", 
    "profile": "cjstokyo", 
    "topicId": 10816, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 110189933, 
    "prevInTime": 10822, 
    "contentTrasformed": false, 
    "postDate": "1081675198", 
    "canDelete": false, 
    "nextInTopic": 0, 
    "prevInTopic": 10816, 
    "headers": {
        "inReplyToHeader": "PGM1NGdmaSszbHZwQGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PFBpbmUuTkVCLjQuNTguMDQwNDExMTc0NDEwMC4xNDI4OUBhbmdlbGljLXZ0ZncuY3Zwbi5jeW5pYy5uZXQ+", 
        "referencesHeader": "PGM1NGdmaSszbHZwQGVHcm91cHMuY29tPg=="
    }
}
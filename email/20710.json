{
    "numMessagesInTopic": 29, 
    "nextInTime": 20711, 
    "senderId": "dky9gOxqNy7DNHeYLWbpave-YCvKpccq4QG4c7OBvbfdA555NDlx4GFqjqmQHYCbF3b9-xM8ch5H-bvB-CW3_QswKP0", 
    "systemMessage": false, 
    "subject": "Re: [junit] Re: Junit 3 suite setup tear down", 
    "from": "&quot;David Saff&quot; &lt;david@...&gt;", 
    "authorName": "David Saff", 
    "msgSnippet": "@BeforeClass and @AfterClass on the @RunWith(Suite) class have exactly this behavior in JUnit 4.4 and beyond.  However, I think the original poster was using", 
    "msgId": 20710, 
    "profile": "dsaff", 
    "topicId": 20668, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 341876227, 
    "messageBody": "<div id=\"ygrps-yiv-1110362422\">@BeforeClass and @AfterClass on the @RunWith(Suite) class have exactly<br/>\nthis behavior in JUnit 4.4 and beyond.  However, I think the original<br/>\nposter was using 3.x.<br/>\n<br/>\n   David Saff<br/>\n<br/>\n<blockquote><span title=\"qreply\"> On Wed, Jul 9, 2008 at 6:45 PM, Cédric Beust ♔ &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:cbeust@...\">cbeust@...</a>&gt; wrote:<br/>\n&gt; That&#39;s a lot of work and therefore a good candidate for a new feature:<br/>\n&gt; @BeforeSuite/@AfterSuite.<br/>\n&gt;<br/>\n&gt; --<br/>\n&gt; Cédric<br/>\n&gt;<br/>\n&gt; On Wed, Jul 9, 2008 at 12:47 PM, toalexsmail &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:toalexsmail@...\">toalexsmail@...</a>&gt; wrote:<br/>\n&gt;<br/>\n&gt;&gt; --- In <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a> &lt;junit%40yahoogroups.com&gt;, &quot;lars&quot;<br/>\n&gt;<br/>\n&gt;&gt; &lt;lars.carlsson@...&gt; wrote:<br/>\n&gt;&gt; &gt;<br/>\n&gt;&gt; &gt; Hi<br/>\n&gt;&gt; &gt; At my company we have alot of automated test cases and in all our<br/>\n&gt;&gt; &gt; suite we have a setup testcase and a teardown test case where we setup<br/>\n&gt;&gt; &gt; network connection that takes some time and can not be done in every<br/>\n&gt;&gt; TC. ,<br/>\n&gt;&gt; &gt; But i think that there should exist a suite setup and a teardown and<br/>\n&gt;&gt; &gt; not be in a setup/teardown TC.<br/>\n&gt;&gt; &gt; Are there any why of doing this or how could i best be solve this by<br/>\n&gt;&gt; &gt; extending TestSuite?<br/>\n&gt;&gt; &gt;<br/>\n&gt;&gt; &gt; Regards Lars<br/>\n&gt;&gt; &gt;<br/>\n&gt;&gt; I think that there is some related thread on this topic, but never mind.<br/>\n&gt;&gt;<br/>\n&gt;&gt; * There are @Before and @After annotation that are equivalent of use<br/>\n&gt;&gt; of setUp() and tearDown().<br/>\n&gt;&gt; * There are @BeforeClass and @AfterClass annotation that are supposed<br/>\n&gt;&gt; to substitute the use of TestSuite. In fact, this method is called<br/>\n&gt;&gt; once per class. You can see on it as your TestSuite was just a single<br/>\n&gt;&gt; class. AFAIK, there is no build in support for TestSuite that is not<br/>\n&gt;&gt; so trivial.<br/>\n&gt;&gt;<br/>\n&gt;&gt; I had similar requirement, namely I wanted to ensure that JDK 1.4+<br/>\n&gt;&gt; assert statement are on, I wanted to start JBoss microcontainer at the<br/>\n&gt;&gt; beginning and shutdown it at the end.<br/>\n&gt;&gt;<br/>\n&gt;&gt; Lets start from the simplest one.<br/>\n&gt;&gt; * I wanted to ensure that JDK 1.4+ assert statement are on.<br/>\n&gt;&gt; I created class with name BaseTestCase and all my test classes<br/>\n&gt;&gt; inherits from it. In this class I put the following method:<br/>\n&gt;&gt;<br/>\n&gt;&gt; @BeforeClass<br/>\n&gt;&gt; public static void oneTimeSetup(){<br/>\n&gt;&gt; // do your one time set-up here!<br/>\n&gt;&gt; log.info(&quot;BaseTestCase.oneTimeSetup()&quot;);<br/>\n&gt;&gt; log.debug(&quot;Going to check whether asserts are enabled&quot;);<br/>\n&gt;&gt; boolean assertsEnabled = false;<br/>\n&gt;&gt; assert (assertsEnabled = true); // Intentional side effect!!!<br/>\n&gt;&gt; if (!assertsEnabled) {<br/>\n&gt;&gt; throw new AssertionError(&quot;Asserts must be enabled!&quot;);<br/>\n&gt;&gt; }<br/>\n&gt;&gt; }<br/>\n&gt;&gt; }<br/>\n&gt;&gt;<br/>\n&gt;&gt; Because all my test classes inherit from BaseTestCase and has their<br/>\n&gt;&gt; base class BaseTestCase, it is guaranteed that first thing that will<br/>\n&gt;&gt; be run (beside JUnit itself) is oneTimeSetup() method.<br/>\n&gt;&gt;<br/>\n&gt;&gt; * I wanted to start JBoss microcontainer at the beginning and shutdown<br/>\n&gt;&gt; it at the end.<br/>\n&gt;&gt;<br/>\n&gt;&gt; Every test class inherit from some base test class, say<br/>\n&gt;&gt; BaseHelloWorldEJBTest (that eventually inherit from BaseTestCase). In<br/>\n&gt;&gt; BaseHelloWorldEJBTest there is method<br/>\n&gt;&gt;<br/>\n&gt;&gt; @BeforeClass<br/>\n&gt;&gt; public static void setUpClass() throws Exception ;<br/>\n&gt;&gt;<br/>\n&gt;&gt; This method basically does the following:<br/>\n&gt;&gt;<br/>\n&gt;&gt; final Bootstrap jbossInstance = Bootstrap.getInstance();<br/>\n&gt;&gt; if (!jbossInstance.isStarted()) {<br/>\n&gt;&gt; log.debug(&quot;starting JBoss microcontainer&quot;);<br/>\n&gt;&gt; jbossInstance.bootstrap();<br/>\n&gt;&gt; log.debug(&quot;JBoss microcontainer is up&quot;);<br/>\n&gt;&gt;<br/>\n&gt;&gt; log.debug(&quot;Going to deploy scanClasspath&quot;);<br/>\n&gt;&gt; deploy(scanClasspath);<br/>\n&gt;&gt; log.debug(&quot;End of deploy scanClasspath&quot;);<br/>\n&gt;&gt; ... &lt;HERE there is more code&gt;<br/>\n&gt;&gt; }<br/>\n&gt;&gt;<br/>\n&gt;&gt; Until now everything is pretty straight-forward. But how can I stop<br/>\n&gt;&gt; JBoss when I finished testing? I don&#39;t want to stop it after every<br/>\n&gt;&gt; class, but after whole TestSuite is done. I didn&#39;t find something<br/>\n&gt;&gt; built-in, so I use ShutdownHook...<br/>\n&gt;&gt;<br/>\n&gt;&gt; In the above setUpClass() mehtod in the place that noted as &quot;&lt;HERE<br/>\n&gt;&gt; there is more code&gt;&quot; I have:<br/>\n&gt;&gt;<br/>\n&gt;&gt; log.debug(&quot;Now add hook to shutdown server&quot;);<br/>\n&gt;&gt; Runtime.getRuntime().addShutdownHook(new Thread() {<br/>\n&gt;&gt; public void run() {<br/>\n&gt;&gt; assert lRunnables!=null;<br/>\n&gt;&gt; Runnable runnable =null;<br/>\n&gt;&gt; String runnableI = null;<br/>\n&gt;&gt; try {<br/>\n&gt;&gt; for(int i=0;i&lt;lRunnables.length;i++){<br/>\n&gt;&gt; runnable = lRunnables[i];<br/>\n&gt;&gt; runnableI = &quot;runnable &quot;+i;<br/>\n&gt;&gt; log.debug(&quot;Going to run &quot;+runnableI);<br/>\n&gt;&gt; if(runnable==null){<br/>\n&gt;&gt; log.warn(runnableI+&quot; is null, skipping&quot;);<br/>\n&gt;&gt; } else {<br/>\n&gt;&gt; try {<br/>\n&gt;&gt; runnable.run();<br/>\n&gt;&gt; log.debug(runnableI+&quot; ends run succesfully&quot;);<br/>\n&gt;&gt; }<br/>\n&gt;&gt; catch(Throwable e){log.error(runnableI+&quot; fails&quot;, e);}<br/>\n&gt;&gt;<br/>\n&gt;&gt; }<br/>\n&gt;&gt; }<br/>\n&gt;&gt;<br/>\n&gt;&gt; }<br/>\n&gt;&gt;<br/>\n&gt;&gt; catch(Throwable e){<br/>\n&gt;&gt; log.error(&quot;This should never happened. Some runnables Throwable<br/>\n&gt;&gt; (exception) propogates outside the loop&quot;, e);<br/>\n&gt;&gt; }<br/>\n&gt;&gt;<br/>\n&gt;&gt;<br/>\n&gt;&gt; synchronized (jbossInstance) {<br/>\n&gt;&gt; jbossInstance.shutdown();<br/>\n&gt;&gt; }<br/>\n&gt;&gt; String junitStatus = junitStatusOs.toString();<br/>\n&gt;&gt; log.debug(junitStatus);<br/>\n&gt;&gt;<br/>\n&gt;&gt; }<br/>\n&gt;&gt; });<br/>\n&gt;&gt; I will talk about junitStatusPs a bit later. What is actually is done<br/>\n&gt;&gt; here that in @BeforeClass that it is before running every class, there<br/>\n&gt;&gt; is check whether JBoss is run or no. If it is run nothing special is<br/>\n&gt;&gt; done. If it is not run, and this will be true only first time this<br/>\n&gt;&gt; check will be done, JBoss is started and ShutDownHook is added. Take a<br/>\n&gt;&gt; look on the JavaDoc on ShutDownHook, but basically, on the call on<br/>\n&gt;&gt; System.exit() JVM will be run your hook. In that shutdown hook I make<br/>\n&gt;&gt; jbossInstance.shutdown().<br/>\n&gt;&gt;<br/>\n&gt;&gt; There is one issue here. One JBoss is shutting down it write some<br/>\n&gt;&gt; thing to the log. What is happen, that I see JUnit report (90000<br/>\n&gt;&gt; tested passes, 100 fails, and 10 ignored) and after this report I see<br/>\n&gt;&gt; the output from shitting down process. This happen, because the<br/>\n&gt;&gt; shutdown hook happens after last JUnit class finished to run.<br/>\n&gt;&gt; I found some work around. In the BaseTestCase I have:<br/>\n&gt;&gt; // the logger<br/>\n&gt;&gt; private static final Log log = LogFactory.getLog(BaseTestCase.class);<br/>\n&gt;&gt; protected static final OutputStream junitStatusOs = new<br/>\n&gt;&gt; ByteArrayOutputStream(16*1024);<br/>\n&gt;&gt;<br/>\n&gt;&gt; This junitStatusPs is actually passed to as PrintStream (instead<br/>\n&gt;&gt; System.out) to the JUnit classes. Note, that I have<br/>\n&gt;&gt;<br/>\n&gt;&gt; String junitStatus = junitStatusOs.toString();<br/>\n&gt;&gt; log.debug(junitStatus);<br/>\n&gt;&gt;<br/>\n&gt;&gt; as the last row of the shutdown hook. This ensure, that I will see the<br/>\n&gt;&gt; output of the shutdown hook first, and the JUnit report will be the<br/>\n&gt;&gt; last rows in the standard output.<br/>\n&gt;&gt; And the last issue is:<br/>\n&gt;&gt;<br/>\n&gt;&gt; If I want to do some other thing I just wrap it as lRunnables and pass<br/>\n&gt;&gt; to the method mentioned above. It is looks like this:<br/>\n&gt;&gt;<br/>\n&gt;&gt; //we want to call cleanUp() method that ear application calls<br/>\n&gt;&gt; //moment before we shutting down JBoss<br/>\n&gt;&gt; Runnable runnable = new Runnable(){<br/>\n&gt;&gt; public void run() {<br/>\n&gt;&gt; try {<br/>\n&gt;&gt; cleanUp();<br/>\n&gt;&gt; }<br/>\n&gt;&gt; catch(HelloWorldException e){<br/>\n&gt;&gt; log.error(&quot;Failed to cleanUp&quot;, e);<br/>\n&gt;&gt; }<br/>\n&gt;&gt; }<br/>\n&gt;&gt; };<br/>\n&gt;&gt;<br/>\n&gt;&gt; setUpClass(System.getProperty(&quot;user.dir&quot;) + &quot;/target/classes&quot;,<br/>\n&gt;&gt; runnable);<br/>\n&gt;&gt;<br/>\n&gt;&gt; In order to shutdown JBoss we use<br/>\n&gt;&gt; @AfterClass<br/>\n&gt;&gt; public static void tearDownClass() throws Exception {<br/>\n&gt;&gt; log.info(&quot;one time tearDownClass()&quot;);<br/>\n&gt;&gt; undeploy();<br/>\n&gt;&gt; Bootstrap.getInstance().shutdown();<br/>\n&gt;&gt; }<br/>\n&gt;&gt;<br/>\n&gt;&gt;<br/>\n&gt;&gt;<br/>\n&gt;<br/>\n&gt; [Non-text portions of this message have been removed]<br/>\n&gt;<br/>\n&gt; </span></blockquote></div>", 
    "prevInTime": 20709, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1216838666", 
    "canDelete": false, 
    "nextInTopic": 20722, 
    "prevInTopic": 20680, 
    "headers": {
        "inReplyToHeader": "PGI4NmI2YTljMDgwNzA5MTU0NWo3N2I3MjZmZWhhMTE4ZWM2NDhiYTg2MjI3QG1haWwuZ21haWwuY29tPg==", 
        "messageIdInHeader": "PDRmN2RhNmI5MDgwNzIzMTE0NGg1YmMxMDRiNnI4OGM2OTZkNTc4YWM4NDJAbWFpbC5nbWFpbC5jb20+", 
        "referencesHeader": "PGc1MW44ZStmdTRyQGVHcm91cHMuY29tPiA8ZzUzNGt1K29mc3RAZUdyb3Vwcy5jb20+CSA8Yjg2YjZhOWMwODA3MDkxNTQ1ajc3YjcyNmZlaGExMThlYzY0OGJhODYyMjdAbWFpbC5nbWFpbC5jb20+"
    }
}
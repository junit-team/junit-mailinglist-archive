{
    "numMessagesInTopic": 29, 
    "nextInTime": 20671, 
    "senderId": "rlVQEToteilM4yrr-SuC_E1n5pJw_njNpMPxDlS9E02x3VvxIs7LBqBCkdIs3TLS5PF5nyIvJNuniiEGJlpSEncpa1UFXqA1UWzi-Q", 
    "systemMessage": true, 
    "subject": "Re: Junit 3 suite setup tear down", 
    "from": "&quot;toalexsmail&quot; &lt;toalexsmail@...&gt;", 
    "authorName": "toalexsmail", 
    "msgSnippet": "... TC. , ... I think that there is some related thread on this topic, but never mind. * There are @Before and @After annotation that are equivalent of use of", 
    "msgId": 20670, 
    "rawEmail": "Return-Path: &lt;toalexsmail@...&gt;\r\nReceived: (qmail 55890 invoked from network); 9 Jul 2008 22:38:41 -0000\r\nReceived: from unknown (66.218.67.96)\n  by m53.grp.scd.yahoo.com with QMQP; 9 Jul 2008 22:38:41 -0000\r\nReceived: from unknown (HELO n49b.bullet.mail.sp1.yahoo.com) (66.163.168.163)\n  by mta17.grp.scd.yahoo.com with SMTP; 9 Jul 2008 22:38:41 -0000\r\nReceived: from [216.252.122.218] by n49.bullet.mail.sp1.yahoo.com with NNFMP; 09 Jul 2008 22:38:41 -0000\r\nReceived: from [66.218.69.5] by t3.bullet.sp1.yahoo.com with NNFMP; 09 Jul 2008 22:38:41 -0000\r\nReceived: from [66.218.66.91] by t5.bullet.scd.yahoo.com with NNFMP; 09 Jul 2008 22:38:41 -0000\r\nX-Sender: toalexsmail@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nX-Received: (qmail 18490 invoked from network); 9 Jul 2008 19:47:29 -0000\r\nX-Received: from unknown (66.218.67.95)\n  by m44.grp.scd.yahoo.com with QMQP; 9 Jul 2008 19:47:29 -0000\r\nX-Received: from unknown (HELO n16b.bullet.sp1.yahoo.com) (69.147.64.122)\n  by mta16.grp.scd.yahoo.com with SMTP; 9 Jul 2008 19:47:29 -0000\r\nX-Received: from [216.252.122.216] by n16.bullet.sp1.yahoo.com with NNFMP; 09 Jul 2008 19:47:29 -0000\r\nX-Received: from [66.218.69.2] by t1.bullet.sp1.yahoo.com with NNFMP; 09 Jul 2008 19:47:29 -0000\r\nX-Received: from [66.218.66.89] by t2.bullet.scd.yahoo.com with NNFMP; 09 Jul 2008 19:47:29 -0000\r\nDate: Wed, 09 Jul 2008 19:47:28 -0000\r\nTo: junit@yahoogroups.com\r\nMessage-ID: &lt;g534kg+5qjg@...&gt;\r\nIn-Reply-To: &lt;g51n8e+fu4r@...&gt;\r\nUser-Agent: eGroups-EW/0.82\r\nMIME-Version: 1.0\r\nContent-Type: text/plain; charset=&quot;ISO-8859-1&quot;\r\nContent-Transfer-Encoding: quoted-printable\r\nX-Mailer: Yahoo Groups Message Poster\r\nX-Yahoo-Newman-Property: groups-system\r\nX-eGroups-Msg-Info: 1:6:0:0:0\r\nFrom: &quot;toalexsmail&quot; &lt;toalexsmail@...&gt;\r\nSubject: Re: Junit 3 suite setup tear down\r\nX-Yahoo-Group-Post: member; u=340165037; y=Y4vq3a1U8qhFc9cEAxv8vvqM-RSZZtVajz3SxTeGQKwUtENiC5o\r\nX-Yahoo-Profile: toalexsmail\r\nX-eGroups-Approved-By: spchappell &lt;simonpeterchappell@...&gt; via web; 09 Jul 2008 22:38:41 -0000\r\n\r\n--- In junit@yahoogroups.com, &quot;lars&quot; &lt;lars.carlsson@...&gt; wrote:\n&gt;\n&gt; Hi \n&gt; A=\r\nt my company we have alot of automated test cases and in all our\n&gt; suite we=\r\n have a setup testcase and a teardown test case where we setup\n&gt; network co=\r\nnnection that takes some time and can not be done in every\nTC. ,\n&gt; But i th=\r\nink that there should exist a suite setup and a teardown and\n&gt; not be in a =\r\nsetup/teardown TC.\n&gt; Are there any why of doing this or how could i best be=\r\n solve this by\n&gt; extending TestSuite?\n&gt; \n&gt; Regards Lars\n&gt;\nI think that ther=\r\ne is some related thread on this topic, but never mind.\n\n* There are @Befor=\r\ne and @After annotation that are equivalent of use\nof setUp() and tearDown(=\r\n).\n* There are @BeforeClass and @AfterClass annotation that are supposed\nto=\r\n substitute the use of TestSuite. In fact, this method is called\nonce per c=\r\nlass. You can see on it as your TestSuite was just a single\nclass. AFAIK, t=\r\nhere is no build in support for TestSuite that is not\nso trivial.\n\nI had si=\r\nmilar requirement, namely I wanted to ensure that JDK 1.4+\nassert statement=\r\n are on, I wanted to start JBoss microcontainer at the\nbeginning and shutdo=\r\nwn it at the end.\n\nLets start from the simplest one. \n*  I wanted to ensure=\r\n that JDK 1.4+ assert statement are on.\nI created class with name BaseTestC=\r\nase and all my test classes\ninherits from it. In this class I put the follo=\r\nwing method:\n\n\n@BeforeClass\npublic static void oneTimeSetup(){\n\t// do your =\r\none time set-up here!\n\tlog.info(&quot;BaseTestCase.oneTimeSetup()&quot;);\n\tlog.debug(=\r\n&quot;Going to check whether asserts are enabled&quot;);\n\tboolean assertsEnabled =3D =\r\nfalse;\n\tassert (assertsEnabled =3D true); // Intentional side effect!!!\n\tif=\r\n (!assertsEnabled) {\n\t\tthrow new AssertionError(&quot;Asserts must be enabled!&quot;)=\r\n;\n\t\t}\n\t}\n}\n\nBecause all my test classes inherit from BaseTestCase and has t=\r\nheir\nbase class BaseTestCase, it is guaranteed that first thing that will\nb=\r\ne run (beside JUnit itself) is oneTimeSetup() method.\n\t\n* I wanted to start=\r\n JBoss microcontainer at the beginning and shutdown\nit at the end.\n\nEvery t=\r\nest class inherit from some base test class, say\nBaseHelloWorldEJBTest  (th=\r\nat eventually inherit from BaseTestCase). In\nBaseHelloWorldEJBTest  there i=\r\ns method \n\n@BeforeClass\npublic static void setUpClass() throws Exception ;\n=\r\n\nThis method basically does the following:\n\nfinal Bootstrap jbossInstance =\r\n=3D  Bootstrap.getInstance();\nif (!jbossInstance.isStarted()) {\t\t\n\tlog.debu=\r\ng(&quot;starting JBoss microcontainer&quot;);\n\tjbossInstance.bootstrap();\n\tlog.debug(=\r\n&quot;JBoss microcontainer is up&quot;);\n\n\tlog.debug(&quot;Going to deploy scanClasspath&quot;)=\r\n;\n\tdeploy(scanClasspath);\n\tlog.debug(&quot;End of deploy scanClasspath&quot;);\n\t... &lt;=\r\nHERE there is more code&gt;\t\n}\n\nUntil now everything is pretty straight-forwar=\r\nd. But how can I stop\nJBoss when I finished testing? I don&#39;t want to stop i=\r\nt after every\nclass, but after whole TestSuite is done. I didn&#39;t find somet=\r\nhing\nbuilt-in, so I use ShutdownHook...\n\nIn the above setUpClass() mehtod i=\r\nn the place that noted as &quot;&lt;HERE\nthere is more code&gt;&quot; I have:\n\nlog.debug(&quot;N=\r\now add hook to shutdown server&quot;);\nRuntime.getRuntime().addShutdownHook(new =\r\nThread() {\n public void run() {\n assert lRunnables!=3Dnull;\n Runnable runna=\r\nble =3Dnull;\n String runnableI =3D null;\n try {\n  for(int i=3D0;i&lt;lRunnable=\r\ns.length;i++){\n  \trunnable =3D lRunnables[i];\n  \trunnableI =3D &quot;runnable &quot;+=\r\ni;\n  \tlog.debug(&quot;Going to run &quot;+runnableI);\n  \tif(runnable=3D=3Dnull){\n  \t\t=\r\n  log.warn(runnableI+&quot; is null, skipping&quot;);\n\t} else {\n\t   try {\n\t    runnab=\r\nle.run();\n\t    log.debug(runnableI+&quot; ends run succesfully&quot;);\n\t    }\n\t   cat=\r\nch(Throwable e){log.error(runnableI+&quot; fails&quot;, e);}\n\t     \n\t   }\n\t}\n\t\t\t     =\r\n       \t\n  }\n\n  catch(Throwable e){\n    log.error(&quot;This should never happen=\r\ned. Some runnables Throwable\n(exception) propogates outside the loop&quot;, e);\n=\r\n   }\n\t\t            \t\n\t\t            \t\n   synchronized (jbossInstance) {\n    =\r\n   \tjbossInstance.shutdown();\n   }\n String junitStatus =3D junitStatusOs.to=\r\nString();\n log.debug(junitStatus);\n\t\t               \n  }\n});\nI will talk ab=\r\nout junitStatusPs a bit later. What is actually is done\nhere that in @Befor=\r\neClass that it is before running every class, there\nis check whether JBoss =\r\nis run or no. If it is run nothing special is\ndone. If it is not run, and t=\r\nhis will be true only first time this\ncheck will be done, JBoss is started =\r\nand ShutDownHook is added. Take a\nlook on the JavaDoc on ShutDownHook, but =\r\nbasically, on the call on\nSystem.exit() JVM will be run your hook. In that =\r\nshutdown hook I make\njbossInstance.shutdown(). \n\n\nThere is one issue here. =\r\nOne JBoss is shutting down it write some\nthing to the log. What is happen, =\r\nthat I see JUnit report (90000\ntested passes, 100 fails, and 10 ignored) an=\r\nd after this report I see\nthe output from shitting down process. This happe=\r\nn, because the\nshutdown hook happens after last JUnit class finished to run=\r\n. \nI found some work around. In the BaseTestCase I have:\n       // the logg=\r\ner\n\tprivate static final Log log =3D LogFactory.getLog(BaseTestCase.class);=\r\n\n\tprotected static final OutputStream junitStatusOs =3D new\nByteArrayOutput=\r\nStream(16*1024);\n\t\nThis junitStatusPs is actually passed to as PrintStream =\r\n(instead\nSystem.out) to the JUnit classes. Note, that I have \n\n String juni=\r\ntStatus =3D junitStatusOs.toString();\n log.debug(junitStatus);\n\t\t          =\r\n     \nas the last row of the shutdown hook. This ensure, that I will see th=\r\ne\noutput of the shutdown hook first, and the JUnit report will be the\nlast =\r\nrows in the standard output. \nAnd the last issue is:\n\nIf I want to do some =\r\nother thing I just wrap it as lRunnables and pass\nto the method mentioned a=\r\nbove. It is looks like this:\n\n    \t//we want to call cleanUp() method that =\r\near application calls\n    \t//moment before we shutting down JBoss\n        R=\r\nunnable runnable =3D new Runnable(){\n        \tpublic void run() {\n        \t=\r\n\ttry {\n       \t\t\t\tcleanUp();        \t\t\t\t\n        \t\t}\n        \t\tcatch(HelloW=\r\norldException e){\n        \t\t\tlog.error(&quot;Failed to cleanUp&quot;, e);\n        \t\t}=\r\n \t\t\n        \t}\n        };\n    \t\n        setUpClass(System.getProperty(&quot;user=\r\n.dir&quot;) + &quot;/target/classes&quot;,\nrunnable);        \n\nIn order to shutdown JBoss =\r\nwe use\n        @AfterClass\n\tpublic static void tearDownClass() throws Excep=\r\ntion {\n       \tlog.info(&quot;one time tearDownClass()&quot;);\n\t\tundeploy();\n\t\tBootst=\r\nrap.getInstance().shutdown();\n\t}\n\n\n\n", 
    "profile": "toalexsmail", 
    "topicId": 20668, 
    "spamInfo": {
        "reason": "6", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 340165037, 
    "prevInTime": 20669, 
    "contentTrasformed": false, 
    "postDate": "1215632848", 
    "canDelete": false, 
    "nextInTopic": 20673, 
    "prevInTopic": 20669, 
    "headers": {
        "inReplyToHeader": "PGc1MW44ZStmdTRyQGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PGc1MzRrZys1cWpnQGVHcm91cHMuY29tPg=="
    }
}
{
    "numMessagesInTopic": 30, 
    "nextInTime": 24314, 
    "senderId": "JdAZbxLmMouke8yVJUuRThC5zok4vrj6IS2UJXhBdcXHhCYWEmgvwCv8fL4jtYGlFmrdVI1mVhArx5p4K44R0s4tT_dAEw", 
    "systemMessage": false, 
    "subject": "Re: Feedback requested: Impending changes to RunListener", 
    "from": "&quot;tibord47&quot; &lt;tibord47@...&gt;", 
    "authorName": "tibord47", 
    "msgSnippet": "Hi all, ok, so in that case the standard javax annotations cannot be used. Other options are jcip and proprietary one. I vote for jcip since the license allows", 
    "msgId": 24313, 
    "rawEmail": "Return-Path: &lt;tibord47@...&gt;\r\nReceived: (qmail 10220 invoked by uid 7800); 12 Feb 2013 23:00:26 -0000\r\nX-Sender: tibord47@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nX-Received: (qmail 68393 invoked from network); 12 Feb 2013 22:14:49 -0000\r\nX-Received: from unknown (10.193.84.151)\n  by m7.grp.bf1.yahoo.com with QMQP; 12 Feb 2013 22:14:49 -0000\r\nX-Received: from unknown (HELO ng4-ip2.bullet.mail.bf1.yahoo.com) (98.139.165.18)\n  by mta5.grp.bf1.yahoo.com with SMTP; 12 Feb 2013 22:14:49 -0000\r\nX-Received: from [98.139.164.122] by ng4.bullet.mail.bf1.yahoo.com with NNFMP; 12 Feb 2013 22:14:49 -0000\r\nX-Received: from [10.193.94.107] by tg3.bullet.mail.bf1.yahoo.com with NNFMP; 12 Feb 2013 22:14:49 -0000\r\nDate: Tue, 12 Feb 2013 22:14:49 -0000\r\nTo: junit@yahoogroups.com\r\nMessage-ID: &lt;kfeesp+knnk@...&gt;\r\nUser-Agent: eGroups-EW/0.82\r\nMIME-Version: 1.0\r\nContent-Type: text/plain; charset=&quot;ISO-8859-1&quot;\r\nContent-Transfer-Encoding: quoted-printable\r\nX-Mailer: Yahoo Groups Message Poster\r\nX-Yahoo-Newman-Property: groups-compose\r\nX-eGroups-Msg-Info: 1:12:0:0:0\r\nFrom: &quot;tibord47&quot; &lt;tibord47@...&gt;\r\nSubject: Re: Feedback requested: Impending changes to RunListener\r\nX-Yahoo-Group-Post: member; u=507342950; y=zLOwJS7s2COvOSnhwxQ94z2RheBkeLbQo9Ir8uA-ONKk6TQ\r\nX-Yahoo-Profile: tibord47\r\nX-eGroups-Approved-By: dsaff &lt;david@...&gt; via email; 12 Feb 2013 23:00:26 -0000\r\n\r\nHi all,\n\nok, so in that case the standard javax annotations cannot be used.=\r\n\n\nOther options are jcip and proprietary one.\n\nI vote for jcip since the li=\r\ncense allows us to use a dependency.\n\nTo me the name &quot;ThreadSafe&quot; sounds mo=\r\nre preferable to &quot;Concurrent&quot;, since the implemntator must take care of mor=\r\ne than concurrent calls of listener&#39;s methods, but also atomicity, visibili=\r\nty of vars, constructor and treatment of critical section(s) inside of the =\r\nlistener.\n\nAny thoughts?\n\nCheers,\nTibor\n\n--- In junit@yahoogroups.com, Kevi=\r\nn Cooney  wrote:\n&gt;\n&gt; On Tue, Feb 12, 2013 at 12:46 AM, sschroev  wrote:\n&gt; \n=\r\n&gt; &gt; **\n&gt; &gt;\n&gt; &gt;\n&gt; &gt; At the risk of repeating myself: my only objection is wi=\r\nth the package in\n&gt; &gt; which said annotation resides: net.jcip.annotations i=\r\nnstead of\n&gt; &gt; javax.annotation.concurrent.\n&gt; &gt;\n&gt; The JSR-305 ThreadSafe ann=\r\notation appears to have\n&gt; @Retention(RetentionPolicy.CLASS):\n&gt; \n&gt; https://c=\r\node.google.com/p/jsr-305/source/browse/trunk/ri/src/main/java/javax/annotat=\r\nion/concurrent/ThreadSafe.java\n&gt; \n&gt; Do you see something different in your =\r\nversion?\n&gt; \n&gt; Having RetentionPolicy.CLASS means it can only be read via by=\r\ntecode-level\n&gt; post-processing, not via reflection:\n&gt; \n&gt; http://stackoverfl=\r\now.com/questions/3107970/annotations-retention-policy\n&gt; \n&gt; \n&gt; &gt; But that ar=\r\ngument can also be made in reverse. Hence my suggestion to\n&gt; &gt; inspect the =\r\nannotation&#39;s simple name only.\n&gt; &gt;\n&gt; That would only work if the retention =\r\npolicy for your ThreadSafe annotation\n&gt; was &quot;RUNTIME&quot;. So if we went with t=\r\nhis approach, we would risk someone\n&gt; making a change that they believe wil=\r\nl allow their runner to be called\n&gt; concurrently but would still result in =\r\nthe calls to their runner\n&gt; being synchronized.\n&gt; \n&gt; -- Kevin\n&gt; \n&gt; That als=\r\no makes the licencing discussion mood, unless one wishes to depend\n&gt; &gt; on j=\r\ncip-annotation to provide a &quot;default&quot; or &quot;preferred&quot; version of the\n&gt; &gt; ann=\r\notation. That&#39;s fine of course. :) Though then do please mark the\n&gt; &gt; depen=\r\ndency : otherwise I have to start explicitly excluding it (I derive my\n&gt; &gt; =\r\nannotations from one of the FindBugs modules mentioned in an earlier email;=\r\n\n&gt; &gt; no need to duplicate classes on the classpath).\n&gt; &gt;\n&gt; &gt; Cheers,\n&gt; &gt; St=\r\nephan\n&gt; &gt;\n&gt; &gt;\n&gt; &gt; --- In junit@yahoogroups.com, &quot;tibord47&quot; wrote:\n&gt; &gt; &gt;\n&gt; &gt;=\r\n &gt; Hi all junit guys,\n&gt; &gt; &gt;\n&gt; &gt; &gt; Let me turn back to the original problem.=\r\n\n&gt; &gt; &gt;\n&gt; &gt; &gt; We knew that it&#39;s a good idea to let the users to annotated a =\r\ncustom\n&gt; &gt; listener by @ThreadSafe if it&#39;s really thread-safe.\n&gt; &gt; &gt;\n&gt; &gt; &gt; =\r\nIn every other case the given listener is wrapped in synchronized\n&gt; &gt; liste=\r\nner which is package private class.\n&gt; &gt; &gt;\n&gt; &gt; &gt; I am convinced that we shou=\r\nld not make synchronized listener public\n&gt; &gt; since this is our internal pat=\r\nch.\n&gt; &gt; &gt;\n&gt; &gt; &gt; The user may have whatever thread-safe listener depending o=\r\nn\n&gt; &gt; implementation and still not having it synchronized. Thus s/he can\n&gt; =\r\n&gt; annotated the clas by @ThreadSafe.\n&gt; &gt; &gt; We are synchronizing the listene=\r\nr&#39;s methods internally in the patch only\n&gt; &gt; because the user&#39;s implementat=\r\nion is unknown -listener in not annotated yet.\n&gt; &gt; &gt;\n&gt; &gt; &gt; Back to jcip-ann=\r\notations license. Such library is under Creative Commons\n&gt; &gt; Attribution Li=\r\ncense (http://creativecommons.org/licenses/by/2.5).\n&gt; &gt; &gt;\n&gt; &gt; &gt; If we use M=\r\naven dependency, we are free to share, distribute and\n&gt; &gt; transmit.\n&gt; &gt; &gt; S=\r\no there is no legal issue for the JUnit.\n&gt; &gt; &gt;\n&gt; &gt; &gt; Any objections to this=\r\n lincense?\n&gt; &gt; &gt;\n&gt; &gt; &gt; Thx, Tibor\n&gt; &gt; &gt;\n&gt; &gt; &gt;\n&gt; &gt; &gt;\n&gt; &gt; &gt; --- In junit@yaho=\r\nogroups.com, &quot;sschroev&quot; wrote:\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; I understand your concerns w=\r\n.r.t. the intended semantics of\n&gt; &gt; third-party @ThreadSafe annotations. Fo=\r\nr that reason I could certainly get\n&gt; &gt; behind a differently-named annotati=\r\non such as @Concurrent. Adding one more\n&gt; &gt; annotation is cheap, after all =\r\n;)\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; Cheers,\n&gt; &gt; &gt; &gt; Stephan\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; --- In junit@yah=\r\noogroups.com, Kevin Cooney wrote:\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; On Wed, Feb 6, 2013 a=\r\nt 10:06 AM, sschroev wrote:\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; **\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; =\r\n&gt;\n&gt; &gt; &gt; &gt; &gt; &gt; I like the idea, a lot!\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; But would lik=\r\ne to ask that only the *simple name* of the\n&gt; &gt; annotation is\n&gt; &gt; &gt; &gt; &gt; &gt; c=\r\nonsidered, without regard for the package in which it resides.\n&gt; &gt; &gt; &gt; &gt; &gt;\n=\r\n&gt; &gt; &gt; &gt; &gt; Interesting idea.\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; It looks like Guice uses th=\r\nis strategy for @Nullable (\n&gt; &gt; &gt; &gt; &gt; https://code.google.com/p/google-guic=\r\ne/wiki/UseNullable)\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; That would require us to iterate th=\r\nrough all of the class&#39;s\n&gt; &gt; annotations, vs\n&gt; &gt; &gt; &gt; &gt; a simple getAnnotati=\r\non() call, but listeners are not added and\n&gt; &gt; removed very\n&gt; &gt; &gt; &gt; &gt; often=\r\n.\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; This way one can:\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; 1. Use an=\r\n alternative third-party annotation, such as\n&gt; &gt; &gt; &gt; &gt; &gt; javax.annotation.c=\r\noncurrent.ThreadSafe from libraries like\n&gt; &gt; &gt; &gt; &gt; &gt; com.google.code.findbu=\r\ngs:jsr305:1.3.9 and\n&gt; &gt; &gt; &gt; &gt; &gt; com.google.code.findbugs:annotations:2.0.1.=\r\n\n&gt; &gt; &gt; &gt; &gt; &gt; 2. Define a private annotation, without adding _any_ additiona=\r\nl\n&gt; &gt; dependency.\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; Alternatively, we could add a JUnit=\r\n-specific annotation (possibly\n&gt; &gt; named\n&gt; &gt; &gt; &gt; &gt; &quot;Concurrent&quot;) and you co=\r\nuld annotate your class with both\n&gt; &gt; annotations (ob\n&gt; &gt; &gt; &gt; &gt; meme: http:=\r\n//www.quickmeme.com/meme/3svo5h/)\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; One reservation I hav=\r\ne with using @ThreadSafe is that usually the\n&gt; &gt; &gt; &gt; &gt; jcip-annotations doc=\r\numents behavior (sure, it is used by findbugs to\n&gt; &gt; find\n&gt; &gt; &gt; &gt; &gt; potenti=\r\nal bugs, but that&#39;s validation based on behavior documented in\n&gt; &gt; &gt; &gt; &gt; an=\r\nnotations). Here we are proposing using @ThreadSafe to modify\n&gt; &gt; behavior.=\r\n\n&gt; &gt; &gt; &gt; &gt; Someone might not expect by simply adding an annotation to a cla=\r\nss\n&gt; &gt; they are\n&gt; &gt; &gt; &gt; &gt; changing the behavior of code that uses instances=\r\n of the class.\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; I use javax.annotation.con=\r\ncurrent.ThreadSafe quite a lot in my own\n&gt; &gt; code,\n&gt; &gt; &gt; &gt; &gt; &gt; so (1) is qu=\r\nite important from my perspective. There are\n&gt; &gt; precedents for\n&gt; &gt; &gt; &gt; &gt; &gt;=\r\n this approach: IIRC, Eclipse does something like this for\n&gt; &gt; variations o=\r\nn\n&gt; &gt; &gt; &gt; &gt; &gt; @Nullable and @Nonnull, whereas (again, IIRC) Findbugs handle=\r\ns two\n&gt; &gt; &gt; &gt; &gt; &gt; instances of @SuppressWarnings.\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; C=\r\nheers,\n&gt; &gt; &gt; &gt; &gt; &gt; Stephan\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; --- In junit=\r\n@yahoogroups.com, Kevin Cooney wrote:\n&gt; &gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; Hello, ev=\r\neryone\n&gt; &gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; Short version: we are thinking of adding=\r\n an optional dependency\n&gt; &gt; from\n&gt; &gt; &gt; &gt; &gt; &gt; JUnit\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; to jcip-an=\r\nnotations and are soliciting feedback.\n&gt; &gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; A few pe=\r\nople have noticed that when you use ParallelComputer,\n&gt; &gt; you got\n&gt; &gt; &gt; &gt; &gt;=\r\n &gt; poor\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; performance because calls to registered RunListeners =\r\nare\n&gt; &gt; synchronized. We\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; would like to fix this in the next r=\r\nelease of JUnit.\n&gt; &gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; In order to prevent affecting =\r\nexisting users, we are proposing\n&gt; &gt; having an\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; annotation tha=\r\nt can be added to RunListener implementations that\n&gt; &gt; can\n&gt; &gt; &gt; &gt; &gt; &gt; safe=\r\nly\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; be called concurrently from multiple threads. If a RunList=\r\nener\n&gt; &gt; passed to\n&gt; &gt; &gt; &gt; &gt; &gt; a\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; RunNotifier is not annotated=\r\n with this annotation, JUnit will\n&gt; &gt; wrap it\n&gt; &gt; &gt; &gt; &gt; &gt; with\n&gt; &gt; &gt; &gt; &gt; &gt; =\r\n&gt; a decorator that does synchronization.\n&gt; &gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; =\r\n&gt; &gt; &gt; &gt; We would appreciate feedback on this new annotation.\n&gt; &gt; &gt; &gt; &gt; &gt; &gt;\n=\r\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; We have two options:\n&gt; &gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; a. Create ou=\r\nr own annotation for this\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; b. Use ThreadSafe (\n&gt; &gt; &gt; &gt; &gt; &gt; &gt;\n&gt;=\r\n &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; http://grepcode.com/file/repo1.maven.org/maven2/net.jcip/jci=\r\np-annotations/1.0/net/jcip/annotations/ThreadSafe.java\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; )\n&gt; &gt; =\r\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; The advantages to option b are:\n&gt; &gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt;=\r\n &gt; &gt; &gt; &gt; 1. It&#39;s a well-known annotation\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; 2. Users that use JU=\r\nnit can add this annotation to their\n&gt; &gt; thread-safe\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; RunListe=\r\nner implementations today and get the benefits &quot;for\n&gt; &gt; free&quot; later.\n&gt; &gt; &gt; =\r\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; Note we can do this without requiring that all users =\r\nof JUnit\n&gt; &gt; have the\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; jcip-annotations jar in their classpath=\r\n as of JDK 1.5.0_06 (see\n&gt; &gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; http://stackoverflow=\r\n.com/questions/3567413/why-doesnt-a-missing-annotation-cause-a-classnotfoun=\r\ndexception-at-runtime\n&gt; &gt; &gt; &gt; &gt; &gt; ).\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; If jcip-annotations is n=\r\not on the classpath then all RunListener\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; implementations will=\r\n be treated as not thread-safe.\n&gt; &gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; As a specific e=\r\nxample, the Maven Surefire plugin would use this\n&gt; &gt; &gt; &gt; &gt; &gt; dependency\n&gt; &gt;=\r\n &gt; &gt; &gt; &gt; &gt; and include jcip-annotations.\n&gt; &gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; Curren=\r\ntly, JUnit only depends on one third-party library\n&gt; &gt; (Hamcrest). This\n&gt; &gt;=\r\n &gt; &gt; &gt; &gt; &gt; has caused us some pain in the past when the Hamcrest code\n&gt; &gt; c=\r\nhanged in\n&gt; &gt; &gt; &gt; &gt; &gt; ways\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; that broke existing users of JUnit=\r\n. We believe this will not be\n&gt; &gt; an issue\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; with jcip-annotati=\r\nons because the JAR only contains annotations,\n&gt; &gt; not any\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; co=\r\nde.\n&gt; &gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; One possible concern would be with other op=\r\nen source libraries\n&gt; &gt; that\n&gt; &gt; &gt; &gt; &gt; &gt; provide\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; RunListener =\r\nimplementations (they would need to add\n&gt; &gt; jcip-annotations to\n&gt; &gt; &gt; &gt; &gt; &gt;=\r\n &gt; their compile-time classpath if they have thread-safe\n&gt; &gt; annotations, a=\r\nnd\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; document this to their users).\n&gt; &gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; &gt;=\r\n Thoughts?\n&gt; &gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; -- Kevin\n&gt; &gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt; &gt;=\r\n\n&gt; &gt; &gt; &gt; &gt; &gt; &gt; [Non-text portions of this message have been removed]\n&gt; &gt; &gt; =\r\n&gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt; &gt; [=\r\nNon-text portions of this message have been removed]\n&gt; &gt; &gt; &gt; &gt;\n&gt; &gt; &gt; &gt;\n&gt; &gt; =\r\n&gt;\n&gt; &gt;\n&gt; &gt;  \n&gt; &gt;\n&gt; \n&gt; \n&gt; [Non-text portions of this message have been remove=\r\nd]\n&gt;\n\n\n\n", 
    "profile": "tibord47", 
    "topicId": 24274, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 507342950, 
    "prevInTime": 24312, 
    "contentTrasformed": false, 
    "postDate": "1360707289", 
    "canDelete": false, 
    "nextInTopic": 24314, 
    "prevInTopic": 24306, 
    "headers": {
        "messageIdInHeader": "PGtmZWVzcCtrbm5rQGVHcm91cHMuY29tPg=="
    }
}
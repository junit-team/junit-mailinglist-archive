{
    "numMessagesInTopic": 5, 
    "nextInTime": 16059, 
    "senderId": "VbWJnaDoJpMFnKI8mj5UASFNjvO4f6yGPV38f6F6ybF7cXtdplQvtaAap-5FMhcM7fZSewbY_TtASJm25FECpYQI5rQ-VN94GUJG5A", 
    "systemMessage": false, 
    "subject": "[PATCH] filter stack traces in junit", 
    "from": "&quot;Ben Maurer&quot; &lt;bmaurer@...&gt;", 
    "authorName": "Ben Maurer", 
    "msgSnippet": "Hey guys, As I mentioned in my previous email, one of the issues with junit is that I have to manually filter out harness stack frames from exceptions. The", 
    "msgId": 16058, 
    "profile": "benjamindavidmaurer", 
    "topicId": 16058, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 256083789, 
    "messageBody": "<div id=\"ygrps-yiv-781930034\">Hey guys,<br/>\n<br/>\nAs I mentioned in my previous email, one of the issues with junit is<br/>\nthat I have to manually filter out harness stack frames from<br/>\nexceptions. The current approach to this is generally to just filter<br/>\nout lines with some specific prefixes. However, this is not ideal. For<br/>\nexample, ant filters out some sun.reflect stack frames. But these can<br/>\noccur *inside* a test case&#39;s stack trace.<br/>\n<br/>\nThe following patch solves the issue by using the<br/>\nInvocationTargetException generated by Method.invoke to figure out<br/>\nwhich stack frames come from JUnit. It then removes these frames from<br/>\nthe trace. This process is transparent to consumers of the junit<br/>\nframework.<br/>\n<br/>\nIssues:<br/>\n<br/>\n1) I&#39;m not sure if the place I located the filter is the most ideal<br/>\nplace in the framework. Other ideas would be greatly appreciated<br/>\n<br/>\n2) I need test cases (I haven&#39;t yet gotten to bite the bullet and<br/>\nwrite tests before I develop ;-).<br/>\n<br/>\nSince this list doesn&#39;t allow attachments, I&#39;ve copied and pasted this<br/>\nin the main text. Since this will probably be hard to apply, I&#39;ve also<br/>\nposted on my dorm computer:<br/>\n<br/>\n<a rel=\"nofollow\" target=\"_blank\" href=\"http://omega.res.cmu.edu/~benm/junit-stacktrace.patch\">http://omega.res.cmu.edu/~benm/junit-stacktrace.patch</a><br/>\n<br/>\n-- Ben<br/>\n<br/>\n<br/>\n<br/>\n<br/>\n<br/>\n<br/>\n<br/>\n<br/>\nIndex: org/junit/internal/runners/TestMethodRunner.java<br/>\n===================================================================<br/>\nRCS file:<br/>\n/cvsroot/junit/junit/org/junit/internal/runners/Attic/TestMethodRunner.java,v<br/>\nretrieving revision 1.1.2.6<br/>\ndiff -u -r1.1.2.6 TestMethodRunner.java<br/>\n--- org/junit/internal/runners/TestMethodRunner.java\t6 Feb 2006<br/>\n04:09:17 -0000\t1.1.2.6<br/>\n+++ org/junit/internal/runners/TestMethodRunner.java\t10 Feb 2006<br/>\n04:44:42 -0000<br/>\n@@ -81,7 +81,10 @@<br/>\n \t\t\tif (expectsException())<br/>\n \t\t\t\taddFailure(new AssertionError(&quot;Expected exception: &quot; +<br/>\nexpectedException().getName()));<br/>\n \t\t} catch (InvocationTargetException e) {<br/>\n-\t\t\tThrowable actual= e.getTargetException();<br/>\n+\t\t\tThrowable actual= e.getTargetException ();<br/>\n+\t\t\t// It&#39;s important that we filter here. This way, we<br/>\n+\t\t\t// cut the sun.reflect.* out of the stack trace.<br/>\n+\t\t\tStackTraceFilter.filter (actual, e);<br/>\n \t\t\tif (!expectsException())<br/>\n \t\t\t\taddFailure(actual);<br/>\n \t\t\telse if (isUnexpected(actual)) {<br/>\nIndex: org/junit/internal/runners/StackTraceFilter.java<br/>\n===================================================================<br/>\nRCS file: org/junit/internal/runners/StackTraceFilter.java<br/>\ndiff -N org/junit/internal/runners/StackTraceFilter.java<br/>\n--- /dev/null\t1 Jan 1970 00:00:00 -0000<br/>\n+++ org/junit/internal/runners/StackTraceFilter.java\t1 Jan 1970<br/>\n00:00:00 -0000<br/>\n@@ -0,0 +1,64 @@<br/>\n+package org.junit.internal.runners;<br/>\n+<br/>\n+import java.util.ArrayList;<br/>\n+import java.util.List;<br/>\n+<br/>\n+/**<br/>\n+ * Methods for filtering out irrelevant stack frames from<br/>\n+ * a Throwable.<br/>\n+ * <br/>\n+ * @author Ben Maurer &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:bmaurer@...\">bmaurer@...</a>&gt;<br/>\n+ */<br/>\n+public class StackTraceFilter {<br/>\n+<br/>\n+\t/**<br/>\n+\t * Removes items from a stack trace that it shares with another trace.<br/>\n+\t * @param trace The trace to filter out<br/>\n+\t * @param base The base trace<br/>\n+\t * @return trace with items at the end that it shares with base removed<br/>\n+\t */<br/>\n+\tstatic StackTraceElement [] doFilter (StackTraceElement [] trace,<br/>\nStackTraceElement [] base)<br/>\n+\t{<br/>\n+\t\tList&lt;StackTraceElement&gt; filtered = new ArrayList&lt;StackTraceElement&gt; ();<br/>\n+\t\tfor (StackTraceElement ele : trace)<br/>\n+\t\t\tfiltered.add (ele);<br/>\n+<br/>\n+\t\tfor (int i = base.length - 1; i &gt;= 0 && filtered.size () &gt; 0; i--) {<br/>\n+\t\t\tif (!filtered.get (filtered.size () - 1).equals (base [i]))<br/>\n+\t\t\t\tbreak;<br/>\n+<br/>\n+\t\t\tfiltered.remove (filtered.size () - 1);<br/>\n+\t\t}<br/>\n+<br/>\n+\t\treturn filtered.toArray (new StackTraceElement [] {});<br/>\n+<br/>\n+\t}<br/>\n+<br/>\n+\t/**<br/>\n+\t * Filters the stack trace components that toFilter shares<br/>\n+\t * with the threads current stack trace.<br/>\n+\t */<br/>\n+\tpublic static void filter (Throwable toFilter)<br/>\n+\t{<br/>\n+\t\tfilter (toFilter, Thread.currentThread ().getStackTrace ());<br/>\n+\t}<br/>\n+<br/>\n+\t/**<br/>\n+\t * Filters the stack trace components that toFilter shares<br/>\n+\t * with baseException.<br/>\n+\t */<br/>\n+\tpublic static void filter (Throwable toFilter, Throwable baseException)<br/>\n+\t{<br/>\n+\t\tfilter (toFilter, baseException.getStackTrace ());<br/>\n+\t}<br/>\n+<br/>\n+\t/**<br/>\n+\t * Filters the stack trace components that toFilter shares<br/>\n+\t * with base.<br/>\n+\t */<br/>\n+\tpublic static void filter (Throwable toFilter, StackTraceElement []<br/>\nbase)<br/>\n+\t{<br/>\n+\t\tfor (Throwable t = toFilter; t != null; t = t.getCause ())<br/>\n+\t\t\tt.setStackTrace (doFilter (t.getStackTrace (), base));<br/>\n+\t}<br/>\n+}</div>", 
    "prevInTime": 16057, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1139547120", 
    "canDelete": false, 
    "nextInTopic": 16066, 
    "prevInTopic": 0, 
    "headers": {
        "messageIdInHeader": "PGRzaDY1ZytvYTV1QGVHcm91cHMuY29tPg=="
    }
}
{
    "numMessagesInTopic": 12, 
    "nextInTime": 23996, 
    "senderId": "xpIHzc0dC4TwbQbtwSKsQgerrj-36uRa5_rnKCr9-p4lp8S-z2F-Pelf7fd7pFrZAQbw5t43sspNxpl1kMLWFNA_PvPEGf5FSrDHqoPpaGM", 
    "systemMessage": false, 
    "subject": "Re: [junit] Re: Tests starting before Logback initialisation complete when run in parallel", 
    "from": "Brett Delle Grazie &lt;bdellegrazie@...&gt;", 
    "authorName": "Brett Delle Grazie", 
    "msgSnippet": "... Except when using an IDE, there I just want to: (1) select an individual test and have that run in a Debugger. Or (2) select a suite or class hierarchy and", 
    "msgId": 23995, 
    "topicId": 23967, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 79191679, 
    "messageBody": "<div id=\"ygrps-yiv-694431698\">On 9 September 2012 13:38, hkaipe &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:hkaipe@...\">hkaipe@...</a>&gt; wrote:<br/>\n<blockquote><span title=\"ireply\"> &gt; --- In <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>, CÃ©dric Beust â™&quot; &lt;cedric@...&gt; wrote:<br/>\n&gt;&gt;<br/>\n&gt;&gt; On Thu, Sep 6, 2012 at 10:38 AM, hkaipe &lt;hkaipe@...&gt; wrote:<br/>\n&gt;&gt;<br/>\n&gt;&gt; &gt; Surefire is your tool to organize which tests to run when and how.<br/>\n&gt;&gt;<br/>\n<br/>\n </span></blockquote>Except when using an IDE, there I just want to:<br/>\n(1) select an individual test and have that run in a Debugger. Or<br/>\n(2) select a suite or class hierarchy and have the output appear in<br/>\nthe JUnit window (and log window if appropriate) confirming things are<br/>\nstill working.<br/>\n<br/>\n<blockquote><span title=\"ireply\"> &gt;&gt;<br/>\n&gt;&gt; Right, which is why I think a @BeforeSuite annotation belongs to the<br/>\n&gt;&gt; testing framework, not the build tool. How would your build tool create a<br/>\n&gt;&gt; connection pool or an executor for your tests to use?<br/>\n<br/>\n </span></blockquote>Agree completely here, with the caveat that _most_ situations would<br/>\nprobably be catered for by @BeforeClass.<br/>\n<br/>\nQ: In multi-threaded mode: are multiple threads used to run the<br/>\n@BeforeClass code?<br/>\n<br/>\n<blockquote><span title=\"ireply\"> &gt;&gt;<br/>\n&gt;&gt; --<br/>\n&gt;&gt; Cédric<br/>\n&gt;<br/>\n&gt; I can see value in a @BeforeSuite-annotation but in general I think test-suites should be administered by the build-tool. - In this case SureFire, which perhaps should support some suite/category-solution that can be applied to many test-frameworks, not only JUnit.<br/>\n<br/>\n </span></blockquote>I agree partially here. Tests should easily selectable within an IDE,<br/>\nin particular I want to be able to debug a specific test or run all<br/>\ntests with the same convenience that I can execute the debugger<br/>\nagainst the main project.<br/>\nUsing Maven + Surefire results in added complexity that isn&#39;t really necessary.<br/>\nThis fails with the IDE use case - IDE users quite often want to<br/>\nexecute a suite or all tests or a particular set of tests simply by<br/>\ngrouping... then they want to debug within that set.<br/>\n<br/>\n<blockquote><span title=\"ireply\"> &gt;<br/>\n&gt; But Brett&#39;s particular problem is not limited to a test-suite or testing framework. It goes beyond testing. - He can accidently encounter it whenever he starts up a multi-threaded JVM, therewith making JVM-startup his problem domain. Therefore I think that using a javaagent would be a good pattern and - yes - my build tool can do that ... - In the Surefire-configuration you specify an &quot;argLine&quot; for the JVM:<br/>\n<br/>\n </span></blockquote>I disagree here.<br/>\nIn applications (web or console based) I can already control<br/>\nprogrammatically how the logging apparatus is instantiated, meaning<br/>\nthis isn&#39;t an issue<br/>\nfor me in the normal case. When using JUnit in parallel test mode I<br/>\ncan&#39;t control this at all<br/>\n<br/>\n<blockquote><span title=\"ireply\"> &gt;<br/>\n&gt; &lt;plugin&gt;<br/>\n&gt; &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;<br/>\n&gt; &lt;configuration&gt;<br/>\n&gt; &lt;argLine&gt; -javaagent:${localRepository}/path/to/myagent/1.0-SNAPSHOT/myagent-1.0-SNAPSHOT.jar &lt;/argLine&gt;<br/>\n&gt; &lt;/configuration&gt;<br/>\n&gt; &lt;/plugin&gt;<br/>\n&gt;<br/>\n&gt; In the &quot;Premain-Class&quot; of &quot;myagent&quot; we can define JVM-wide setup and/or tearDown - e.g.<br/>\n&gt;<br/>\n&gt; public class GlobalTearDown extends Thread<br/>\n&gt; {<br/>\n&gt; public static void premain(String args)<br/>\n&gt; {<br/>\n&gt; System.out.println(&quot;HELLO FROM premain&quot;);<br/>\n&gt; Runtime.getRuntime().addShutdownHook(new GlobalTearDown());<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt; public void run()<br/>\n&gt; {<br/>\n&gt; System.out.println(&quot;TEAR-DOWN EXECUTES HERE&quot;);<br/>\n&gt; }<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt; Output from Maven/Surefire when &quot;GlobalTearDown&quot; is used as &quot;Premain-Class&quot;:<br/>\n&gt; ---------------------------------------------------------------------<br/>\n&gt; [surefire:test]<br/>\n&gt; Surefire report directory: /home/me/projects/experiments/target/surefire-reports<br/>\n&gt; HELLO FROM premain<br/>\n&gt;<br/>\n&gt; -------------------------------------------------------<br/>\n&gt;  T E S T S<br/>\n&gt; -------------------------------------------------------<br/>\n&gt; Running org.callbackparams.experiments.DummyTest<br/>\n&gt; Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.029 sec<br/>\n&gt;<br/>\n&gt; Results :<br/>\n&gt;<br/>\n&gt; Tests run: 1, Failures: 0, Errors: 0, Skipped: 0<br/>\n&gt;<br/>\n&gt; TEAR-DOWN EXECUTES HERE<br/>\n&gt; ---------------------------------------------------------------------<br/>\n&gt;<br/>\n&gt; I don&#39;t know how the &quot;Premain-Class&quot; should look to solve Brett&#39;s problem but I&#39;m quite sure the problem can be elegantly solved with this pattern. - And his solution can perhaps be easily reused in other projects as well as outside of the testing activities.<br/>\n&gt;<br/>\n&gt; /Henrik<br/>\n&gt;<br/>\n<br/>\n </span></blockquote>I appreciate you&#39;ve gone to great lengths to propose a general &#39;fits<br/>\nall&#39; category of solution but I am concerned about the unintended<br/>\nconsequences such<br/>\nbehaviour might introduce (there might be none and I fully admit that<br/>\nI don&#39;t rightly know). I do know that this type of shutdown hook<br/>\nprocessing is the<br/>\nwrong solution for web applications (they should hook into the<br/>\ncontainer life-cycle for such tasks).<br/>\n<br/>\nEssentially we&#39;re talking about controlled initialisation and shutdown<br/>\nof an application using whatever is the appropriate life-cycle. In<br/>\nthis context the<br/>\nlife-cycle is the initialisation and shutdown of JUnit or whatever<br/>\ntesting framework being used.<br/>\n<br/>\nContainers / Frameworks that support multi-threading usually have a<br/>\nsingle-threaded initialisation and shutdown phases to enforce<br/>\ndeterministic behaviour<br/>\nduring these critical phases before going into full mutli-threaded mode.<br/>\n<br/>\nWe are talking about a very specific case of behaviour which is<br/>\nultimately caused by parallel test execution without a guaranteed<br/>\ndeterministic stable<br/>\ninitialisation phase. It boils down to the simple fact that there is a<br/>\nuse case for something similar to:<br/>\n@BeforeAll / @AfterAll (or any appropriate naming)<br/>\nThese should be executed serially rather than multi-threaded and<br/>\nconsidered &#39;reserved&#39; only for special global setup / tear-down<br/>\noperations that must<br/>\nbe executed under single-threading conditions.<br/>\n<br/>\nWhat&#39;s more, this should work out of the box with any IDE.<br/>\n<br/>\nAs David et. al. have indicated already this is technically possible by using:<br/>\n(1) A common base class and locking<br/>\nOR<br/>\n(2) Annotating all classes with a special rule and using locking<br/>\n<br/>\nThe problem with this solution is its logically in reverse. I would<br/>\nlike the startup / teardown behaviour applied automatically rather<br/>\nthan me<br/>\nhaving to decorate classes accordingly or use a specific base class.<br/>\nUse of a special Runner is possible I guess but would break in a IDE<br/>\n(which typically uses its own runner).<br/>\n<br/>\nEssentially I guess this is a necessary start-up &#39;aspect&#39;  - which I<br/>\nsuspect is, in the main, the idea you&#39;re proposing by using a Java<br/>\nAgent<br/>\n<br/>\nIrrespective however, the discussion is most interesting.<br/>\n<br/>\n-- <br/>\nBest Regards,<br/>\n<br/>\nBrett Delle Grazie</div>", 
    "prevInTime": 23994, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1347274655", 
    "canDelete": false, 
    "nextInTopic": 0, 
    "prevInTopic": 23992, 
    "headers": {
        "inReplyToHeader": "PGsyaTJrbitidnJrQGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PENBQ0xEMD03aC1nLXhKdXFHNFdPSD03NWZPNGJZbjdTUXBnWSs4X1ZlVWQ1Um15V1N5Z0BtYWlsLmdtYWlsLmNvbT4=", 
        "referencesHeader": "PENBT3BoZ0pEVD1BVGg4enVELVYtPW9SVjM1cFVGcDh3R2lXOW5CWG9OZTNqTnFhNnEyd0BtYWlsLmdtYWlsLmNvbT4JPGsyaTJrbitidnJrQGVHcm91cHMuY29tPg=="
    }
}
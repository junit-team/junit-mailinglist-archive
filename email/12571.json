{
    "numMessagesInTopic": 1, 
    "nextInTime": 12572, 
    "senderId": "saU4YU72YzZiyXnId-i10vWmjhdTVBPKKwos9aWVein5teadYuoCYl7izlqPZsnMhtg-AJ0bAyMlZHHLkhJPcvl3I0NUQbaFF1E1vZkZfdy7", 
    "systemMessage": true, 
    "subject": "Java Imaging Error , please help", 
    "from": "&quot;Juliana  Lewis&quot; &lt;juliana_lewis@...&gt;", 
    "authorName": "Juliana  Lewis", 
    "msgSnippet": "hello there. I am working on image processing in Java. I was writing a simple application which can gray-scale an image, sharpen it , blur it, invert its", 
    "msgId": 12571, 
    "profile": "juliana_lewis", 
    "topicId": 12571, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 120719883, 
    "messageBody": "<div id=\"ygrps-yiv-1109868047\">hello there.<br/>\nI am working on image processing in Java. I was writing a <br/>\nsimple application which can gray-scale an image, sharpen<br/>\nit , blur it, invert its colors.<br/>\n<br/>\nNow i&#39;ve writting the following code to accomplish the following<br/>\ntask. I used simple java.awt.image class to write the convolution<br/>\nfilter, instead of using java ConvolveOp operator, to clarify the<br/>\nconcepts but now it gives me the error which is<br/>\n<br/>\n&quot;Array index out of bounds Exception&quot; and IndexColorModel sort of<br/>\nerror, can someone please help me, i am posting the code with it.<br/>\n<br/>\nlisting 1<br/>\n/*<br/>\n * &lt;applet code=ImageFilterDemo width=350 height=450&gt;<br/>\n * &lt;param name=img value=vincent.jpg&gt;<br/>\n * &lt;param name=filters value=&quot;Grayscale+Invert+Contrast+Blur+Sharpen&quot;&gt;<br/>\n * &lt;/applet&gt;<br/>\n */<br/>\nimport java.applet.*;<br/>\nimport java.awt.*;<br/>\nimport java.awt.event.*;<br/>\nimport java.util.*;<br/>\n<br/>\npublic class ImageFilterDemo extends Applet implements ActionListener {<br/>\n  Image img;<br/>\n  PlugInFilter pif;<br/>\n  Image fimg;<br/>\n  Image curImg;<br/>\n  LoadedImage lim;<br/>\n  Label lab;<br/>\n  Button reset;<br/>\n<br/>\n  public void init() {<br/>\n    setLayout(new BorderLayout());<br/>\n    Panel p = new Panel();<br/>\n    add(p, BorderLayout.SOUTH);<br/>\n    reset = new Button(&quot;Reset&quot;);<br/>\n    reset.addActionListener(this);<br/>\n    p.add(reset);<br/>\n    StringTokenizer st = new StringTokenizer(getParameter(&quot;filters&quot;),<br/>\n&quot;+&quot;);<br/>\n    while(st.hasMoreTokens()) {<br/>\n      Button b = new Button(st.nextToken());<br/>\n      b.addActionListener(this);<br/>\n      p.add(b);<br/>\n    }<br/>\n    <br/>\n    lab = new Label(&quot;&quot;);<br/>\n    add(lab, BorderLayout.NORTH);<br/>\n<br/>\n    img = getImage(getDocumentBase(), getParameter(&quot;img&quot;));<br/>\n    lim = new LoadedImage(img);<br/>\n    add(lim, BorderLayout.CENTER);<br/>\n   <br/>\n  }<br/>\n<br/>\n  public void actionPerformed(ActionEvent ae) {<br/>\n    String a = &quot;&quot;;<br/>\n<br/>\n    try {<br/>\n      a = (String)ae.getActionCommand();<br/>\n      if (a.equals(&quot;Reset&quot;)) {<br/>\n        lim.set(img);<br/>\n        lab.setText(&quot;Normal&quot;);<br/>\n      }<br/>\n      else {<br/>\n        pif = (PlugInFilter) Class.forName(a).newInstance();<br/>\n        fimg = pif.filter(this, img);<br/>\n        lim.set(fimg);<br/>\n        lab.setText(&quot;Filtered: &quot; + a);<br/>\n      }<br/>\n      repaint();<br/>\n    } catch (ClassNotFoundException e) {<br/>\n      lab.setText(a + &quot; not found&quot;);<br/>\n      lim.set(img);<br/>\n      repaint();<br/>\n    } catch (InstantiationException e) {<br/>\n      lab.setText(&quot;could&#39;t new &quot; + a);<br/>\n    } catch (IllegalAccessException e) {<br/>\n      lab.setText(&quot;no access: &quot; + a);<br/>\n    }<br/>\n  }<br/>\n}<br/>\n<br/>\nlisting 2<br/>\ninterface PlugInFilter {<br/>\n  java.awt.Image filter(java.applet.Applet a, java.awt.Image in);<br/>\n}<br/>\n<br/>\nlisting 3<br/>\nimport java.awt.*;<br/>\n<br/>\npublic class LoadedImage extends Canvas {<br/>\n  Image img;<br/>\n<br/>\n  public LoadedImage(Image i) {<br/>\n    set(i);<br/>\n  }<br/>\n<br/>\n  void set(Image i) {<br/>\n    MediaTracker mt = new MediaTracker(this);<br/>\n    mt.addImage(i, 0);<br/>\n    try {<br/>\n      mt.waitForAll();<br/>\n    } catch (InterruptedException e) { };<br/>\n    img = i;<br/>\n    repaint();<br/>\n  }<br/>\n  <br/>\n  public void paint(Graphics g) {<br/>\n    if (img == null) {<br/>\n      g.drawString(&quot;no image&quot;, 10, 30);<br/>\n    } else {<br/>\n      g.drawImage(img, 0, 0, this);<br/>\n    } <br/>\n  }<br/>\n<br/>\n  public Dimension getPreferredSize()  {<br/>\n    return new Dimension(img.getWidth(this), img.getHeight(this));<br/>\n  }<br/>\n  <br/>\n  public Dimension getMinimumSize()  {<br/>\n    return getPreferredSize();<br/>\n  }<br/>\n}<br/>\n<br/>\nlisting 4<br/>\nimport java.applet.*;<br/>\nimport java.awt.*;<br/>\nimport java.awt.image.*;<br/>\n<br/>\nclass Grayscale extends RGBImageFilter implements PlugInFilter {<br/>\n  public Image filter(Applet a, Image in) {<br/>\n    return a.createImage(new FilteredImageSource(in.getSource(), this));<br/>\n  }<br/>\n<br/>\n  public int filterRGB(int x, int y, int rgb) {<br/>\n    int r = (rgb &gt;&gt; 16) & 0xff;<br/>\n    int g = (rgb &gt;&gt; 8) & 0xff;<br/>\n    int b = rgb & 0xff;<br/>\n    int k = (int) (.56 * g + .33 * r + .11 * b);<br/>\n    return (0xff000000 | k &lt;&lt; 16 | k &lt;&lt; 8 | k);<br/>\n  }<br/>\n}<br/>\n<br/>\nlisting 5<br/>\nimport java.applet.*;<br/>\nimport java.awt.*;<br/>\nimport java.awt.image.*;<br/>\n<br/>\nclass Invert extends RGBImageFilter implements PlugInFilter {<br/>\n  public Image filter(Applet a, Image in) {<br/>\n    return a.createImage(new FilteredImageSource(in.getSource(), this));<br/>\n  }<br/>\n  public int filterRGB(int x, int y, int rgb) {<br/>\n    int r = 0xff - (rgb &gt;&gt; 16) & 0xff;<br/>\n    int g = 0xff - (rgb &gt;&gt; 8) & 0xff;<br/>\n    int b = 0xff - rgb & 0xff;<br/>\n    return (0xff000000 | r &lt;&lt; 16 | g &lt;&lt; 8 | b);<br/>\n  }<br/>\n}<br/>\n<br/>\nlisting 6<br/>\nimport java.applet.*;<br/>\nimport java.awt.*;<br/>\nimport java.awt.image.*;<br/>\n<br/>\npublic class Contrast extends RGBImageFilter implements PlugInFilter {<br/>\n<br/>\n  public Image filter(Applet a, Image in) {<br/>\n    return a.createImage(new FilteredImageSource(in.getSource(), this));<br/>\n  }<br/>\n<br/>\n  private int multclamp(int in, double factor) {<br/>\n    in = (int) (in * factor);<br/>\n    return in &gt; 255 ? 255 : in;<br/>\n  }<br/>\n<br/>\n  double gain = 1.2;<br/>\n  private int cont(int in) {<br/>\n    return (in &lt; 128) ? (int)(in/gain) : multclamp(in, gain);<br/>\n  }<br/>\n<br/>\n  public int filterRGB(int x, int y, int rgb) {<br/>\n    int r = cont((rgb &gt;&gt; 16) & 0xff);<br/>\n    int g = cont((rgb &gt;&gt; 8) & 0xff);<br/>\n    int b = cont(rgb & 0xff);<br/>\n    return (0xff000000 | r &lt;&lt; 16 | g &lt;&lt; 8 | b);<br/>\n  }<br/>\n}<br/>\n<br/>\nlisting 7<br/>\nimport java.applet.*;<br/>\nimport java.awt.*;<br/>\nimport java.awt.image.*;<br/>\n<br/>\nabstract class Convolver implements ImageConsumer, PlugInFilter {<br/>\n  int width, height;<br/>\n  int imgpixels[], newimgpixels[];<br/>\n<br/>\n  abstract void convolve();  // filter goes here...<br/>\n  <br/>\n  public Image filter(Applet a, Image in) {<br/>\n    in.getSource().startProduction(this);<br/>\n    waitForImage();<br/>\n    newimgpixels = new int[width*height];<br/>\n<br/>\n    try {<br/>\n      convolve();<br/>\n    } catch (Exception e) {<br/>\n      System.out.println(&quot;Convolver failed: &quot; + e);<br/>\n      e.printStackTrace();<br/>\n    }<br/>\n<br/>\n    return a.createImage(<br/>\n      new MemoryImageSource(width, height, newimgpixels, 0, width));<br/>\n  }<br/>\n<br/>\n  synchronized void waitForImage() {<br/>\n    try { wait(); } catch (Exception e) { };<br/>\n  }<br/>\n<br/>\n  public void setProperties(java.util.Hashtable dummy) { }<br/>\n  public void setColorModel(ColorModel dummy) { }<br/>\n  public void setHints(int dummy) { }<br/>\n<br/>\n  public synchronized void imageComplete(int dummy) {<br/>\n    notifyAll();<br/>\n  }<br/>\n<br/>\n  public void setDimensions(int x, int y) {<br/>\n    width = x;<br/>\n    height = y;<br/>\n    imgpixels = new int[x*y];<br/>\n  }<br/>\n<br/>\n  public void setPixels(int x1, int y1, int w, int h, <br/>\n    ColorModel model, byte pixels[], int off, int scansize) {<br/>\n    int pix, x, y, x2, y2, sx, sy;<br/>\n<br/>\n    x2 = x1+w;<br/>\n    y2 = y1+h;<br/>\n    sy = off;<br/>\n    for(y=y1; y&lt;y2; y++) {<br/>\n      sx = sy;<br/>\n      for(x=x1; x&lt;x2; x++) {<br/>\n        pix = model.getRGB(pixels[sx++]);<br/>\n        if((pix & 0xff000000) == 0)<br/>\n            pix = 0x00ffffff;<br/>\n        imgpixels[y*width+x] = pix;<br/>\n      }<br/>\n      sy += scansize;<br/>\n    }<br/>\n  }<br/>\n<br/>\n  public void setPixels(int x1, int y1, int w, int h, <br/>\n    ColorModel model, int pixels[], int off, int scansize) {<br/>\n    int pix, x, y, x2, y2, sx, sy;<br/>\n<br/>\n    x2 = x1+w;<br/>\n    y2 = y1+h;<br/>\n    sy = off;<br/>\n    for(y=y1; y&lt;y2; y++) {<br/>\n      sx = sy;<br/>\n      for(x=x1; x&lt;x2; x++) {<br/>\n        pix = model.getRGB(pixels[sx++]);<br/>\n        if((pix & 0xff000000) == 0)<br/>\n            pix = 0x00ffffff;<br/>\n        imgpixels[y*width+x] = pix;<br/>\n      }<br/>\n      sy += scansize;<br/>\n    }<br/>\n  }<br/>\n}<br/>\n<br/>\nlisting 8<br/>\npublic class Blur extends Convolver {<br/>\n  public void convolve() {<br/>\n    for(int y=1; y&lt;height-1; y++) {<br/>\n      for(int x=1; x&lt;width-1; x++) {<br/>\n        int rs = 0;<br/>\n        int gs = 0;<br/>\n        int bs = 0;<br/>\n<br/>\n        for(int k=-1; k&lt;=1; k++) {<br/>\n          for(int j=-1; j&lt;=1; j++) {<br/>\n            int rgb = imgpixels[(y+k)*width+x+j];<br/>\n            int r = (rgb &gt;&gt; 16) & 0xff;<br/>\n            int g = (rgb &gt;&gt; 8) & 0xff;<br/>\n            int b = rgb & 0xff;<br/>\n            rs += r;<br/>\n            gs += g;<br/>\n            bs += b;<br/>\n          }<br/>\n        }<br/>\n<br/>\n        rs /= 9;<br/>\n        gs /= 9;<br/>\n        bs /= 9;<br/>\n<br/>\n       newimgpixels[y*width+x] = (0xff000000 |<br/>\n                                 rs &lt;&lt; 16 | gs &lt;&lt; 8 | bs);<br/>\n      }<br/>\n    }<br/>\n  }<br/>\n}<br/>\n<br/>\nlisting 9<br/>\npublic class Sharpen extends Convolver {<br/>\n<br/>\n  private final int clamp(int c) {<br/>\n    return (c &gt; 255 ? 255 : (c &lt; 0 ? 0 : c));<br/>\n  }<br/>\n<br/>\n  public void convolve() {<br/>\n    int r0=0, g0=0, b0=0;<br/>\n    for(int y=1; y&lt;height-1; y++) {<br/>\n      for(int x=1; x&lt;width-1; x++) {<br/>\n        int rs = 0;<br/>\n        int gs = 0;<br/>\n        int bs = 0;<br/>\n<br/>\n        for(int k=-1; k&lt;=1; k++) {<br/>\n          for(int j=-1; j&lt;=1; j++) {<br/>\n            int rgb = imgpixels[(y+k)*width+x+j];<br/>\n            int r = (rgb &gt;&gt; 16) & 0xff;<br/>\n            int g = (rgb &gt;&gt; 8) & 0xff;<br/>\n            int b = rgb & 0xff;<br/>\n            if (j == 0 && k == 0) {<br/>\n              r0 = r;<br/>\n              g0 = g;<br/>\n              b0 = b;<br/>\n            } else {<br/>\n              rs += r;<br/>\n              gs += g;<br/>\n              bs += b;<br/>\n            }<br/>\n          }<br/>\n        }<br/>\n<br/>\n        rs &gt;&gt;= 3;<br/>\n        gs &gt;&gt;= 3;<br/>\n        bs &gt;&gt;= 3;<br/>\n        newimgpixels[y*width+x] = (0xff000000 |<br/>\n                                clamp(r0+r0-rs) &lt;&lt; 16 |<br/>\n                                clamp(g0+g0-gs) &lt;&lt; 8 |<br/>\n                                clamp(b0+b0-bs));<br/>\n      }<br/>\n    }<br/>\n  }<br/>\n}<br/>\n<br/>\nThe error is coming in the Convolver class, please help me<br/>\nout with it. I would be obliged.<br/>\nRegards,<br/>\nJules</div>", 
    "prevInTime": 12570, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1104596547", 
    "canDelete": false, 
    "nextInTopic": 0, 
    "prevInTopic": 0, 
    "headers": {
        "messageIdInHeader": "PGNyNmlvMytzbGJ2QGVHcm91cHMuY29tPg=="
    }
}
{
    "numMessagesInTopic": 29, 
    "nextInTime": 20723, 
    "senderId": "kB5h_p75czDb8DsMQnlPo8GufTfAf8k579BiH3onqJUCbKa0z2hwMQFaW3-OASXwIXfriol_0bMDdsiBqORuOYrwV3wo_VZTCmYi2Q", 
    "systemMessage": true, 
    "subject": "Re: Junit 3 suite setup tear down", 
    "from": "&quot;toalexsmail&quot; &lt;toalexsmail@...&gt;", 
    "authorName": "toalexsmail", 
    "msgSnippet": "No, you re wrong. Suppose you want to run suite with 2 different classes and you want to make one time setup only once. That is you want to do", 
    "msgId": 20722, 
    "profile": "toalexsmail", 
    "topicId": 20668, 
    "spamInfo": {
        "reason": "6", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 340165037, 
    "messageBody": "<div id=\"ygrps-yiv-678178326\">No, you&#39;re wrong. Suppose you want to run suite with 2 different<br/>\nclasses and you want to make one time setup only once. That is you<br/>\nwant to do your-one-time-setup, run class A, run class B, and to do<br/>\nyour-one-time-teardown. How can you do it?<br/>\nMorevoer, suppose, you want to run only some specific methods from<br/>\nthose classes, not all the methods, how can you do it? In JUnit 3.8.x<br/>\nthere was a way to do it.<br/>\n<br/>\n<blockquote><span title=\"qreply\"> --- In <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>, &quot;David Saff&quot; &lt;david@...&gt; wrote:<br/>\n&gt;<br/>\n&gt; @BeforeClass and @AfterClass on the @RunWith(Suite) class have exactly<br/>\n&gt; this behavior in JUnit 4.4 and beyond.  However, I think the original<br/>\n&gt; poster was using 3.x.<br/>\n&gt; <br/>\n&gt;    David Saff<br/>\n&gt; <br/>\n&gt; On Wed, Jul 9, 2008 at 6:45 PM, CÃ©dric Beust â&quot; &lt;cbeust@...&gt; wrote:<br/>\n&gt; &gt; That&#39;s a lot of work and therefore a good candidate for a new feature:<br/>\n&gt; &gt; @BeforeSuite/@AfterSuite.<br/>\n&gt; &gt;<br/>\n&gt; &gt; --<br/>\n&gt; &gt; CÃ©dric<br/>\n&gt; &gt;<br/>\n&gt; &gt; On Wed, Jul 9, 2008 at 12:47 PM, toalexsmail &lt;toalexsmail@...&gt; wrote:<br/>\n&gt; &gt;<br/>\n&gt; &gt;&gt; --- In <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a> &lt;junit%40yahoogroups.com&gt;, &quot;lars&quot;<br/>\n&gt; &gt;<br/>\n&gt; &gt;&gt; &lt;lars.carlsson@&gt; wrote:<br/>\n&gt; &gt;&gt; &gt;<br/>\n&gt; &gt;&gt; &gt; Hi<br/>\n&gt; &gt;&gt; &gt; At my company we have alot of automated test cases and in all our<br/>\n&gt; &gt;&gt; &gt; suite we have a setup testcase and a teardown test case where<br/>\nwe setup<br/>\n&gt; &gt;&gt; &gt; network connection that takes some time and can not be done in<br/>\nevery<br/>\n&gt; &gt;&gt; TC. ,<br/>\n&gt; &gt;&gt; &gt; But i think that there should exist a suite setup and a<br/>\nteardown and<br/>\n&gt; &gt;&gt; &gt; not be in a setup/teardown TC.<br/>\n&gt; &gt;&gt; &gt; Are there any why of doing this or how could i best be solve<br/>\nthis by<br/>\n&gt; &gt;&gt; &gt; extending TestSuite?<br/>\n&gt; &gt;&gt; &gt;<br/>\n&gt; &gt;&gt; &gt; Regards Lars<br/>\n&gt; &gt;&gt; &gt;<br/>\n&gt; &gt;&gt; I think that there is some related thread on this topic, but<br/>\nnever mind.<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; * There are @Before and @After annotation that are equivalent of use<br/>\n&gt; &gt;&gt; of setUp() and tearDown().<br/>\n&gt; &gt;&gt; * There are @BeforeClass and @AfterClass annotation that are supposed<br/>\n&gt; &gt;&gt; to substitute the use of TestSuite. In fact, this method is called<br/>\n&gt; &gt;&gt; once per class. You can see on it as your TestSuite was just a single<br/>\n&gt; &gt;&gt; class. AFAIK, there is no build in support for TestSuite that is not<br/>\n&gt; &gt;&gt; so trivial.<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; I had similar requirement, namely I wanted to ensure that JDK 1.4+<br/>\n&gt; &gt;&gt; assert statement are on, I wanted to start JBoss microcontainer<br/>\nat the<br/>\n&gt; &gt;&gt; beginning and shutdown it at the end.<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; Lets start from the simplest one.<br/>\n&gt; &gt;&gt; * I wanted to ensure that JDK 1.4+ assert statement are on.<br/>\n&gt; &gt;&gt; I created class with name BaseTestCase and all my test classes<br/>\n&gt; &gt;&gt; inherits from it. In this class I put the following method:<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; @BeforeClass<br/>\n&gt; &gt;&gt; public static void oneTimeSetup(){<br/>\n&gt; &gt;&gt; // do your one time set-up here!<br/>\n&gt; &gt;&gt; log.info(&quot;BaseTestCase.oneTimeSetup()&quot;);<br/>\n&gt; &gt;&gt; log.debug(&quot;Going to check whether asserts are enabled&quot;);<br/>\n&gt; &gt;&gt; boolean assertsEnabled = false;<br/>\n&gt; &gt;&gt; assert (assertsEnabled = true); // Intentional side effect!!!<br/>\n&gt; &gt;&gt; if (!assertsEnabled) {<br/>\n&gt; &gt;&gt; throw new AssertionError(&quot;Asserts must be enabled!&quot;);<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; Because all my test classes inherit from BaseTestCase and has their<br/>\n&gt; &gt;&gt; base class BaseTestCase, it is guaranteed that first thing that will<br/>\n&gt; &gt;&gt; be run (beside JUnit itself) is oneTimeSetup() method.<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; * I wanted to start JBoss microcontainer at the beginning and<br/>\nshutdown<br/>\n&gt; &gt;&gt; it at the end.<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; Every test class inherit from some base test class, say<br/>\n&gt; &gt;&gt; BaseHelloWorldEJBTest (that eventually inherit from BaseTestCase). In<br/>\n&gt; &gt;&gt; BaseHelloWorldEJBTest there is method<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; @BeforeClass<br/>\n&gt; &gt;&gt; public static void setUpClass() throws Exception ;<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; This method basically does the following:<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; final Bootstrap jbossInstance = Bootstrap.getInstance();<br/>\n&gt; &gt;&gt; if (!jbossInstance.isStarted()) {<br/>\n&gt; &gt;&gt; log.debug(&quot;starting JBoss microcontainer&quot;);<br/>\n&gt; &gt;&gt; jbossInstance.bootstrap();<br/>\n&gt; &gt;&gt; log.debug(&quot;JBoss microcontainer is up&quot;);<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; log.debug(&quot;Going to deploy scanClasspath&quot;);<br/>\n&gt; &gt;&gt; deploy(scanClasspath);<br/>\n&gt; &gt;&gt; log.debug(&quot;End of deploy scanClasspath&quot;);<br/>\n&gt; &gt;&gt; ... &lt;HERE there is more code&gt;<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; Until now everything is pretty straight-forward. But how can I stop<br/>\n&gt; &gt;&gt; JBoss when I finished testing? I don&#39;t want to stop it after every<br/>\n&gt; &gt;&gt; class, but after whole TestSuite is done. I didn&#39;t find something<br/>\n&gt; &gt;&gt; built-in, so I use ShutdownHook...<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; In the above setUpClass() mehtod in the place that noted as &quot;&lt;HERE<br/>\n&gt; &gt;&gt; there is more code&gt;&quot; I have:<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; log.debug(&quot;Now add hook to shutdown server&quot;);<br/>\n&gt; &gt;&gt; Runtime.getRuntime().addShutdownHook(new Thread() {<br/>\n&gt; &gt;&gt; public void run() {<br/>\n&gt; &gt;&gt; assert lRunnables!=null;<br/>\n&gt; &gt;&gt; Runnable runnable =null;<br/>\n&gt; &gt;&gt; String runnableI = null;<br/>\n&gt; &gt;&gt; try {<br/>\n&gt; &gt;&gt; for(int i=0;i&lt;lRunnables.length;i++){<br/>\n&gt; &gt;&gt; runnable = lRunnables[i];<br/>\n&gt; &gt;&gt; runnableI = &quot;runnable &quot;+i;<br/>\n&gt; &gt;&gt; log.debug(&quot;Going to run &quot;+runnableI);<br/>\n&gt; &gt;&gt; if(runnable==null){<br/>\n&gt; &gt;&gt; log.warn(runnableI+&quot; is null, skipping&quot;);<br/>\n&gt; &gt;&gt; } else {<br/>\n&gt; &gt;&gt; try {<br/>\n&gt; &gt;&gt; runnable.run();<br/>\n&gt; &gt;&gt; log.debug(runnableI+&quot; ends run succesfully&quot;);<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt; catch(Throwable e){log.error(runnableI+&quot; fails&quot;, e);}<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; catch(Throwable e){<br/>\n&gt; &gt;&gt; log.error(&quot;This should never happened. Some runnables Throwable<br/>\n&gt; &gt;&gt; (exception) propogates outside the loop&quot;, e);<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; synchronized (jbossInstance) {<br/>\n&gt; &gt;&gt; jbossInstance.shutdown();<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt; String junitStatus = junitStatusOs.toString();<br/>\n&gt; &gt;&gt; log.debug(junitStatus);<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt; });<br/>\n&gt; &gt;&gt; I will talk about junitStatusPs a bit later. What is actually is done<br/>\n&gt; &gt;&gt; here that in @BeforeClass that it is before running every class,<br/>\nthere<br/>\n&gt; &gt;&gt; is check whether JBoss is run or no. If it is run nothing special is<br/>\n&gt; &gt;&gt; done. If it is not run, and this will be true only first time this<br/>\n&gt; &gt;&gt; check will be done, JBoss is started and ShutDownHook is added.<br/>\nTake a<br/>\n&gt; &gt;&gt; look on the JavaDoc on ShutDownHook, but basically, on the call on<br/>\n&gt; &gt;&gt; System.exit() JVM will be run your hook. In that shutdown hook I make<br/>\n&gt; &gt;&gt; jbossInstance.shutdown().<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; There is one issue here. One JBoss is shutting down it write some<br/>\n&gt; &gt;&gt; thing to the log. What is happen, that I see JUnit report (90000<br/>\n&gt; &gt;&gt; tested passes, 100 fails, and 10 ignored) and after this report I see<br/>\n&gt; &gt;&gt; the output from shitting down process. This happen, because the<br/>\n&gt; &gt;&gt; shutdown hook happens after last JUnit class finished to run.<br/>\n&gt; &gt;&gt; I found some work around. In the BaseTestCase I have:<br/>\n&gt; &gt;&gt; // the logger<br/>\n&gt; &gt;&gt; private static final Log log = LogFactory.getLog(BaseTestCase.class);<br/>\n&gt; &gt;&gt; protected static final OutputStream junitStatusOs = new<br/>\n&gt; &gt;&gt; ByteArrayOutputStream(16*1024);<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; This junitStatusPs is actually passed to as PrintStream (instead<br/>\n&gt; &gt;&gt; System.out) to the JUnit classes. Note, that I have<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; String junitStatus = junitStatusOs.toString();<br/>\n&gt; &gt;&gt; log.debug(junitStatus);<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; as the last row of the shutdown hook. This ensure, that I will<br/>\nsee the<br/>\n&gt; &gt;&gt; output of the shutdown hook first, and the JUnit report will be the<br/>\n&gt; &gt;&gt; last rows in the standard output.<br/>\n&gt; &gt;&gt; And the last issue is:<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; If I want to do some other thing I just wrap it as lRunnables and<br/>\npass<br/>\n&gt; &gt;&gt; to the method mentioned above. It is looks like this:<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; //we want to call cleanUp() method that ear application calls<br/>\n&gt; &gt;&gt; //moment before we shutting down JBoss<br/>\n&gt; &gt;&gt; Runnable runnable = new Runnable(){<br/>\n&gt; &gt;&gt; public void run() {<br/>\n&gt; &gt;&gt; try {<br/>\n&gt; &gt;&gt; cleanUp();<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt; catch(HelloWorldException e){<br/>\n&gt; &gt;&gt; log.error(&quot;Failed to cleanUp&quot;, e);<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt; };<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; setUpClass(System.getProperty(&quot;user.dir&quot;) + &quot;/target/classes&quot;,<br/>\n&gt; &gt;&gt; runnable);<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; In order to shutdown JBoss we use<br/>\n&gt; &gt;&gt; @AfterClass<br/>\n&gt; &gt;&gt; public static void tearDownClass() throws Exception {<br/>\n&gt; &gt;&gt; log.info(&quot;one time tearDownClass()&quot;);<br/>\n&gt; &gt;&gt; undeploy();<br/>\n&gt; &gt;&gt; Bootstrap.getInstance().shutdown();<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt; [Non-text portions of this message have been removed]<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; </span></blockquote></div>", 
    "prevInTime": 20721, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1217451519", 
    "canDelete": false, 
    "nextInTopic": 20726, 
    "prevInTopic": 20710, 
    "headers": {
        "inReplyToHeader": "PDRmN2RhNmI5MDgwNzIzMTE0NGg1YmMxMDRiNnI4OGM2OTZkNTc4YWM4NDJAbWFpbC5nbWFpbC5jb20+", 
        "messageIdInHeader": "PGc2cWtsdis3cTFlQGVHcm91cHMuY29tPg=="
    }
}
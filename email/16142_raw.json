{
    "numMessagesInTopic": 5, 
    "nextInTime": 16143, 
    "senderId": "HV9E7wZf8426qltshBnb54a7Ld_Su1W0XgZRrsL-av508ZWbACnwOgOU39MmoW8Ddl1aqIrMUUStm4JlWGE1EA", 
    "systemMessage": false, 
    "subject": "Re: [junit] [PATCH] filter stack traces in junit", 
    "from": "David Saff &lt;saff@...&gt;", 
    "authorName": "David Saff", 
    "msgSnippet": "Ben, I m afraid that after discussion, we re still reluctant to have JUnit natively filter stack traces.  It looks to me that this is something that could work", 
    "msgId": 16142, 
    "rawEmail": "Return-Path: &lt;saff@...&gt;\r\nX-Sender: saff@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (qmail 80165 invoked from network); 21 Feb 2006 16:25:20 -0000\r\nReceived: from unknown (66.218.67.36)\n  by m29.grp.scd.yahoo.com with QMQP; 21 Feb 2006 16:25:20 -0000\r\nReceived: from unknown (HELO rozz.csail.mit.edu) (128.30.2.16)\n  by mta10.grp.scd.yahoo.com with SMTP; 21 Feb 2006 16:25:19 -0000\r\nReceived: from 30-5-166.wireless.csail.mit.edu ([128.30.5.166])\n\tby rozz.csail.mit.edu with esmtpsa (TLSv1:AES256-SHA:256)\n\t(Exim 4.50)\n\tid 1FBaIi-0002aD-JA\n\tfor junit@yahoogroups.com; Tue, 21 Feb 2006 11:23:44 -0500\r\nMessage-ID: &lt;43FB3E8F.5080907@...&gt;\r\nDate: Tue, 21 Feb 2006 11:23:43 -0500\r\nUser-Agent: Thunderbird 1.5 (Windows/20051201)\r\nMIME-Version: 1.0\r\nTo: junit@yahoogroups.com\r\nReferences: &lt;dsh65g+oa5u@...&gt;\r\nIn-Reply-To: &lt;dsh65g+oa5u@...&gt;\r\nContent-Type: text/plain; charset=ISO-8859-1; format=flowed\r\nContent-Transfer-Encoding: 7bit\r\nX-eGroups-Msg-Info: 1:12:0:0\r\nFrom: David Saff &lt;saff@...&gt;\r\nSubject: Re: [junit] [PATCH] filter stack traces in junit\r\nX-Yahoo-Group-Post: member; u=139771899; y=KQGjar5YiAe05CoxS8xw-I3X63DmvbI9JGrtebPsSMg\r\nX-Yahoo-Profile: dsaff\r\n\r\nBen,\n\nI&#39;m afraid that after discussion, we&#39;re still reluctant to have JUnit \nnatively filter stack traces.  It looks to me that this is something \nthat could work in a custom runner--are you interested in seeing if this \nis so?\n\nAlso, thank you for all of your feedback so far, and please do keep \nconsidering ways we can improve the framework.  The sourceforge project \npage has a convenient place for any future patches.  Thanks,\n\n    David Saff\n\nBen Maurer wrote:\n&gt; Hey guys,\n&gt;\n&gt; As I mentioned in my previous email, one of the issues with junit is\n&gt; that I have to manually filter out harness stack frames from\n&gt; exceptions. The current approach to this is generally to just filter\n&gt; out lines with some specific prefixes. However, this is not ideal. For\n&gt; example, ant filters out some sun.reflect stack frames. But these can\n&gt; occur *inside* a test case&#39;s stack trace.\n&gt;\n&gt; The following patch solves the issue by using the\n&gt; InvocationTargetException generated by Method.invoke to figure out\n&gt; which stack frames come from JUnit. It then removes these frames from\n&gt; the trace. This process is transparent to consumers of the junit\n&gt; framework.\n&gt;\n&gt; Issues:\n&gt;\n&gt; 1) I&#39;m not sure if the place I located the filter is the most ideal\n&gt; place in the framework. Other ideas would be greatly appreciated\n&gt;\n&gt; 2) I need test cases (I haven&#39;t yet gotten to bite the bullet and\n&gt; write tests before I develop ;-).\n&gt;\n&gt; Since this list doesn&#39;t allow attachments, I&#39;ve copied and pasted this\n&gt; in the main text. Since this will probably be hard to apply, I&#39;ve also\n&gt; posted on my dorm computer:\n&gt;\n&gt; http://omega.res.cmu.edu/~benm/junit-stacktrace.patch \n&gt; &lt;http://omega.res.cmu.edu/%7Ebenm/junit-stacktrace.patch&gt;\n&gt;\n&gt; -- Ben\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt; Index: org/junit/internal/runners/TestMethodRunner.java\n&gt; ===================================================================\n&gt; RCS file:\n&gt; /cvsroot/junit/junit/org/junit/internal/runners/Attic/TestMethodRunner.java,v\n&gt; retrieving revision 1.1.2.6\n&gt; diff -u -r1.1.2.6 TestMethodRunner.java\n&gt; --- org/junit/internal/runners/TestMethodRunner.java      6 Feb 2006\n&gt; 04:09:17 -0000      1.1.2.6\n&gt; +++ org/junit/internal/runners/TestMethodRunner.java      10 Feb 2006\n&gt; 04:44:42 -0000\n&gt; @@ -81,7 +81,10 @@\n&gt;                   if (expectsException())\n&gt;                         addFailure(new AssertionError(&quot;Expected \n&gt; exception: &quot; +\n&gt; expectedException().getName()));\n&gt;             } catch (InvocationTargetException e) {\n&gt; -                  Throwable actual= e.getTargetException();\n&gt; +                  Throwable actual= e.getTargetException ();\n&gt; +                  // It&#39;s important that we filter here. This way, we\n&gt; +                  // cut the sun.reflect.* out of the stack trace.\n&gt; +                  StackTraceFilter.filter (actual, e);\n&gt;                   if (!expectsException())\n&gt;                         addFailure(actual);\n&gt;                   else if (isUnexpected(actual)) {\n&gt; Index: org/junit/internal/runners/StackTraceFilter.java\n&gt; ===================================================================\n&gt; RCS file: org/junit/internal/runners/StackTraceFilter.java\n&gt; diff -N org/junit/internal/runners/StackTraceFilter.java\n&gt; --- /dev/null      1 Jan 1970 00:00:00 -0000\n&gt; +++ org/junit/internal/runners/StackTraceFilter.java      1 Jan 1970\n&gt; 00:00:00 -0000\n&gt; @@ -0,0 +1,64 @@\n&gt; +package org.junit.internal.runners;\n&gt; +\n&gt; +import java.util.ArrayList;\n&gt; +import java.util.List;\n&gt; +\n&gt; +/**\n&gt; + * Methods for filtering out irrelevant stack frames from\n&gt; + * a Throwable.\n&gt; + *\n&gt; + * @author Ben Maurer &lt;bmaurer@...&gt;\n&gt; + */\n&gt; +public class StackTraceFilter {\n&gt; +\n&gt; +      /**\n&gt; +      * Removes items from a stack trace that it shares with another \n&gt; trace.\n&gt; +      * @param trace The trace to filter out\n&gt; +      * @param base The base trace\n&gt; +      * @return trace with items at the end that it shares with base \n&gt; removed\n&gt; +      */\n&gt; +      static StackTraceElement [] doFilter (StackTraceElement [] trace,\n&gt; StackTraceElement [] base)\n&gt; +      {\n&gt; +            List&lt;StackTraceElement&gt; filtered = new \n&gt; ArrayList&lt;StackTraceElement&gt; ();\n&gt; +            for (StackTraceElement ele : trace)\n&gt; +                  filtered.add (ele);\n&gt; +\n&gt; +            for (int i = base.length - 1; i &gt;= 0 && filtered.size () \n&gt; &gt; 0; i--) {\n&gt; +                  if (!filtered.get (filtered.size () - 1).equals \n&gt; (base [i]))\n&gt; +                        break;\n&gt; +\n&gt; +                  filtered.remove (filtered.size () - 1);\n&gt; +            }\n&gt; +\n&gt; +            return filtered.toArray (new StackTraceElement [] {});\n&gt; +\n&gt; +      }\n&gt; +\n&gt; +      /**\n&gt; +      * Filters the stack trace components that toFilter shares\n&gt; +      * with the threads current stack trace.\n&gt; +      */\n&gt; +      public static void filter (Throwable toFilter)\n&gt; +      {\n&gt; +            filter (toFilter, Thread.currentThread ().getStackTrace ());\n&gt; +      }\n&gt; +\n&gt; +      /**\n&gt; +      * Filters the stack trace components that toFilter shares\n&gt; +      * with baseException.\n&gt; +      */\n&gt; +      public static void filter (Throwable toFilter, Throwable \n&gt; baseException)\n&gt; +      {\n&gt; +            filter (toFilter, baseException.getStackTrace ());\n&gt; +      }\n&gt; +\n&gt; +      /**\n&gt; +      * Filters the stack trace components that toFilter shares\n&gt; +      * with base.\n&gt; +      */\n&gt; +      public static void filter (Throwable toFilter, StackTraceElement []\n&gt; base)\n&gt; +      {\n&gt; +            for (Throwable t = toFilter; t != null; t = t.getCause ())\n&gt; +                  t.setStackTrace (doFilter (t.getStackTrace (), base));\n&gt; +      }\n&gt; +}\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt; SPONSORED LINKS\n&gt; Basic programming language \n&gt; &lt;http://groups.yahoo.com/gads?t=ms&k=Basic+programming+language&w1=Basic+programming+language&w2=C+programming+language&w3=Computer+programming+languages&w4=The+c+programming+language&w5=C+++programming+language&w6=List+of+programming+languages&c=6&s=193&.sig=aLlETYEcZKW67uFZnuZPPw&gt; \n&gt; \tC programming language \n&gt; &lt;http://groups.yahoo.com/gads?t=ms&k=C+programming+language&w1=Basic+programming+language&w2=C+programming+language&w3=Computer+programming+languages&w4=The+c+programming+language&w5=C+++programming+language&w6=List+of+programming+languages&c=6&s=193&.sig=n4wEVXDpIBKogo8e_G77cw&gt; \n&gt; \tComputer programming languages \n&gt; &lt;http://groups.yahoo.com/gads?t=ms&k=Computer+programming+languages&w1=Basic+programming+language&w2=C+programming+language&w3=Computer+programming+languages&w4=The+c+programming+language&w5=C+++programming+language&w6=List+of+programming+languages&c=6&s=193&.sig=KFl1CeQi7jrKmsK4WD6ygQ&gt; \n&gt;\n&gt; The c programming language \n&gt; &lt;http://groups.yahoo.com/gads?t=ms&k=The+c+programming+language&w1=Basic+programming+language&w2=C+programming+language&w3=Computer+programming+languages&w4=The+c+programming+language&w5=C+++programming+language&w6=List+of+programming+languages&c=6&s=193&.sig=lU9w7-4UlGPB4LjDy84c2Q&gt; \n&gt; \tC programming language \n&gt; &lt;http://groups.yahoo.com/gads?t=ms&k=C+++programming+language&w1=Basic+programming+language&w2=C+programming+language&w3=Computer+programming+languages&w4=The+c+programming+language&w5=C+++programming+language&w6=List+of+programming+languages&c=6&s=193&.sig=dtKotXT1Ne2N9AO_aEbPFQ&gt; \n&gt; \tList of programming languages \n&gt; &lt;http://groups.yahoo.com/gads?t=ms&k=List+of+programming+languages&w1=Basic+programming+language&w2=C+programming+language&w3=Computer+programming+languages&w4=The+c+programming+language&w5=C+++programming+language&w6=List+of+programming+languages&c=6&s=193&.sig=0shmxLBHwrZWcSjC3QvZAA&gt; \n&gt;\n&gt;\n&gt;\n&gt; ------------------------------------------------------------------------\n&gt; YAHOO! GROUPS LINKS\n&gt;\n&gt;     *  Visit your group &quot;junit &lt;http://groups.yahoo.com/group/junit&gt;&quot;\n&gt;       on the web.\n&gt;        \n&gt;     *  To unsubscribe from this group, send an email to:\n&gt;        junit-unsubscribe@yahoogroups.com\n&gt;       &lt;mailto:junit-unsubscribe@yahoogroups.com?subject=Unsubscribe&gt;\n&gt;        \n&gt;     *  Your use of Yahoo! Groups is subject to the Yahoo! Terms of\n&gt;       Service &lt;http://docs.yahoo.com/info/terms/&gt;.\n&gt;\n&gt;\n&gt; ------------------------------------------------------------------------\n&gt;\n\n\n", 
    "profile": "dsaff", 
    "topicId": 16058, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 139771899, 
    "prevInTime": 16141, 
    "contentTrasformed": false, 
    "postDate": "1140539023", 
    "canDelete": false, 
    "nextInTopic": 16160, 
    "prevInTopic": 16072, 
    "headers": {
        "inReplyToHeader": "PGRzaDY1ZytvYTV1QGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PDQzRkIzRThGLjUwODA5MDdAbWl0LmVkdT4=", 
        "referencesHeader": "PGRzaDY1ZytvYTV1QGVHcm91cHMuY29tPg=="
    }
}
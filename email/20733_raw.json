{
    "numMessagesInTopic": 7, 
    "nextInTime": 20734, 
    "senderId": "b15QcbGjqxknfk-xexCyyqT9OEcOTKcCamVHI0iWEZuAyg3HLAbXXbLRkosSKrOqMuIefQtBb3cKz-9Cjn8OBVp1g8JTLl0cVej9DcmGdD8O", 
    "systemMessage": false, 
    "subject": "Re: [junit] Running parallel tests in JUnit4.4+", 
    "from": "Daniel Brolund &lt;daniel.brolund@...&gt;", 
    "authorName": "Daniel Brolund", 
    "msgSnippet": "Hi David, The solution in my email proved unuseful for nested suites, since each suite needs its own thread pool ﻿(an ExecutorService). This leeds to ", 
    "msgId": 20733, 
    "rawEmail": "Return-Path: &lt;daniel.brolund@...&gt;\r\nX-Sender: daniel.brolund@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nX-Received: (qmail 47719 invoked from network); 31 Jul 2008 23:43:10 -0000\r\nX-Received: from unknown (66.218.67.96)\n  by m49.grp.scd.yahoo.com with QMQP; 31 Jul 2008 23:43:10 -0000\r\nX-Received: from unknown (HELO lists.levonline.com) (217.70.33.37)\n  by mta17.grp.scd.yahoo.com with SMTP; 31 Jul 2008 23:43:09 -0000\r\nX-Received: from localhost (localhost.localdomain [127.0.0.1])\n\tby lists.levonline.com (Postfix) with ESMTP id 13C9E29C09A\n\tfor &lt;junit@yahoogroups.com&gt;; Fri,  1 Aug 2008 01:43:06 +0200 (CEST)\r\nX-Virus-Scanned: By http://levonline.com - free virus scanning for all\n\tcustomers\r\nX-Received: from lists.levonline.com ([127.0.0.1])\n\tby localhost (lists.levonline.com [127.0.0.1]) (amavisd-new, port 10024)\n\twith ESMTP id 04o4ZQxXj+NI for &lt;junit@yahoogroups.com&gt;;\n\tFri,  1 Aug 2008 01:43:04 +0200 (CEST)\r\nX-Received: from ormen1.djurnet.levonline.com (ormen1.djurnet.levonline.com [192.168.17.31])\n\tby lists.levonline.com (Postfix) with ESMTP id B37F929C07C\n\tfor &lt;junit@yahoogroups.com&gt;; Fri,  1 Aug 2008 01:43:04 +0200 (CEST)\r\nX-Received: from [192.168.0.168] (c80-217-174-4.bredband.comhem.se [80.217.174.4])\n\t(authenticated bits=0)\n\tby ormen1.djurnet.levonline.com (8.12.11.20060308/8.12.11) with ESMTP id m6VNh4OB018285\n\tfor &lt;junit@yahoogroups.com&gt;; Fri, 1 Aug 2008 01:43:04 +0200\r\nTo: junit@yahoogroups.com\r\nIn-Reply-To: &lt;4f7da6b90807310847v53fd4a05o886cb7775da327a5@...&gt;\r\nReferences: &lt;1207234461.18347.40.camel@daniel-kubuntu&gt;\n\t &lt;23fce8e60804031251h3ea5f8e8n11f3524ab878eb9f@...&gt;\n\t &lt;4f7da6b90807310847v53fd4a05o886cb7775da327a5@...&gt;\r\nContent-Type: text/plain; charset=utf-8\r\nOrganization: Agical\r\nDate: Fri, 01 Aug 2008 01:43:02 +0200\r\nMessage-Id: &lt;1217547782.6555.243.camel@daniel-ubuntu&gt;\r\nMime-Version: 1.0\r\nX-Mailer: Evolution 2.22.3.1 \r\nContent-Transfer-Encoding: 8bit\r\nX-eGroups-Msg-Info: 2:3:4:0:0\r\nFrom: Daniel Brolund &lt;daniel.brolund@...&gt;\r\nReply-To: daniel.brolund@...\r\nSubject: Re: [junit] Running parallel tests in JUnit4.4+\r\nX-Yahoo-Group-Post: member; u=331284687; y=XEse6QwmUm5HYV6w2iMRuBk23axWFAdxgTjrsWXwAv0VoXXpSOp_uxs\r\nX-Yahoo-Profile: daniel.brolund\r\n\r\nHi David,\n\nThe solution in my email proved unuseful for nested suites, since each\nsuite needs its own &quot;thread pool&quot; ﻿(an ExecutorService). This leeds to\nresource starvation. The solution to that was to try to share the\n&quot;thread pool&quot;, and that ended in a static property/flag mess. It kind of\nworked, but it was (is) a mess.\n\n﻿I found it a bit hard to get control over the execution, probably\nbecause of the recursive nature of the execution with run/runChildren,\nand when I tried to do just a little bit more I felt like I was\nreimplementing JUnit.\n\nAFAIKS, the structure of execution has changed a lot to the better in\nJUnit4.5 with the Statements, but in the parallelization case I&#39;m\nworried that this just encapsulates the recursion for the suites, e.g.:\n\nprotected Statement childrenInvoker(final RunNotifier notifier) {\n  return new Statement() {\n  @Override\n  public void evaluate() {\n    runChildren(notifier);\n  }};\n}\n\nand it doesn&#39;t provide the means to get to the core blocks that we\nreally want to parallelize. \n\nThe next step might be that Statements (or some derivative thereof)\nare: \n* hierachial\n* traversable\n* dependable\n\nThen you can choose different traversers to either:\n1. traverse the statement hierarchy and evaluate (current behavior)\n2. ﻿traverse the statement hierarchy, resolve dependenices and execute\nin dependency order\n3. 2) + ignore dependent tests\n4. 1), 2) or 3) + parallelize execution\n\nCan you give me a reality check on this? I probably have missed some of\nyour discussions around Statements.\n \nCheers\nDaniel\n\n\n\n\nOn Thu, 2008-07-31 at 11:47 -0400, David Saff wrote:\n&gt; Daniel,\n&gt; \n&gt; Per my earlier message, did this go anywhere? Thanks,\n&gt; \n&gt; David Saff\n&gt; \n&gt; On Thu, Apr 3, 2008 at 3:51 PM, James Abley &lt;james.abley@...&gt;\n&gt; wrote:\n&gt; &gt; On 03/04/2008, Daniel Brolund &lt;daniel.brolund@...&gt; wrote:\n&gt; &gt;&gt;\n&gt; &gt;&gt; Hi all,\n&gt; &gt;&gt;\n&gt; &gt;&gt; I&#39;ve been looking around a bit for some sort of parallel execution\n&gt; of\n&gt; &gt;&gt; JUnit 4.4+ tests, but I didn&#39;t find much.\n&gt; &gt;&gt;\n&gt; &gt;&gt; So, I tried a few things myself and came up with the two examples\n&gt; below;\n&gt; &gt;&gt; one is a parallel suite, and the other is for running parameterized\n&gt; test\n&gt; &gt;&gt; instances in parallel. It is almost too simple for me to really\n&gt; believe\n&gt; &gt;&gt; in it. ;-)\n&gt; &gt;&gt;\n&gt; &gt;&gt; I would really like some feedback on it; things I&#39;ve missed, cases\n&gt; where\n&gt; &gt;&gt; it won&#39;t work etc.\n&gt; &gt;&gt;\n&gt; &gt;&gt; ===========================================\n&gt; &gt;&gt;\n&gt; &gt;&gt; package com.agical.junit;\n&gt; &gt;&gt;\n&gt; &gt;&gt; import java.util.List;\n&gt; &gt;&gt;\n&gt; &gt;&gt; import org.junit.internal.runners.InitializationError;\n&gt; &gt;&gt; import org.junit.runner.Runner;\n&gt; &gt;&gt; import org.junit.runner.notification.RunNotifier;\n&gt; &gt;&gt; import org.junit.runners.Suite;\n&gt; &gt;&gt;\n&gt; &gt;&gt; public class ParallelSuite extends Suite {\n&gt; &gt;&gt;\n&gt; &gt;&gt; public ParallelSuite(Class&lt;?&gt; klass) throws InitializationError {\n&gt; &gt;&gt; super(klass);\n&gt; &gt;&gt; }\n&gt; &gt;&gt;\n&gt; &gt;&gt; public ParallelSuite(Class&lt;?&gt; klass, Class&lt;?&gt;[] annotatedClasses)\n&gt; &gt;&gt; throws InitializationError {\n&gt; &gt;&gt; super(klass, annotatedClasses);\n&gt; &gt;&gt; }\n&gt; &gt;&gt;\n&gt; &gt;&gt; @Override\n&gt; &gt;&gt; protected void runChildren(final RunNotifier runNotifier) {\n&gt; &gt;&gt; final List&lt;Runner&gt; runners = getRunners();\n&gt; &gt;&gt; runRunnersInParallel(runNotifier, runners);\n&gt; &gt;&gt; }\n&gt; &gt;&gt;\n&gt; &gt;&gt; public static void runRunnersInParallel(final RunNotifier\n&gt; &gt;&gt; runNotifier,\n&gt; &gt;&gt; final List&lt;Runner&gt; runners) {\n&gt; &gt;&gt; Thread[] threads = new Thread[runners.size()];\n&gt; &gt;&gt; for (int i = 0; i &lt; threads.length; i++) {\n&gt; &gt;&gt; final int index = i;\n&gt; &gt;&gt; threads[i] = new Thread(new Runnable() {\n&gt; &gt;&gt; public void run() {\n&gt; &gt;&gt; runners.get(index).run(runNotifier);\n&gt; &gt;&gt; }});\n&gt; &gt;&gt; threads[i].start();\n&gt; &gt;&gt; }\n&gt; &gt;&gt; for (int i = 0; i &lt; threads.length; i++) {\n&gt; &gt;&gt; try {\n&gt; &gt;&gt; threads[i].join();\n&gt; &gt;&gt; } catch (InterruptedException e) {\n&gt; &gt;&gt; throw new RuntimeException(&quot;Couldn&#39;t join thread\n&gt; &gt;&gt; nicely&quot;, e);\n&gt; &gt;&gt; }\n&gt; &gt;&gt; }\n&gt; &gt;&gt; }\n&gt; &gt;&gt; }\n&gt; &gt;&gt;\n&gt; &gt;&gt; ===========================================\n&gt; &gt;&gt;\n&gt; &gt;&gt; package com.agical.junit;\n&gt; &gt;&gt;\n&gt; &gt;&gt; import java.util.List;\n&gt; &gt;&gt;\n&gt; &gt;&gt; import org.junit.runner.Runner;\n&gt; &gt;&gt; import org.junit.runner.notification.RunNotifier;\n&gt; &gt;&gt; import org.junit.runners.Parameterized;\n&gt; &gt;&gt;\n&gt; &gt;&gt; public class ParallelAndParameterized extends Parameterized {\n&gt; &gt;&gt;\n&gt; &gt;&gt; public ParallelAndParameterized(Class&lt;?&gt; klass) throws Exception {\n&gt; &gt;&gt; super(klass);\n&gt; &gt;&gt; }\n&gt; &gt;&gt;\n&gt; &gt;&gt; @Override\n&gt; &gt;&gt; protected void runChildren(final RunNotifier runNotifier) {\n&gt; &gt;&gt; final List&lt;Runner&gt; runners = getRunners();\n&gt; &gt;&gt; ParallelSuite.runRunnersInParallel(runNotifier, runners);\n&gt; &gt;&gt; }\n&gt; &gt;&gt; }\n&gt; &gt;&gt;\n&gt; &gt;&gt; ===========================================\n&gt; &gt;&gt;\n&gt; &gt;&gt; There is still some work needed to be done, but I would like to\n&gt; hear if\n&gt; &gt;&gt; I&#39;m totally on the wrong path.\n&gt; &gt;&gt;\n&gt; &gt;&gt; Cheers\n&gt; &gt;&gt; Daniel\n&gt; &gt;&gt;\n&gt; &gt;\n&gt; &gt;\n&gt; &gt; Hi Daniel,\n&gt; &gt;\n&gt; &gt; Nice thinking. Did you consider using\n&gt; &gt; java.util.concurrent.CountDownLatch and maybe the Executor\n&gt; framework?\n&gt; &gt; That might better communicate the intention.\n&gt; &gt;\n&gt; &gt; Regards,\n&gt; &gt;\n&gt; &gt; James\n&gt; &gt;\n&gt; &gt; ------------------------------------\n&gt; &gt;\n&gt; &gt; Yahoo! Groups Links\n&gt; &gt;\n&gt; &gt;\n&gt; &gt;\n&gt; &gt;\n&gt; \n&gt; \n&gt; \n&gt;  \n\n\n", 
    "profile": "daniel.brolund", 
    "topicId": 20427, 
    "spamInfo": {
        "reason": "3", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 331284687, 
    "prevInTime": 20732, 
    "contentTrasformed": false, 
    "postDate": "1217547782", 
    "canDelete": false, 
    "nextInTopic": 20734, 
    "prevInTopic": 20730, 
    "headers": {
        "inReplyToHeader": "PDRmN2RhNmI5MDgwNzMxMDg0N3Y1M2ZkNGEwNW84ODZjYjc3NzVkYTMyN2E1QG1haWwuZ21haWwuY29tPg==", 
        "messageIdInHeader": "PDEyMTc1NDc3ODIuNjU1NS4yNDMuY2FtZWxAZGFuaWVsLXVidW50dT4=", 
        "referencesHeader": "PDEyMDcyMzQ0NjEuMTgzNDcuNDAuY2FtZWxAZGFuaWVsLWt1YnVudHU+CSA8MjNmY2U4ZTYwODA0MDMxMjUxaDNlYTVmOGU4bjExZjM1MjRhYjg3OGViOWZAbWFpbC5nbWFpbC5jb20+CSA8NGY3ZGE2YjkwODA3MzEwODQ3djUzZmQ0YTA1bzg4NmNiNzc3NWRhMzI3YTVAbWFpbC5nbWFpbC5jb20+"
    }
}
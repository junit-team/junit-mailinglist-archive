{
    "numMessagesInTopic": 9, 
    "nextInTime": 1974, 
    "senderId": "PFzMNRNHirs70ZXM-BosK-YHwz0yoPICxR93bUi47SvDUiUIlCZusu6TAj_1EeokXuGrUpYHHobCTxbsBgKqYKzv-IPX6xVW4Yk", 
    "systemMessage": false, 
    "subject": "RE: [junit] ClassCastException only using swing/awt ui", 
    "from": "John Pletka &lt;John.Pletka@...&gt;", 
    "authorName": "John Pletka", 
    "msgSnippet": "Thanks.  I added my remote interfaces to the excluded.properties file and everything started working fine. ... From: Scott Stirling", 
    "msgId": 1973, 
    "topicId": 1943, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 0, 
    "messageBody": "<div id=\"ygrps-yiv-31423217\">Thanks.  I added my remote interfaces to the excluded.properties file and<br/>\neverything started working fine.  <br/>\n<br/>\n-----Original Message-----<br/>\nFrom: Scott Stirling [mailto:<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:sstirling@...\">sstirling@...</a>]<br/>\nSent: Monday, July 16, 2001 4:12 PM<br/>\nTo: &#39;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>&#39;<br/>\nSubject: RE: [junit] ClassCastException only using swing/awt ui<br/>\n<br/>\n<br/>\nInterestingly, calls to javax.rmi.PortableRemoteObject are delegated to an<br/>\nimplementation of javax.rmi.CORBA.PortableRemoteObjectDelegate, which in<br/>\nSun&#39;s 1.3.1 JDK is com.sun.corba.se.internal.javax.rmi.PortableRemoteObject.<br/>\nThat doesn&#39;t explain anything -- I just thought it was just kinda<br/>\ninteresting how buried that reference was.<br/>\n<br/>\nAnyway, this is another problem inherent to JUnit&#39;s Swingui&#39;s<br/>\nTestCaseClassLoader architecture.  Similar to the LinkageErrors with JAXP<br/>\nand the org.xml and org.w3c classes, but with a different result here.<br/>\nWe&#39;ve seen it here with EJB lookups too, but we mostly use the Ant runner so<br/>\nit&#39;s not usually a problem.<br/>\n<br/>\nSo why a ClassCastException when you narrow() in a TestCase?  <br/>\n<br/>\nHere&#39;s John Pletka&#39;s test code:<br/>\n<br/>\nPoint point;<br/>\nPointHome pointHome;<br/>\n<br/>\n//The next line works in textui, but throws <br/>\n//ClassCastException in swingui<br/>\npointHome =<br/>\n(PointHome)PortableRemoteObject.narrow(ctx.lookup(&quot;base/PointHome&quot;),PointHom<br/>\ne.class);<br/>\n<br/>\nRecall that in Java 2 an object&#39;s class (aka &quot;runtime type&quot;) is identified<br/>\nin the JVM as &lt;fully-qualified-classname;definingClassLoaderInstance&gt; or<br/>\n&lt;C;L&gt;.  That is, the defining loader is part of the runtime name identifying<br/>\nthat class (there&#39;s a subtle distinction in Java between &#39;class&#39; and &#39;type&#39;<br/>\nI won&#39;t go into).  Also recall that the JVM will ask a class&#39;s defining<br/>\nloader to load all unloaded classes referenced by the classes it loads.<br/>\n<br/>\nMy hypothesis (I just tested it here and proved it) is that the ctx.lookup()<br/>\nreturns an object that was loaded through the JVM&#39;s system classloader<br/>\n(sun.misc.Launcher$AppClassLoader), but the PointHome.class type is loaded<br/>\nby JUnit&#39;s TestCaseClassLoader.  In the narrow, the two fully qualified<br/>\nclass names are the same, but the defining classloaders for the two are<br/>\ndifferent so you get the exception because the JVM doesn&#39;t see them as being<br/>\nthe same &lt;C;L&gt; class/type.<br/>\n<br/>\nThe solution would be to exclude your EJB&#39;s interface classes from being<br/>\nloaded by the JUnit custom class loader by adding them to the<br/>\nexcluded.properties in junit.jar.  Granted, not a very nice solution unless,<br/>\nperhaps, it were easier to modify the exclusion list.  I hear in JUnit 4.0<br/>\nthat one idea is to make it easy to define exclusions in TestCases<br/>\nthemselves.<br/>\n<br/>\nYou can find out more about which loader loaded which class by doing this:<br/>\n<br/>\nSystem.out.println(ctx.lookup(&quot;base/PointHome&quot;));<br/>\nSystem.out.println(PointHome.class.getClassLoader());<br/>\n<br/>\nI bet you&#39;ll find when using the Swing UI that the PointHome type is defined<br/>\nby the JUnit TestCaseClassLoader and the object returned from ctx.lookup()<br/>\nwas defined through the JVM&#39;s system class loader.  When using the textui<br/>\nthey&#39;ll both load through the system loader.<br/>\n<br/>\nScott Stirling<br/>\nJRun QA<br/>\nMacromedia<br/>\n<br/>\n<blockquote><span title=\"ireply\"> &gt; -----Original Message-----<br/>\n&gt; From: Mike Lepine [mailto:<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:mike.lepine@...\">mike.lepine@...</a>]<br/>\n&gt; Sent: Monday, July 16, 2001 2:45 PM<br/>\n&gt; To: <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a><br/>\n&gt; Subject: RE: [junit] ClassCastException only using swing/awt ui<br/>\n&gt; <br/>\n&gt; <br/>\n&gt; Thank goodness. I did finally come to the same conclusion that the<br/>\n&gt; swingui.TestRunner was responsible (and not the JNDI code) for the<br/>\n&gt; ClassCastExceptions I was getting when retrieving an object <br/>\n&gt; from JNDI. I<br/>\n&gt; haven&#39;t looked through the TestRunner source to determine why <br/>\n&gt; this occurs<br/>\n&gt; but am also interested to know the answer.<br/>\n<br/>\n<br/>\n </span></blockquote>To unsubscribe from this group, send an email to:<br/>\n<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit-unsubscribe@yahoogroups.com\">junit-unsubscribe@yahoogroups.com</a><br/>\n <br/>\n<br/>\nYour use of Yahoo! Groups is subject to <a rel=\"nofollow\" target=\"_blank\" href=\"http://docs.yahoo.com/info/terms/\">http://docs.yahoo.com/info/terms/</a></div>", 
    "prevInTime": 1972, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "995391865", 
    "canDelete": false, 
    "nextInTopic": 2314, 
    "prevInTopic": 1949, 
    "headers": {
        "messageIdInHeader": "PEFDOEQ2NUU5QzhBREQzMTFBN0NGMDAwOEM3REY2MDhEMDNBREZBRTdAc3BhY2VsZXkuYWx0cmFuZXQuY29tPg=="
    }
}
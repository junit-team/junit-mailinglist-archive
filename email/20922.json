{
    "numMessagesInTopic": 2, 
    "nextInTime": 20923, 
    "senderId": "_vPSjpQu0xByAk4lJ9XXXgRULgBztqY_wnfuVcO3uufWxLiTSj2xWWkux09Mg2o4uVFBtiY1W1SjSddU-LBCAJnkSSg", 
    "systemMessage": false, 
    "subject": "Re: [junit] not able to run the junit please help", 
    "from": "&quot;David Saff&quot; &lt;david@...&gt;", 
    "authorName": "David Saff", 
    "msgSnippet": "Sushil, I would definitely recommend trying to write JUnit tests for a simple, self-contained class first, to make sure you understand the basics. Then,", 
    "msgId": 20922, 
    "profile": "dsaff", 
    "topicId": 20861, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 341876227, 
    "messageBody": "<div id=\"ygrps-yiv-343120801\">Sushil,<br/>\n<br/>\nI would definitely recommend trying to write JUnit tests for a simple,<br/>\nself-contained class first, to make sure you understand the basics.<br/>\nThen, practice some with jMock.  It looks like you&#39;re jumping in with<br/>\nboth feet here.<br/>\n<br/>\n   David Saff<br/>\n<br/>\n<blockquote><span title=\"qreply\"> On Wed, Sep 10, 2008 at 11:28 AM, Sushil Dodake &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:sushil_d10@...\">sushil_d10@...</a>&gt; wrote:<br/>\n&gt; Hi guys...<br/>\n&gt; i am trying to write a junit test class for the class which uses the ldap<br/>\n&gt; template.<br/>\n&gt; i am confued as i cant solve this.<br/>\n&gt; can sombody help me here<br/>\n&gt; i a posting my original calss and the test class.<br/>\n&gt; the exception i m getting is as below<br/>\n&gt;<br/>\n&gt; when i debugged the stuff i found out that the ContextSource is not se in<br/>\n&gt; the MOCKed LDAP template object. i tried setting it.<br/>\n&gt; i m new to writing the junit test class.<br/>\n&gt; i dont know if i am missing anything here.<br/>\n&gt;<br/>\n&gt; com.XXX.YYY.reporting.exception.ReportingException: Error getting<br/>\n&gt; distributor info from LDAP<br/>\n&gt; at<br/>\n&gt; com.XXX.YYY.reporting.dao.LdapDaoImpl.getAllActiveDomesticDistributor(LdapDaoImpl.java:52)<br/>\n&gt; at<br/>\n&gt; com.XXX.YYY.reporting.dao.LdapDaoImplTest.testGetAllActiveDomesticDistributor(LdapDaoImplTest.java:43)<br/>\n&gt; at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br/>\n&gt; at<br/>\n&gt; sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)<br/>\n&gt; at<br/>\n&gt; sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)<br/>\n&gt; at java.lang.reflect.Method.invoke(Method.java:597)<br/>\n&gt; at junit.framework.TestCase.runTest(TestCase.java:154)<br/>\n&gt; at org.jmock.core.VerifyingTestCase.runBare(VerifyingTestCase.java:39)<br/>\n&gt; at junit.framework.TestResult$1.protect(TestResult.java:106)<br/>\n&gt; at junit.framework.TestResult.runProtected(TestResult.java:124)<br/>\n&gt; at junit.framework.TestResult.run(TestResult.java:109)<br/>\n&gt; at junit.framework.TestCase.run(TestCase.java:118)<br/>\n&gt; at junit.framework.TestSuite.runTest(TestSuite.java:208)<br/>\n&gt; at junit.framework.TestSuite.run(TestSuite.java:203)<br/>\n&gt; at<br/>\n&gt; org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:128)<br/>\n&gt; at<br/>\n&gt; org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)<br/>\n&gt; at<br/>\n&gt; org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:460)<br/>\n&gt; at<br/>\n&gt; org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:673)<br/>\n&gt; at<br/>\n&gt; org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386)<br/>\n&gt; at<br/>\n&gt; org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196)<br/>\n&gt; Caused by: org.jmock.core.DynamicMockError: mockLdapTemplate: unexpected<br/>\n&gt; invocation<br/>\n&gt; Invoked: mockLdapTemplate.search(&quot;&quot;,<br/>\n&gt; &quot;(&(ttcUserType=distributor)(ttcgeographicregion=United States))&quot;,<br/>\n&gt; &lt;com.XXX.YYY.reporting.dao.LdapDaoImpl$DistributorInfoAttributeMapper@1e12f6d&gt;)<br/>\n&gt; Allowed:<br/>\n&gt; expected once: search( eq(&lt;class java.lang.String&gt;), eq(&lt;class<br/>\n&gt; java.lang.String&gt;), eq(&lt;class<br/>\n&gt; com.XXX.YYY.reporting.dao.LdapDaoImpl$DistributorInfoAttributeMapper&gt;) ),<br/>\n&gt; returns &lt;com.XXX.YYY.reporting.struts.form.DistributorInfo@15428dd&gt;<br/>\n&gt;<br/>\n&gt; at<br/>\n&gt; org.jmock.core.AbstractDynamicMock.mockInvocation(AbstractDynamicMock.java:58)<br/>\n&gt; at org.jmock.cglib.CGLIBCoreMock.intercept(CGLIBCoreMock.java:71)<br/>\n&gt; at<br/>\n&gt; org.springframework.ldap.core.LdapTemplate$$EnhancerByCGLIB$$3bfb79d.search(&lt;generated&gt;)<br/>\n&gt; at<br/>\n&gt; com.XXX.YYY.reporting.dao.LdapDaoImpl.getAllActiveDomesticDistributor(LdapDaoImpl.java:47)<br/>\n&gt; ... 19 morethe actual source file looks as below<br/>\n&gt;<br/>\n&gt; Code:<br/>\n&gt; /**<br/>\n&gt; * private logger instance for logging.<br/>\n&gt; */<br/>\n&gt; private static final Logger LOG = Logger.getLogger(LdapDaoImpl.class);<br/>\n&gt;<br/>\n&gt; private LdapTemplate ldapTemplate;<br/>\n&gt;<br/>\n&gt; /**<br/>\n&gt; * @param ldapTemplate the ldapTemplate to set<br/>\n&gt; */<br/>\n&gt; public void setLdapTemplate(LdapTemplate ldapTemplate) {<br/>\n&gt; this.ldapTemplate = ldapTemplate;<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt; /**<br/>\n&gt; * This method retreives all domestic distributors from LDAP<br/>\n&gt; * @exception reporting exception<br/>\n&gt; * @return list of distributors with company name and the distributor ID<br/>\n&gt; */<br/>\n&gt; public List getAllActiveDomesticDistributor()throws ReportingException{<br/>\n&gt; List distList= null;<br/>\n&gt;<br/>\n&gt; try{<br/>\n&gt; AndFilter filter = new AndFilter();<br/>\n&gt; filter.and(new EqualsFilter(ReportingConstant.TTC_USER_TYPE,<br/>\n&gt; ReportingConstant.DISTRIBUTOR));<br/>\n&gt; filter.and(new EqualsFilter(ReportingConstant.GEOGRAPHIC_REGION,<br/>\n&gt; ReportingConstant.US));<br/>\n&gt; System.out.println(filter.encode());<br/>\n&gt; distList = ldapTemplate.search(ReportingConstant.BLANK, filter.encode(), new<br/>\n&gt; DistributorInfoAttributeMapper());<br/>\n&gt; distList = sanitizeDistributorList(distList);<br/>\n&gt; LOG.debug(&quot;List Distributor Info retrieved from LDAP&quot;);<br/>\n&gt; }catch(Throwable t){<br/>\n&gt; LOG.error(&quot;Error getting distributor info from LDAP&quot;);<br/>\n&gt; throw new ReportingException(&quot;Error getting distributor info from LDAP&quot;, t);<br/>\n&gt; }<br/>\n&gt; return distList;<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt; /**<br/>\n&gt; * Inner Class for the retrived attribute mapper<br/>\n&gt; */<br/>\n&gt; protected class DistributorInfoAttributeMapper implements AttributesMapper{<br/>\n&gt; public Object mapFromAttributes(Attributes attri) throws NamingException {<br/>\n&gt; DistributorInfo distInfo = new DistributorInfo();<br/>\n&gt; distInfo.setDistributorId((String)attri.get(ReportingConstant.TTC_CUST_ID).get());<br/>\n&gt; distInfo.setCompanyName((String)attri.get(ReportingConstant.TTC_COMPANY_NAME).get());<br/>\n&gt; return distInfo;<br/>\n&gt; }<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt; /**<br/>\n&gt; * Format the retrived distributor info from LDAP<br/>\n&gt; * prepends 000 to distributor ID also prepends the distributor ID to the<br/>\n&gt; company name<br/>\n&gt; */<br/>\n&gt; private List sanitizeDistributorList (List distInfo){<br/>\n&gt; List distributors = new ArrayList();<br/>\n&gt; for (int i=0; i&lt;distInfo.size(); i++){<br/>\n&gt; DistributorInfo distributorInfo = (DistributorInfo)distInfo.get(i);<br/>\n&gt; String distId = distributorInfo.getDistributorId();<br/>\n&gt; String compName = distributorInfo.getCompanyName();<br/>\n&gt; if(hasNumber(distId)){<br/>\n&gt; if(Integer.parseInt(distId)&lt; 600){<br/>\n&gt; distributorInfo.setDistributorId(ReportingConstant.TRIPLE_ZERO + distId);<br/>\n&gt; distributorInfo.setCompanyName(distId + ReportingConstant.DASH + compName);<br/>\n&gt; distributors.add(distributorInfo);<br/>\n&gt; }<br/>\n&gt; }<br/>\n&gt; }<br/>\n&gt; return distributors;<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt; /**<br/>\n&gt; * Verifies if the string has a numbers in it<br/>\n&gt; */<br/>\n&gt; private boolean hasNumber(String s) {<br/>\n&gt; for (int j = 0;j &lt; s.length();j++)<br/>\n&gt; if (!Character.isDigit(s.charAt(j))) return false;<br/>\n&gt; return true;<br/>\n&gt; }my application context looks as below<br/>\n&gt;<br/>\n&gt; Code:<br/>\n&gt; &lt;bean id=&quot;ldapDao&quot; class=&quot; com.toro.rebate.reporting.dao.LdapDaoImpl&quot;&gt;<br/>\n&gt; &lt;property name=&quot;ldapTemplate&quot; ref=&quot;ldapTemplate&quot;/&gt;<br/>\n&gt;<br/>\n&gt; &lt;/bean&gt;<br/>\n&gt;<br/>\n&gt;<br/>\n&gt; &lt;bean id=&quot;contextSource&quot;<br/>\n&gt; class=&quot;org.springframework.ldap.core.support.LdapContextSource&quot;&gt;<br/>\n&gt; &lt;property name=&quot;url&quot;&gt;&lt;value&gt;${LDAP.url}&lt;/value&gt;&lt;/property&gt;<br/>\n&gt; &lt;property name=&quot;base&quot;&gt;&lt;value&gt;${LDAP.base}&lt;/value&gt;&lt;/property&gt;<br/>\n&gt; &lt;/bean&gt;<br/>\n&gt; &lt;bean id=&quot;ldapTemplate&quot; class=&quot;org.springframework.ldap.core.LdapTemplate&quot;&gt;<br/>\n&gt; &lt;constructor-arg ref=&quot;contextSource&quot; /&gt;<br/>\n&gt; &lt;/bean&gt;<br/>\n&gt; and my test clas is as below<br/>\n&gt;<br/>\n&gt; Code:<br/>\n&gt; public class LdapDaoImplTest extends MockObjectTestCase{<br/>\n&gt;<br/>\n&gt; private LdapDaoImpl ldapDao;<br/>\n&gt; AndFilter filter;<br/>\n&gt; Mock andFilterMock;<br/>\n&gt;<br/>\n&gt; LdapTemplate ldapTemplate;<br/>\n&gt; Mock ldapTemplateMock;<br/>\n&gt;<br/>\n&gt; protected void setUp() throws Exception{<br/>\n&gt; ldapTemplateMock = mock(LdapTemplate.class);<br/>\n&gt; ldapDao = new LdapDaoImpl();<br/>\n&gt; ldapTemplate = new LdapTemplate();<br/>\n&gt; // ldapTemplate.setContextSource(arg0)<br/>\n&gt;<br/>\n&gt;<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt; protected void tearDown() throws Exception {<br/>\n&gt;<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt; public void testGetAllActiveDomesticDistributor(){<br/>\n&gt; List distributorList = getDistributorList();<br/>\n&gt; DistributorInfo distInfo = getDistributorInfo();<br/>\n&gt; //<br/>\n&gt; ldapTemplateMock.expects(once()).method(&quot;search&quot;).with(ANYTHING).will(returnValue(distributorList));<br/>\n&gt; // ldapTemplateMock.expects(once()).method(&quot;search&quot;).with(eq(String.class),<br/>\n&gt; &quot;(&(ttcUserType=distributor)(ttcgeographicregion=United States))&quot;,<br/>\n&gt; DistributorInfoAttributeMapper.class);<br/>\n&gt; ldapTemplateMock.expects(once()).method(&quot;setContextSource&quot;).with(eq(ContextSource.class));<br/>\n&gt; ldapTemplateMock.expects(once()).method(&quot;search&quot;).with(eq(String.class),<br/>\n&gt; eq(String.class), eq(ldapDao.new DistributorInfoAttributeMapper()));<br/>\n&gt; ldapDao.setLdapTemplate((LdapTemplate)ldapTemplateMock.proxy());<br/>\n&gt; List actualDistList = ldapDao.getAllActiveDomesticDistributor();<br/>\n&gt; System.out.println(actualDistList.size());<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt; public List getDistributorList(){<br/>\n&gt; List distInfoList = new ArrayList();<br/>\n&gt;<br/>\n&gt; DistributorInfo distInfo1 = new DistributorInfo();<br/>\n&gt; distInfo1.setCompanyName(&quot;Wsco Turf Supply&quot;);<br/>\n&gt; distInfo1.setDistributorId(&quot;150&quot;);<br/>\n&gt;<br/>\n&gt; DistributorInfo distInfo2 = new DistributorInfo();<br/>\n&gt; distInfo2.setCompanyName(&quot;Test non Domestic DIst&quot;);<br/>\n&gt; distInfo2.setDistributorId(&quot;810&quot;);<br/>\n&gt;<br/>\n&gt; distInfoList.add(distInfo2);<br/>\n&gt; return distInfoList;<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt; public DistributorInfo getDistributorInfo(){<br/>\n&gt; List distInfoList = new ArrayList();<br/>\n&gt;<br/>\n&gt; DistributorInfo distInfo1 = new DistributorInfo();<br/>\n&gt; distInfo1.setCompanyName(&quot;Wsco Turf Supply&quot;);<br/>\n&gt; distInfo1.setDistributorId(&quot;150&quot;);<br/>\n&gt;<br/>\n&gt; // DistributorInfo distInfo2 = new DistributorInfo();<br/>\n&gt; // distInfo2.setCompanyName(&quot;Test non Domestic DIst&quot;);<br/>\n&gt; // distInfo2.setDistributorId(&quot;810&quot;);<br/>\n&gt; //<br/>\n&gt; // distInfoList.add(distInfo2);<br/>\n&gt; return distInfo1;<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt; private ContextSource getLDAPContextSource() {<br/>\n&gt; LdapContextSource ldapContextSource = new LdapContextSource();<br/>\n&gt; ldapContextSource.setUrl(&quot;ldap://ldap-ttcdit.toro.com:389&quot;);<br/>\n&gt; ldapContextSource.setBase(&quot;ou=Companies,o=ttc&quot;);<br/>\n&gt;<br/>\n&gt; try {<br/>\n&gt; ldapContextSource.afterPropertiesSet();<br/>\n&gt; } catch (Exception e) {<br/>\n&gt; e.printStackTrace();<br/>\n&gt; }<br/>\n&gt; return ldapContextSource;<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt; [Non-text portions of this message have been removed]<br/>\n&gt;<br/>\n&gt; </span></blockquote></div>", 
    "prevInTime": 20921, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1222289982", 
    "canDelete": false, 
    "nextInTopic": 0, 
    "prevInTopic": 20861, 
    "headers": {
        "inReplyToHeader": "PDMwNzQ2NS4yNjc2Mi5xbUB3ZWIzMTAwMS5tYWlsLm11ZC55YWhvby5jb20+", 
        "messageIdInHeader": "PDRmN2RhNmI5MDgwOTI0MTM1OW42M2FiMDNmMWw2YmUxYzQ1ZDhkMmIyODk2QG1haWwuZ21haWwuY29tPg==", 
        "referencesHeader": "PDMwNzQ2NS4yNjc2Mi5xbUB3ZWIzMTAwMS5tYWlsLm11ZC55YWhvby5jb20+"
    }
}
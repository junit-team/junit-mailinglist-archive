{
    "numMessagesInTopic": 5, 
    "nextInTime": 16143, 
    "senderId": "pkv_y6eNDzSj-OancfWLyKmDmgWbEfXccGkTtH-EeM0mRyk8FjBj1NykDP0dWjntwU3Mr7JDANcODCnj31L_6A", 
    "systemMessage": false, 
    "subject": "Re: [junit] [PATCH] filter stack traces in junit", 
    "from": "David Saff &lt;saff@...&gt;", 
    "authorName": "David Saff", 
    "msgSnippet": "Ben, I m afraid that after discussion, we re still reluctant to have JUnit natively filter stack traces.  It looks to me that this is something that could work", 
    "msgId": 16142, 
    "profile": "dsaff", 
    "topicId": 16058, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 139771899, 
    "messageBody": "<div id=\"ygrps-yiv-1782009309\">Ben,<br/>\n<br/>\nI&#39;m afraid that after discussion, we&#39;re still reluctant to have JUnit <br/>\nnatively filter stack traces.  It looks to me that this is something <br/>\nthat could work in a custom runner--are you interested in seeing if this <br/>\nis so?<br/>\n<br/>\nAlso, thank you for all of your feedback so far, and please do keep <br/>\nconsidering ways we can improve the framework.  The sourceforge project <br/>\npage has a convenient place for any future patches.  Thanks,<br/>\n<br/>\n    David Saff<br/>\n<br/>\nBen Maurer wrote:<br/>\n<blockquote><span title=\"qreply\"> &gt; Hey guys,<br/>\n&gt;<br/>\n&gt; As I mentioned in my previous email, one of the issues with junit is<br/>\n&gt; that I have to manually filter out harness stack frames from<br/>\n&gt; exceptions. The current approach to this is generally to just filter<br/>\n&gt; out lines with some specific prefixes. However, this is not ideal. For<br/>\n&gt; example, ant filters out some sun.reflect stack frames. But these can<br/>\n&gt; occur *inside* a test case&#39;s stack trace.<br/>\n&gt;<br/>\n&gt; The following patch solves the issue by using the<br/>\n&gt; InvocationTargetException generated by Method.invoke to figure out<br/>\n&gt; which stack frames come from JUnit. It then removes these frames from<br/>\n&gt; the trace. This process is transparent to consumers of the junit<br/>\n&gt; framework.<br/>\n&gt;<br/>\n&gt; Issues:<br/>\n&gt;<br/>\n&gt; 1) I&#39;m not sure if the place I located the filter is the most ideal<br/>\n&gt; place in the framework. Other ideas would be greatly appreciated<br/>\n&gt;<br/>\n&gt; 2) I need test cases (I haven&#39;t yet gotten to bite the bullet and<br/>\n&gt; write tests before I develop ;-).<br/>\n&gt;<br/>\n&gt; Since this list doesn&#39;t allow attachments, I&#39;ve copied and pasted this<br/>\n&gt; in the main text. Since this will probably be hard to apply, I&#39;ve also<br/>\n&gt; posted on my dorm computer:<br/>\n&gt;<br/>\n&gt; <a rel=\"nofollow\" target=\"_blank\" href=\"http://omega.res.cmu.edu/~benm/junit-stacktrace.patch\">http://omega.res.cmu.edu/~benm/junit-stacktrace.patch</a> <br/>\n&gt; &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"http://omega.res.cmu.edu/%7Ebenm/junit-stacktrace.patch\">http://omega.res.cmu.edu/%7Ebenm/junit-stacktrace.patch</a>&gt;<br/>\n&gt;<br/>\n&gt; -- Ben<br/>\n&gt;<br/>\n&gt;<br/>\n&gt;<br/>\n&gt;<br/>\n&gt;<br/>\n&gt;<br/>\n&gt;<br/>\n&gt;<br/>\n&gt; Index: org/junit/internal/runners/TestMethodRunner.java<br/>\n&gt; ===================================================================<br/>\n&gt; RCS file:<br/>\n&gt; /cvsroot/junit/junit/org/junit/internal/runners/Attic/TestMethodRunner.java,v<br/>\n&gt; retrieving revision 1.1.2.6<br/>\n&gt; diff -u -r1.1.2.6 TestMethodRunner.java<br/>\n&gt; --- org/junit/internal/runners/TestMethodRunner.java      6 Feb 2006<br/>\n&gt; 04:09:17 -0000      1.1.2.6<br/>\n&gt; +++ org/junit/internal/runners/TestMethodRunner.java      10 Feb 2006<br/>\n&gt; 04:44:42 -0000<br/>\n&gt; @@ -81,7 +81,10 @@<br/>\n&gt;                   if (expectsException())<br/>\n&gt;                         addFailure(new AssertionError(&quot;Expected <br/>\n&gt; exception: &quot; +<br/>\n&gt; expectedException().getName()));<br/>\n&gt;             } catch (InvocationTargetException e) {<br/>\n&gt; -                  Throwable actual= e.getTargetException();<br/>\n&gt; +                  Throwable actual= e.getTargetException ();<br/>\n&gt; +                  // It&#39;s important that we filter here. This way, we<br/>\n&gt; +                  // cut the sun.reflect.* out of the stack trace.<br/>\n&gt; +                  StackTraceFilter.filter (actual, e);<br/>\n&gt;                   if (!expectsException())<br/>\n&gt;                         addFailure(actual);<br/>\n&gt;                   else if (isUnexpected(actual)) {<br/>\n&gt; Index: org/junit/internal/runners/StackTraceFilter.java<br/>\n&gt; ===================================================================<br/>\n&gt; RCS file: org/junit/internal/runners/StackTraceFilter.java<br/>\n&gt; diff -N org/junit/internal/runners/StackTraceFilter.java<br/>\n&gt; --- /dev/null      1 Jan 1970 00:00:00 -0000<br/>\n&gt; +++ org/junit/internal/runners/StackTraceFilter.java      1 Jan 1970<br/>\n&gt; 00:00:00 -0000<br/>\n&gt; @@ -0,0 +1,64 @@<br/>\n&gt; +package org.junit.internal.runners;<br/>\n&gt; +<br/>\n&gt; +import java.util.ArrayList;<br/>\n&gt; +import java.util.List;<br/>\n&gt; +<br/>\n&gt; +/**<br/>\n&gt; + * Methods for filtering out irrelevant stack frames from<br/>\n&gt; + * a Throwable.<br/>\n&gt; + *<br/>\n&gt; + * @author Ben Maurer &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:bmaurer@...\">bmaurer@...</a>&gt;<br/>\n&gt; + */<br/>\n&gt; +public class StackTraceFilter {<br/>\n&gt; +<br/>\n&gt; +      /**<br/>\n&gt; +      * Removes items from a stack trace that it shares with another <br/>\n&gt; trace.<br/>\n&gt; +      * @param trace The trace to filter out<br/>\n&gt; +      * @param base The base trace<br/>\n&gt; +      * @return trace with items at the end that it shares with base <br/>\n&gt; removed<br/>\n&gt; +      */<br/>\n&gt; +      static StackTraceElement [] doFilter (StackTraceElement [] trace,<br/>\n&gt; StackTraceElement [] base)<br/>\n&gt; +      {<br/>\n&gt; +            List&lt;StackTraceElement&gt; filtered = new <br/>\n&gt; ArrayList&lt;StackTraceElement&gt; ();<br/>\n&gt; +            for (StackTraceElement ele : trace)<br/>\n&gt; +                  filtered.add (ele);<br/>\n&gt; +<br/>\n&gt; +            for (int i = base.length - 1; i &gt;= 0 && filtered.size () <br/>\n&gt; &gt; 0; i--) {<br/>\n&gt; +                  if (!filtered.get (filtered.size () - 1).equals <br/>\n&gt; (base [i]))<br/>\n&gt; +                        break;<br/>\n&gt; +<br/>\n&gt; +                  filtered.remove (filtered.size () - 1);<br/>\n&gt; +            }<br/>\n&gt; +<br/>\n&gt; +            return filtered.toArray (new StackTraceElement [] {});<br/>\n&gt; +<br/>\n&gt; +      }<br/>\n&gt; +<br/>\n&gt; +      /**<br/>\n&gt; +      * Filters the stack trace components that toFilter shares<br/>\n&gt; +      * with the threads current stack trace.<br/>\n&gt; +      */<br/>\n&gt; +      public static void filter (Throwable toFilter)<br/>\n&gt; +      {<br/>\n&gt; +            filter (toFilter, Thread.currentThread ().getStackTrace ());<br/>\n&gt; +      }<br/>\n&gt; +<br/>\n&gt; +      /**<br/>\n&gt; +      * Filters the stack trace components that toFilter shares<br/>\n&gt; +      * with baseException.<br/>\n&gt; +      */<br/>\n&gt; +      public static void filter (Throwable toFilter, Throwable <br/>\n&gt; baseException)<br/>\n&gt; +      {<br/>\n&gt; +            filter (toFilter, baseException.getStackTrace ());<br/>\n&gt; +      }<br/>\n&gt; +<br/>\n&gt; +      /**<br/>\n&gt; +      * Filters the stack trace components that toFilter shares<br/>\n&gt; +      * with base.<br/>\n&gt; +      */<br/>\n&gt; +      public static void filter (Throwable toFilter, StackTraceElement []<br/>\n&gt; base)<br/>\n&gt; +      {<br/>\n&gt; +            for (Throwable t = toFilter; t != null; t = t.getCause ())<br/>\n&gt; +                  t.setStackTrace (doFilter (t.getStackTrace (), base));<br/>\n&gt; +      }<br/>\n&gt; +}<br/>\n&gt;<br/>\n&gt;<br/>\n&gt;<br/>\n&gt;<br/>\n&gt;<br/>\n&gt;<br/>\n&gt; SPONSORED LINKS<br/>\n&gt; Basic programming language <br/>\n&gt; &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"http://groups.yahoo.com/gads?t=ms&k=Basic+programming+language&w1=Basic+programming+language&w2=C+programming+language&w3=Computer+programming+languages&w4=The+c+programming+language&w5=C+++programming+language&w6=List+of+programming+languages&c=6&s=193&.sig=aLlETYEcZKW67uFZnuZPPw\">http://groups.yahoo.com/gads?t=ms&k=Basic+programming+language&w1=Basic+programming+language&w2=C+programming+language&w3=Computer+programming+languages&w4=The+c+programming+language&w5=C+++programming+language&w6=List+of+programming+languages&c=6&s=193&.sig=aLlETYEcZKW67uFZnuZPPw</a>&gt; <br/>\n&gt; \tC programming language <br/>\n&gt; &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"http://groups.yahoo.com/gads?t=ms&k=C+programming+language&w1=Basic+programming+language&w2=C+programming+language&w3=Computer+programming+languages&w4=The+c+programming+language&w5=C+++programming+language&w6=List+of+programming+languages&c=6&s=193&.sig=n4wEVXDpIBKogo8e_G77cw\">http://groups.yahoo.com/gads?t=ms&k=C+programming+language&w1=Basic+programming+language&w2=C+programming+language&w3=Computer+programming+languages&w4=The+c+programming+language&w5=C+++programming+language&w6=List+of+programming+languages&c=6&s=193&.sig=n4wEVXDpIBKogo8e_G77cw</a>&gt; <br/>\n&gt; \tComputer programming languages <br/>\n&gt; &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"http://groups.yahoo.com/gads?t=ms&k=Computer+programming+languages&w1=Basic+programming+language&w2=C+programming+language&w3=Computer+programming+languages&w4=The+c+programming+language&w5=C+++programming+language&w6=List+of+programming+languages&c=6&s=193&.sig=KFl1CeQi7jrKmsK4WD6ygQ\">http://groups.yahoo.com/gads?t=ms&k=Computer+programming+languages&w1=Basic+programming+language&w2=C+programming+language&w3=Computer+programming+languages&w4=The+c+programming+language&w5=C+++programming+language&w6=List+of+programming+languages&c=6&s=193&.sig=KFl1CeQi7jrKmsK4WD6ygQ</a>&gt; <br/>\n&gt;<br/>\n&gt; The c programming language <br/>\n&gt; &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"http://groups.yahoo.com/gads?t=ms&k=The+c+programming+language&w1=Basic+programming+language&w2=C+programming+language&w3=Computer+programming+languages&w4=The+c+programming+language&w5=C+++programming+language&w6=List+of+programming+languages&c=6&s=193&.sig=lU9w7-4UlGPB4LjDy84c2Q\">http://groups.yahoo.com/gads?t=ms&k=The+c+programming+language&w1=Basic+programming+language&w2=C+programming+language&w3=Computer+programming+languages&w4=The+c+programming+language&w5=C+++programming+language&w6=List+of+programming+languages&c=6&s=193&.sig=lU9w7-4UlGPB4LjDy84c2Q</a>&gt; <br/>\n&gt; \tC programming language <br/>\n&gt; &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"http://groups.yahoo.com/gads?t=ms&k=C+++programming+language&w1=Basic+programming+language&w2=C+programming+language&w3=Computer+programming+languages&w4=The+c+programming+language&w5=C+++programming+language&w6=List+of+programming+languages&c=6&s=193&.sig=dtKotXT1Ne2N9AO_aEbPFQ\">http://groups.yahoo.com/gads?t=ms&k=C+++programming+language&w1=Basic+programming+language&w2=C+programming+language&w3=Computer+programming+languages&w4=The+c+programming+language&w5=C+++programming+language&w6=List+of+programming+languages&c=6&s=193&.sig=dtKotXT1Ne2N9AO_aEbPFQ</a>&gt; <br/>\n&gt; \tList of programming languages <br/>\n&gt; &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"http://groups.yahoo.com/gads?t=ms&k=List+of+programming+languages&w1=Basic+programming+language&w2=C+programming+language&w3=Computer+programming+languages&w4=The+c+programming+language&w5=C+++programming+language&w6=List+of+programming+languages&c=6&s=193&.sig=0shmxLBHwrZWcSjC3QvZAA\">http://groups.yahoo.com/gads?t=ms&k=List+of+programming+languages&w1=Basic+programming+language&w2=C+programming+language&w3=Computer+programming+languages&w4=The+c+programming+language&w5=C+++programming+language&w6=List+of+programming+languages&c=6&s=193&.sig=0shmxLBHwrZWcSjC3QvZAA</a>&gt; <br/>\n&gt;<br/>\n&gt;<br/>\n&gt;<br/>\n&gt; ------------------------------------------------------------------------<br/>\n&gt; YAHOO! GROUPS LINKS<br/>\n&gt;<br/>\n&gt;     *  Visit your group &quot;junit &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"http://groups.yahoo.com/group/junit\">http://groups.yahoo.com/group/junit</a>&gt;&quot;<br/>\n&gt;       on the web.<br/>\n&gt;        <br/>\n&gt;     *  To unsubscribe from this group, send an email to:<br/>\n&gt;        <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit-unsubscribe@yahoogroups.com\">junit-unsubscribe@yahoogroups.com</a><br/>\n&gt;       &lt;mailto:<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit-unsubscribe@yahoogroups.com\">junit-unsubscribe@yahoogroups.com</a>?subject=Unsubscribe&gt;<br/>\n&gt;        <br/>\n&gt;     *  Your use of Yahoo! Groups is subject to the Yahoo! Terms of<br/>\n&gt;       Service &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"http://docs.yahoo.com/info/terms/\">http://docs.yahoo.com/info/terms/</a>&gt;.<br/>\n&gt;<br/>\n&gt;<br/>\n&gt; ------------------------------------------------------------------------<br/>\n&gt; </span></blockquote></div>", 
    "prevInTime": 16141, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1140539023", 
    "canDelete": false, 
    "nextInTopic": 16160, 
    "prevInTopic": 16072, 
    "headers": {
        "inReplyToHeader": "PGRzaDY1ZytvYTV1QGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PDQzRkIzRThGLjUwODA5MDdAbWl0LmVkdT4=", 
        "referencesHeader": "PGRzaDY1ZytvYTV1QGVHcm91cHMuY29tPg=="
    }
}
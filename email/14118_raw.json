{
    "numMessagesInTopic": 9, 
    "nextInTime": 14119, 
    "senderId": "LaGOezGqQvdKhKOcYGjAmIvCT2rI53LGZeTtMooBdcEVXph1zDVtajppL1VQ_Dz-3Y1pt3KwYXDYRnJlWOiUElke25HOvwgsuwu8j7sHfslFqmZAcw", 
    "systemMessage": false, 
    "subject": "Re: [junit] Testing Methods with Dates WAS: Testing Methods with Random Numbers", 
    "from": "Andrew McDonagh &lt;andrew.mcdonagh@...&gt;", 
    "authorName": "Andrew McDonagh", 
    "msgSnippet": "... snipped. ... snipped Yes thats a very good technique.   I ve used  it when using Dates and the current system time. Instead of code using Java s", 
    "msgId": 14118, 
    "rawEmail": "Return-Path: &lt;andrew.mcdonagh@...&gt;\r\nX-Sender: andrew.mcdonagh@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (qmail 72668 invoked from network); 12 Jul 2005 09:46:33 -0000\r\nReceived: from unknown (66.218.66.166)\n  by m20.grp.scd.yahoo.com with QMQP; 12 Jul 2005 09:46:33 -0000\r\nReceived: from unknown (HELO relay.ipaccess.com) (217.204.123.74)\n  by mta5.grp.scd.yahoo.com with SMTP; 12 Jul 2005 09:46:29 -0000\r\nReceived: from magrat.ipaccess.com ([172.28.0.6])\n\tby relay.ipaccess.com with esmtp (Exim 4.50)\n\tid 1DsHLK-0001Rk-K6\n\tfor junit@yahoogroups.com; Tue, 12 Jul 2005 09:46:22 +0000\r\nReceived: from aragorn.ipaccess.com\n\t([172.28.0.78] helo=aragorn ident=mail)\n\tby magrat.ipaccess.com with esmtp (Exim 3.35 #1 (Debian))\n\tid 1DsHLJ-0008FB-00\n\tfor &lt;junit@yahoogroups.com&gt;; Tue, 12 Jul 2005 09:46:21 +0000\r\nReceived: from [172.28.1.102] (helo=[172.28.1.102])\n\tby aragorn with esmtp (Exim 3.35 #1 (Debian))\n\tid 1DsHLJ-0005Qn-00\n\tfor &lt;junit@yahoogroups.com&gt;; Tue, 12 Jul 2005 09:46:21 +0000\r\nMessage-ID: &lt;42D3916A.3000908@...&gt;\r\nDate: Tue, 12 Jul 2005 10:46:18 +0100\r\nUser-Agent: Mozilla Thunderbird 1.0.2 (Windows/20050317)\r\nX-Accept-Language: en-us, en\r\nMIME-Version: 1.0\r\nTo: junit@yahoogroups.com\r\nReferences: &lt;dan9s6+icni@...&gt;\r\nIn-Reply-To: &lt;dan9s6+icni@...&gt;\r\nContent-Type: text/plain; charset=ISO-8859-1; format=flowed\r\nContent-Transfer-Encoding: 7bit\r\nX-eGroups-Msg-Info: 1:12:0\r\nFrom: Andrew McDonagh &lt;andrew.mcdonagh@...&gt;\r\nReply-To: andrew.mcdonagh@...\r\nSubject: Re: [junit] Testing Methods with Dates WAS: Testing Methods with\n Random Numbers\r\nX-Yahoo-Group-Post: member; u=73998260; y=fzsxKxGPI234cfRQOrM6qyJ6It7mjn8rRkCkwVitN6yyUIqqCAdrdA\r\nX-Yahoo-Profile: andy_ipaccess\r\n\r\nMichael wrote:\n\n&gt;Hi. I was brainstorming and idea on the drive home from work tonight\n&gt;and realized I didn&#39;t know how to test something. This didn&#39;t come as\n&gt;a major shock, but I think I have an idea for a solution and I would\n&gt;like some devil&#39;s advocates :)\n&gt;\n&gt;\n&gt;  \n&gt;\nsnipped.\n\n&gt;The implementation of DoubleGenerator in production code could be a\n&gt;wrapper around Math.random() and a testing implementation could allow\n&gt;you to set the sequence of doubles to return.\n&gt;\n&gt;\n&gt;  \n&gt;\nsnipped\n\n\nYes thats a very good technique.   I&#39;ve used  it when using Dates and \nthe current system time.\n\nInstead of code using Java&#39;s System.currentTimeInMillis() method \ndirectly, they get the time via an abstract factory. The production code \nconcrete factory does the usual System.currentTimeInMillis() whereas the \ntests use a Test Concrete Factory that is preconfigured to always return \nthe same value.\n\nprotected void setUp() throws Exception {\n      SystemTimeFactorySingleton.setConcreteFactory(new \nTestSystemTimeFactory(10));\n   }\n\npublic void testReportingInvalidAttributeType() {\n\n   AlarmReporterImpl reporter = new AlarmReporterImpl();\n\n   MockAlarmEventSubscriber mockAlarmEventSubscriber = new \nMockAlarmEventSubscriber();\n   reporter.setAlarmEventSubscriber(mockAlarmEventSubscriber);\n\n   String dn = &quot;bss=0,Site=2&quot;;\n\n   reporter.reportInvalidAttributeTypeAlarm(dn);\n\n   Alarm actualAlarm = mockAlarmEventSubscriber.getLastAlarm();\n\n   Date expectedDate = new \nDate(SystemTimeFactorySingleton.getInstance().currentTimeInMillis());\n   assertEquals(expectedDate, actualAlarm .getDate());\n   assertEquals(expectedDN, actualAlarm.getDN());\n}\n\n\n\n\npublic interface SystemTimeFactory {\n   long currentTimeInMillis();\n   long currentTimeInSeconds();\n}\n\n\n//////////////////////////////\npublic class DefaultSystemTimeFactory implements SystemTimeFactory {\n\n   public long currentTimeInMillis() {\n      return System.currentTimeMillis();\n   }\n\n   public long currentTimeInSeconds() {\n      return (currentTimeInMillis() / 1000) * 1000;\n   }\n}\n\n//////////////////////////////\npublic class TestSystemTimeFactory implements SystemTimeFactory {\n\n   public TestSystemTimeFactory(long time) {\n      m_time = time;\n   }\n\n   public void setTimeInMillis(long time) {\n      m_time = time;\n   }\n\n  public long currentTimeInMillis() {\n      return m_time;\n   }\n\n   public long currentTimeInSeconds() {\n      return (currentTimeInMillis() / 1000) * 1000;\n   }\n\n   private long m_time;\n}\n\npublic class SystemTimeFactorySingleton {\n   public static SystemTimeFactory getInstance() {\n      return s_concreteFactory;\n   }\n\n   /**\n    * use this to replace the &quot;production&quot; factory with one for a \nspecific purpose such as testing.\n    */\n   public static void setConcreteFactory(SystemTimeFactory \nconcreteFactory) {\n      s_concreteFactory = concreteFactory;\n   }\n\n   private static SystemTimeFactory s_concreteFactory = new \nDefaultSystemTimeFactory();\n}\n\nWe chose to use a singleton abstract factory rather than pass around the \nSystemTime, mainly because we were working on legacy code As the legacy \ncode was already doing System.currentTimeInMIllis() it helped us move \nforward with the story without having to refactor method signatures to \npass the time around.  I&#39;m not sure if I would have used a Singleton \nAbstract factory or not next time (no pun intended).\n\n\nAndrew\n\n", 
    "profile": "andy_ipaccess", 
    "topicId": 14105, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 73998260, 
    "prevInTime": 14117, 
    "contentTrasformed": false, 
    "postDate": "1121161578", 
    "canDelete": false, 
    "nextInTopic": 14119, 
    "prevInTopic": 14116, 
    "headers": {
        "inReplyToHeader": "PGRhbjlzNitpY25pQGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PDQyRDM5MTZBLjMwMDA5MDhAaXBhY2Nlc3MuY29tPg==", 
        "referencesHeader": "PGRhbjlzNitpY25pQGVHcm91cHMuY29tPg=="
    }
}
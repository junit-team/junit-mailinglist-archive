{
    "numMessagesInTopic": 5, 
    "nextInTime": 14063, 
    "senderId": "qWNYIrR2P15FCvfYGvtlYc3tQ_Klo6Vr59imWG_xa7XvA2HT6PEX_WSzaUkiBPypJrMxCxWyx5sbF42p", 
    "systemMessage": true, 
    "subject": "Re: [junit] Re: Using a Special Class Loader to test a Singleton", 
    "from": "ray@...", 
    "authorName": "ray@allthisisthat.com", 
    "msgSnippet": "Thanks Jeff.  That is very helpful.  It was really driving me up the wall.  I don t understand the point about replacing the private singleton instance", 
    "msgId": 14062, 
    "rawEmail": "Return-Path: &lt;ray@...&gt;\r\nReceived: (qmail 9331 invoked from network); 29 Jun 2005 04:59:04 -0000\r\nReceived: from unknown (66.218.66.166)\n  by m26.grp.scd.yahoo.com with QMQP; 29 Jun 2005 04:59:04 -0000\r\nReceived: from unknown (HELO n14a.bulk.scd.yahoo.com) (66.94.237.28)\n  by mta5.grp.scd.yahoo.com with SMTP; 29 Jun 2005 04:59:04 -0000\r\nComment: DomainKeys? See http://antispam.yahoo.com/domainkeys\r\nReceived: from [66.218.69.3] by n14.bulk.scd.yahoo.com with NNFMP; 29 Jun 2005 04:58:31 -0000\r\nReceived: from [66.218.66.80] by mailer3.bulk.scd.yahoo.com with NNFMP; 29 Jun 2005 04:58:31 -0000\r\nX-Sender: ray@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (qmail 587 invoked from network); 28 Jun 2005 16:40:22 -0000\r\nReceived: from unknown (66.218.66.166)\n  by m22.grp.scd.yahoo.com with QMQP; 28 Jun 2005 16:40:21 -0000\r\nReceived: from unknown (HELO ws6-2.us4.outblaze.com) (205.158.62.197)\n  by mta5.grp.scd.yahoo.com with SMTP; 28 Jun 2005 16:40:21 -0000\r\nReceived: by ws6-2.us4.outblaze.com (Postfix, from userid 1001)\n\tid CCA889E7A0; Tue, 28 Jun 2005 16:40:11 +0000 (GMT)\r\nContent-Disposition: inline\r\nContent-Transfer-Encoding: quoted-printable\r\nContent-Type: text/plain; charset=&quot;iso-8859-1&quot;\r\nMIME-Version: 1.0\r\nReceived: from [130.76.32.16] by ws6-2.us4.outblaze.com with http for\n ray@...; Tue, 28 Jun 2005 08:40:11 -0800\r\nTo: junit@yahoogroups.com\r\nDate: Tue, 28 Jun 2005 08:40:11 -0800\r\nX-Originating-Server: ws6-2.us4.outblaze.com\r\nMessage-Id: &lt;20050628164011.CCA889E7A0@...&gt;\r\nX-eGroups-Msg-Info: 1:12:0\r\nFrom: ray@...\r\nSubject: Re: [junit] Re: Using a Special Class Loader to test a Singleton\r\nX-Yahoo-Group-Post: member; u=228922213; y=NwTA2J_cT_Eg3fBxV9ouBAtIfdG47ffCJqIKgJgCUWYy6HIJoA\r\nX-Yahoo-Profile: raycclough\r\nX-Yahoo-Newman-Property: groups-system\r\nX-eGroups-Approved-By: nails762 &lt;jbrains@...&gt; via web; 29 Jun 2005 04:58:28 -0000\r\n\r\nThanks Jeff.  That is very helpful.  It was really driving me up the wall. =\r\n I don&#39;t understand the point about replacing the private singleton instanc=\r\ne variable, though.  How would that help?  Wouldn&#39;t that ultimately leave m=\r\ne with the same problem, only within the singleton class?\n\nThanks,\nRay Clou=\r\ngh\n\n----- Original Message -----\nFrom: &quot;Jeff Grigg&quot; &lt;jeffgrigg@...&gt;=\r\n\nTo: junit@yahoogroups.com\nSubject: [junit] Re: Using a Special Class Loade=\r\nr to test a Singleton\nDate: Tue, 28 Jun 2005 12:42:04 -0000\n\n\n&lt;html&gt;&lt;body&gt;\n=\r\n\n\n&lt;tt&gt;\n--- &quot;raycclough&quot; &lt;ray@a...&gt; wrote:&lt;BR&gt;\n&gt; [...], I created a custom C=\r\nlass Loader, and use Reflection to&lt;BR&gt;\n&gt; create the object.  It works great=\r\n (except, of course, where&lt;BR&gt;\n&gt; it doesn&#39;t).  The reflexively obtained con=\r\nstructor returns an&lt;BR&gt;\n&gt; object of type &#39;Object&#39;, which the debugger says =\r\nhas the&lt;BR&gt;\n&gt; correct underlying type, and it contains the correct data,&lt;BR=\r\n&gt;\n&gt; but I cannot Cast it to the type it needs to be.  Any hint&lt;BR&gt;\n&gt; to wha=\r\nt I&#39;m doing wrong?  Thanks for any advice you can give&lt;BR&gt;\n&gt; me on this.&lt;BR=\r\n&gt;\n&lt;BR&gt;\nTo directly answer your question:  You can&#39;t cast the object because=\r\n &lt;BR&gt;\nit was created under a different class loader.  You can only &lt;BR&gt;\nint=\r\neract with that class through reflection.  You can&#39;t cast it to &lt;BR&gt;\ntypes =\r\nor interfaces -- unless those classes were loaded by a common &lt;BR&gt;\nclass lo=\r\nader -- IE: the system class loader.&lt;BR&gt;\n&lt;BR&gt;\nI worked around this recently=\r\n by loading the TestCase class itself &lt;BR&gt;\nunder the new class loader and c=\r\nalling the current test method on &lt;BR&gt;\nthe new instance, using reflection. =\r\n (And setting a flag so that the &lt;BR&gt;\nnew instance knew it was running unde=\r\nr the new class loader.)&lt;BR&gt;\n&lt;BR&gt;\nA bit more detail:  The &quot;type&quot; of an inst=\r\nance, its identification, &lt;BR&gt;\nis the class name *PLUS* the the address of =\r\nthe ClassLoader instance &lt;BR&gt;\nthat loaded it.  That&#39;s how web servers keep =\r\napplications separate &lt;BR&gt;\nfrom each other: They create one ClassLoader ins=\r\ntance for each &lt;BR&gt;\nlogical application &quot;process&quot; they want to keep separat=\r\ne.&lt;BR&gt;\n&lt;BR&gt;\nQuestion:&lt;BR&gt;\nSince you&#39;re already using &#39;.setAccessible(true)&#39;=\r\n already, why not &lt;BR&gt;\nuse reflection to replace the static singleton insta=\r\nnce field?&lt;BR&gt;\n&lt;BR&gt;\n&gt; [...]&lt;BR&gt;\n&gt;     SpecialClassLoader loader =3D new Spe=\r\ncialClassLoader();&lt;BR&gt;\n&gt;     Class ctlrClass =3D loader.findClass(         =\r\n         &lt;BR&gt;\n&gt; &quot;rdyne_rdcs.comm_gateway.controller.DefaultGatewayControlle=\r\nr&quot;);&lt;BR&gt;\n&gt;                                                 &lt;BR&gt;\n&gt;     // in=\r\nstantiate the controller using reflection&lt;BR&gt;\n&gt;     Class[] paramTypes =3D =\r\n{ Reader.class };&lt;BR&gt;\n&gt;     Object[] args =3D {reader};    // contains the =\r\n&quot;test data&quot;&lt;BR&gt;\n&gt;                   &lt;BR&gt;\n&gt;     Constructor constructor =3D =\r\n&lt;BR&gt;\n&gt; ctlrClass.getDeclaredConstructor(paramTypes);&lt;BR&gt;\n&gt;     constructor.=\r\nsetAccessible(true);&lt;BR&gt;\n&gt;     Object o =3D constructor.newInstance(args);&lt;=\r\nBR&gt;\n&gt;                   &lt;BR&gt;\n&gt;     //Method m =3D ctlrClass.getMethod(&quot;getC=\r\nontroller&quot;,paramTypes);&lt;BR&gt;\n&gt;     //m.setAccessible(true);&lt;BR&gt;\n&gt;     //Obje=\r\nct o =3D m.invoke(null,args);&lt;BR&gt;\n&gt;                   &lt;BR&gt;\n&gt; // TODO  - Fig=\r\nure this out!!!!!!!!!!!!!!!!!!&lt;BR&gt;\n&gt; // unfortunately somehow the Object ma=\r\ny not be cast to the required&lt;BR&gt;\n&gt; // class &quot;DefaultGatewayController&quot;, or=\r\n even to its interface.&lt;BR&gt;\n&gt; // This is true whether the &quot;Constructor&quot; met=\r\nhod or the &quot;Method&quot;&lt;BR&gt;\n&gt; // method is used.  &lt;BR&gt;\n&gt; &lt;BR&gt;\n&gt;     if ( Defaul=\r\ntGatewayController.class.isInstance(o) ) {&lt;BR&gt;\n&gt;         // &quot;o&quot; may safely =\r\nbe cast as a &quot;DefaultGatewayController&quot;&lt;BR&gt;\n&gt;       System.out.println(&quot;YOW=\r\nSA&quot;);&lt;BR&gt;\n&gt;       ctlr =3D (DefaultGatewayController)o;&lt;BR&gt;\n&gt;     } else {&lt;=\r\nBR&gt;\n&gt;       System.out.println(&quot;OHNO&quot;);&lt;BR&gt;\n&gt;       System.out.println(&quot;Cla=\r\nss: &quot; + o.getClass().getName());&lt;BR&gt;\n&gt;     }&lt;BR&gt;\n&gt; [...]&lt;BR&gt;\n&gt; &lt;BR&gt;\n&gt; This =\r\nalways goes thru the &quot;OHNO&quot; branch, although the output&lt;BR&gt;\n&gt; of the class =\r\nname is what it should be to allow me to cast it.&lt;BR&gt;\n&gt; I&#39;m fairly new to J=\r\nUnit, and I&#39;m really new to custom Class&lt;BR&gt;\n&gt; Loaders, but it seems to me =\r\nthat this should work easily and&lt;BR&gt;\n&gt; well. [...]&lt;BR&gt;\n&lt;BR&gt;\n&lt;BR&gt;\n&lt;BR&gt;\n&lt;/tt&gt;=\r\n\n\n\n&lt;?---- LSpots keywords ?&gt;\n  &lt;?---- HM ADS ?&gt;\n  \n\n&lt;!-- |**|begin egp html=\r\n banner|**| --&gt;\n\n\n&lt;br&gt;\n  &lt;div style=3D&quot;text-align:center; color:#909090; wi=\r\ndth:500px;&quot;&gt;\n  &lt;hr style=3D&quot;border-bottom:1px; width:500px; text-align:left=\r\n;&quot;&gt;\n  &lt;tt&gt;YAHOO! GROUPS LINKS&lt;/tt&gt;\n&lt;/div&gt;\n&lt;br&gt;\n&lt;ul&gt;\n  &lt;tt&gt;&lt;li type=3Dsquare=\r\n&gt; Visit your group &quot;&lt;a href=3D&quot;http://groups.yahoo.com/group/junit&quot;&gt;junit&lt;/=\r\na&gt;&quot; on the web.&lt;br&gt; &lt;/tt&gt;\n  &lt;tt&gt;&lt;li type=3Dsquare&gt; To unsubscribe from this=\r\n group, send an email to:&lt;br&gt; &lt;a href=3D&quot;mailto:junit-unsubscribe@yahoogrou=\r\nps.com?subject=3DUnsubscribe&quot;&gt;junit-unsubscribe@yahoogroups.com&lt;/a&gt;&lt;br&gt; &lt;/t=\r\nt&gt;\n  &lt;tt&gt;&lt;li type=3Dsquare&gt; Your use of Yahoo! Groups is subject to the &lt;a =\r\nhref=3D&quot;http://docs.yahoo.com/info/terms/&quot;&gt;Yahoo! Terms of Service&lt;/a&gt;.&lt;/tt=\r\n&gt;\n&lt;/ul&gt;\n&lt;br&gt;\n&lt;div style=3D&quot;text-align:center; color:#909090; width:500px;&quot;&gt;=\r\n\n  &lt;hr style=3D&quot;border-bottom:1px; width:500px; text-align:left;&quot;&gt;\n&lt;/div&gt;\n&lt;=\r\n/br&gt;\n\n&lt;!-- |**|end egp html banner|**| --&gt;\n\n\n&lt;/body&gt;&lt;/html&gt;\n\n\n\n\n\n\n\n", 
    "profile": "raycclough", 
    "topicId": 14046, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 228922213, 
    "prevInTime": 14061, 
    "contentTrasformed": false, 
    "postDate": "1119976811", 
    "canDelete": false, 
    "nextInTopic": 14064, 
    "prevInTopic": 14053, 
    "headers": {
        "messageIdInHeader": "PDIwMDUwNjI4MTY0MDExLkNDQTg4OUU3QTBAd3M2LTIudXM0Lm91dGJsYXplLmNvbT4="
    }
}
{
    "numMessagesInTopic": 9, 
    "nextInTime": 22499, 
    "senderId": "LArmWDedXbuKSqsJokrzY-7XnGa649i6ustNIuYQy69noAjsQ7JHZ1FxuQBR4O7tG-OXPbiypbGnScFC4Z7--nNF", 
    "systemMessage": false, 
    "subject": "Re: [junit] [RT] JUnit Core, Parallelism, Documentation", 
    "from": "David Saff &lt;david@...&gt;", 
    "authorName": "David Saff", 
    "msgSnippet": "On Tue, Mar 2, 2010 at 12:47 PM, Loritsch, Berin C. ... That s very, very, in-progress code, currently very changed from the most recent release (4.8.1), and", 
    "msgId": 22498, 
    "rawEmail": "Return-Path: &lt;david.saff@...&gt;\r\nX-Sender: david.saff@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nX-Received: (qmail 23969 invoked from network); 3 Mar 2010 14:12:20 -0000\r\nX-Received: from unknown (98.137.34.46)\n  by m14.grp.re1.yahoo.com with QMQP; 3 Mar 2010 14:12:20 -0000\r\nX-Received: from unknown (HELO mail-pv0-f172.google.com) (74.125.83.172)\n  by mta3.grp.sp2.yahoo.com with SMTP; 3 Mar 2010 14:12:20 -0000\r\nX-Received: by pvg2 with SMTP id 2so401905pvg.17\n        for &lt;junit@yahoogroups.com&gt;; Wed, 03 Mar 2010 06:12:20 -0800 (PST)\r\nMIME-Version: 1.0\r\nX-Received: by 10.141.188.37 with SMTP id q37mr941386rvp.212.1267625540067; Wed, \n\t03 Mar 2010 06:12:20 -0800 (PST)\r\nIn-Reply-To: &lt;75F5ED8A5A553646A46E00E6EC854FA3044B99E4@...-ais.com&gt;\r\nReferences: &lt;75F5ED8A5A553646A46E00E6EC854FA3044B97F2@...-ais.com&gt;\n\t &lt;4f7da6b91003020631o6f820d27kb159770c9d7ca1ca@...&gt;\n\t &lt;75F5ED8A5A553646A46E00E6EC854FA3044B99E4@...-ais.com&gt;\r\nDate: Wed, 3 Mar 2010 09:12:20 -0500\r\nX-Google-Sender-Auth: 665391c608cf4175\r\nMessage-ID: &lt;4f7da6b91003030612s55107826o3113e7677cfbeab5@...&gt;\r\nTo: junit@yahoogroups.com\r\nContent-Type: text/plain; charset=ISO-8859-1\r\nContent-Transfer-Encoding: quoted-printable\r\nX-eGroups-Msg-Info: 1:12:0:0:0\r\nFrom: David Saff &lt;david@...&gt;\r\nSubject: Re: [junit] [RT] JUnit Core, Parallelism, Documentation\r\nX-Yahoo-Group-Post: member; u=341876227; y=K1rlFBIK4Th3Evd3a_gY-e4M0UJfmnvhE3GmotSRpQc\r\nX-Yahoo-Profile: dsaff\r\n\r\nOn Tue, Mar 2, 2010 at 12:47 PM, Loritsch, Berin C.\n&lt;berin.loritsch@gd-ais.=\r\ncom&gt; wrote:\n&gt; Well, getting to the core, it is not very clear what is the _=\r\ninternal_\n&gt; API and what is the _external_ API. =A0For something like JUnit=\r\n there are\n&gt; actually two external APIs to worry about:\n&gt;\n&gt;\n&gt;\n&gt; * =A0 =A0 =\r\n=A0 =A0 The API for Test Writers\n&gt;\n&gt; * =A0 =A0 =A0 =A0 The API for IDE/tool=\r\n writers\n&gt;\n&gt;\n&gt;\n&gt; The JavaDocs do have to be very clear on what is likely to=\r\n change, and\n&gt; what is meant to be stable. =A0This approach allows you to c=\r\nlean up cruft\n&gt; over time.\n&gt;\n&gt;\n&gt;\n&gt; The first misstep I saw was the move fro=\r\nm using the Description object\n&gt; to build the tree of tests to using a Plan=\r\n to build the tree of tests.\n&gt; The addChild() and getChildren() methods of =\r\nthe Description object are\n&gt; deprecated, yet JUnit creates the Plan from th=\r\ne description object. =A0I\n&gt; believe that the new direction of using a Plan=\r\n instead of a hierarchy of\n&gt; descriptions is the correct one from a concept=\r\nual standpoint.\n\nThat&#39;s very, very, in-progress code, currently very change=\r\nd from the\nmost recent release (4.8.1), and certain to change before the ne=\r\nxt\nrelease (4.9).  This particular point is more about recognizing that\nwit=\r\nh github, more people are probably watching HEAD, and we should\nconsider a =\r\ndevelopment branch, than anything to do with the\npublic/private APIs when a=\r\n release version does come out.\n\n&gt; The API for testers is pretty well under=\r\nstood, and I would be very\n&gt; resistant to arbitrarily changing that. =A0I t=\r\nhink most people would be as\n&gt; well.\n&gt;\n&gt;\n&gt;\n&gt; What is less understood is whe=\r\nre JUnit is designed to integrate with\n&gt; IDEs and tool vendors. =A0How much=\r\n of the Computer/Plan/Filtering/Ordering\n&gt; do we want to expose? =A0What ar=\r\ne we confident with? =A0The rest, as they\n&gt; say, making sure our internals =\r\nwork with that spec. =A0None of the\n&gt; internals should rely on deprecated f=\r\neatures. =A0Anything in the\n&gt; &quot;internal&quot; package should be considered, by d=\r\nefinition, internal. =A0That\n&gt; means anything in there that is deprecated s=\r\nhould be free to be removed.\n\nNo disagreement here.  As you see individual =\r\nsteps to take us in that\ndirection, please bring them to our attention.\n\n  =\r\n David Saff\n\n&gt;\n&gt;\n&gt;\n&gt; At least, this is how I&#39;ve evolved libraries before (I=\r\n&#39;ve worked on a\n&gt; few Apache projects in the past).\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt; From: junit=\r\n@yahoogroups.com [mailto:junit@yahoogroups.com] On Behalf Of\n&gt; David Saff\n&gt;=\r\n Sent: Tuesday, March 02, 2010 9:32 AM\n&gt; To: junit@yahoogroups.com\n&gt; Subjec=\r\nt: Re: [junit] [RT] JUnit Core, Parallelism, Documentation\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt; Beri=\r\nn,\n&gt;\n&gt; Thanks for this! I can&#39;t touch here on all of your ideas, so feel\n&gt; =\r\nfree to repeat any points you&#39;d like to prioritize in the discussion.\n&gt;\n&gt; W=\r\nith regard to deprecation, we&#39;ve definitely begun to feel the weight\n&gt; of t=\r\nhe old code, but have indeed felt that it&#39;s not clear whether\n&gt; being very =\r\naggressive would be in the best interests of users: thanks\n&gt; to the fact th=\r\nat many users of tools like Eclipse and Maven have their\n&gt; JUnit version au=\r\ntomatically updated without explicit intervention,\n&gt; it&#39;s easy to be the ca=\r\nuse of breaking something that&#39;s been working\n&gt; for years. That said, I thi=\r\nnk it is time for a little housecleaning.\n&gt; I&#39;ve mentioned to Kent that we =\r\nshould do a codesearch.google.com\n&gt; smackdown, and start kicking the least-=\r\nused public method or class\n&gt; &quot;off the island&quot; with each release.\n&gt;\n&gt; As yo=\r\nu mention, I think that the biggest obstacle to real parallelism\n&gt; is an re=\r\nplacement or enhancement of the BeforeClass/AfterClass idiom\n&gt; that is well=\r\n-defined outside of a single-threaded execution. As two\n&gt; examples, (1) it&#39;=\r\ns not well-defined whether a BeforeClass method\n&gt; should be able to be run =\r\nmore than once per test suite execution, (2)\n&gt; it&#39;s not well-defined whethe=\r\nr one class can correctly start before\n&gt; another class&#39;s AfterClass method =\r\nhas been called.\n&gt;\n&gt; David\n&gt;\n&gt; On Mon, Mar 1, 2010 at 5:17 PM, Loritsch, Be=\r\nrin C.\n&gt; &lt;berin.loritsch@... &lt;mailto:berin.loritsch%40gd-ais.com&gt; &gt; =\r\nwrote:\n&gt;&gt; RT =3D Random Thought. =A0It&#39;s a habit I picked up from Stefano M=\r\nazzocchi\n&gt;&gt; when I used to work with him on the Cocoon project. =A0Essentia=\r\nlly, it&#39;s\n&gt; a\n&gt;&gt; structured brain dump based on observations of the interna=\r\nls of a\n&gt;&gt; project (as such it is longer than most posts). =A0My apologies =\r\nif this\n&gt; is\n&gt;&gt; not the forum for this.\n&gt;&gt;\n&gt;&gt; =3D=3D Code Maintenance Thoug=\r\nhts =3D=3D\n&gt;&gt;\n&gt;&gt; I&#39;ve been going through some of the JUnit Core to add some=\r\n JavaDocs\n&gt;&gt; (it&#39;s in my forked copy if you want me to do a Push request), =\r\nand made\n&gt; a\n&gt;&gt; few observations. =A0I can definitely see how JUnit has beg=\r\nun to evolve\n&gt;&gt; over the years, and as is natural with a couple missteps al=\r\nong the\n&gt; way.\n&gt;&gt; It&#39;s hard to get rid of those missteps because some peopl=\r\ne may have\n&gt;&gt; extended them. =A0Some of the classes have been deprecated wi=\r\nth the\n&gt;&gt; promise that they would be removed in the next revision (as of 4.=\r\n4)\n&gt; and\n&gt;&gt; they are still there. =A0I&#39;m not saying that the current soluti=\r\non is a\n&gt;&gt; misstep, just that it is hard to separate the past ones from the=\r\n\n&gt; current\n&gt;&gt; preferred solution.\n&gt;&gt;\n&gt;&gt; Part of managing a codebase like th=\r\nis includes separating the public\n&gt; and\n&gt;&gt; private API. =A0Some of that has=\r\n been done with the &quot;internal&quot; package.\n&gt;&gt; There is no reason to worry abou=\r\nt deprecating classes and methods in\n&gt; the\n&gt;&gt; internal package because they=\r\n are not part of the public API. =A0But I\n&gt; did\n&gt;&gt; notice that when some cl=\r\nasses got moved, the old class in full was\n&gt; kept\n&gt;&gt; in the original locati=\r\non. =A0A low maintenance way of performing a move\n&gt;&gt; like that makes use of=\r\n inheritance. =A0Essentially the newer class is\n&gt;&gt; moved so there is one ma=\r\nintenance location, and the deprecated class\n&gt;&gt; extends the newer class. =\r\n=A0Kind of like how the JUnit4 runner provides\n&gt; a\n&gt;&gt; preferred alias to th=\r\ne BlockJUnit4Runner class.\n&gt;&gt;\n&gt;&gt; Part of the core includes a nice little ca=\r\nllback interface (the\n&gt;&gt; RunListener). =A0I imagine that a number of integr=\r\nations make good use\n&gt; of\n&gt;&gt; this little class. =A0However, with the implem=\r\nentation as it is\n&gt; currently\n&gt;&gt; written, the RunListener can affect the ru=\r\nn performance and\n&gt; parallelism\n&gt;&gt; available. =A0Essentially, the act of ca=\r\nlling a method is a synchronous\n&gt;&gt; function. =A0That means a poorly written=\r\n runner can detrimentally affect\n&gt;&gt; the performance of JUnit. =A0The one th=\r\nat is included with JUnit is\n&gt; pretty\n&gt;&gt; tame, doing the absolute minimum i=\r\nt has to do to track the test\n&gt;&gt; progress. =A0However, if your tests execut=\r\ne slower in an IDE than with\n&gt;&gt; JUnit alone, it&#39;s probably the RunListener =\r\nslowing things down.\n&gt;&gt;\n&gt;&gt; =3D=3D Parallelism Thoughts =3D=3D\n&gt;&gt;\n&gt;&gt; Some of=\r\n the architectural decisions in JUnit&#39;s core definitely reflect\n&gt;&gt; the sync=\r\nhronous nature that the tests were designed to be written. =A0I\n&gt;&gt; don&#39;t th=\r\nink there is going to be an easy solution to that problem,\n&gt;&gt; unless you st=\r\nick to a test class per thread model. =A0More on that a bit\n&gt;&gt; latter.\n&gt;&gt;\n&gt;=\r\n&gt; When designing for parallel execution of tests (the ParallelComputer\n&gt;&gt; h=\r\nints at this), you usually don&#39;t want an unbounded number of threads\n&gt; to\n&gt;=\r\n&gt; be executed in the system. =A0A fairly common approach to taming the\n&gt;&gt; t=\r\nhread/work apportioning beast is to use queues and worker threads.\n&gt;&gt; Essen=\r\ntially, each test (including the set up and tear down parts) gets\n&gt;&gt; pushed=\r\n on to the queue, while the executor pops it off on the other\n&gt; side\n&gt;&gt; in =\r\nanother process. =A0Essentially the relationship to executors to work\n&gt;&gt; qu=\r\neues depends on whatever rules you&#39;ve set up. =A0For JUnit a simple\n&gt;&gt; mapp=\r\ning of executors to the number of processors (cores) or some\n&gt;&gt; multiple of=\r\n that would be sufficient. =A0This model is closer to how JMS\n&gt;&gt; works with=\r\nout all the quality of service overhead. =A0As the executor\n&gt; runs\n&gt;&gt; the t=\r\nest, it sends notification objects to the notification queue.\n&gt;&gt; Using one =\r\nline of ASCII art, the process looks like this:\n&gt;&gt;\n&gt;&gt; Classes/Suite =3D=3D&gt;=\r\n Executor =3D=3D&gt; Notifier\n&gt;&gt;\n&gt;&gt; Each &quot;=3D=3D&gt;&quot; represents a queue. =A0The =\r\nnotification mechanism then\n&gt; becomes\n&gt;&gt; more like Swing events. =A0We coul=\r\nd even cheat and use an Java 5 enum\n&gt; for\n&gt;&gt; the types of events. =A0This p=\r\nrovides the same interface for all the\n&gt;&gt; events, and the convenience of an=\r\n enum for determining the type of\n&gt;&gt; event. =A0If we take this approach a s=\r\ntep further, if we substitute a\n&gt;&gt; PriorityQueue for the first queue, we ge=\r\nt a way to prefer some tests\n&gt;&gt; over others (e.g. using categories as a pri=\r\nority mechanism).\n&gt; Collecting\n&gt;&gt; the results in a separate thread than the=\r\ny are being executed protects\n&gt;&gt; the execution of tests from poorly written=\r\n listeners.\n&gt;&gt;\n&gt;&gt; We could go to a very fine level of detail (i.e. each ind=\r\nividual test)\n&gt;&gt; if it weren&#39;t for the class setup/tear down methods. =A0Th=\r\nose kind of\n&gt;&gt; tests would force some sort of ordering. =A0It&#39;s not entirel=\r\ny\n&gt; impossible,\n&gt;&gt; but does require more care.\n&gt;&gt;\n&gt;&gt; Such an approach may b=\r\ne over-engineering things a bit, and for short\n&gt;&gt; runs of a couple hundred =\r\ntests that takes less than a second to run\n&gt;&gt; definitely overkill. =A0Howev=\r\ner for larger projects with much larger\n&gt;&gt; execution times, it may be a way=\r\n to short circuit the execution a bit.\n&gt;&gt; Essentially the win here would be=\r\n the ability to execute tests while\n&gt;&gt; they are still being parsed and prep=\r\nared. =A0That can help with things\n&gt;&gt; like Theories where collecting a larg=\r\ne number of DataPoints can have a\n&gt;&gt; profound impact on the time it takes t=\r\no run.\n&gt;&gt;\n&gt;&gt; It would be pretty easy to ensure that no more than n+2 thread=\r\ns are\n&gt; used\n&gt;&gt; in a system, where n =3D Runtime.availableProcessors().\n&gt;&gt;\n=\r\n&gt;&gt;\n&gt;&gt; [Non-text portions of this message have been removed]\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt; ---=\r\n---------------------------------\n&gt;&gt;\n&gt;&gt; Yahoo! Groups Links\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;&gt;\n&gt;\n&gt;=\r\n\n&gt;\n&gt;\n&gt;\n&gt; [Non-text portions of this message have been removed]\n&gt;\n&gt;\n&gt;\n&gt; ----=\r\n--------------------------------\n&gt;\n&gt; Yahoo! Groups Links\n&gt;\n&gt;\n&gt;\n&gt;\n\n", 
    "profile": "dsaff", 
    "topicId": 22487, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 341876227, 
    "prevInTime": 22497, 
    "contentTrasformed": false, 
    "postDate": "1267625540", 
    "canDelete": false, 
    "nextInTopic": 0, 
    "prevInTopic": 22497, 
    "headers": {
        "inReplyToHeader": "PDc1RjVFRDhBNUE1NTM2NDZBNDZFMDBFNkVDODU0RkEzMDQ0Qjk5RTRAdmFmZjAxLW1haWwwMS5hZC5nZC1haXMuY29tPg==", 
        "messageIdInHeader": "PDRmN2RhNmI5MTAwMzAzMDYxMnM1NTEwNzgyNm8zMTEzZTc2NzdjZmJlYWI1QG1haWwuZ21haWwuY29tPg==", 
        "referencesHeader": "PDc1RjVFRDhBNUE1NTM2NDZBNDZFMDBFNkVDODU0RkEzMDQ0Qjk3RjJAdmFmZjAxLW1haWwwMS5hZC5nZC1haXMuY29tPgkgPDRmN2RhNmI5MTAwMzAyMDYzMW82ZjgyMGQyN2tiMTU5NzcwYzlkN2NhMWNhQG1haWwuZ21haWwuY29tPgkgPDc1RjVFRDhBNUE1NTM2NDZBNDZFMDBFNkVDODU0RkEzMDQ0Qjk5RTRAdmFmZjAxLW1haWwwMS5hZC5nZC1haXMuY29tPg=="
    }
}
{
    "numMessagesInTopic": 30, 
    "nextInTime": 24307, 
    "senderId": "D2aEucO0P5KCadO13z4rETG4iZc5IIPY55jNXXcW23CLSCaN3nE4NljjlH9XT8T655Ae-GoR3NlM5kEh1xpt29Yp8bPd4VfX", 
    "systemMessage": false, 
    "subject": "Re: [junit] Re: Feedback requested: Impending changes to RunListener", 
    "from": "Kevin Cooney &lt;kcooney@...&gt;", 
    "authorName": "Kevin Cooney", 
    "msgSnippet": "... The JSR-305 ThreadSafe annotation appears to have @Retention(RetentionPolicy.CLASS): ", 
    "msgId": 24306, 
    "profile": "kevincooney2000", 
    "topicId": 24274, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 475263748, 
    "messageBody": "<div id=\"ygrps-yiv-439736678\">On Tue, Feb 12, 2013 at 12:46 AM, sschroev &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:stephan202@...\">stephan202@...</a>&gt; wrote:<br/>\n<br/>\n<blockquote><span title=\"ireply\"> &gt; **<br/>\n&gt;<br/>\n&gt;<br/>\n&gt; At the risk of repeating myself: my only objection is with the package in<br/>\n&gt; which said annotation resides: net.jcip.annotations instead of<br/>\n&gt; javax.annotation.concurrent.<br/>\n&gt;<br/>\n </span></blockquote>The JSR-305 ThreadSafe annotation appears to have<br/>\n@Retention(RetentionPolicy.CLASS):<br/>\n<br/>\n<a rel=\"nofollow\" target=\"_blank\" href=\"https://code.google.com/p/jsr-305/source/browse/trunk/ri/src/main/java/javax/annotation/concurrent/ThreadSafe.java\">https://code.google.com/p/jsr-305/source/browse/trunk/ri/src/main/java/javax/annotation/concurrent/ThreadSafe.java</a><br/>\n<br/>\nDo you see something different in your version?<br/>\n<br/>\nHaving RetentionPolicy.CLASS means it can only be read via bytecode-level<br/>\npost-processing, not via reflection:<br/>\n<br/>\n<a rel=\"nofollow\" target=\"_blank\" href=\"http://stackoverflow.com/questions/3107970/annotations-retention-policy\">http://stackoverflow.com/questions/3107970/annotations-retention-policy</a><br/>\n<br/>\n<br/>\n<blockquote><span title=\"ireply\"> &gt; But that argument can also be made in reverse. Hence my suggestion to<br/>\n&gt; inspect the annotation&#39;s simple name only.<br/>\n&gt;<br/>\n </span></blockquote>That would only work if the retention policy for your ThreadSafe annotation<br/>\nwas &quot;RUNTIME&quot;. So if we went with this approach, we would risk someone<br/>\nmaking a change that they believe will allow their runner to be called<br/>\nconcurrently but would still result in the calls to their runner<br/>\nbeing synchronized.<br/>\n<br/>\n-- Kevin<br/>\n<br/>\nThat also makes the licencing discussion mood, unless one wishes to depend<br/>\n<blockquote><span title=\"ireply\"> &gt; on jcip-annotation to provide a &quot;default&quot; or &quot;preferred&quot; version of the<br/>\n&gt; annotation. That&#39;s fine of course. :) Though then do please mark the<br/>\n&gt; dependency : otherwise I have to start explicitly excluding it (I derive my<br/>\n&gt; annotations from one of the FindBugs modules mentioned in an earlier email;<br/>\n&gt; no need to duplicate classes on the classpath).<br/>\n&gt;<br/>\n&gt; Cheers,<br/>\n&gt; Stephan<br/>\n&gt;<br/>\n&gt;<br/>\n&gt; --- In <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>, &quot;tibord47&quot; wrote:<br/>\n&gt; &gt;<br/>\n&gt; &gt; Hi all junit guys,<br/>\n&gt; &gt;<br/>\n&gt; &gt; Let me turn back to the original problem.<br/>\n&gt; &gt;<br/>\n&gt; &gt; We knew that it&#39;s a good idea to let the users to annotated a custom<br/>\n&gt; listener by @ThreadSafe if it&#39;s really thread-safe.<br/>\n&gt; &gt;<br/>\n&gt; &gt; In every other case the given listener is wrapped in synchronized<br/>\n&gt; listener which is package private class.<br/>\n&gt; &gt;<br/>\n&gt; &gt; I am convinced that we should not make synchronized listener public<br/>\n&gt; since this is our internal patch.<br/>\n&gt; &gt;<br/>\n&gt; &gt; The user may have whatever thread-safe listener depending on<br/>\n&gt; implementation and still not having it synchronized. Thus s/he can<br/>\n&gt; annotated the clas by @ThreadSafe.<br/>\n&gt; &gt; We are synchronizing the listener&#39;s methods internally in the patch only<br/>\n&gt; because the user&#39;s implementation is unknown -listener in not annotated yet.<br/>\n&gt; &gt;<br/>\n&gt; &gt; Back to jcip-annotations license. Such library is under Creative Commons<br/>\n&gt; Attribution License (<a rel=\"nofollow\" target=\"_blank\" href=\"http://creativecommons.org/licenses/by/2.5)\">http://creativecommons.org/licenses/by/2.5)</a>.<br/>\n&gt; &gt;<br/>\n&gt; &gt; If we use Maven dependency, we are free to share, distribute and<br/>\n&gt; transmit.<br/>\n&gt; &gt; So there is no legal issue for the JUnit.<br/>\n&gt; &gt;<br/>\n&gt; &gt; Any objections to this lincense?<br/>\n&gt; &gt;<br/>\n&gt; &gt; Thx, Tibor<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt; --- In <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>, &quot;sschroev&quot; wrote:<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; I understand your concerns w.r.t. the intended semantics of<br/>\n&gt; third-party @ThreadSafe annotations. For that reason I could certainly get<br/>\n&gt; behind a differently-named annotation such as @Concurrent. Adding one more<br/>\n&gt; annotation is cheap, after all ;)<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; Cheers,<br/>\n&gt; &gt; &gt; Stephan<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; --- In <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>, Kevin Cooney wrote:<br/>\n&gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; On Wed, Feb 6, 2013 at 10:06 AM, sschroev wrote:<br/>\n&gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; **<br/>\n&gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; I like the idea, a lot!<br/>\n&gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; But would like to ask that only the *simple name* of the<br/>\n&gt; annotation is<br/>\n&gt; &gt; &gt; &gt; &gt; considered, without regard for the package in which it resides.<br/>\n&gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; Interesting idea.<br/>\n&gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; It looks like Guice uses this strategy for @Nullable (<br/>\n&gt; &gt; &gt; &gt; <a rel=\"nofollow\" target=\"_blank\" href=\"https://code.google.com/p/google-guice/wiki/UseNullable)\">https://code.google.com/p/google-guice/wiki/UseNullable)</a><br/>\n&gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; That would require us to iterate through all of the class&#39;s<br/>\n&gt; annotations, vs<br/>\n&gt; &gt; &gt; &gt; a simple getAnnotation() call, but listeners are not added and<br/>\n&gt; removed very<br/>\n&gt; &gt; &gt; &gt; often.<br/>\n&gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; This way one can:<br/>\n&gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; 1. Use an alternative third-party annotation, such as<br/>\n&gt; &gt; &gt; &gt; &gt; javax.annotation.concurrent.ThreadSafe from libraries like<br/>\n&gt; &gt; &gt; &gt; &gt; com.google.code.findbugs:jsr305:1.3.9 and<br/>\n&gt; &gt; &gt; &gt; &gt; com.google.code.findbugs:annotations:2.0.1.<br/>\n&gt; &gt; &gt; &gt; &gt; 2. Define a private annotation, without adding _any_ additional<br/>\n&gt; dependency.<br/>\n&gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; Alternatively, we could add a JUnit-specific annotation (possibly<br/>\n&gt; named<br/>\n&gt; &gt; &gt; &gt; &quot;Concurrent&quot;) and you could annotate your class with both<br/>\n&gt; annotations (ob<br/>\n&gt; &gt; &gt; &gt; meme: <a rel=\"nofollow\" target=\"_blank\" href=\"http://www.quickmeme.com/meme/3svo5h/)\">http://www.quickmeme.com/meme/3svo5h/)</a><br/>\n&gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; One reservation I have with using @ThreadSafe is that usually the<br/>\n&gt; &gt; &gt; &gt; jcip-annotations documents behavior (sure, it is used by findbugs to<br/>\n&gt; find<br/>\n&gt; &gt; &gt; &gt; potential bugs, but that&#39;s validation based on behavior documented in<br/>\n&gt; &gt; &gt; &gt; annotations). Here we are proposing using @ThreadSafe to modify<br/>\n&gt; behavior.<br/>\n&gt; &gt; &gt; &gt; Someone might not expect by simply adding an annotation to a class<br/>\n&gt; they are<br/>\n&gt; &gt; &gt; &gt; changing the behavior of code that uses instances of the class.<br/>\n&gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; I use javax.annotation.concurrent.ThreadSafe quite a lot in my own<br/>\n&gt; code,<br/>\n&gt; &gt; &gt; &gt; &gt; so (1) is quite important from my perspective. There are<br/>\n&gt; precedents for<br/>\n&gt; &gt; &gt; &gt; &gt; this approach: IIRC, Eclipse does something like this for<br/>\n&gt; variations on<br/>\n&gt; &gt; &gt; &gt; &gt; @Nullable and @Nonnull, whereas (again, IIRC) Findbugs handles two<br/>\n&gt; &gt; &gt; &gt; &gt; instances of @SuppressWarnings.<br/>\n&gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; Cheers,<br/>\n&gt; &gt; &gt; &gt; &gt; Stephan<br/>\n&gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; --- In <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>, Kevin Cooney wrote:<br/>\n&gt; &gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; Hello, everyone<br/>\n&gt; &gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; Short version: we are thinking of adding an optional dependency<br/>\n&gt; from<br/>\n&gt; &gt; &gt; &gt; &gt; JUnit<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; to jcip-annotations and are soliciting feedback.<br/>\n&gt; &gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; A few people have noticed that when you use ParallelComputer,<br/>\n&gt; you got<br/>\n&gt; &gt; &gt; &gt; &gt; poor<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; performance because calls to registered RunListeners are<br/>\n&gt; synchronized. We<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; would like to fix this in the next release of JUnit.<br/>\n&gt; &gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; In order to prevent affecting existing users, we are proposing<br/>\n&gt; having an<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; annotation that can be added to RunListener implementations that<br/>\n&gt; can<br/>\n&gt; &gt; &gt; &gt; &gt; safely<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; be called concurrently from multiple threads. If a RunListener<br/>\n&gt; passed to<br/>\n&gt; &gt; &gt; &gt; &gt; a<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; RunNotifier is not annotated with this annotation, JUnit will<br/>\n&gt; wrap it<br/>\n&gt; &gt; &gt; &gt; &gt; with<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; a decorator that does synchronization.<br/>\n&gt; &gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; We would appreciate feedback on this new annotation.<br/>\n&gt; &gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; We have two options:<br/>\n&gt; &gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; a. Create our own annotation for this<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; b. Use ThreadSafe (<br/>\n&gt; &gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt;<br/>\n&gt; <a rel=\"nofollow\" target=\"_blank\" href=\"http://grepcode.com/file/repo1.maven.org/maven2/net.jcip/jcip-annotations/1.0/net/jcip/annotations/ThreadSafe.java\">http://grepcode.com/file/repo1.maven.org/maven2/net.jcip/jcip-annotations/1.0/net/jcip/annotations/ThreadSafe.java</a><br/>\n&gt; &gt; &gt; &gt; &gt; &gt; )<br/>\n&gt; &gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; The advantages to option b are:<br/>\n&gt; &gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; 1. It&#39;s a well-known annotation<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; 2. Users that use JUnit can add this annotation to their<br/>\n&gt; thread-safe<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; RunListener implementations today and get the benefits &quot;for<br/>\n&gt; free&quot; later.<br/>\n&gt; &gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; Note we can do this without requiring that all users of JUnit<br/>\n&gt; have the<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; jcip-annotations jar in their classpath as of JDK 1.5.0_06 (see<br/>\n&gt; &gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt;<br/>\n&gt; <a rel=\"nofollow\" target=\"_blank\" href=\"http://stackoverflow.com/questions/3567413/why-doesnt-a-missing-annotation-cause-a-classnotfoundexception-at-runtime\">http://stackoverflow.com/questions/3567413/why-doesnt-a-missing-annotation-cause-a-classnotfoundexception-at-runtime</a><br/>\n&gt; &gt; &gt; &gt; &gt; ).<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; If jcip-annotations is not on the classpath then all RunListener<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; implementations will be treated as not thread-safe.<br/>\n&gt; &gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; As a specific example, the Maven Surefire plugin would use this<br/>\n&gt; &gt; &gt; &gt; &gt; dependency<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; and include jcip-annotations.<br/>\n&gt; &gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; Currently, JUnit only depends on one third-party library<br/>\n&gt; (Hamcrest). This<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; has caused us some pain in the past when the Hamcrest code<br/>\n&gt; changed in<br/>\n&gt; &gt; &gt; &gt; &gt; ways<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; that broke existing users of JUnit. We believe this will not be<br/>\n&gt; an issue<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; with jcip-annotations because the JAR only contains annotations,<br/>\n&gt; not any<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; code.<br/>\n&gt; &gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; One possible concern would be with other open source libraries<br/>\n&gt; that<br/>\n&gt; &gt; &gt; &gt; &gt; provide<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; RunListener implementations (they would need to add<br/>\n&gt; jcip-annotations to<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; their compile-time classpath if they have thread-safe<br/>\n&gt; annotations, and<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; document this to their users).<br/>\n&gt; &gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; Thoughts?<br/>\n&gt; &gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; -- Kevin<br/>\n&gt; &gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; &gt; [Non-text portions of this message have been removed]<br/>\n&gt; &gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; [Non-text portions of this message have been removed]<br/>\n&gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt;<br/>\n&gt;  <br/>\n&gt;<br/>\n<br/>\n<br/>\n </span></blockquote>[Non-text portions of this message have been removed]</div>", 
    "prevInTime": 24305, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1360693569", 
    "canDelete": false, 
    "nextInTopic": 24313, 
    "prevInTopic": 24305, 
    "headers": {
        "inReplyToHeader": "PGtmY3ZocCtkNHIxQGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PENBQTNFK2VYNk1WPW9aUVZiWGppbVdWb3NaY0R6ekVDd1Y9NVFVRytwTUxLN1dYeENZQUBtYWlsLmdtYWlsLmNvbT4=", 
        "referencesHeader": "PGtmY3ZocCtkNHIxQGVHcm91cHMuY29tPg=="
    }
}
{
    "numMessagesInTopic": 1, 
    "nextInTime": 12572, 
    "senderId": "ZTnzNQuPmm_2pj87xmcP-KzCoymN02tEwCOYRCFDYZoPTm1FgJOdhjEeXw-7HDWIHtX1mY8yJGqQn91GCu33FtYor3kCr3XBAzE4RaYS23fv", 
    "systemMessage": true, 
    "subject": "Java Imaging Error , please help", 
    "from": "&quot;Juliana  Lewis&quot; &lt;juliana_lewis@...&gt;", 
    "authorName": "Juliana  Lewis", 
    "msgSnippet": "hello there. I am working on image processing in Java. I was writing a simple application which can gray-scale an image, sharpen it , blur it, invert its", 
    "msgId": 12571, 
    "rawEmail": "Return-Path: &lt;juliana_lewis@...&gt;\r\nReceived: (qmail 13359 invoked from network); 3 Jan 2005 14:12:22 -0000\r\nReceived: from unknown (66.218.66.218)\n  by m6.grp.scd.yahoo.com with QMQP; 3 Jan 2005 14:12:22 -0000\r\nReceived: from unknown (HELO n16a.bulk.scd.yahoo.com) (66.94.237.45)\n  by mta3.grp.scd.yahoo.com with SMTP; 3 Jan 2005 14:12:21 -0000\r\nReceived: from [66.218.66.58] by n16.bulk.scd.yahoo.com with NNFMP; 03 Jan 2005 14:12:09 -0000\r\nReceived: from [66.218.67.149] by mailer7.bulk.scd.yahoo.com with NNFMP; 03 Jan 2005 14:12:09 -0000\r\nX-Sender: juliana_lewis@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (qmail 94129 invoked from network); 1 Jan 2005 16:22:30 -0000\r\nReceived: from unknown (66.218.66.217)\n  by m18.grp.scd.yahoo.com with QMQP; 1 Jan 2005 16:22:30 -0000\r\nReceived: from unknown (HELO n3a.bulk.scd.yahoo.com) (66.94.237.37)\n  by mta2.grp.scd.yahoo.com with SMTP; 1 Jan 2005 16:22:30 -0000\r\nReceived: from [66.218.69.3] by n3.bulk.scd.yahoo.com with NNFMP; 01 Jan 2005 16:22:30 -0000\r\nReceived: from [66.218.67.164] by mailer3.bulk.scd.yahoo.com with NNFMP; 01 Jan 2005 16:22:29 -0000\r\nDate: Sat, 01 Jan 2005 16:22:27 -0000\r\nTo: junit@yahoogroups.com\r\nMessage-ID: &lt;cr6io3+slbv@...&gt;\r\nUser-Agent: eGroups-EW/0.82\r\nMIME-Version: 1.0\r\nContent-Type: text/plain; charset=ISO-8859-1\r\nContent-Length: 8651\r\nX-Mailer: Yahoo Groups Message Poster\r\nX-Yahoo-Newman-Property: groups-system\r\nX-eGroups-Remote-IP: 66.94.237.37\r\nFrom: &quot;Juliana  Lewis&quot; &lt;juliana_lewis@...&gt;\r\nSubject: Java Imaging Error , please help\r\nX-Yahoo-Group-Post: member; u=120719883\r\nX-Yahoo-Profile: juliana_lewis\r\nX-eGroups-Approved-By: nails762 &lt;jbrains@...&gt; via web; 03 Jan 2005 14:12:05 -0000\r\nX-eGroups-Remote-IP: 66.94.237.45\r\n\r\n\n\nhello there.\nI am working on image processing in Java. I was writing a \nsimple application which can gray-scale an image, sharpen\nit , blur it, invert its colors.\n\nNow i&#39;ve writting the following code to accomplish the following\ntask. I used simple java.awt.image class to write the convolution\nfilter, instead of using java ConvolveOp operator, to clarify the\nconcepts but now it gives me the error which is\n\n&quot;Array index out of bounds Exception&quot; and IndexColorModel sort of\nerror, can someone please help me, i am posting the code with it.\n\nlisting 1\n/*\n * &lt;applet code=ImageFilterDemo width=350 height=450&gt;\n * &lt;param name=img value=vincent.jpg&gt;\n * &lt;param name=filters value=&quot;Grayscale+Invert+Contrast+Blur+Sharpen&quot;&gt;\n * &lt;/applet&gt;\n */\nimport java.applet.*;\nimport java.awt.*;\nimport java.awt.event.*;\nimport java.util.*;\n\npublic class ImageFilterDemo extends Applet implements ActionListener {\n  Image img;\n  PlugInFilter pif;\n  Image fimg;\n  Image curImg;\n  LoadedImage lim;\n  Label lab;\n  Button reset;\n\n  public void init() {\n    setLayout(new BorderLayout());\n    Panel p = new Panel();\n    add(p, BorderLayout.SOUTH);\n    reset = new Button(&quot;Reset&quot;);\n    reset.addActionListener(this);\n    p.add(reset);\n    StringTokenizer st = new StringTokenizer(getParameter(&quot;filters&quot;),\n&quot;+&quot;);\n    while(st.hasMoreTokens()) {\n      Button b = new Button(st.nextToken());\n      b.addActionListener(this);\n      p.add(b);\n    }\n    \n    lab = new Label(&quot;&quot;);\n    add(lab, BorderLayout.NORTH);\n\n    img = getImage(getDocumentBase(), getParameter(&quot;img&quot;));\n    lim = new LoadedImage(img);\n    add(lim, BorderLayout.CENTER);\n   \n  }\n\n  public void actionPerformed(ActionEvent ae) {\n    String a = &quot;&quot;;\n\n    try {\n      a = (String)ae.getActionCommand();\n      if (a.equals(&quot;Reset&quot;)) {\n        lim.set(img);\n        lab.setText(&quot;Normal&quot;);\n      }\n      else {\n        pif = (PlugInFilter) Class.forName(a).newInstance();\n        fimg = pif.filter(this, img);\n        lim.set(fimg);\n        lab.setText(&quot;Filtered: &quot; + a);\n      }\n      repaint();\n    } catch (ClassNotFoundException e) {\n      lab.setText(a + &quot; not found&quot;);\n      lim.set(img);\n      repaint();\n    } catch (InstantiationException e) {\n      lab.setText(&quot;could&#39;t new &quot; + a);\n    } catch (IllegalAccessException e) {\n      lab.setText(&quot;no access: &quot; + a);\n    }\n  }\n}\n\nlisting 2\ninterface PlugInFilter {\n  java.awt.Image filter(java.applet.Applet a, java.awt.Image in);\n}\n\nlisting 3\nimport java.awt.*;\n\npublic class LoadedImage extends Canvas {\n  Image img;\n\n  public LoadedImage(Image i) {\n    set(i);\n  }\n\n  void set(Image i) {\n    MediaTracker mt = new MediaTracker(this);\n    mt.addImage(i, 0);\n    try {\n      mt.waitForAll();\n    } catch (InterruptedException e) { };\n    img = i;\n    repaint();\n  }\n  \n  public void paint(Graphics g) {\n    if (img == null) {\n      g.drawString(&quot;no image&quot;, 10, 30);\n    } else {\n      g.drawImage(img, 0, 0, this);\n    } \n  }\n\n  public Dimension getPreferredSize()  {\n    return new Dimension(img.getWidth(this), img.getHeight(this));\n  }\n  \n  public Dimension getMinimumSize()  {\n    return getPreferredSize();\n  }\n}\n\nlisting 4\nimport java.applet.*;\nimport java.awt.*;\nimport java.awt.image.*;\n\nclass Grayscale extends RGBImageFilter implements PlugInFilter {\n  public Image filter(Applet a, Image in) {\n    return a.createImage(new FilteredImageSource(in.getSource(), this));\n  }\n\n  public int filterRGB(int x, int y, int rgb) {\n    int r = (rgb &gt;&gt; 16) & 0xff;\n    int g = (rgb &gt;&gt; 8) & 0xff;\n    int b = rgb & 0xff;\n    int k = (int) (.56 * g + .33 * r + .11 * b);\n    return (0xff000000 | k &lt;&lt; 16 | k &lt;&lt; 8 | k);\n  }\n}\n\nlisting 5\nimport java.applet.*;\nimport java.awt.*;\nimport java.awt.image.*;\n\nclass Invert extends RGBImageFilter implements PlugInFilter {\n  public Image filter(Applet a, Image in) {\n    return a.createImage(new FilteredImageSource(in.getSource(), this));\n  }\n  public int filterRGB(int x, int y, int rgb) {\n    int r = 0xff - (rgb &gt;&gt; 16) & 0xff;\n    int g = 0xff - (rgb &gt;&gt; 8) & 0xff;\n    int b = 0xff - rgb & 0xff;\n    return (0xff000000 | r &lt;&lt; 16 | g &lt;&lt; 8 | b);\n  }\n}\n\nlisting 6\nimport java.applet.*;\nimport java.awt.*;\nimport java.awt.image.*;\n\npublic class Contrast extends RGBImageFilter implements PlugInFilter {\n\n  public Image filter(Applet a, Image in) {\n    return a.createImage(new FilteredImageSource(in.getSource(), this));\n  }\n\n  private int multclamp(int in, double factor) {\n    in = (int) (in * factor);\n    return in &gt; 255 ? 255 : in;\n  }\n\n  double gain = 1.2;\n  private int cont(int in) {\n    return (in &lt; 128) ? (int)(in/gain) : multclamp(in, gain);\n  }\n\n  public int filterRGB(int x, int y, int rgb) {\n    int r = cont((rgb &gt;&gt; 16) & 0xff);\n    int g = cont((rgb &gt;&gt; 8) & 0xff);\n    int b = cont(rgb & 0xff);\n    return (0xff000000 | r &lt;&lt; 16 | g &lt;&lt; 8 | b);\n  }\n}\n\nlisting 7\nimport java.applet.*;\nimport java.awt.*;\nimport java.awt.image.*;\n\nabstract class Convolver implements ImageConsumer, PlugInFilter {\n  int width, height;\n  int imgpixels[], newimgpixels[];\n\n  abstract void convolve();  // filter goes here...\n  \n  public Image filter(Applet a, Image in) {\n    in.getSource().startProduction(this);\n    waitForImage();\n    newimgpixels = new int[width*height];\n\n    try {\n      convolve();\n    } catch (Exception e) {\n      System.out.println(&quot;Convolver failed: &quot; + e);\n      e.printStackTrace();\n    }\n\n    return a.createImage(\n      new MemoryImageSource(width, height, newimgpixels, 0, width));\n  }\n\n  synchronized void waitForImage() {\n    try { wait(); } catch (Exception e) { };\n  }\n\n  public void setProperties(java.util.Hashtable dummy) { }\n  public void setColorModel(ColorModel dummy) { }\n  public void setHints(int dummy) { }\n\n  public synchronized void imageComplete(int dummy) {\n    notifyAll();\n  }\n\n  public void setDimensions(int x, int y) {\n    width = x;\n    height = y;\n    imgpixels = new int[x*y];\n  }\n\n  public void setPixels(int x1, int y1, int w, int h, \n    ColorModel model, byte pixels[], int off, int scansize) {\n    int pix, x, y, x2, y2, sx, sy;\n\n    x2 = x1+w;\n    y2 = y1+h;\n    sy = off;\n    for(y=y1; y&lt;y2; y++) {\n      sx = sy;\n      for(x=x1; x&lt;x2; x++) {\n        pix = model.getRGB(pixels[sx++]);\n        if((pix & 0xff000000) == 0)\n            pix = 0x00ffffff;\n        imgpixels[y*width+x] = pix;\n      }\n      sy += scansize;\n    }\n  }\n\n  public void setPixels(int x1, int y1, int w, int h, \n    ColorModel model, int pixels[], int off, int scansize) {\n    int pix, x, y, x2, y2, sx, sy;\n\n    x2 = x1+w;\n    y2 = y1+h;\n    sy = off;\n    for(y=y1; y&lt;y2; y++) {\n      sx = sy;\n      for(x=x1; x&lt;x2; x++) {\n        pix = model.getRGB(pixels[sx++]);\n        if((pix & 0xff000000) == 0)\n            pix = 0x00ffffff;\n        imgpixels[y*width+x] = pix;\n      }\n      sy += scansize;\n    }\n  }\n}\n\nlisting 8\npublic class Blur extends Convolver {\n  public void convolve() {\n    for(int y=1; y&lt;height-1; y++) {\n      for(int x=1; x&lt;width-1; x++) {\n        int rs = 0;\n        int gs = 0;\n        int bs = 0;\n\n        for(int k=-1; k&lt;=1; k++) {\n          for(int j=-1; j&lt;=1; j++) {\n            int rgb = imgpixels[(y+k)*width+x+j];\n            int r = (rgb &gt;&gt; 16) & 0xff;\n            int g = (rgb &gt;&gt; 8) & 0xff;\n            int b = rgb & 0xff;\n            rs += r;\n            gs += g;\n            bs += b;\n          }\n        }\n\n        rs /= 9;\n        gs /= 9;\n        bs /= 9;\n\n       newimgpixels[y*width+x] = (0xff000000 |\n                                 rs &lt;&lt; 16 | gs &lt;&lt; 8 | bs);\n      }\n    }\n  }\n}\n\nlisting 9\npublic class Sharpen extends Convolver {\n\n  private final int clamp(int c) {\n    return (c &gt; 255 ? 255 : (c &lt; 0 ? 0 : c));\n  }\n\n  public void convolve() {\n    int r0=0, g0=0, b0=0;\n    for(int y=1; y&lt;height-1; y++) {\n      for(int x=1; x&lt;width-1; x++) {\n        int rs = 0;\n        int gs = 0;\n        int bs = 0;\n\n        for(int k=-1; k&lt;=1; k++) {\n          for(int j=-1; j&lt;=1; j++) {\n            int rgb = imgpixels[(y+k)*width+x+j];\n            int r = (rgb &gt;&gt; 16) & 0xff;\n            int g = (rgb &gt;&gt; 8) & 0xff;\n            int b = rgb & 0xff;\n            if (j == 0 && k == 0) {\n              r0 = r;\n              g0 = g;\n              b0 = b;\n            } else {\n              rs += r;\n              gs += g;\n              bs += b;\n            }\n          }\n        }\n\n        rs &gt;&gt;= 3;\n        gs &gt;&gt;= 3;\n        bs &gt;&gt;= 3;\n        newimgpixels[y*width+x] = (0xff000000 |\n                                clamp(r0+r0-rs) &lt;&lt; 16 |\n                                clamp(g0+g0-gs) &lt;&lt; 8 |\n                                clamp(b0+b0-bs));\n      }\n    }\n  }\n}\n\nThe error is coming in the Convolver class, please help me\nout with it. I would be obliged.\nRegards,\nJules\n\n\n\n\n\n\n\n", 
    "profile": "juliana_lewis", 
    "topicId": 12571, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 120719883, 
    "prevInTime": 12570, 
    "contentTrasformed": false, 
    "postDate": "1104596547", 
    "canDelete": false, 
    "nextInTopic": 0, 
    "prevInTopic": 0, 
    "headers": {
        "messageIdInHeader": "PGNyNmlvMytzbGJ2QGVHcm91cHMuY29tPg=="
    }
}
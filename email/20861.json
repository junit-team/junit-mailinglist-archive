{
    "numMessagesInTopic": 2, 
    "nextInTime": 20862, 
    "senderId": "au73h8qucH-K0duIR-0bh_pTRK7PgVvCA-16_nmyXjKrXMkE_1hMSce0_FPlQFxlaZ80TXwrTmr-QO9mXiigP0ghGoTXBb_qfX_y", 
    "systemMessage": true, 
    "subject": "not able to run the junit please help", 
    "from": "Sushil Dodake &lt;sushil_d10@...&gt;", 
    "authorName": "Sushil Dodake", 
    "msgSnippet": "Hi guys... i am trying to write a junit test class for the class which uses the ldap template. i am confued as i cant solve this. can sombody help me here i a", 
    "msgId": 20861, 
    "profile": "sushil_d10", 
    "topicId": 20861, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 78024148, 
    "messageBody": "<div id=\"ygrps-yiv-2062593817\">Hi guys...<br/>\ni am trying to write a junit test class for the class which uses the ldap template.<br/>\ni am confued as i cant solve this.<br/>\ncan sombody help me here<br/>\ni a posting my original calss and the test class.<br/>\nthe exception i m getting is as below<br/>\n<br/>\nwhen i debugged the stuff i found out that the ContextSource is not se in the MOCKed LDAP template object. i tried setting it.<br/>\ni m new to writing the junit test class.<br/>\ni dont know if i am missing anything here.<br/>\n<br/>\n<br/>\ncom.XXX.YYY.reporting.exception.ReportingException: Error getting distributor info from LDAP<br/>\n\tat com.XXX.YYY.reporting.dao.LdapDaoImpl.getAllActiveDomesticDistributor(LdapDaoImpl.java:52)<br/>\n\tat com.XXX.YYY.reporting.dao.LdapDaoImplTest.testGetAllActiveDomesticDistributor(LdapDaoImplTest.java:43)<br/>\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br/>\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)<br/>\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)<br/>\n\tat java.lang.reflect.Method.invoke(Method.java:597)<br/>\n\tat junit.framework.TestCase.runTest(TestCase.java:154)<br/>\n\tat org.jmock.core.VerifyingTestCase.runBare(VerifyingTestCase.java:39)<br/>\n\tat junit.framework.TestResult$1.protect(TestResult.java:106)<br/>\n\tat junit.framework.TestResult.runProtected(TestResult.java:124)<br/>\n\tat junit.framework.TestResult.run(TestResult.java:109)<br/>\n\tat junit.framework.TestCase.run(TestCase.java:118)<br/>\n\tat junit.framework.TestSuite.runTest(TestSuite.java:208)<br/>\n\tat junit.framework.TestSuite.run(TestSuite.java:203)<br/>\n\tat org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:128)<br/>\n\tat org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)<br/>\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:460)<br/>\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:673)<br/>\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386)<br/>\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196)<br/>\nCaused by: org.jmock.core.DynamicMockError: mockLdapTemplate: unexpected invocation<br/>\nInvoked: mockLdapTemplate.search(&quot;&quot;, &quot;(&(ttcUserType=distributor)(ttcgeographicregion=United States))&quot;, &lt;com.XXX.YYY.reporting.dao.LdapDaoImpl$DistributorInfoAttributeMapper@1e12f6d&gt;)<br/>\nAllowed:<br/>\nexpected once: search( eq(&lt;class java.lang.String&gt;), eq(&lt;class java.lang.String&gt;), eq(&lt;class com.XXX.YYY.reporting.dao.LdapDaoImpl$DistributorInfoAttributeMapper&gt;) ), returns &lt;com.XXX.YYY.reporting.struts.form.DistributorInfo@15428dd&gt;<br/>\n<br/>\n\tat org.jmock.core.AbstractDynamicMock.mockInvocation(AbstractDynamicMock.java:58)<br/>\n\tat org.jmock.cglib.CGLIBCoreMock.intercept(CGLIBCoreMock.java:71)<br/>\n\tat org.springframework.ldap.core.LdapTemplate$$EnhancerByCGLIB$$3bfb79d.search(&lt;generated&gt;)<br/>\n\tat com.XXX.YYY.reporting.dao.LdapDaoImpl.getAllActiveDomesticDistributor(LdapDaoImpl.java:47)<br/>\n\t... 19 morethe actual source file looks as below<br/>\n<br/>\nCode:<br/>\n\t/**<br/>\n\t * private logger instance for logging.<br/>\n\t */<br/>\n\tprivate static final Logger LOG = Logger.getLogger(LdapDaoImpl.class);<br/>\n\t<br/>\n\tprivate LdapTemplate ldapTemplate;<br/>\n<br/>\n\t/**<br/>\n\t * @param ldapTemplate the ldapTemplate to set<br/>\n\t */<br/>\n\tpublic void setLdapTemplate(LdapTemplate ldapTemplate) {<br/>\n\t\tthis.ldapTemplate = ldapTemplate;<br/>\n\t}<br/>\n<br/>\n\t/**<br/>\n\t * This method retreives all domestic distributors from LDAP<br/>\n\t * @exception reporting exception<br/>\n\t * @return list of distributors with company name and the distributor ID <br/>\n\t */<br/>\n\tpublic List getAllActiveDomesticDistributor()throws ReportingException{<br/>\n\t\tList distList= null;<br/>\n<br/>\n\t\ttry{<br/>\n\t\t\tAndFilter filter = new AndFilter();<br/>\n\t\t\tfilter.and(new EqualsFilter(ReportingConstant.TTC_USER_TYPE, ReportingConstant.DISTRIBUTOR));<br/>\n\t\t\tfilter.and(new EqualsFilter(ReportingConstant.GEOGRAPHIC_REGION, ReportingConstant.US));<br/>\n\t\t\tSystem.out.println(filter.encode());<br/>\n\t\t\tdistList = ldapTemplate.search(ReportingConstant.BLANK, filter.encode(), new DistributorInfoAttributeMapper());<br/>\n\t\t\tdistList = sanitizeDistributorList(distList);<br/>\n\t\t\tLOG.debug(&quot;List Distributor Info retrieved from LDAP&quot;);<br/>\n\t\t}catch(Throwable t){<br/>\n\t\t\tLOG.error(&quot;Error getting distributor info from LDAP&quot;);<br/>\n\t\t\tthrow new ReportingException(&quot;Error getting distributor info from LDAP&quot;, t);<br/>\n\t\t}<br/>\n\t\treturn distList;<br/>\n\t}<br/>\n<br/>\n\t/**<br/>\n\t * Inner Class for the retrived attribute mapper <br/>\n\t */<br/>\n\tprotected class DistributorInfoAttributeMapper implements AttributesMapper{<br/>\n\t\tpublic Object mapFromAttributes(Attributes attri) throws NamingException {<br/>\n\t\t\tDistributorInfo distInfo = new DistributorInfo();<br/>\n\t\t\tdistInfo.setDistributorId((String)attri.get(ReportingConstant.TTC_CUST_ID).get());<br/>\n\t\t\tdistInfo.setCompanyName((String)attri.get(ReportingConstant.TTC_COMPANY_NAME).get());<br/>\n\t\t\treturn distInfo;<br/>\n\t\t}<br/>\n\t}<br/>\n\t<br/>\n\t/**<br/>\n\t * Format the retrived distributor info from LDAP<br/>\n\t * prepends 000 to distributor ID also prepends the distributor ID to the company name <br/>\n\t */<br/>\n\tprivate List sanitizeDistributorList (List distInfo){<br/>\n\t\tList distributors = new ArrayList();<br/>\n\t\tfor (int i=0; i&lt;distInfo.size(); i++){<br/>\n\t\t\tDistributorInfo distributorInfo = (DistributorInfo)distInfo.get(i);<br/>\n\t\t\tString distId = distributorInfo.getDistributorId();<br/>\n\t\t\tString compName = distributorInfo.getCompanyName();<br/>\n\t\t\tif(hasNumber(distId)){<br/>\n\t\t\t\tif(Integer.parseInt(distId)&lt; 600){<br/>\n\t\t\t\t\tdistributorInfo.setDistributorId(ReportingConstant.TRIPLE_ZERO + distId);<br/>\n\t\t\t\t\tdistributorInfo.setCompanyName(distId + ReportingConstant.DASH + compName);<br/>\n\t\t\t\t\tdistributors.add(distributorInfo);<br/>\n\t\t\t\t}<br/>\n\t\t\t}<br/>\n\t\t}<br/>\n\t\treturn distributors;<br/>\n\t}<br/>\n<br/>\n\t/**<br/>\n\t * Verifies if the string has a numbers in it<br/>\n\t */<br/>\n   private boolean hasNumber(String s) {<br/>\n      for (int j = 0;j &lt; s.length();j++) <br/>\n         if (!Character.isDigit(s.charAt(j))) return false; <br/>\n      return true;<br/>\n   }my application context looks as below<br/>\n<br/>\n<br/>\nCode:<br/>\n\t&lt;bean id=&quot;ldapDao&quot; class=&quot; com.toro.rebate.reporting.dao.LdapDaoImpl&quot;&gt;<br/>\n\t\t&lt;property name=&quot;ldapTemplate&quot; ref=&quot;ldapTemplate&quot;/&gt;<br/>\n\t\t<br/>\n\t&lt;/bean&gt;<br/>\n\t<br/>\n<br/>\n\t&lt;bean id=&quot;contextSource&quot; class=&quot;org.springframework.ldap.core.support.LdapContextSource&quot;&gt;<br/>\n\t\t&lt;property name=&quot;url&quot;&gt;&lt;value&gt;${LDAP.url}&lt;/value&gt;&lt;/property&gt;<br/>\n\t\t&lt;property name=&quot;base&quot;&gt;&lt;value&gt;${LDAP.base}&lt;/value&gt;&lt;/property&gt;\t\t<br/>\n\t&lt;/bean&gt;<br/>\n\t&lt;bean id=&quot;ldapTemplate&quot; class=&quot;org.springframework.ldap.core.LdapTemplate&quot;&gt;<br/>\n\t\t&lt;constructor-arg ref=&quot;contextSource&quot; /&gt;<br/>\n\t&lt;/bean&gt;<br/>\nand my test clas is as below<br/>\n<br/>\n<br/>\nCode:<br/>\npublic class LdapDaoImplTest extends MockObjectTestCase{<br/>\n\t<br/>\n\tprivate LdapDaoImpl ldapDao;<br/>\n\tAndFilter filter;<br/>\n\tMock andFilterMock;<br/>\n\t<br/>\n\tLdapTemplate ldapTemplate;<br/>\n\tMock ldapTemplateMock;<br/>\n\t<br/>\n\tprotected void setUp() throws Exception{<br/>\n\t\tldapTemplateMock = mock(LdapTemplate.class);<br/>\n\t\tldapDao = new LdapDaoImpl();<br/>\n\t\tldapTemplate = new LdapTemplate();<br/>\n//\t\tldapTemplate.setContextSource(arg0)<br/>\n<br/>\n\t\t<br/>\n\t}<br/>\n\t<br/>\n\tprotected void tearDown() throws Exception {<br/>\n\t\t<br/>\n\t}<br/>\n\t<br/>\n\tpublic void testGetAllActiveDomesticDistributor(){<br/>\n\t\tList distributorList = getDistributorList();<br/>\n\t\tDistributorInfo distInfo = getDistributorInfo();<br/>\n//\t\tldapTemplateMock.expects(once()).method(&quot;search&quot;).with(ANYTHING).will(returnValue(distributorList));<br/>\n//\t\tldapTemplateMock.expects(once()).method(&quot;search&quot;).with(eq(String.class), &quot;(&(ttcUserType=distributor)(ttcgeographicregion=United States))&quot;, DistributorInfoAttributeMapper.class);<br/>\n\t\tldapTemplateMock.expects(once()).method(&quot;setContextSource&quot;).with(eq(ContextSource.class));<br/>\n\t\tldapTemplateMock.expects(once()).method(&quot;search&quot;).with(eq(String.class), eq(String.class), eq(ldapDao.new DistributorInfoAttributeMapper()));<br/>\n\t\tldapDao.setLdapTemplate((LdapTemplate)ldapTemplateMock.proxy());<br/>\n\t\tList actualDistList = ldapDao.getAllActiveDomesticDistributor();<br/>\n\t\tSystem.out.println(actualDistList.size());<br/>\n\t}<br/>\n\t<br/>\n\tpublic List getDistributorList(){<br/>\n\t\tList distInfoList = new ArrayList();<br/>\n\t\t<br/>\n\t\tDistributorInfo distInfo1 = new DistributorInfo();<br/>\n\t\tdistInfo1.setCompanyName(&quot;Wsco Turf Supply&quot;);<br/>\n\t\tdistInfo1.setDistributorId(&quot;150&quot;);<br/>\n<br/>\n\t\tDistributorInfo distInfo2 = new DistributorInfo();<br/>\n\t\tdistInfo2.setCompanyName(&quot;Test non Domestic DIst&quot;);<br/>\n\t\tdistInfo2.setDistributorId(&quot;810&quot;);<br/>\n<br/>\n\t\tdistInfoList.add(distInfo2);<br/>\n\t\treturn distInfoList;<br/>\n\t}<br/>\n\t<br/>\n\tpublic DistributorInfo getDistributorInfo(){<br/>\n\t\tList distInfoList = new ArrayList();<br/>\n\t\t<br/>\n\t\tDistributorInfo distInfo1 = new DistributorInfo();<br/>\n\t\tdistInfo1.setCompanyName(&quot;Wsco Turf Supply&quot;);<br/>\n\t\tdistInfo1.setDistributorId(&quot;150&quot;);<br/>\n<br/>\n//\t\tDistributorInfo distInfo2 = new DistributorInfo();<br/>\n//\t\tdistInfo2.setCompanyName(&quot;Test non Domestic DIst&quot;);<br/>\n//\t\tdistInfo2.setDistributorId(&quot;810&quot;);<br/>\n//<br/>\n//\t\tdistInfoList.add(distInfo2);<br/>\n\t\treturn distInfo1;<br/>\n\t}<br/>\n\t<br/>\n\t private ContextSource getLDAPContextSource() {<br/>\n\t        LdapContextSource ldapContextSource = new LdapContextSource();<br/>\n\t        ldapContextSource.setUrl(&quot;ldap://ldap-ttcdit.toro.com:389&quot;);<br/>\n\t        ldapContextSource.setBase(&quot;ou=Companies,o=ttc&quot;);<br/>\n<br/>\n\t        try {<br/>\n\t            ldapContextSource.afterPropertiesSet();<br/>\n\t        } catch (Exception e) {<br/>\n\t            e.printStackTrace();<br/>\n\t        }<br/>\n\t        return ldapContextSource;<br/>\n\t    }<br/>\n<br/>\n}<br/>\n<br/>\n<br/>\n      <br/>\n<br/>\n[Non-text portions of this message have been removed]</div>", 
    "prevInTime": 20860, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1221060483", 
    "canDelete": false, 
    "nextInTopic": 20922, 
    "prevInTopic": 0, 
    "headers": {
        "messageIdInHeader": "PDMwNzQ2NS4yNjc2Mi5xbUB3ZWIzMTAwMS5tYWlsLm11ZC55YWhvby5jb20+"
    }
}
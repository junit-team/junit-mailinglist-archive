{
    "numMessagesInTopic": 4, 
    "nextInTime": 10757, 
    "senderId": "kUBW2WtGQR8J-3vsg50W_6I5GUtDlofT-7d_Nwdgg8ufds1zMrsW-lHPqqFzed4MRyQVY7AZprENEqwtNdisljTsJN-8mOd6M2r5euZt", 
    "systemMessage": false, 
    "subject": "Best practice - should I fake, or depend on real world objects?", 
    "from": "Jonathan Oddy &lt;j.oddy@...&gt;", 
    "authorName": "Jonathan Oddy", 
    "msgSnippet": "Dear All, I ve noticed a pattern I have slipped into recently when writing a number of units.  A lot of my work revolves around using immutable data types ", 
    "msgId": 10756, 
    "rawEmail": "Return-Path: &lt;J.Oddy@...&gt;\r\nX-Sender: J.Oddy@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (qmail 83602 invoked from network); 5 Apr 2004 16:22:55 -0000\r\nReceived: from unknown (66.218.66.166)\n  by m19.grp.scd.yahoo.com with QMQP; 5 Apr 2004 16:22:55 -0000\r\nReceived: from unknown (HELO mail70.messagelabs.com) (193.109.255.115)\n  by mta5.grp.scd.yahoo.com with SMTP; 5 Apr 2004 16:22:55 -0000\r\nX-VirusChecked: Checked\r\nX-Env-Sender: J.Oddy@...\r\nX-Msg-Ref: server-13.tower-70.messagelabs.com!1081182172!2086982\r\nX-StarScan-Version: 5.2.10; banners=-,-,-\r\nReceived: (qmail 2331 invoked from network); 5 Apr 2004 16:22:52 -0000\r\nReceived: from mailgate.servicepower.com (195.8.178.34)\n  by server-13.tower-70.messagelabs.com with SMTP; 5 Apr 2004 16:22:52 -0000\r\nReceived: from ravel.sbs (ravel.sbs [172.16.2.13])\n\tby mailgate.servicepower.com (8.12.10/8.12.10) with ESMTP id i35GMqDN029252\n\tfor &lt;junit@yahoogroups.com&gt;; Mon, 5 Apr 2004 17:22:52 +0100\r\nReceived: from nt-stoc-0.sbs (nt-stoc-0 [172.16.2.11])\n\tby ravel.sbs (8.11.6/8.11.6) with ESMTP id i35GMqh09841\n\tfor &lt;junit@yahoogroups.com&gt;; Mon, 5 Apr 2004 17:22:52 +0100\r\nReceived: by nt-stoc-0.sbs with Internet Mail Service (5.5.2653.19)\n\tid &lt;HN7MFKXN&gt;; Mon, 5 Apr 2004 17:22:52 +0100\r\nMessage-ID: &lt;E5C79049D461D311B83100062950B54A0127C464@...&gt;\r\nTo: &quot;&#39;junit@yahoogroups.com&#39;&quot; &lt;junit@yahoogroups.com&gt;\r\nDate: Mon, 5 Apr 2004 17:22:48 +0100 \r\nMIME-Version: 1.0\r\nX-Mailer: Internet Mail Service (5.5.2653.19)\r\nContent-Type: text/plain;\n\tcharset=&quot;iso-8859-1&quot;\r\nX-eGroups-Remote-IP: 193.109.255.115\r\nFrom: Jonathan Oddy &lt;j.oddy@...&gt;\r\nSubject: Best practice - should I fake, or depend on real world objects?\r\nX-Yahoo-Group-Post: member; u=124029770\r\nX-Yahoo-Profile: jonathanoddy\r\n\r\nDear All,\n\nI&#39;ve noticed a pattern I have slipped into recently when writing a number of\nunits.  A lot of my work revolves around using immutable data types\n(serialised from some server).  As this project began life in the\ndim-and-distant past (pre unit testing) there aren&#39;t yet a whole load of\nunit tests - however their number is growing.  I used to fake the immutable\nobjects used within some method/behavoiur under test, and I&#39;ve one this\nusing one (or more) Object Mothers.  This works fine as it makes the test\ncases easier to understand.\n\nRecently, because I&#39;ve needed to fix a couple of faults within one of these\ntypes I&#39;ve created a small MockObjectInputStream (yes I know I should have\nused somebodies nMock library - but that&#39;s not important right now...) which\nallows me to construct/populate these objects from a String.  Since then\nI&#39;ve started creating &quot;real&quot; immutable objects from &quot;live&quot; data and using\nthese to test drive my current piece of implementation.  This feels &quot;right&quot;\nto me, because I&#39;ve been reducing the dependencies on the real world, and\nusing real world objects - so if they break/change somewhere then I am more\nlikely to see other unit tests failing, whereas a fake (and I&#39;ve been bitten\nby this a number of times) can contain inaccurate assumptions which mean\nthat the code I am test driving is implemented wrongly - because of those\nassumptions.\n\nBy way of clarification here&#39;s my Object Mother for class A, with both old\nand new factory methods:\n\npublic class ObjectMotherForA\n{\n  // &quot;old way&quot;\n  public static A oldCreate(int a, int b, int c...)\n  {\n    return new A()\n    {\n      public int getX() { return x; }\n      public int getY() { return y; }\n      public int getZ() { return z; }\n      // one problem I keep falling for is \n      // not overloading equals/hashCode/toString as appriate\n    }\n  }\n\n  // new way\n  public static A newCreate(String dataStream)\n  {\n    A a = new A();\n    a.readExternal(MockObjectInputStream(dataStream));\n    // no problems with equals, hashCode here!\n    return a;\n  }\n}\n\nI have two problems with &quot;new&quot; method of construction, firstly my test\nmethods look less meaning full - most of my immutable objects have *lots* of\nattributes which lead to less than helpful lines of code, and secondly it is\nvery easy (finger trouble) to mistype this serialised string (although I&#39;ve\ntended to use live data from log files for my initial data construction):\n\n// example of actual data stream\nA myA = ObjectMotherForA.newCreate(&quot;180593,OB_221,SK8\n9DF,2760,42,0,0,11,,SIX_4,0,,862430460,542720,0,0,0,1237,M,318,0,862358400,0\n,99999999,0,-1,862311600,862358400,0,0,0,0,0,0,0&quot;);\n\nI&#39;ve started working this way because when fixing field faults I&#39;ve been\ngiven various log files containing the serialised contents of these\nimmutable objects, so I&#39;ve been building tests using the above method\n(because it contains the erroneous data).  To improve matters my test cases\ncontain factory methods and/or the data stream broken up to highlight the\nproblematic (&quot;important&quot;) data, however you still end up with a lot of chaff\nsurrounding the tests.  For example:\n\npublic void testSomething()\n{\n  String product = &quot;98-a1&quot;;\n  String reason = &quot;-38&quot;;\n\n  ProductVerifier pv = new ProductVerifier(\n    createAWithInvalidProductAndReasonCodes(product, reason));\n  assertFalse(product + &quot;, &quot; + reason, pv.isValid();\n}\n\nprivate A createAWithInvalidStatusCode(String product, String reasonCode)\n{\n  String x = &quot;180593,OB_221,SK8 9DF,2760,42,0,0,11,,&quot;;\n  String y = &quot;,0,,862430460,542720,0,0,0,1237,M,&quot;;\n  String z =\n&quot;,0,862358400,0,99999999,0,-1,862311600,862358400,0,0,0,0,0,0,0&quot;;\n  return ObjectMotherForA.newCreate(x + product + y + reasonCode + z); \n}\n\nDoes this seem like a resonable direction to be going - or am I setting\nmyself up for an unpleasant (unforseen) fall somewhere later down the track?\n\nAny thoughts/criticisms welcome.\n\nJonathan\n\n--\nJonathan Oddy\nSERVICEPower Business Solutions Ltd\nPetersgate House - St Petersgate - Stockport - SK1 1HE - ENGLAND\nTel: +44 (0)161 476 2277\nEmail: j.oddy@... &lt;mailto:j.oddy@...&gt;\n\n\n", 
    "profile": "jonathanoddy", 
    "topicId": 10756, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 124029770, 
    "prevInTime": 10755, 
    "contentTrasformed": false, 
    "postDate": "1081182168", 
    "canDelete": false, 
    "nextInTopic": 10780, 
    "prevInTopic": 0, 
    "headers": {
        "messageIdInHeader": "PEU1Qzc5MDQ5RDQ2MUQzMTFCODMxMDAwNjI5NTBCNTRBMDEyN0M0NjRAbnQtc3RvYy0wLnNicz4="
    }
}
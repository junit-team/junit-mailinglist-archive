{
    "numMessagesInTopic": 5, 
    "nextInTime": 14052, 
    "senderId": "SjamCNt3I3iDQrN56GfeA7HrZ9wkRymaS62DeIxFQvWpbtRlr5NW1YSvtsKoPi3P5axYyaYIZTOs8whIVz6vRITlqIoEt8O6uO89zAH9fn6ijuABAA", 
    "systemMessage": false, 
    "subject": "Re: [junit] Using a Special Class Loader to test a Singleton", 
    "from": "Andrew McDonagh &lt;andrew.mcdonagh@...&gt;", 
    "authorName": "Andrew McDonagh", 
    "msgSnippet": "... snipped code. I take it you want to do some kind of reset of the singleton so that you can test different datasets? If so, forget about classloading,", 
    "msgId": 14051, 
    "profile": "andy_ipaccess", 
    "topicId": 14046, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 73998260, 
    "messageBody": "<div id=\"ygrps-yiv-952841385\">raycclough wrote:<br/>\n<br/>\n<blockquote><span title=\"ireply\"> &gt;I know that the JUnit community frowns on Singletons.  However I have<br/>\n&gt;a piece of code which uses a singleton, and I want to test it.  The<br/>\n&gt;singleton takes a &quot;Reader&quot; in it&#39;s constructor (which may be null, and<br/>\n&gt;then it uses a properties file to create its data).  I want to test it<br/>\n&gt;using various different data sets.  In line with that, I created a<br/>\n&gt;custom Class Loader, and use Reflection to create the object.  It<br/>\n&gt;works great (except, of course, where it doesn&#39;t).  The reflexively<br/>\n&gt;obtained constructor returns an object of type &#39;Object&#39;, which the<br/>\n&gt;debugger says has the correct underlying type, and it contains the<br/>\n&gt;correct data, but I cannot Cast it to the type it needs to be.  Any<br/>\n&gt;hint to what I&#39;m doing wrong?  Thanks for any advice you can give me<br/>\n&gt;on this.<br/>\n&gt;<br/>\n&gt;  <br/>\n&gt;<br/>\n<br/>\n </span></blockquote>snipped code.<br/>\n<br/>\nI take it you want to do some kind of reset of the singleton so that you <br/>\ncan test different datasets?<br/>\n<br/>\nIf so, forget about classloading, reflection, etc and keep it simple.<br/>\n<br/>\nA number of options are available all...<br/>\n<br/>\n1) just add a public instance method to reset the reader and anything <br/>\nelse of the singleton:<br/>\n<br/>\nclass DefaultGatewayController {<br/>\n    public static DefaultGatewayController getInstance() {<br/>\n       return s_instance;<br/>\n    }<br/>\n<br/>\n   public void resetReader(Reader r) {<br/>\n        ....<br/>\n<br/>\n   }<br/>\n}<br/>\n<br/>\n2) Hide the reset methods behind an interface. Move the Singleton <br/>\nimplementation behind an interface and a test interface.  The <br/>\ngetInstance() method return type would be the standard interface, but <br/>\nyour tests can cast to the testInterface to get access to the reset methods.<br/>\n<br/>\nclass GatewayControllerSingleton {<br/>\n     private static GatewayController s_instance;<br/>\n<br/>\n    public static GatewayController  getInstance() {<br/>\n        if (s_instance != null) {<br/>\n            s_instance = new DefaultGatewayController();<br/>\n       }<br/>\n<br/>\n        return s_instance;<br/>\n    }<br/>\n<br/>\n}<br/>\n<br/>\ninterface GatewayController {<br/>\n...<br/>\n}<br/>\n<br/>\n<br/>\ninterface TestableGatewayController {<br/>\n   void resetReader(Reader r);<br/>\n}<br/>\n<br/>\n<br/>\nclass DefaultGatewayController implements GatewayController, <br/>\nTestableGatewayController{<br/>\n...<br/>\n}<br/>\n<br/>\nPlus some other approaches....<br/>\n<br/>\nHTH<br/>\n<br/>\nAndrew</div>", 
    "prevInTime": 14050, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1119949237", 
    "canDelete": false, 
    "nextInTopic": 14053, 
    "prevInTopic": 14046, 
    "headers": {
        "inReplyToHeader": "PGQ5cTU1Zis3NjVrQGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PDQyQzExMUI1LjQwNDAzMDVAaXBhY2Nlc3MuY29tPg==", 
        "referencesHeader": "PGQ5cTU1Zis3NjVrQGVHcm91cHMuY29tPg=="
    }
}
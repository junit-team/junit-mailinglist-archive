{
    "numMessagesInTopic": 7, 
    "nextInTime": 2986, 
    "senderId": "Pm5d4JbJICcSwhuYSD7OQ8uc8sZMW50ogQhnInERaBP3imMSeNRNMpAHlWmBh5Z3WnbKQl1X-CxTUWUvGCpdRzQ6jV6rYg_K_O51kdGz", 
    "systemMessage": false, 
    "subject": "RE: [junit] Re: swingui & jdk1.4", 
    "from": "&quot;David Hooker&quot; &lt;dhooker@...&gt;", 
    "authorName": "David Hooker", 
    "msgSnippet": "Excellent!  Exactly what I wanted to know, thanks! ... From: Scott Stirling [mailto:sstirling@macromedia.com] Sent: Wednesday, October 17, 2001 1:00 PM To:", 
    "msgId": 2985, 
    "profile": "dudehook", 
    "topicId": 2764, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 0, 
    "messageBody": "<div id=\"ygrps-yiv-1693722217\">Excellent!  Exactly what I wanted to know, thanks!<br/>\n<br/>\n-----Original Message-----<br/>\nFrom: Scott Stirling [mailto:<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:sstirling@...\">sstirling@...</a>] <br/>\nSent: Wednesday, October 17, 2001 1:00 PM<br/>\nTo: &#39;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>&#39;<br/>\nSubject: RE: [junit] Re: swingui & jdk1.4<br/>\n<br/>\n<br/>\nHere&#39;s a definitive answer (watch what you ask for ;-&gt; ), from my post<br/>\nto<br/>\nthis group on 7/10/01.  If Jim wants to put in the FAQ, please do.  It&#39;s<br/>\ndefinitely in the top 5 FAQs on this list.<br/>\n****************************<br/>\n<br/>\nThe JUnit TestCaseClassLoader (the reloadable one) has a fundamental<br/>\nproblem<br/>\nthat results in frequent LinkageErrors under the following conditions:<br/>\n<br/>\n1. You use the JUnit Swing UI.<br/>\n<br/>\n2.  You use JAXP in your test cases or any classes referenced in your<br/>\ntest<br/>\ncases, or even any &quot;instanceof&quot; expressions that reference JAXP classes.<br/>\n(By JAXP I mean the whole set of javax.* classes plus the org.w3c.dom.*<br/>\nand<br/>\norg.xml.sax.* classes)<br/>\n<br/>\nI can go into this in depth, but the bottom line problems are that JUnit<br/>\nloads classes from the same place as the JVM&#39;s system loader; the<br/>\nclasspath.<br/>\nThis necessitates the use of an exclusion list to filter out certain<br/>\nclass<br/>\nnames that either must be loaded by the system loader, or you would like<br/>\nto<br/>\nhave loaded by the system loader.  The JUnit loader does not always<br/>\ndelegate<br/>\nto the system loader when it should, particularly in the case of JAXP,<br/>\nwhich<br/>\nis a weird mix of classes whose names begin with the filtered &quot;javax.*&quot;<br/>\nand<br/>\nthe unfiltered &quot;org.w3c.*&quot; and org.xml.*&quot;.<br/>\n<br/>\nJAXP is a special case because it is based on a set of javax.* classes.<br/>\nAll<br/>\njavax.* classes are excluded from the JUnit loader by default (in the<br/>\ndefault excluded.properties file) in junit.jar.  But JAXP, as shipped<br/>\nfrom<br/>\nSun, comes with a bunch of other classes in org.w3c.* and org.xml.*.<br/>\nThe<br/>\ninteresting thing is a direct dependency between javax.* classes and<br/>\nsome<br/>\nother classes not in the usual exclusion list of com.sun.*, javax.*,<br/>\netc.<br/>\n<br/>\nSo what can happen, and frequently does when using the JUnit Swing UI<br/>\nwith<br/>\ntest cases or other classes, such as Log4J, that use JAXP, is that the<br/>\nJUnit<br/>\nclass loader (properly) delegates javax.xml.* classes it &quot;sees&quot; to the<br/>\nsystem loader.  But then the system loader loads up a bunch of<br/>\norg.w3c.dom<br/>\nand/or org.xml.sax classes as the result of initializing and loading<br/>\nthat<br/>\nJAXP class.  Later, if the JUnit loader comes across some org.w3c/xml<br/>\nclass<br/>\nthat it&#39;s never seen before, it tries to load it because the classname<br/>\ndoesn&#39;t match one of the patterns in the exclude list.  <br/>\n<br/>\nBut it&#39;s already been loaded through the &quot;backdoor&quot; as the result of<br/>\nsome<br/>\nother class loaded by the system loader (remember, the JVM keeps classes<br/>\nin<br/>\ntheir own namespace by identifying them by their fully qualified name<br/>\nplus<br/>\nthe instance of their _defining_ (not initiating) loader, AND, the JVM<br/>\nwill<br/>\nattempt to assign all unloaded classes referenced by a defined class to<br/>\nthat<br/>\ndefining class&#39;s loader).  The JVM&#39;s classresolver routine keeps track<br/>\nof<br/>\nall these class loading events and &quot;sees&quot; that the JUnit loader is<br/>\nattempting to define a class that has already been defined by the system<br/>\nloader.  That&#39;s wrong because according to the rules of loader<br/>\nconstraints,<br/>\nJUnit should delegate this load to the system loader.<br/>\n<br/>\nYou can hack around this (I did) by catching the LinkageError in<br/>\nTestCaseClassLoader&#39;s loadClass() method and then making a recovery call<br/>\nto<br/>\nfindSystemClass() -- thereby delegating to the system loader after the<br/>\nfact<br/>\n(which is OK).  This hack only works some of the time, though, because<br/>\nnow<br/>\nyou can have the reverse problem where the JUnit loader loads a host of<br/>\norg.*.* classes, and then the system loader violates the loader<br/>\ncontraints<br/>\nat some point when it tries to do exactly what I described above with<br/>\nJAXP<br/>\nbecause it doesn&#39;t ever delegate to its child (the JUnit loader).<br/>\nInevitably, if your test cases use many JAXP and related XML classes,<br/>\none or<br/>\nthe other ClassLoader will end violating the constraints whatever you<br/>\ndo.<br/>\n<br/>\nSo the solution in the existing JUnit is to definitely add org.w3c.dom.*<br/>\nand<br/>\norg.xml.sax.* to your excluded.properties if you&#39;re using any JAXP<br/>\nstuff.<br/>\n<br/>\nWhat can we learn from this?  Well, one thing is that it&#39;s a good idea<br/>\nto<br/>\nhave your custom class loaders load classes from repositories other than<br/>\nthe<br/>\nsystem classpath.  Note that the JVM&#39;s built-in classloaders work that<br/>\nway<br/>\n(one for the jre/ext dirs, another for the java.class.path).<br/>\n<br/>\nAnyway, the excluded.properties fix is just a matter of time before it<br/>\nbecomes standard in JUnit, since JAXP will be a standard part of the 1.4<br/>\nJDK.  It&#39;ll be just like having org.omg.* excluded.<br/>\n<br/>\nScott Stirling<br/>\n<br/>\n-----Original Message-----<br/>\nFrom: David V. Olivier [mailto:<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:dolivier@...\">dolivier@...</a>]<br/>\nSent: Wednesday, October 17, 2001 1:56 PM<br/>\nTo: <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a><br/>\nSubject: Re: [junit] Re: swingui & jdk1.4<br/>\n<br/>\n<br/>\nThis is similar to a question I had a week ago and I was told many other<br/>\n<br/>\nsubscribers had had the same type of question.  Perhaps this is a<br/>\ncandidate <br/>\nfor the new FAQ.<br/>\n<br/>\nDavid Olivier<br/>\n<br/>\nAt 05:43 PM 10/17/2001 +0000, you wrote:<br/>\n<blockquote><span title=\"ireply\"> &gt;I&#39;m having similar issues when test code that uses dom4j (which uses<br/>\n&gt;JAXP to instantiate an XML parser, like Xerces).  When I run under<br/>\n&gt;junit, it can&#39;t find some org.xml classes.  When I run standalone I<br/>\n&gt;have no problems.<br/>\n&gt;<br/>\n&gt;If anyone knows why, I&#39;d love to find out.<br/>\n&gt;<br/>\n&gt;--- In junit@y..., Anthony  Pereira &lt;apereira@3...&gt; wrote:<br/>\n&gt; &gt; Hi,<br/>\n&gt; &gt;<br/>\n&gt; &gt; I&#39;m not sure whether this is the place to submit what I&#39;m just<br/>\n&gt;going to<br/>\n&gt; &gt; write about, if not please do point me in the right direction,<br/>\n&gt;cheers.<br/>\n&gt; &gt;<br/>\n&gt; &gt; I came across a rather bizzare scenario, today using the<br/>\n&gt; &gt; junit.swingui.TestRunner in a java 1.4beta2 environment. In some of<br/>\n&gt;my code,<br/>\n&gt; &gt; I reference classes in org.w3c.dom and org.apache.crimson. Now, as<br/>\n&gt;soon as<br/>\n&gt; &gt; junit came across classes from these packages, it threw class not<br/>\n&gt;found<br/>\n&gt; &gt; exceptions. Please note that this doesn&#39;t happen in the the textui<br/>\n&gt;nor my<br/>\n&gt; &gt; own testing classes, since they are both in the classpath.<br/>\n&gt; &gt;<br/>\n&gt; &gt; org.w3c.dom specifically is in the rt.jar<br/>\n&gt; &gt; org.apache.crimson is a separate jar, which is on my classpath<br/>\n&gt; &gt;<br/>\n&gt; &gt; After a bit of digging around in the source code, specifically in<br/>\n&gt;the<br/>\n&gt; &gt; TestCaseClassLoader, I found out about the<br/>\n&gt;junit&#92;runner&#92;exclude.properties<br/>\n&gt; &gt; file. When I added these package names to that file, things seemed<br/>\n&gt;ok, and<br/>\n&gt; &gt; those exceptions didn&#39;t take place.<br/>\n&gt; &gt;<br/>\n&gt; &gt; What confused me was why it didn&#39;t find the classes, even though<br/>\n&gt;they was on<br/>\n&gt; &gt; my classpath, especially the org.w3c ones which are in the rt.jar<br/>\n&gt;(with<br/>\n&gt; &gt; 1.4). Furthermore, this was only a problem when using the swingui,<br/>\n&gt;with the<br/>\n&gt; &gt; textui, it was fine.<br/>\n&gt; &gt;<br/>\n&gt; &gt; I&#39;ve got it working now that I put those details in the<br/>\n&gt;exclude.properties<br/>\n&gt; &gt; file. Is this perhaps a issue with using 1.4?<br/>\n&gt; &gt;<br/>\n&gt; &gt; Any comments or explainations?<br/>\n&gt; &gt; Thanks<br/>\n&gt; &gt; Anthony<br/>\n&gt;<br/>\n&gt;<br/>\n&gt;To unsubscribe from this group, send an email to:<br/>\n&gt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit-unsubscribe@yahoogroups.com\">junit-unsubscribe@yahoogroups.com</a><br/>\n&gt;<br/>\n&gt;<br/>\n&gt;Your use of Yahoo! Groups is subject to<br/>\n </span></blockquote><a rel=\"nofollow\" target=\"_blank\" href=\"http://docs.yahoo.com/info/terms/\">http://docs.yahoo.com/info/terms/</a><br/>\n<br/>\n<br/>\n<br/>\nTo unsubscribe from this group, send an email to:<br/>\n<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit-unsubscribe@yahoogroups.com\">junit-unsubscribe@yahoogroups.com</a><br/>\n <br/>\n<br/>\nYour use of Yahoo! Groups is subject to<br/>\n<a rel=\"nofollow\" target=\"_blank\" href=\"http://docs.yahoo.com/info/terms/\">http://docs.yahoo.com/info/terms/</a> <br/>\n<br/>\n<br/>\n<br/>\nTo unsubscribe from this group, send an email to:<br/>\n<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit-unsubscribe@yahoogroups.com\">junit-unsubscribe@yahoogroups.com</a><br/>\n <br/>\n<br/>\nYour use of Yahoo! Groups is subject to<br/>\n<a rel=\"nofollow\" target=\"_blank\" href=\"http://docs.yahoo.com/info/terms/\">http://docs.yahoo.com/info/terms/</a></div>", 
    "prevInTime": 2984, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1003341855", 
    "canDelete": false, 
    "nextInTopic": 2986, 
    "prevInTopic": 2984, 
    "headers": {
        "inReplyToHeader": "PDRGNDdEQ0ZBREM4REQ1MTE4RDJCMDA1MDhCOTUyRDk2MEMzOTg5QHNhbHNhLmFsbGFpcmUuY29tPg==", 
        "messageIdInHeader": "PDAwMDIwMWMxNTczNiQyMjc4M2JjMCQ2YjAxYThjMEBESE9PS0VSPg=="
    }
}
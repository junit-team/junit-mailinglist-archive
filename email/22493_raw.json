{
    "numMessagesInTopic": 9, 
    "nextInTime": 22494, 
    "senderId": "vHs9kmi9AWaeQChiSovrXb8YyEUyuw9MSsLZ6udlLly8wy1EOWIkiO_MisLgWKTi61yTQct4KKntzBk5vEslLMn7", 
    "systemMessage": false, 
    "subject": "Re: [junit] [RT] JUnit Core, Parallelism, Documentation", 
    "from": "David Saff &lt;david@...&gt;", 
    "authorName": "David Saff", 
    "msgSnippet": "Berin, Thanks for this!  I can t touch here on all of your ideas, so feel free to repeat any points you d like to prioritize in the discussion. With regard to", 
    "msgId": 22493, 
    "rawEmail": "Return-Path: &lt;david.saff@...&gt;\r\nX-Sender: david.saff@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nX-Received: (qmail 99875 invoked from network); 2 Mar 2010 14:31:52 -0000\r\nX-Received: from unknown (98.137.34.44)\n  by m1.grp.sp2.yahoo.com with QMQP; 2 Mar 2010 14:31:52 -0000\r\nX-Received: from unknown (HELO mail-pv0-f180.google.com) (74.125.83.180)\n  by mta1.grp.sp2.yahoo.com with SMTP; 2 Mar 2010 14:31:52 -0000\r\nX-Received: by pvc22 with SMTP id 22so70060pvc.39\n        for &lt;junit@yahoogroups.com&gt;; Tue, 02 Mar 2010 06:31:52 -0800 (PST)\r\nMIME-Version: 1.0\r\nX-Received: by 10.141.109.16 with SMTP id l16mr1394239rvm.167.1267540311957; \n\tTue, 02 Mar 2010 06:31:51 -0800 (PST)\r\nIn-Reply-To: &lt;75F5ED8A5A553646A46E00E6EC854FA3044B97F2@...-ais.com&gt;\r\nReferences: &lt;75F5ED8A5A553646A46E00E6EC854FA3044B97F2@...-ais.com&gt;\r\nDate: Tue, 2 Mar 2010 09:31:51 -0500\r\nX-Google-Sender-Auth: e13607efaef325f9\r\nMessage-ID: &lt;4f7da6b91003020631o6f820d27kb159770c9d7ca1ca@...&gt;\r\nTo: junit@yahoogroups.com\r\nContent-Type: text/plain; charset=ISO-8859-1\r\nContent-Transfer-Encoding: quoted-printable\r\nX-eGroups-Msg-Info: 1:12:0:0:0\r\nFrom: David Saff &lt;david@...&gt;\r\nSubject: Re: [junit] [RT] JUnit Core, Parallelism, Documentation\r\nX-Yahoo-Group-Post: member; u=341876227; y=3r32e_0RiENs9NW8QirFut5mDhQmUGjCCvwNWK5zbZk\r\nX-Yahoo-Profile: dsaff\r\n\r\nBerin,\n\nThanks for this!  I can&#39;t touch here on all of your ideas, so feel\n=\r\nfree to repeat any points you&#39;d like to prioritize in the discussion.\n\nWith=\r\n regard to deprecation, we&#39;ve definitely begun to feel the weight\nof the ol=\r\nd code, but have indeed felt that it&#39;s not clear whether\nbeing very aggress=\r\nive would be in the best interests of users: thanks\nto the fact that many u=\r\nsers of tools like Eclipse and Maven have their\nJUnit version automatically=\r\n updated without explicit intervention,\nit&#39;s easy to be the cause of breaki=\r\nng something that&#39;s been working\nfor years.  That said, I think it is time =\r\nfor a little housecleaning.\nI&#39;ve mentioned to Kent that we should do a code=\r\nsearch.google.com\nsmackdown, and start kicking the least-used public method=\r\n or class\n&quot;off the island&quot; with each release.\n\nAs you mention, I think that=\r\n the biggest obstacle to real parallelism\nis an replacement or enhancement =\r\nof the BeforeClass/AfterClass idiom\nthat is well-defined outside of a singl=\r\ne-threaded execution.  As two\nexamples, (1) it&#39;s not well-defined whether a=\r\n BeforeClass method\nshould be able to be run more than once per test suite =\r\nexecution, (2)\nit&#39;s not well-defined whether one class can correctly start =\r\nbefore\nanother class&#39;s AfterClass method has been called.\n\n   David\n\nOn Mon=\r\n, Mar 1, 2010 at 5:17 PM, Loritsch, Berin C.\n&lt;berin.loritsch@...&gt; wr=\r\note:\n&gt; RT =3D Random Thought. =A0It&#39;s a habit I picked up from Stefano Mazz=\r\nocchi\n&gt; when I used to work with him on the Cocoon project. =A0Essentially,=\r\n it&#39;s a\n&gt; structured brain dump based on observations of the internals of a=\r\n\n&gt; project (as such it is longer than most posts). =A0My apologies if this =\r\nis\n&gt; not the forum for this.\n&gt;\n&gt; =3D=3D Code Maintenance Thoughts =3D=3D\n&gt;\n=\r\n&gt; I&#39;ve been going through some of the JUnit Core to add some JavaDocs\n&gt; (it=\r\n&#39;s in my forked copy if you want me to do a Push request), and made a\n&gt; few=\r\n observations. =A0I can definitely see how JUnit has begun to evolve\n&gt; over=\r\n the years, and as is natural with a couple missteps along the way.\n&gt; It&#39;s =\r\nhard to get rid of those missteps because some people may have\n&gt; extended t=\r\nhem. =A0Some of the classes have been deprecated with the\n&gt; promise that th=\r\ney would be removed in the next revision (as of 4.4) and\n&gt; they are still t=\r\nhere. =A0I&#39;m not saying that the current solution is a\n&gt; misstep, just that=\r\n it is hard to separate the past ones from the current\n&gt; preferred solution=\r\n.\n&gt;\n&gt; Part of managing a codebase like this includes separating the public =\r\nand\n&gt; private API. =A0Some of that has been done with the &quot;internal&quot; packag=\r\ne.\n&gt; There is no reason to worry about deprecating classes and methods in t=\r\nhe\n&gt; internal package because they are not part of the public API. =A0But I=\r\n did\n&gt; notice that when some classes got moved, the old class in full was k=\r\nept\n&gt; in the original location. =A0A low maintenance way of performing a mo=\r\nve\n&gt; like that makes use of inheritance. =A0Essentially the newer class is\n=\r\n&gt; moved so there is one maintenance location, and the deprecated class\n&gt; ex=\r\ntends the newer class. =A0Kind of like how the JUnit4 runner provides a\n&gt; p=\r\nreferred alias to the BlockJUnit4Runner class.\n&gt;\n&gt; Part of the core include=\r\ns a nice little callback interface (the\n&gt; RunListener). =A0I imagine that a=\r\n number of integrations make good use of\n&gt; this little class. =A0However, w=\r\nith the implementation as it is currently\n&gt; written, the RunListener can af=\r\nfect the run performance and parallelism\n&gt; available. =A0Essentially, the a=\r\nct of calling a method is a synchronous\n&gt; function. =A0That means a poorly =\r\nwritten runner can detrimentally affect\n&gt; the performance of JUnit. =A0The =\r\none that is included with JUnit is pretty\n&gt; tame, doing the absolute minimu=\r\nm it has to do to track the test\n&gt; progress. =A0However, if your tests exec=\r\nute slower in an IDE than with\n&gt; JUnit alone, it&#39;s probably the RunListener=\r\n slowing things down.\n&gt;\n&gt; =3D=3D Parallelism Thoughts =3D=3D\n&gt;\n&gt; Some of th=\r\ne architectural decisions in JUnit&#39;s core definitely reflect\n&gt; the synchron=\r\nous nature that the tests were designed to be written. =A0I\n&gt; don&#39;t think t=\r\nhere is going to be an easy solution to that problem,\n&gt; unless you stick to=\r\n a test class per thread model. =A0More on that a bit\n&gt; latter.\n&gt;\n&gt; When de=\r\nsigning for parallel execution of tests (the ParallelComputer\n&gt; hints at th=\r\nis), you usually don&#39;t want an unbounded number of threads to\n&gt; be executed=\r\n in the system. =A0A fairly common approach to taming the\n&gt; thread/work app=\r\nortioning beast is to use queues and worker threads.\n&gt; Essentially, each te=\r\nst (including the set up and tear down parts) gets\n&gt; pushed on to the queue=\r\n, while the executor pops it off on the other side\n&gt; in another process. =\r\n=A0Essentially the relationship to executors to work\n&gt; queues depends on wh=\r\natever rules you&#39;ve set up. =A0For JUnit a simple\n&gt; mapping of executors to=\r\n the number of processors (cores) or some\n&gt; multiple of that would be suffi=\r\ncient. =A0This model is closer to how JMS\n&gt; works without all the quality o=\r\nf service overhead. =A0As the executor runs\n&gt; the test, it sends notificati=\r\non objects to the notification queue.\n&gt; Using one line of ASCII art, the pr=\r\nocess looks like this:\n&gt;\n&gt; Classes/Suite =3D=3D&gt; Executor =3D=3D&gt; Notifier\n=\r\n&gt;\n&gt; Each &quot;=3D=3D&gt;&quot; represents a queue. =A0The notification mechanism then b=\r\necomes\n&gt; more like Swing events. =A0We could even cheat and use an Java 5 e=\r\nnum for\n&gt; the types of events. =A0This provides the same interface for all =\r\nthe\n&gt; events, and the convenience of an enum for determining the type of\n&gt; =\r\nevent. =A0If we take this approach a step further, if we substitute a\n&gt; Pri=\r\norityQueue for the first queue, we get a way to prefer some tests\n&gt; over ot=\r\nhers (e.g. using categories as a priority mechanism). =A0Collecting\n&gt; the r=\r\nesults in a separate thread than they are being executed protects\n&gt; the exe=\r\ncution of tests from poorly written listeners.\n&gt;\n&gt; We could go to a very fi=\r\nne level of detail (i.e. each individual test)\n&gt; if it weren&#39;t for the clas=\r\ns setup/tear down methods. =A0Those kind of\n&gt; tests would force some sort o=\r\nf ordering. =A0It&#39;s not entirely impossible,\n&gt; but does require more care.\n=\r\n&gt;\n&gt; Such an approach may be over-engineering things a bit, and for short\n&gt; =\r\nruns of a couple hundred tests that takes less than a second to run\n&gt; defin=\r\nitely overkill. =A0However for larger projects with much larger\n&gt; execution=\r\n times, it may be a way to short circuit the execution a bit.\n&gt; Essentially=\r\n the win here would be the ability to execute tests while\n&gt; they are still =\r\nbeing parsed and prepared. =A0That can help with things\n&gt; like Theories whe=\r\nre collecting a large number of DataPoints can have a\n&gt; profound impact on =\r\nthe time it takes to run.\n&gt;\n&gt; It would be pretty easy to ensure that no mor=\r\ne than n+2 threads are used\n&gt; in a system, where n =3D Runtime.availablePro=\r\ncessors().\n&gt;\n&gt;\n&gt; [Non-text portions of this message have been removed]\n&gt;\n&gt;\n=\r\n&gt;\n&gt; ------------------------------------\n&gt;\n&gt; Yahoo! Groups Links\n&gt;\n&gt;\n&gt;\n&gt;\n\n", 
    "profile": "dsaff", 
    "topicId": 22487, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 341876227, 
    "prevInTime": 22492, 
    "contentTrasformed": false, 
    "postDate": "1267540311", 
    "canDelete": false, 
    "nextInTopic": 22494, 
    "prevInTopic": 22491, 
    "headers": {
        "inReplyToHeader": "PDc1RjVFRDhBNUE1NTM2NDZBNDZFMDBFNkVDODU0RkEzMDQ0Qjk3RjJAdmFmZjAxLW1haWwwMS5hZC5nZC1haXMuY29tPg==", 
        "messageIdInHeader": "PDRmN2RhNmI5MTAwMzAyMDYzMW82ZjgyMGQyN2tiMTU5NzcwYzlkN2NhMWNhQG1haWwuZ21haWwuY29tPg==", 
        "referencesHeader": "PDc1RjVFRDhBNUE1NTM2NDZBNDZFMDBFNkVDODU0RkEzMDQ0Qjk3RjJAdmFmZjAxLW1haWwwMS5hZC5nZC1haXMuY29tPg=="
    }
}
{
    "numMessagesInTopic": 23, 
    "nextInTime": 22541, 
    "senderId": "Iy8mQPlVwenI_-RfVWKwRrT25DIr1_dxgt4v16zPOyLDEGXwlbEDNbyP_kGBZtMd36L9PS7qcZNpMeQfQhSdv90VqVitGV_5mp-U", 
    "systemMessage": true, 
    "subject": "Re: [junit] Re: @DataPoints called several times for Theories", 
    "from": "Brett Daniel &lt;brettdaniel@...&gt;", 
    "authorName": "Brett Daniel", 
    "msgSnippet": "The undergrads I am advising recently pushed a patch that addresses the issue of mutable data points. ", 
    "msgId": 22540, 
    "rawEmail": "Return-Path: &lt;brettdaniel@...&gt;\r\nReceived: (qmail 11974 invoked from network); 13 Mar 2010 01:36:04 -0000\r\nReceived: from unknown (66.196.94.105)\n  by m14.grp.re1.yahoo.com with QMQP; 13 Mar 2010 01:36:04 -0000\r\nReceived: from unknown (HELO n43d.bullet.mail.sp1.yahoo.com) (66.163.169.157)\n  by mta1.grp.re1.yahoo.com with SMTP; 13 Mar 2010 01:36:04 -0000\r\nDKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoogroups.com; s=lima; t=1268443989; bh=Ph7shx77vgHC41UvdVjycCGngcTeMi8LbBdmxJIwua0=; h=Received:Received:X-Sender:X-Apparently-To:X-Received:X-Received:X-Received:X-Received:MIME-Version:X-Received:In-Reply-To:References:Date:X-Google-Sender-Auth:Message-ID:To:Cc:X-Originating-IP:X-eGroups-Msg-Info:X-eGroups-From:From:Subject:X-Yahoo-Group-Post:X-Yahoo-Profile:Content-Type:Content-Transfer-Encoding:X-YGroups-SubInfo:Sender:X-Yahoo-Newman-Property:X-eGroups-Approved-By:X-eGroups-Auth; b=EgDMBkAspOaZVx1hz6zMGQZTi7nfJqVWIryJ8l9GwwSepmvRoWlCiATVzlGtOB4IXWOdaJhAJI8f5vSoLF8XdNoj8Rp7+bE75IZ5WCklvQnU4CS2cuOyLMIsUh/8TbE+\r\nReceived: from [69.147.65.171] by n43.bullet.mail.sp1.yahoo.com with NNFMP; 13 Mar 2010 01:33:09 -0000\r\nReceived: from [98.137.34.73] by t13.bullet.mail.sp1.yahoo.com with NNFMP; 13 Mar 2010 01:33:08 -0000\r\nX-Sender: brettdaniel@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nX-Received: (qmail 3816 invoked from network); 12 Mar 2010 23:44:45 -0000\r\nX-Received: from unknown (98.137.34.46)\n  by m11.grp.re1.yahoo.com with QMQP; 12 Mar 2010 23:44:45 -0000\r\nX-Received: from unknown (HELO mail-gy0-f178.google.com) (209.85.160.178)\n  by mta3.grp.sp2.yahoo.com with SMTP; 12 Mar 2010 23:44:44 -0000\r\nX-Received: by gyf3 with SMTP id 3so333119gyf.23\n        for &lt;junit@yahoogroups.com&gt;; Fri, 12 Mar 2010 15:44:44 -0800 (PST)\r\nMIME-Version: 1.0\r\nX-Received: by 10.101.154.5 with SMTP id g5mr2183822ano.224.1268437484107; Fri, \n\t12 Mar 2010 15:44:44 -0800 (PST)\r\nIn-Reply-To: &lt;hlkif2+3mte@...&gt;\r\nReferences: &lt;58dba2251002180943q238dd8dv11ab48736321e178@...&gt;\n\t &lt;hlkif2+3mte@...&gt;\r\nDate: Fri, 12 Mar 2010 17:44:44 -0600\r\nX-Google-Sender-Auth: 0a4482de86243d85\r\nMessage-ID: &lt;58dba2251003121544p3cd7dd28h1a899ce657f66ad3@...&gt;\r\nTo: junit@yahoogroups.com\r\nCc: Shin Hwei Tan &lt;stan6@...&gt;, Sang Y Baik &lt;sybaik2@...&gt;\r\nX-eGroups-Msg-Info: 1:12:0:0:0\r\nX-eGroups-From: Brett Daniel &lt;bdaniel3@...&gt;\r\nFrom: Brett Daniel &lt;brettdaniel@...&gt;\r\nSubject: Re: [junit] Re: @DataPoints called several times for Theories\r\nX-Yahoo-Group-Post: member; u=416009989; y=T8vMzZIipk2MHF9SevWQqStpt_kcNCjeuVRJ7i4RtnKBCph8Y84Y\r\nX-Yahoo-Profile: brettddaniel\r\nContent-Type: text/plain\r\nContent-Transfer-Encoding: quoted-printable\r\nX-Yahoo-Newman-Property: groups-system\r\nX-eGroups-Approved-By: spchappell &lt;simonpeterchappell@...&gt; via web; 13 Mar 2010 01:33:06 -0000\r\n\r\nThe undergrads I am advising recently pushed a patch that addresses the\niss=\r\nue of mutable data points.\n\n\nhttp://github.com/stan6/junit/commit/dcfa3c414=\r\n46c469a4edc7513e9e7a9b610b04020\n\nThe patch allows developers to define &quot;cop=\r\ny strategies&quot; that duplicate\nmarked data points before every theory executi=\r\non. In this way, every\nexecution receives a pristine data point, which remo=\r\nves the problems caused\nwhen a theory mutates data points. This is orthogon=\r\nal to datapoint\n(re)creation, but I think copy strategies may help address =\r\nthe bug that\nBerin found.\n\nThe patch creates a new, optional &quot;copyStrategy&quot;=\r\n parameter for the\n@DataPoint and @DataPoints annotations. If the developer=\r\n wants to copy data\npoints, he or she sets the parameter to a class impleme=\r\nnting a new\nCopyStrategy interface.\n\nHere is an example:\n\n  @RunWith(Theori=\r\nes.class)\n    public class TestMutable {\n\n    @DataPoint(copyStrategy =3D M=\r\nutableWithCopyStrategy.class)\n    public static Mutable mutable =3D new Mut=\r\nable();\n\n    @Theory\n    public static testMutate(Mutable a) {\n      a.muta=\r\nte();\n    }\n\n    @Theory\n    public static testNotMutated(Mutable a) {\n    =\r\n  assertFalse(a.isMutated());\n    }\n  }\n\nIn the current implementation of J=\r\nUnit, the second theory may fail because\nthe first theory mutates the datap=\r\noint. With a copy strategy enabled, both\ntheories receive a new value.\n\nStr=\r\nategies can do almost anything: clone the data point, call a factory\nmethod=\r\n, or--as in the following implementation--instantaiate a new object\nwith a =\r\ncopy constructor.\n\n  public class MutableWithCopyStrategy implements CopySt=\r\nrategy {\n    public Object copyDataPoint(Object toCopy) throws Exception {\n=\r\n      return new Mutable((Mutable)toCopy);\n    }\n  }\n\nThere are several ben=\r\nefits to this implementation. First, the new parameter\nis completely option=\r\nal; if it is omitted, the theory runner behaves as it\nalways has. Second, i=\r\nt doesn&#39;t require modifying the data point&#39;s class (for\nexample, to add a c=\r\nopy constructor or clone method). Most importantly, it\nmakes it clear to th=\r\ne tester that without a copy strategy one theory\nexecution can impact anoth=\r\ner.\n\nI have CC&#39;d the two students in this email. Please direct any question=\r\ns to\nthem.\n\nBrett\n\nOn Thu, Feb 18, 2010 at 5:28 PM, Berin &lt;berin.loritsch@g=\r\nd-ais.com&gt; wrote:\n\n&gt;\n&gt;\n&gt; I agree with your prognosis, about fresh data poin=\r\nts for testing the\n&gt; theories. That is precisely why I proposed reading the=\r\nm once, and cloning\n&gt; them (making a copy) as needed for each theory. With =\r\nthat approach we even\n&gt; get the protection from mutated data points when yo=\r\nu use the @DataPoint to\n&gt; mark a static field.\n&gt;\n&gt; Cloning is a much quicke=\r\nr operation, does not execute any constructors. It\n&gt; merely copies the cont=\r\nents of the object memory verbatim.\n&gt;\n&gt; With the current implementation, if=\r\n you are not prepared for the\n&gt; combinatorial affect of 60 data points comb=\r\nined with 60 data points for each\n&gt; theory there is a major disconnect. The=\r\n majority of the overhead in this\n&gt; particular scenario has to do with crea=\r\nting objects (with the additional\n&gt; overhead of doing it by reflection).\n&gt;\n=\r\n&gt; When I created only one instance of each class instead of two, the\n&gt; perf=\r\normance was twice as fast (i.e. 37 seconds down to about 16 seconds).\n&gt;\n&gt; E=\r\nssentially the number of times your @DataPoints method is called depends\n&gt; =\r\non the number of parameters in your @Theory and how many theories you have.=\r\n\n&gt; Essentially the formula for my theory (ha, ha) of the execution is like\n=\r\n&gt; this:\n&gt;\n&gt; N^(p-1) + 1\n&gt;\n&gt; where:\n&gt;\n&gt; N is the number of data points retur=\r\nned by the method\n&gt; p is the number of parameters\n&gt; and the + 1 represents =\r\nthe run where the data point is read the first time\n&gt;\n&gt; So for 60 data poin=\r\nts it is run 61 times for two parameters. With three\n&gt; parameters it would =\r\nbe called 3601 times. I have to verify with three\n&gt; parameters. The theory =\r\nis called N^p times for sure and that is expected.\n&gt;\n&gt; With the above formu=\r\nla, the mapping of number of calls to parameters for 60\n&gt; data points would=\r\n be:\n&gt;\n&gt; 1 -&gt; 2 (I know this is wrong which gives me doubts on the formula)=\r\n\n&gt; 2 -&gt; 61\n&gt; 3 -&gt; 3601\n&gt; 3 -&gt; 216001\n&gt;\n&gt; Essentially when the Assignments c=\r\nlass needs to make the combinations, it\n&gt; will collect the data points init=\r\nially for each theory. It then calls the\n&gt; data points again for each exist=\r\ning data point it collected from the first\n&gt; read. With a third parameter i=\r\nt would take all those combinations again, to\n&gt; add all the permutations fo=\r\nr the next round.\n&gt;\n&gt; I might be wrong and the real formula would be like t=\r\nhis:\n&gt;\n&gt; N^0 + N^1 ... + N^(p-1)\n&gt;\n&gt; If this is the correct formula, then i=\r\nf you have 60 data points the number\n&gt; of times the method is called would =\r\nmap to the number of parameters like\n&gt; this:\n&gt;\n&gt; 1 -&gt; 1\n&gt; 2 -&gt; 61\n&gt; 3 -&gt; 36=\r\n61\n&gt; 4 -&gt; 219661\n&gt;\n&gt;\n&gt; --- In junit@yahoogroups.com &lt;junit%40yahoogroups.co=\r\nm&gt;, Brett Daniel\n&gt; &lt;brettdaniel@...&gt; wrote:\n&gt; &gt;\n&gt; &gt; Berin,\n&gt; &gt;\n&gt; &gt; When a t=\r\nheory mutates data points, it might be beneficial to recreate\n&gt; &gt; the data =\r\npoint for every theory invocation. Doing so prevents one\n&gt; &gt; theory executi=\r\non from affecting others. I wrote about this issue in\n&gt; &gt; the following web=\r\nlog post:\n&gt; &gt;\n&gt; &gt; http://www.brettdaniel.com/archives/2009/09/24/200845/\n&gt; =\r\n&gt;\n&gt; &gt; You are correct, though, that copying would avoid some of the overhea=\r\nd\n&gt; &gt; in calling datapoint methods. It is interesting you mention this idea=\r\n,\n&gt; &gt; because I am currently overseeing two students who for their senior\n&gt;=\r\n &gt; thesis project are implementing framework for copying datapoints. I\n&gt; &gt; =\r\nwill post more information to the mailing list as the project\n&gt; &gt; continues=\r\n.\n&gt; &gt;\n&gt; &gt; Brett\n&gt; &gt;\n&gt;\n&gt;  \n&gt;\n\n\n[Non-text portions of this message have been =\r\nremoved]\n\n\n", 
    "profile": "brettddaniel", 
    "topicId": 22425, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 416009989, 
    "prevInTime": 22539, 
    "contentTrasformed": false, 
    "postDate": "1268437484", 
    "canDelete": false, 
    "nextInTopic": 22541, 
    "prevInTopic": 22452, 
    "headers": {
        "inReplyToHeader": "PGhsa2lmMiszbXRlQGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PDU4ZGJhMjI1MTAwMzEyMTU0NHAzY2Q3ZGQyOGgxYTg5OWNlNjU3ZjY2YWQzQG1haWwuZ21haWwuY29tPg==", 
        "referencesHeader": "PDU4ZGJhMjI1MTAwMjE4MDk0M3EyMzhkZDhkdjExYWI0ODczNjMyMWUxNzhAbWFpbC5nbWFpbC5jb20+CSA8aGxraWYyKzNtdGVAZUdyb3Vwcy5jb20+"
    }
}
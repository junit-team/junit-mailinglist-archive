{
    "topicId": 1855, 
    "postDate": "994822320", 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "from": "Scott Stirling &lt;sstirling@...&gt;", 
    "canDelete": false, 
    "replyTo": "LIST", 
    "senderId": "mqricxPo9y8nDNy7CmI5Gkcwdz5uvMECohabwWuWh5eWuJEHek0pOos_UYzwJW0wRP8MrMJp7CY51ewNVaNA1lO89_kHewuoYe-61HJYL4Y", 
    "nextInTime": 1865, 
    "userId": 0, 
    "prevInTime": 1863, 
    "prevInTopic": 1862, 
    "headers": {
        "messageIdInHeader": "PEMzODQzQkQxQjgzREQyMTE5RDc5MDAwMDkyQTdCQUQ0MDczMTVCOURAcGxhdGludW0uYWxsYWlyZS5jb20+"
    }, 
    "authorName": "Scott Stirling", 
    "numMessagesInTopic": 11, 
    "msgSnippet": "The JUnit TestCaseClassLoader (the reloadable one) has a fundamental problem that results in frequent LinkageErrors under the following conditions: 1. You use", 
    "contentTrasformed": false, 
    "msgId": 1864, 
    "nextInTopic": 1865, 
    "systemMessage": false, 
    "rawEmail": "Return-Path: &lt;sstirling@...&gt;\r\nX-Sender: sstirling@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (EGP: mail-7_2_0); 11 Jul 2001 03:32:07 -0000\r\nReceived: (qmail 49849 invoked from network); 11 Jul 2001 03:32:07 -0000\r\nReceived: from unknown (10.1.10.27) by l7.egroups.com with QMQP; 11 Jul 2001 03:32:07 -0000\r\nReceived: from unknown (HELO s0001exc0011.allaire.com) (63.109.193.187) by mta2 with SMTP; 11 Jul 2001 03:32:06 -0000\r\nReceived: by S0001EXC0011 with Internet Mail Service (5.5.2650.21) id &lt;MXX4MAQY&gt;; Tue, 10 Jul 2001 23:32:05 -0400\r\nMessage-ID: &lt;C3843BD1B83DD2119D79000092A7BAD407315B9D@...&gt;\r\nTo: &quot;&#39;chw@... &#39;&quot; &lt;chw@...&gt;,  &quot;&#39;junit@yahoogroups.com &#39;&quot; &lt;junit@yahoogroups.com&gt;\r\nSubject: RE: [junit] Class loader error with junit\r\nDate: Tue, 10 Jul 2001 23:32:00 -0400\r\nMIME-Version: 1.0\r\nX-Mailer: Internet Mail Service (5.5.2650.21)\r\nList-Unsubscribe: &lt;mailto:junit-unsubscribe@yahoogroups.com&gt;\r\nContent-Type: text/plain; charset=&quot;iso-8859-1&quot;\r\nFrom: Scott Stirling &lt;sstirling@...&gt;\r\n\r\nThe JUnit TestCaseClassLoader (the reloadable one) has a fundamental problem\nthat results in frequent LinkageErrors under the following conditions:\n\n1. You use the JUnit Swing UI.\n\n2.  You use JAXP in your test cases or any classes referenced in your test\ncases, or even any &quot;instanceof&quot; expressions that reference JAXP classes.\n(By JAXP I mean the whole set of javax.* classes plus the org.w3c.dom.* and\norg.xml.sax.* classes)\n\nI can go into this in depth, but the bottom line problems are that JUnit\nloads classes from the same place as the JVM&#39;s system loader; the classpath.\nThis necessitates the use of an exclusion list to filter out certain class\nnames that either must be loaded by the system loader, or you would like to\nhave loaded by the system loader.  The JUnit loader does not always delegate\nto the system loader when it should, particularly in the case of JAXP, which\nis a weird mix of classes whose names begin with the filtered &quot;javax.*&quot; and\nthe unfiltered &quot;org.w3c.*&quot; and org.xml.*&quot;.\n\nJAXP is a special case because it is based on a set of javax.* classes.  All\njavax.* classes are excluded from the JUnit loader by default (in the\ndefault excluded.properties file) in junit.jar.  But JAXP, as shipped from\nSun, comes with a bunch of other classes in org.w3c.* and org.xml.*.  The\ninteresting thing is a direct dependency between javax.* classes and some\nother classes not in the usual exclusion list of com.sun.*, javax.*, etc.\n\nSo what can happen, and frequently does when using the JUnit Swing UI with\ntest cases or other classes, such as Log4J, that use JAXP, is that the JUnit\nclass loader (properly) delegates javax.xml.* classes it &quot;sees&quot; to the\nsystem loader.  But then the system loader loads up a bunch of org.w3c.dom\nand/or org.xml.sax classes as the result of initializing and loading that\nJAXP class.  Later, if the JUnit loader comes across some org.w3c/xml class\nthat it&#39;s never seen before, it tries to load it because the classname\ndoesn&#39;t match one of the patterns in the exclude list.  \n\nBut it&#39;s already been loaded through the &quot;backdoor&quot; as the result of some\nother class loaded by the system loader (remember, the JVM keeps classes in\ntheir own namespace by identifying them by their fully qualified name plus\nthe instance of their _defining_ (not initiating) loader, AND, the JVM will\nattempt to assign all unloaded classes referenced by a defined class to that\ndefining class&#39;s loader).  The JVM&#39;s classresolver routine keeps track of\nall these class loading events and &quot;sees&quot; that the JUnit loader is\nattempting to define a class that has already been defined by the system\nloader.  That&#39;s wrong because according to the rules of loader constraints,\nJUnit should delegate this load to the system loader.\n\nYou can hack around this (I did) by catching the LinkageError in\nTestCaseClassLoader&#39;s loadClass() method and then making a recovery call to\nfindSystemClass() -- thereby delegating to the system loader after the fact\n(which is OK).  This hack only works some of the time, though, because now\nyou can have the reverse problem where the JUnit loader loads a host of\norg.*.* classes, and then the system loader violates the loader contraints\nat some point when it tries to do exactly what I described above with JAXP\nbecause it doesn&#39;t ever delegate to its child (the JUnit loader).\nInevitably, if your test cases use many JAXP and related XML classes, one or\nthe other ClassLoader will end violating the constraints whatever you do.\n\nSo the solution in the existing JUnit is to definitely add org.w3c.dom.* and\norg.xml.sax.* to your excluded.properties if you&#39;re using any JAXP stuff.\n\nWhat can we learn from this?  Well, one thing is that it&#39;s a good idea to\nhave your custom class loaders load classes from repositories other than the\nsystem classpath.  Note that the JVM&#39;s built-in classloaders work that way\n(one for the jre/ext dirs, another for the java.class.path).\n\nAnyway, the excluded.properties fix is just a matter of time before it\nbecomes standard in JUnit, since JAXP will be a standard part of the 1.4\nJDK.  It&#39;ll be just like having org.omg.* excluded.\n\nScott Stirling\n\n-----Original Message-----\nFrom: chw@...\nTo: junit@yahoogroups.com\nSent: 7/10/01 10:43 PM\nSubject: [junit] Class loader error with junit\n\nFolks:\n\nI am using Junit (I am a newbie at it) with Log4j (which we use \nextensively) and I cannot seem to get the Log4j stuff initialized.  \n\nWhen I put the DOMConfigurator.configure() call from Log4j in main(), \nit is apparently lost when the test cases are run (different class \nloader? causing the singleton functions to use a different set \nobjects?)\n\nWhen I put the Log4j config stuff in the setUp(), I get the following.  \n\nAny suggestions what the problem is and how to work around it? \n\nThanks\n\nCharlie\n\n\njava.lang.LinkageError: Class org/xml/sax/InputSource violates loader \nconstraints\n\tat \norg.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:\n1169)\n\tat \norg.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:\n1039)\n\tat \norg.apache.log4j.xml.DOMConfigurator.configure(DOMConfigurator.java:11\n97)\n\tat \ncom.clearmetrix.outreach.datamodel.VisitorExperienceSqlOperationTestCa\nse.setUp(VisitorExperienceSqlOperationTestCase.java:38)\n\n\n\nTo unsubscribe from this group, send an email to:\njunit-unsubscribe@yahoogroups.com\n \n\nYour use of Yahoo! Groups is subject to\nhttp://docs.yahoo.com/info/terms/ \n\n\n", 
    "subject": "RE: [junit] Class loader error with junit"
}
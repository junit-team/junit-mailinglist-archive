{
    "numMessagesInTopic": 9, 
    "nextInTime": 1950, 
    "senderId": "A2PpsnupzzHYMAkL0o0MfdEPD4EIR9S4bn5ENlgKDlRLPMxdIb7sKyNal8N8XMd1nKtHbw-0hsBJZhQ881zZigXsQafDTWhNQqvB8cENDIo", 
    "systemMessage": false, 
    "subject": "RE: [junit] ClassCastException only using swing/awt ui", 
    "from": "Scott Stirling &lt;sstirling@...&gt;", 
    "authorName": "Scott Stirling", 
    "msgSnippet": "Shoot -- always something wrong. This line: System.out.println(ctx.lookup( base/PointHome )); ...should say: ", 
    "msgId": 1949, 
    "topicId": 1943, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 0, 
    "messageBody": "<div id=\"ygrps-yiv-1699439095\">Shoot -- always something wrong.<br/>\n<br/>\nThis line:<br/>\n<br/>\nSystem.out.println(ctx.lookup(&quot;base/PointHome&quot;));<br/>\n<br/>\n...should say:<br/>\n<br/>\nSystem.out.println(ctx.lookup(&quot;base/PointHome&quot;).getClass().getClassLoader())<br/>\n;<br/>\n<br/>\nSorry,<br/>\n<br/>\nScott Stirling<br/>\nJRun QA<br/>\nMacromedia<br/>\n<br/>\n<blockquote><span title=\"ireply\"> &gt; -----Original Message-----<br/>\n&gt; From: Scott Stirling [mailto:<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:sstirling@...\">sstirling@...</a>]<br/>\n&gt; Sent: Monday, July 16, 2001 5:12 PM<br/>\n&gt; To: &#39;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>&#39;<br/>\n&gt; Subject: RE: [junit] ClassCastException only using swing/awt ui<br/>\n&gt; <br/>\n&gt; <br/>\n&gt; Interestingly, calls to javax.rmi.PortableRemoteObject are <br/>\n&gt; delegated to an<br/>\n&gt; implementation of <br/>\n&gt; javax.rmi.CORBA.PortableRemoteObjectDelegate, which in<br/>\n&gt; Sun&#39;s 1.3.1 JDK is <br/>\n&gt; com.sun.corba.se.internal.javax.rmi.PortableRemoteObject.<br/>\n&gt; That doesn&#39;t explain anything -- I just thought it was just kinda<br/>\n&gt; interesting how buried that reference was.<br/>\n&gt; <br/>\n&gt; Anyway, this is another problem inherent to JUnit&#39;s Swingui&#39;s<br/>\n&gt; TestCaseClassLoader architecture.  Similar to the <br/>\n&gt; LinkageErrors with JAXP<br/>\n&gt; and the org.xml and org.w3c classes, but with a different result here.<br/>\n&gt; We&#39;ve seen it here with EJB lookups too, but we mostly use <br/>\n&gt; the Ant runner so<br/>\n&gt; it&#39;s not usually a problem.<br/>\n&gt; <br/>\n&gt; So why a ClassCastException when you narrow() in a TestCase?  <br/>\n&gt; <br/>\n&gt; Here&#39;s John Pletka&#39;s test code:<br/>\n&gt; <br/>\n&gt; Point point;<br/>\n&gt; PointHome pointHome;<br/>\n&gt; <br/>\n&gt; //The next line works in textui, but throws <br/>\n&gt; //ClassCastException in swingui<br/>\n&gt; pointHome =<br/>\n&gt; (PointHome)PortableRemoteObject.narrow(ctx.lookup(&quot;base/PointH<br/>\n&gt; ome&quot;),PointHom<br/>\n&gt; e.class);<br/>\n&gt; <br/>\n&gt; Recall that in Java 2 an object&#39;s class (aka &quot;runtime type&quot;) <br/>\n&gt; is identified<br/>\n&gt; in the JVM as <br/>\n&gt; &lt;fully-qualified-classname;definingClassLoaderInstance&gt; or<br/>\n&gt; &lt;C;L&gt;.  That is, the defining loader is part of the runtime <br/>\n&gt; name identifying<br/>\n&gt; that class (there&#39;s a subtle distinction in Java between <br/>\n&gt; &#39;class&#39; and &#39;type&#39;<br/>\n&gt; I won&#39;t go into).  Also recall that the JVM will ask a <br/>\n&gt; class&#39;s defining<br/>\n&gt; loader to load all unloaded classes referenced by the classes <br/>\n&gt; it loads.<br/>\n&gt; <br/>\n&gt; My hypothesis (I just tested it here and proved it) is that <br/>\n&gt; the ctx.lookup()<br/>\n&gt; returns an object that was loaded through the JVM&#39;s system classloader<br/>\n&gt; (sun.misc.Launcher$AppClassLoader), but the PointHome.class <br/>\n&gt; type is loaded<br/>\n&gt; by JUnit&#39;s TestCaseClassLoader.  In the narrow, the two fully <br/>\n&gt; qualified<br/>\n&gt; class names are the same, but the defining classloaders for <br/>\n&gt; the two are<br/>\n&gt; different so you get the exception because the JVM doesn&#39;t <br/>\n&gt; see them as being<br/>\n&gt; the same &lt;C;L&gt; class/type.<br/>\n&gt; <br/>\n&gt; The solution would be to exclude your EJB&#39;s interface classes <br/>\n&gt; from being<br/>\n&gt; loaded by the JUnit custom class loader by adding them to the<br/>\n&gt; excluded.properties in junit.jar.  Granted, not a very nice <br/>\n&gt; solution unless,<br/>\n&gt; perhaps, it were easier to modify the exclusion list.  I hear <br/>\n&gt; in JUnit 4.0<br/>\n&gt; that one idea is to make it easy to define exclusions in TestCases<br/>\n&gt; themselves.<br/>\n&gt; <br/>\n&gt; You can find out more about which loader loaded which class <br/>\n&gt; by doing this:<br/>\n&gt; <br/>\n&gt; System.out.println(ctx.lookup(&quot;base/PointHome&quot;));<br/>\n&gt; System.out.println(PointHome.class.getClassLoader());<br/>\n&gt; <br/>\n&gt; I bet you&#39;ll find when using the Swing UI that the PointHome <br/>\n&gt; type is defined<br/>\n&gt; by the JUnit TestCaseClassLoader and the object returned from <br/>\n&gt; ctx.lookup()<br/>\n&gt; was defined through the JVM&#39;s system class loader.  When <br/>\n&gt; using the textui<br/>\n&gt; they&#39;ll both load through the system loader.<br/>\n&gt; <br/>\n&gt; Scott Stirling<br/>\n&gt; JRun QA<br/>\n&gt; Macromedia<br/>\n&gt; <br/>\n&gt; &gt; -----Original Message-----<br/>\n&gt; &gt; From: Mike Lepine [mailto:<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:mike.lepine@...\">mike.lepine@...</a>]<br/>\n&gt; &gt; Sent: Monday, July 16, 2001 2:45 PM<br/>\n&gt; &gt; To: <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a><br/>\n&gt; &gt; Subject: RE: [junit] ClassCastException only using swing/awt ui<br/>\n&gt; &gt; <br/>\n&gt; &gt; <br/>\n&gt; &gt; Thank goodness. I did finally come to the same conclusion that the<br/>\n&gt; &gt; swingui.TestRunner was responsible (and not the JNDI code) for the<br/>\n&gt; &gt; ClassCastExceptions I was getting when retrieving an object <br/>\n&gt; &gt; from JNDI. I<br/>\n&gt; &gt; haven&#39;t looked through the TestRunner source to determine why <br/>\n&gt; &gt; this occurs<br/>\n&gt; &gt; but am also interested to know the answer.<br/>\n&gt; <br/>\n&gt; ------------------------ Yahoo! Groups Sponsor <br/>\n&gt; ---------------------~--&gt;<br/>\n&gt; Secure your servers with 128-bit SSL encryption! Grab your copy of<br/>\n&gt; VeriSign&#39;s FREE Guide &quot;Securing Your Web Site for Business.&quot; <br/>\n&gt; Get it now!<br/>\n&gt; <a rel=\"nofollow\" target=\"_blank\" href=\"http://www.verisign.com/cgi-bin/go.cgi?a=n094442340008000\">http://www.verisign.com/cgi-bin/go.cgi?a=n094442340008000</a><br/>\n&gt; <a rel=\"nofollow\" target=\"_blank\" href=\"http://us.click.yahoo.com/6lIgYB/IWxCAA/yigFAA/NhFolB/TM\">http://us.click.yahoo.com/6lIgYB/IWxCAA/yigFAA/NhFolB/TM</a><br/>\n&gt; --------------------------------------------------------------<br/>\n&gt; -------~-&gt;<br/>\n&gt; <br/>\n&gt; To unsubscribe from this group, send an email to:<br/>\n&gt; <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit-unsubscribe@yahoogroups.com\">junit-unsubscribe@yahoogroups.com</a><br/>\n&gt;  <br/>\n&gt; <br/>\n&gt; Your use of Yahoo! Groups is subject to <br/>\n </span></blockquote><a rel=\"nofollow\" target=\"_blank\" href=\"http://docs.yahoo.com/info/terms/\">http://docs.yahoo.com/info/terms/</a></div>", 
    "prevInTime": 1948, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "995318246", 
    "canDelete": false, 
    "nextInTopic": 1973, 
    "prevInTopic": 1948, 
    "headers": {
        "messageIdInHeader": "PEM3QUJBMzE1MjA1Q0Q0MTE4Q0U2MDA1MDhCOTUyRDk2NTVGQjY1QHNhbHNhLmFsbGFpcmUuY29tPg=="
    }
}
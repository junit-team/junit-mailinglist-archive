{
    "numMessagesInTopic": 125, 
    "nextInTime": 14660, 
    "senderId": "k8DkRLI96xRlM9xw2EUxw0cUycoPPdVIc_OyWDLBv62bBCr2YlFn_ieB6777_U8Q-qjmFjARoN9qPM-GIfouE7GuoZVuJJbrR19RDoMtBwfB", 
    "systemMessage": true, 
    "subject": "RE: [junit] Re: How to test private methods in a class.", 
    "from": "&quot;Iliya Agoshkov&quot; &lt;Iliya.Agoshkov@...&gt;", 
    "authorName": "Iliya Agoshkov", 
    "msgSnippet": "Hi, Robert. Thanks a lot for your design solution. But this QueryBuilder class looks for me more like FlightSearchQueryBuilder, as it doesn t provide any", 
    "msgId": 14659, 
    "profile": "agoshkoviv", 
    "topicId": 14490, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 234978661, 
    "messageBody": "<div id=\"ygrps-yiv-562127972\">Hi, Robert.<br/>\n<br/>\n <br/>\n<br/>\nThanks a lot for your design solution.<br/>\n<br/>\n <br/>\n<br/>\nBut this QueryBuilder class looks for me more like<br/>\nFlightSearchQueryBuilder, as it doesn&#39;t provide any useful functionality<br/>\nfor any places other<br/>\n<br/>\nthen presented &#39;search&#39; method.<br/>\n<br/>\n <br/>\n<br/>\nBut that&#39;s ok anyway. I&#39;ve got the idea.<br/>\n<br/>\nLooks like &quot;the more you refactor the closer you come to a better<br/>\nsolution&quot;.<br/>\n<br/>\n <br/>\n<br/>\nConsider the following example (these are methods of the same class<br/>\nwhich has the &#39;search(...)&#39; method):<br/>\n<br/>\n <br/>\n<br/>\npublic class FlightSearch<br/>\n<br/>\n{<br/>\n<br/>\n....<br/>\n<br/>\n            /**<br/>\n<br/>\n             * Prints all the cities (and airports) and airlines,<br/>\nspecifying &quot;selected&quot; attribute<br/>\n<br/>\n             * near those cities(airports) and airlines which were<br/>\nchosen by user in search parameters.<br/>\n<br/>\n             * The &quot;selected&quot; attribute is needed to show &quot;search form&quot;<br/>\nback to user, with corresponding<br/>\n<br/>\n             * cities(airports) and airlines selected.<br/>\n<br/>\n             *<br/>\n<br/>\n             * @param xmlBuf                     the buffer where to<br/>\nprint XML, must be not &lt;code&gt;null&lt;/code&gt;<br/>\n<br/>\n             * @param searchParams          search parameters specified<br/>\nby user, if &lt;code&gt;null&lt;/code&gt;<br/>\n<br/>\n             *<br/>\nthen no &quot;selected&quot; attribute will be appended<br/>\n<br/>\n             */<br/>\n<br/>\n            private void printSearchFormXML( XMLBuffer xmlBuf,<br/>\nFlightSearchParameters searchParams )<br/>\n<br/>\n            {<br/>\n<br/>\n                        xmlBuf.openTag( &quot;search-form&quot; );<br/>\n<br/>\n                        printCities( xmlBuf, searchParams );<br/>\n<br/>\n                        printAirlines( xmlBuf, searchParams );<br/>\n<br/>\n                        xmlBuf.closeTag( &quot;search-form&quot; );<br/>\n<br/>\n            }<br/>\n<br/>\n <br/>\n<br/>\n            /**<br/>\n<br/>\n             * Prints all airlines, specifying &quot;selected&quot; attribute near<br/>\nairlines which were chosen by user<br/>\n<br/>\n             * in search parameters.<br/>\n<br/>\n             * The &quot;selected&quot; attribute is needed to show &quot;search form&quot;<br/>\nback to user, with corresponding<br/>\n<br/>\n             * airlines selected.<br/>\n<br/>\n             * This method is used internally in {@link<br/>\n#printSearchFormXML}<br/>\n<br/>\n             *<br/>\n<br/>\n             * @param xmlBuf                     the buffer where to<br/>\nprint XML, must be not &lt;code&gt;null&lt;/code&gt;<br/>\n<br/>\n             * @param params                    search parameters<br/>\nspecified by user, must be not &lt;code&gt;null&lt;/code&gt;<br/>\n<br/>\n             * @see              #printSearchFormXML<br/>\n<br/>\n             */<br/>\n<br/>\n            private void printAirlines( XMLBuffer xmlBuf,<br/>\nFlightSearchParameters params )<br/>\n<br/>\n            {<br/>\n<br/>\n                        xmlBuf.openTag( &quot;airlines&quot; );<br/>\n<br/>\n                        Collection airlines = Airline.getList();<br/>\n<br/>\n                        Iterator airlinesIt = airlines.iterator();<br/>\n<br/>\n                        String selectedAirlineId = params != null ?<br/>\nparams.getAirlineId() : null;<br/>\n<br/>\n                        while ( airlinesIt.hasNext() )<br/>\n<br/>\n                        {<br/>\n<br/>\n                                    Airline airline = ( Airline )<br/>\nairlinesIt.next();<br/>\n<br/>\n                                    boolean selected = false;<br/>\n<br/>\n                                    if (<br/>\nairline.getId().equalsIgnoreCase( selectedAirlineId ) )<br/>\n<br/>\n                                    {<br/>\n<br/>\n                                                selected = true;<br/>\n<br/>\n                                    }<br/>\n<br/>\n                                    airline.printXML( xmlBuf, selected<br/>\n);<br/>\n<br/>\n                        }<br/>\n<br/>\n                        xmlBuf.closeTag( &quot;airlines&quot; );<br/>\n<br/>\n            }<br/>\n<br/>\n <br/>\n<br/>\n            /**<br/>\n<br/>\n             * Prints all cities(airports), specifying &quot;selected&quot;<br/>\nattribute near cities(airports) which were chosen<br/>\n<br/>\n             * by user in search parameters.<br/>\n<br/>\n             * The &quot;selected&quot; attribute is needed to show &quot;search form&quot;<br/>\nback to user, with corresponding<br/>\n<br/>\n             * cities(airports) selected.<br/>\n<br/>\n             * This method is used internally in {@link<br/>\n#printSearchFormXML}<br/>\n<br/>\n             *<br/>\n<br/>\n             * @param xmlBuf                     the buffer where to<br/>\nprint XML, must be not &lt;code&gt;null&lt;/code&gt;<br/>\n<br/>\n             * @param params                    search parameters<br/>\nspecified by user, must be not &lt;code&gt;null&lt;/code&gt;<br/>\n<br/>\n             * @see              #printSearchFormXML<br/>\n<br/>\n             */<br/>\n<br/>\n            private void printCities( XMLBuffer xmlBuf,<br/>\nFlightSearchParameters params )<br/>\n<br/>\n            {<br/>\n<br/>\n                        xmlBuf.openTag( &quot;cities&quot; );<br/>\n<br/>\n                        Collection cities = City.getList();<br/>\n<br/>\n                        Iterator citiesIt = cities.iterator();<br/>\n<br/>\n                        String selectedAirportId = params != null ?<br/>\nparams.getAirportId() : null;<br/>\n<br/>\n                        String selectedCityId = params != null ?<br/>\nparams.getCityId() : null;<br/>\n<br/>\n                        while ( citiesIt.hasNext() )<br/>\n<br/>\n                        {<br/>\n<br/>\n                                    City city = ( City )<br/>\ncitiesIt.next();<br/>\n<br/>\n                                    boolean selected = false;<br/>\n<br/>\n                                    if ( city.getId().equalsIgnoreCase(<br/>\nselectedCityId ) )<br/>\n<br/>\n                                    {<br/>\n<br/>\n                                                selected = true;<br/>\n<br/>\n                                    }<br/>\n<br/>\n                                    city.printXML( xmlBuf, true,<br/>\nselected, selectedAirportId );<br/>\n<br/>\n                        }<br/>\n<br/>\n                        xmlBuf.closeTag( &quot;cities&quot; );<br/>\n<br/>\n            }<br/>\n<br/>\n...<br/>\n<br/>\n}<br/>\n<br/>\n <br/>\n<br/>\npublic class FlightSearchParameters<br/>\n<br/>\n{<br/>\n<br/>\n            private String vnukovoAirportId;<br/>\n<br/>\n            private String cityId;<br/>\n<br/>\n            private String airportId;<br/>\n<br/>\n            private int direction;<br/>\n<br/>\n            private Date date;<br/>\n<br/>\n            private String airlineId;<br/>\n<br/>\n <br/>\n<br/>\n//// +constructor and lots of getters methods<br/>\n<br/>\n}<br/>\n<br/>\n <br/>\n<br/>\nThe whole idea is that all these methods print XML to XMLBuffer and the<br/>\nonly thing changing in this XML from time to time is that<br/>\n&#39;selected=&quot;true&quot;&#39; attribute<br/>\n<br/>\nadded in those nodes which correspond to parameters in<br/>\nFlightSearchParameters.<br/>\n<br/>\nSo when we print collection of Airlines to XML one of them can be<br/>\nselected and the selected=&#39;true&#39; is placed in this node. (selected means<br/>\nthat flightSearchParameters.getAirlineId().equals(<br/>\ncurrentPrintedAirlineId ))<br/>\n<br/>\nWith cities situation is some more complicated, as each city can have<br/>\nmultiple airports inside (and some of airports may be selected), so I<br/>\npass selectedAirportId parameters to city.printXML(...).<br/>\n<br/>\n <br/>\n<br/>\nCan you suggest any better solution?<br/>\n<br/>\n <br/>\n<br/>\nP.S. Sorry for such a large listing.<br/>\n<br/>\n <br/>\n<br/>\n-----Original Message-----<br/>\nFrom: <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a> [mailto:<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>] On Behalf Of<br/>\nRobert<br/>\nSent: Monday, September 05, 2005 3:19 PM<br/>\nTo: <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a><br/>\nSubject: [junit] Re: How to test private methods in a class.<br/>\n<br/>\n <br/>\n<br/>\n--- In <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>, &quot;Iliya Agoshkov&quot; &lt;Iliya.Agoshkov@a...&gt;<br/>\nwrote:<br/>\n<blockquote><span title=\"ireply\"> &gt; Continuing about testing private methods.<br/>\n&gt; What if a private method represent some kind of functionality that<br/>\n </span></blockquote>is<br/>\n<blockquote><span title=\"ireply\"> &gt; needed only to this concrete class.<br/>\n&gt; You know sometimes there is a big method which is not clearly<br/>\n </span></blockquote>readable.<br/>\n<blockquote><span title=\"ireply\"> &gt; So usually I extract some smaller pieces of code naming them<br/>\n&gt; correspondingly.<br/>\n&gt; So the code becomes more readable. But these methods are private<br/>\n </span></blockquote>and it<br/>\n<blockquote><span title=\"ireply\"> &gt; seems to me,<br/>\n&gt; that there is no way to extract them to a separate class.<br/>\n<br/>\n </span></blockquote>I extract private methods out of public methods to improve<br/>\nreadability. I transform private methods into methods on new classes<br/>\nto improve testability - there are different drivers in force.<br/>\n<br/>\nIn your particular example, I&#39;d create a QueryBuilder class, and I&#39;d<br/>\nprobably put some more smarts into the FlightSearchParameters. Try<br/>\nsomething like this:<br/>\n<br/>\npublic static Collection&lt;Flight&gt; search(FlightSearchParameters<br/>\nparams) {<br/>\n  QueryBuilder builder = new QueryBuilder(params);<br/>\n  builder.addDirections();<br/>\n  builder.addAirline();<br/>\n  builder.addDate();<br/>\n<br/>\n  Query&lt;Flight&gt; query = builder.buildQuery(Flight.class);<br/>\n  return query.execute();<br/>\n}<br/>\n<br/>\nThis should be reasonably testable - if you need a bit more, consider<br/>\nadding a QueryBuilderFactory, which would let you drop in mock<br/>\nQueryBuilders to test the construction of the query.<br/>\n<br/>\nThe &quot;addDirections()&quot;, &quot;addAirline()&quot;, &quot;addDate()&quot; methods would<br/>\nessentially do the logic you&#39;ve got in each part of the query<br/>\nconstruction. For example, addDirections() would look like this:<br/>\n<br/>\npublic void addDirections() {<br/>\n  if ( params.getCityId() != null ) {          <br/>\n    addDirectionFilter( params, whereString, whereParams,<br/>\n&quot;T_AIRPORT.XM_CITY_ID&quot;, params.getCityId() );<br/>\n  } else {<br/>\n    addDirectionFilter( params, whereString, whereParams,<br/>\n&quot;T_AIRPORT.M_ID&quot;, params.getAirportId() );<br/>\n  }<br/>\n}<br/>\n<br/>\nThe Query class would be constructed with SQL and parameters, as built<br/>\nup by the QueryBuilder. The execute method would execute the SQL.<br/>\n<br/>\nThe first time I did this, it would end up as an inner class of<br/>\nwhatever the search() method is in. Over time, as other methods would<br/>\nget written, I would extract out bits and pieces. For example, the<br/>\nQuery class is extremely re-usable would come out very fast. The<br/>\nQueryBuilder class, by contrast, would become public fairly slowly,<br/>\nand there may well be a few different implementations to present a<br/>\nsuitable specialised interface. It&#39;s also possible that I would move<br/>\nthe smarts back to the SearchParameters - this would allow me to have<br/>\na reasonable generic QueryBuilder, with customised search parameters.<br/>\n<br/>\nThe interesting part here is that I can obtain this solution from the<br/>\nexisting code fairly easily by applying some simple &quot;Extract Method&quot;<br/>\nrefactorings, plus a coulple of &quot;Extract Method Object&quot; refactorings.<br/>\nThese tend to be very &quot;safe&quot; refactorings, which means I would be<br/>\nconfident enough to do it on a code base with otherwise shaky tests.<br/>\n<br/>\nHope this helps.<br/>\n<br/>\n<blockquote><span title=\"ireply\"> &gt; How do I test these all &#39;addXXXFilter&#39; methods? <br/>\n<br/>\n </span></blockquote>As you&#39;d eat an elephant - one bite at a time.<br/>\n<br/>\n<blockquote><span title=\"ireply\"> &gt; Or I don&#39;t need to test em at all (cause they are tested through the<br/>\n&gt; test of &#39;public search(...)&#39; method)??<br/>\n<br/>\n </span></blockquote>No, you do need to test them, because they can fail. However, you<br/>\ndon&#39;t want to test all the permutations. By breaking them out, you can<br/>\neasily see what happens.<br/>\n<br/>\n<blockquote><span title=\"ireply\"> &gt; Or may be you can suggest a better design solution?<br/>\n<br/>\n </span></blockquote>Maybe. Maybe I didn&#39;t - I don&#39;t have the context to answer the<br/>\nquestion. I can confidently say I&#39;ve presented a _different_ design<br/>\nsolution, though.<br/>\n<br/>\nRobert.<br/>\n<br/>\n<br/>\n<br/>\n<br/>\n<br/>\n<br/>\n________________________________<br/>\n<br/>\nYAHOO! GROUPS LINKS <br/>\n<br/>\n <br/>\n<br/>\n*          Visit your group &quot;junit &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"http://groups.yahoo.com/group/junit\">http://groups.yahoo.com/group/junit</a>&gt;<br/>\n&quot; on the web.<br/>\n  <br/>\n<br/>\n*          To unsubscribe from this group, send an email to:<br/>\n <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit-unsubscribe@yahoogroups.com\">junit-unsubscribe@yahoogroups.com</a><br/>\n&lt;mailto:<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit-unsubscribe@yahoogroups.com\">junit-unsubscribe@yahoogroups.com</a>?subject=Unsubscribe&gt; <br/>\n  <br/>\n<br/>\n*          Your use of Yahoo! Groups is subject to the Yahoo! Terms of<br/>\nService &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"http://docs.yahoo.com/info/terms/\">http://docs.yahoo.com/info/terms/</a>&gt; . <br/>\n<br/>\n <br/>\n<br/>\n________________________________<br/>\n<br/>\n<br/>\n<br/>\n[Non-text portions of this message have been removed]</div>", 
    "prevInTime": 14658, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1125923469", 
    "canDelete": false, 
    "nextInTopic": 14661, 
    "prevInTopic": 14658, 
    "headers": {
        "messageIdInHeader": "PDlCRUFBMUI4Njc4MzM0NEJBNkNGOUI5NUY1QjYyMDkyM0MxODhCQG5ld3Rvbi5ocS5hY3Rpcy5ydT4="
    }
}
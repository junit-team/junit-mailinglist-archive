{
    "numMessagesInTopic": 7, 
    "nextInTime": 20734, 
    "senderId": "8TdBs8TNg0M2Z0iZ2_zanuyfgaoT07NVhY4RpVcX_aIVtd33jGrtZYVnY2252rgzfHpkM0pfIM22cl8oz-ZHBGK7JQcAsCplOBrTY7SeTvG_", 
    "systemMessage": false, 
    "subject": "Re: [junit] Running parallel tests in JUnit4.4+", 
    "from": "Daniel Brolund &lt;daniel.brolund@...&gt;", 
    "authorName": "Daniel Brolund", 
    "msgSnippet": "Hi David, The solution in my email proved unuseful for nested suites, since each suite needs its own thread pool ﻿(an ExecutorService). This leeds to ", 
    "msgId": 20733, 
    "profile": "daniel.brolund", 
    "topicId": 20427, 
    "spamInfo": {
        "reason": "3", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 331284687, 
    "messageBody": "<div id=\"ygrps-yiv-367054801\">Hi David,<br/>\n<br/>\nThe solution in my email proved unuseful for nested suites, since each<br/>\nsuite needs its own &quot;thread pool&quot; ﻿(an ExecutorService). This leeds to<br/>\nresource starvation. The solution to that was to try to share the<br/>\n&quot;thread pool&quot;, and that ended in a static property/flag mess. It kind of<br/>\nworked, but it was (is) a mess.<br/>\n<br/>\n﻿I found it a bit hard to get control over the execution, probably<br/>\nbecause of the recursive nature of the execution with run/runChildren,<br/>\nand when I tried to do just a little bit more I felt like I was<br/>\nreimplementing JUnit.<br/>\n<br/>\nAFAIKS, the structure of execution has changed a lot to the better in<br/>\nJUnit4.5 with the Statements, but in the parallelization case I&#39;m<br/>\nworried that this just encapsulates the recursion for the suites, e.g.:<br/>\n<br/>\nprotected Statement childrenInvoker(final RunNotifier notifier) {<br/>\n  return new Statement() {<br/>\n  @Override<br/>\n  public void evaluate() {<br/>\n    runChildren(notifier);<br/>\n  }};<br/>\n}<br/>\n<br/>\nand it doesn&#39;t provide the means to get to the core blocks that we<br/>\nreally want to parallelize. <br/>\n<br/>\nThe next step might be that Statements (or some derivative thereof)<br/>\nare: <br/>\n* hierachial<br/>\n* traversable<br/>\n* dependable<br/>\n<br/>\nThen you can choose different traversers to either:<br/>\n1. traverse the statement hierarchy and evaluate (current behavior)<br/>\n2. ﻿traverse the statement hierarchy, resolve dependenices and execute<br/>\nin dependency order<br/>\n3. 2) + ignore dependent tests<br/>\n4. 1), 2) or 3) + parallelize execution<br/>\n<br/>\nCan you give me a reality check on this? I probably have missed some of<br/>\nyour discussions around Statements.<br/>\n <br/>\nCheers<br/>\nDaniel<br/>\n<br/>\n<br/>\n<br/>\n<br/>\n<blockquote><span title=\"qreply\"> On Thu, 2008-07-31 at 11:47 -0400, David Saff wrote:<br/>\n&gt; Daniel,<br/>\n&gt; <br/>\n&gt; Per my earlier message, did this go anywhere? Thanks,<br/>\n&gt; <br/>\n&gt; David Saff<br/>\n&gt; <br/>\n&gt; On Thu, Apr 3, 2008 at 3:51 PM, James Abley &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:james.abley@...\">james.abley@...</a>&gt;<br/>\n&gt; wrote:<br/>\n&gt; &gt; On 03/04/2008, Daniel Brolund &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:daniel.brolund@...\">daniel.brolund@...</a>&gt; wrote:<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; Hi all,<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; I&#39;ve been looking around a bit for some sort of parallel execution<br/>\n&gt; of<br/>\n&gt; &gt;&gt; JUnit 4.4+ tests, but I didn&#39;t find much.<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; So, I tried a few things myself and came up with the two examples<br/>\n&gt; below;<br/>\n&gt; &gt;&gt; one is a parallel suite, and the other is for running parameterized<br/>\n&gt; test<br/>\n&gt; &gt;&gt; instances in parallel. It is almost too simple for me to really<br/>\n&gt; believe<br/>\n&gt; &gt;&gt; in it. ;-)<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; I would really like some feedback on it; things I&#39;ve missed, cases<br/>\n&gt; where<br/>\n&gt; &gt;&gt; it won&#39;t work etc.<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; ===========================================<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; package com.agical.junit;<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; import java.util.List;<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; import org.junit.internal.runners.InitializationError;<br/>\n&gt; &gt;&gt; import org.junit.runner.Runner;<br/>\n&gt; &gt;&gt; import org.junit.runner.notification.RunNotifier;<br/>\n&gt; &gt;&gt; import org.junit.runners.Suite;<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; public class ParallelSuite extends Suite {<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; public ParallelSuite(Class&lt;?&gt; klass) throws InitializationError {<br/>\n&gt; &gt;&gt; super(klass);<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; public ParallelSuite(Class&lt;?&gt; klass, Class&lt;?&gt;[] annotatedClasses)<br/>\n&gt; &gt;&gt; throws InitializationError {<br/>\n&gt; &gt;&gt; super(klass, annotatedClasses);<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; @Override<br/>\n&gt; &gt;&gt; protected void runChildren(final RunNotifier runNotifier) {<br/>\n&gt; &gt;&gt; final List&lt;Runner&gt; runners = getRunners();<br/>\n&gt; &gt;&gt; runRunnersInParallel(runNotifier, runners);<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; public static void runRunnersInParallel(final RunNotifier<br/>\n&gt; &gt;&gt; runNotifier,<br/>\n&gt; &gt;&gt; final List&lt;Runner&gt; runners) {<br/>\n&gt; &gt;&gt; Thread[] threads = new Thread[runners.size()];<br/>\n&gt; &gt;&gt; for (int i = 0; i &lt; threads.length; i++) {<br/>\n&gt; &gt;&gt; final int index = i;<br/>\n&gt; &gt;&gt; threads[i] = new Thread(new Runnable() {<br/>\n&gt; &gt;&gt; public void run() {<br/>\n&gt; &gt;&gt; runners.get(index).run(runNotifier);<br/>\n&gt; &gt;&gt; }});<br/>\n&gt; &gt;&gt; threads[i].start();<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt; for (int i = 0; i &lt; threads.length; i++) {<br/>\n&gt; &gt;&gt; try {<br/>\n&gt; &gt;&gt; threads[i].join();<br/>\n&gt; &gt;&gt; } catch (InterruptedException e) {<br/>\n&gt; &gt;&gt; throw new RuntimeException(&quot;Couldn&#39;t join thread<br/>\n&gt; &gt;&gt; nicely&quot;, e);<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; ===========================================<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; package com.agical.junit;<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; import java.util.List;<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; import org.junit.runner.Runner;<br/>\n&gt; &gt;&gt; import org.junit.runner.notification.RunNotifier;<br/>\n&gt; &gt;&gt; import org.junit.runners.Parameterized;<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; public class ParallelAndParameterized extends Parameterized {<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; public ParallelAndParameterized(Class&lt;?&gt; klass) throws Exception {<br/>\n&gt; &gt;&gt; super(klass);<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; @Override<br/>\n&gt; &gt;&gt; protected void runChildren(final RunNotifier runNotifier) {<br/>\n&gt; &gt;&gt; final List&lt;Runner&gt; runners = getRunners();<br/>\n&gt; &gt;&gt; ParallelSuite.runRunnersInParallel(runNotifier, runners);<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt; }<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; ===========================================<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; There is still some work needed to be done, but I would like to<br/>\n&gt; hear if<br/>\n&gt; &gt;&gt; I&#39;m totally on the wrong path.<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;&gt; Cheers<br/>\n&gt; &gt;&gt; Daniel<br/>\n&gt; &gt;&gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt; Hi Daniel,<br/>\n&gt; &gt;<br/>\n&gt; &gt; Nice thinking. Did you consider using<br/>\n&gt; &gt; java.util.concurrent.CountDownLatch and maybe the Executor<br/>\n&gt; framework?<br/>\n&gt; &gt; That might better communicate the intention.<br/>\n&gt; &gt;<br/>\n&gt; &gt; Regards,<br/>\n&gt; &gt;<br/>\n&gt; &gt; James<br/>\n&gt; &gt;<br/>\n&gt; &gt; ------------------------------------<br/>\n&gt; &gt;<br/>\n&gt; &gt; Yahoo! Groups Links<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; <br/>\n&gt; <br/>\n&gt; <br/>\n&gt; </span></blockquote></div>", 
    "prevInTime": 20732, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1217547782", 
    "canDelete": false, 
    "nextInTopic": 20734, 
    "prevInTopic": 20730, 
    "headers": {
        "inReplyToHeader": "PDRmN2RhNmI5MDgwNzMxMDg0N3Y1M2ZkNGEwNW84ODZjYjc3NzVkYTMyN2E1QG1haWwuZ21haWwuY29tPg==", 
        "messageIdInHeader": "PDEyMTc1NDc3ODIuNjU1NS4yNDMuY2FtZWxAZGFuaWVsLXVidW50dT4=", 
        "referencesHeader": "PDEyMDcyMzQ0NjEuMTgzNDcuNDAuY2FtZWxAZGFuaWVsLWt1YnVudHU+CSA8MjNmY2U4ZTYwODA0MDMxMjUxaDNlYTVmOGU4bjExZjM1MjRhYjg3OGViOWZAbWFpbC5nbWFpbC5jb20+CSA8NGY3ZGE2YjkwODA3MzEwODQ3djUzZmQ0YTA1bzg4NmNiNzc3NWRhMzI3YTVAbWFpbC5nbWFpbC5jb20+"
    }
}
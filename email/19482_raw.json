{
    "numMessagesInTopic": 2, 
    "nextInTime": 19483, 
    "senderId": "jqEzw6RBiPUX_i5XCYiULQeOfqRp-AmgDriFYZg7Mwj4MWyMXAl-qgcwVo8zIAg5PWo6Xd_zard3D-tGlqQGI9nkMo7jGwBN3oYNIHdKyHYJQd8", 
    "systemMessage": false, 
    "subject": "Re: The problem when I use MockStrutsTestCase.", 
    "from": "=?iso-8859-1?B?zfXB6Luq?= &lt;hut@...&gt;", 
    "authorName": "ÍõÁè»ª", 
    "msgSnippet": "...  ...  ... Our base struts action do the protection for transaction. ... // clean current transaction flag. ", 
    "msgId": 19482, 
    "rawEmail": "Return-Path: &lt;hut@...&gt;\r\nReceived: (qmail 99299 invoked by uid 7800); 20 Jun 2007 13:04:53 -0000\r\nX-Sender: hut@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (qmail 90940 invoked from network); 20 Jun 2007 07:18:42 -0000\r\nReceived: from unknown (66.218.67.34)\n  by m51.grp.scd.yahoo.com with QMQP; 20 Jun 2007 07:18:42 -0000\r\nReceived: from unknown (HELO n28.bullet.scd.yahoo.com) (66.94.237.21)\n  by mta8.grp.scd.yahoo.com with SMTP; 20 Jun 2007 07:18:42 -0000\r\nReceived: from [209.73.164.86] by n28.bullet.scd.yahoo.com with NNFMP; 20 Jun 2007 07:18:25 -0000\r\nReceived: from [66.218.67.197] by t8.bullet.scd.yahoo.com with NNFMP; 20 Jun 2007 07:18:25 -0000\r\nDate: Wed, 20 Jun 2007 07:18:25 -0000\r\nTo: junit@yahoogroups.com\r\nMessage-ID: &lt;f5akc1+n0ml@...&gt;\r\nIn-Reply-To: &lt;f585es+mr9l@...&gt;\r\nUser-Agent: eGroups-EW/0.82\r\nMIME-Version: 1.0\r\nContent-Type: text/plain; charset=&quot;ISO-8859-1&quot;\r\nContent-Transfer-Encoding: quoted-printable\r\nX-Mailer: Yahoo Groups Message Poster\r\nX-Yahoo-Newman-Property: groups-compose\r\nX-eGroups-Msg-Info: 1:6:0:0\r\nFrom: =?iso-8859-1?B?zfXB6Luq?= &lt;hut@...&gt;\r\nSubject: Re: The problem when I use MockStrutsTestCase.\r\nX-Yahoo-Group-Post: member; u=300426891; y=hF690RxucEnQgRHbY4-5aIpikvOZnFTwNnWXl_p4pefaRP9F5A4R2899\r\nX-Yahoo-Profile: wanglinghua2008\r\nX-eGroups-Approved-By: ddoss_2006 &lt;didoss@...&gt; via email; 20 Jun 2007 13:04:53 -0000\r\n\r\n\n--- In junit@yahoogroups.com, =CD=F5=C1=E8=BB=AA &lt;hut@...&gt; wrote:\n&gt;\n&gt; Hi, =\r\nAll,\n&gt;\n&gt; Prediction: Struts, Ibatis.\n&gt;\n&gt; The structure of table siteconfig:=\r\n\n&gt;\n&gt; Column: SiteID, ItemName,ItemValue,LastModifiedTime.\n&gt;\n&gt; The item name=\r\nd item1&#39; s value is 1 by default in database.\n&gt;\n&gt;\n&gt; To avoid to update data=\r\nbase directly, we are manage to implement all\n&gt; changes/configuration in a =\r\ntransaction.\n&gt; If we try to configure a specific condition for our test cas=\r\ne, we just\n&gt; do.\n&gt;\n&gt;             a. Start a transation.\n&gt;\n&gt;             b. =\r\nExecute some sqls.\n&gt;\n&gt;             c. Rollback the transation.\n&gt;\n&gt; Then we =\r\ncan meet our requests without any actual changes of database.\n&gt;\n&gt; But I met=\r\n a problem during using MockStrutsTestCase!\n&gt;\n&gt; My test class extends MockS=\r\ntrutsTestCase,  what I have done is :\n&gt;\n&gt;\n---------------------------------=\r\n---------------------------------------&#92;\n&#92;\n&gt;\n------------------------------=\r\n------------------------------------------&#92;\n&#92;\n&gt; -------------------\n&gt;      =\r\n   ...\n&gt;         private SiteConfig siteConfig;\n&gt;          private SiteConf=\r\nigDao siteConfigDao =3D ...\n&gt;\n&gt;         public void setUp() throws Exceptio=\r\nn {\n&gt;                      super.setUp();\n&gt;                      wbxDaoMana=\r\nger.startTransaction();\n&gt;                     long siteid =3D this.getUTCon=\r\nfig().getSiteId();\n&gt;\n&gt;                      // Get site configuration for a=\r\n specified site\n&gt;                      siteConfig =3D\n&gt; BizFactory.getSiteM=\r\ngr().getSiteConfig(siteid);\n&gt;         }\n&gt;\n&gt;         /**\n&gt;       * @throws E=\r\nxception Exception\n&gt;       */\n&gt;         public void mytest() throws Excepti=\r\non {\n&gt;                      // Execute a sql to update item named item1. =\r\n=3D\n&gt; &quot;update siteconfig set itemvalue=3D&#39;1&#39; where siteid=3D** and\n&gt; itemva=\r\nlue=3D&#39;item1&#39; &quot;\n&gt;                 // Change the itemvalue named item1 to 0.=\r\n\n&gt;\n&gt; siteConfigDao.setConfigItem(this.getUTConfig().getSiteId(),\n&gt; &quot;item1&quot;,=\r\n&quot;0&quot;);\n&gt;\n&gt;                      setRequestPathInfo(&quot;/queue&quot;);\n&gt;             =\r\n     actionPerform();\n&gt;                      verifyForward(&quot;notsupportitem1=\r\n&quot;);\n&gt;         }\n&gt;\n&gt;\n&gt;         /**\n&gt;       *@throws Exception Exception\n&gt;   =\r\n    */\n&gt;      public void tearDown() throws Exception {\n&gt;          super.te=\r\narDown();\n&gt;\n&gt;          // RollBack Transaction\n&gt;          wbxDaoManager.rol=\r\nlbackTransaction();\n&gt;\n&gt;          // Release Transaction.\n&gt;          wbxDaoM=\r\nanager.releaseTransaction();\n&gt;      }\n&gt;\n&gt; actionPerform() method will guide=\r\n to struts action that &#39;/queue&#39; path\n&gt; point to, but in this action,\n&gt;\n&gt; Wh=\r\nen I try to get siteconfig object as :\n&gt;\n&gt; SiteConfig siteConfig =3D BizFac=\r\ntory.getSiteMgr().getSiteConfig(siteid);\n&gt; siteConfig.getItem1(); // MainTa=\r\nin the unchange value : 1.\n&gt;\n&gt; It seems that my started transaction have lo=\r\nst, any idea?\n&gt;\n&gt; Thanks for your patient.\n&gt;\n&gt; Regards & Thanks,\n&gt;\n&gt; -Hut\n\n=\r\n&gt; [Non-text portions of this message have been removed]\n&gt;\n\n:) I found the r=\r\noot cause!\n\nOur base struts action do the protection for transaction.\n\n----=\r\n----------------------------------------\n// clean current transaction flag.=\r\n\nBizFactory.cleanDaoManagerTransactionFlag(siteID);\n\nif (siteID =3D=3D 0) {=\r\n\nlogger.logError(&quot;the SiteID is 0 , It&#39;s abnormal&quot;\n+ this.getClass().getNam=\r\ne());\nlogger.logError(&quot;the SiteID is 0 , It&#39;s abnormal&quot;\n+ this.getClass());=\r\n\n}\n\nactionForward =3D process(mapping, form, request,\nresponse);\n...\n------=\r\n-------------------------------------\n\nWhat should I do is\ncomment=A0:BizFa=\r\nctory.cleanDaoManagerTransactionFlag(siteID);\n\nThanks&Regards,\n\n-Hut\n\n\n\n\n\n", 
    "profile": "wanglinghua2008", 
    "topicId": 19478, 
    "spamInfo": {
        "reason": "6", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 300426891, 
    "prevInTime": 19481, 
    "contentTrasformed": false, 
    "postDate": "1182323905", 
    "canDelete": false, 
    "nextInTopic": 0, 
    "prevInTopic": 19478, 
    "headers": {
        "inReplyToHeader": "PGY1ODVlcyttcjlsQGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PGY1YWtjMStuMG1sQGVHcm91cHMuY29tPg=="
    }
}
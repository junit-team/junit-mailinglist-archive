{
    "numMessagesInTopic": 2, 
    "nextInTime": 4952, 
    "senderId": "Zwsbm62sd1nPACICnJ76wp-sV_TJ0OoQUzO99O-79N13pdCUf952fLkyCz43e0QeBPQ3jHyYbxUOQ4LTquc6WOrTG2w8xsc2", 
    "systemMessage": false, 
    "subject": "Re: [junit] Re: unit testing philosophy [LONG]", 
    "from": "&quot;Steve Freeman&quot; &lt;steve@...&gt;", 
    "authorName": "Steve Freeman", 
    "msgSnippet": "... That s why we started mocking up Dynamo components. In some ways, the Nucleus is very amenable to writing mock-based unit tests given that it s all about", 
    "msgId": 4951, 
    "rawEmail": "Return-Path: &lt;steve@...&gt;\r\nX-Sender: steve@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (EGP: mail-8_0_3_2); 12 May 2002 10:41:47 -0000\r\nReceived: (qmail 73285 invoked from network); 12 May 2002 10:41:47 -0000\r\nReceived: from unknown (66.218.66.216)\n  by m14.grp.scd.yahoo.com with QMQP; 12 May 2002 10:41:47 -0000\r\nReceived: from unknown (HELO protactinium.btinternet.com) (194.73.73.176)\n  by mta1.grp.scd.yahoo.com with SMTP; 12 May 2002 10:41:47 -0000\r\nReceived: from host217-39-59-18.in-addr.btopenworld.com ([217.39.59.18] helo=gateway)\n\tby protactinium.btinternet.com with smtp (Exim 3.22 #8)\n\tid 176qnS-0007h7-00\n\tfor junit@yahoogroups.com; Sun, 12 May 2002 11:41:46 +0100\r\nMessage-ID: &lt;003501c1f9a1$a47582a0$123b27d9@gateway&gt;\r\nTo: &lt;junit@yahoogroups.com&gt;\r\nReferences: &lt;abf3us+5c1l@...&gt;\r\nSubject: Re: [junit] Re: unit testing philosophy [LONG]\r\nDate: Sun, 12 May 2002 11:41:06 +0100\r\nOrganization: M3P\r\nMIME-Version: 1.0\r\nContent-Type: text/plain;\n\tcharset=&quot;iso-8859-1&quot;\r\nContent-Transfer-Encoding: 7bit\r\nX-Priority: 3\r\nX-MSMail-Priority: Normal\r\nX-Mailer: Microsoft Outlook Express 5.50.4807.1700\r\nX-MimeOLE: Produced By Microsoft MimeOLE V5.50.4807.1700\r\nFrom: &quot;Steve Freeman&quot; &lt;steve@...&gt;\r\nX-Yahoo-Group-Post: member; u=30618548\r\nX-Yahoo-Profile: smg_freeman\r\n\r\n&gt; In the real world, I use ATG Dynamo.  If you&#39;ve heard of it or used\n&gt; it, it&#39;s an App Server / EJB Container.   Dynamo&#39;s entire framework is\n&gt; based off this component known as Nucleus, which does a lot of work in\n&gt; terms of instantiating classes, setting properties, etc..  It&#39;s also\n&gt; very slow and to test - build - test takes forever if I have to start\n&gt; and stop the app-server for every change in the code.\n\nThat&#39;s why we started mocking up Dynamo components. In some ways, the\nNucleus is very amenable to writing mock-based unit tests given that\nit&#39;s all about glueing components together at runtime. If you define\nyour components in terms of interfaces rather than classes, then it&#39;s\neasier to substitute alternative implementations. Once you&#39;ve done\nthis, it turns out that your code is better structured for coping with\nnew requirements.\n\n&gt; That&#39;s where MockObjects come in.  Dynamo is a very Java Beans heavy\n&gt; framework, that relies a lot on setters and getters.  ( In fact, the\n&gt; MockObjects guys at SF have started putting together some Dynamo\n&gt; MockObjects. ) I was looking into MockObjects as a way to lessen my\n&gt; reliance on the Nucleus namespace so that I could code quickly and\n&gt; only integrate with the Nucleus namespace at the latest possible time.\n\nSadly, our library is getting out of date, because I&#39;m not working\nwith Dynamo any more. One point is that we&#39;re trying to move away from\ngetters and setters. It&#39;s worth thinking about passing handler and\npolicy objects around, rather than extracting values via getters. The\nNucleus supports it just as well.\n\n&gt; However, I can&#39;t get my head around the fact that in certain cases my\n&gt; mock code will need to generate other mock code\n\nSometimes that happens, for example with the JDBC library. Where it&#39;s\nunavoidable, at least it&#39;s usually repeated across multiple tests and\nso worth wrapping in some helper code, or in the TestCase setup. For\nsomething like the Dynamo repository, you&#39;re likely to be using the\ninfrastructure a lot, so there may be some point in investing in a\nlittle infrastrcuture. Don&#39;t forget that you only need enough\nimplementation to get through the test (in a modern IDE this is a\nmatter of a few points-and-clicks). For example, something like:\n\nclass MockRepository extends MockObject {\n  private RepositoryView view;\n  private ExpectationValue itemDescription =\n    new ExpectationValue(&quot;MockRepository.itemDescription&quot;);\n\n  public void setExpectedGetView(String description,\n                                 RepositoryView aView) {\n    view = aView;\n    itemDescription.setExpected(description);\n  }\n\n  public RepositoryView getView(String description) {\n    itemDescription.setActual(description);\n    return view;\n  }\n}\n\nAnother other route to consider is that you can use the Repository\noutside Dynamo. Set up a test instance of the database and manage test\nvalues with something like DBUnit.\n\nFinally, what makes this code hard to test is that there are too many\nobjects involved in the method, can we break them up? One observation\nis that the sequence from the Repository to the array of items is more\nor less independant of the application. Does it repeat often enough to\nwrite something like:\n\npublic Map generateEmptyPreferencesMap(Map map)\n{\n  RepositoryView contactMethodView =\n\n\n    getPreferencesRepository().getView(CONTACT_METHOD_REPOSITORY_ITEM );\n  PropertyFinder finder = finderFactory.make(contactMethodView);\n  finder.addPropertyValuesTo(map, CONTACT_METHOD_CODE_PROPERTY_NAME);\n  return map;\n}\n\nWhere the PropertyFinder encapsulates all that RepositoryView\nstuff. If you create PropertyFinder&#39;s via a factory, you can subsitute\na MockPropertyFinder when testing the Droplet. You can then test the\nPropertyFinder separately with a smaller chain of mock\n(or real) Repository objects. It would be too much work if this is the\nonly place you do this but, more likely, you can refactor in this\ndirection as you discover repetitions. An example of a test would be:\n\npublic void testGenerateEmptyPreferencesMap() throws RepositoryException\n{\n    MockPropertyFinder mockFinder = new MockPropertyFinder();\n    Map map = new Hashmap();\n\n    mockRepository.setupView(mockRepositoryView);\n    mockFinderFactory.setupFinder(mockFinder);\n\n    mockFinderFactory.setExpectedView(mockRepositoryView);\n    mockRepository.setExpectedGetView(CONTACT_METHOD_REPOSITORY_ITEM);\n    mockFinder.setExpectedAddPropertyValuesTo(map,\nCONTACT_METHOD_CODE_PROPERTY_NAME);\n\n    assertEquals(&quot;Should be same map&quot;, map,\ndroplet.generateEmptyPreferencesMap(map));\n    mockFinderFactory.verify();\n    mockRepository.verify();\n    mockFinder.verify();\n}\n\nHmmm, thinking about it, the next version might be:\n\npublic Map generateEmptyPreferencesMap(Map map)\n{\n    PropertyFinder finder =\n        finderFactory.simpleFinder(preferencesRepository,\nCONTACT_METHOD_REPOSITORY_ITEM );\n    finder.addPropertyValuesTo(map, CONTACT_METHOD_CODE_PROPERTY_NAME);\n    return map;\n}\n\nSteve\n\n&gt; Here&#39;s a method from a piece of old code that I wrote before I decided\n&gt; to start using JUnit:\n&gt;\n&gt;     public  Map generateEmptyPreferencesMap( Map m ) throws\n&gt; RepositoryException {\n&gt;\n&gt; // get the list of possible preferences\n&gt; RepositoryView contactMethodView = getPreferencesRepository().getView(\n&gt; CONTACT_METHOD_REPOSITORY_ITEM );\n&gt; RepositoryItem[] contactMethods = contactMethodView.executeQuery(\n&gt; contactMethodView.getQueryBuilder().createUnconstrainedQuery() );\n&gt;\n&gt; if ( ( contactMethods != null ) && ( contactMethods.length &gt; 0 ) )  {\n&gt;     // add each one to the map\n&gt;     for ( int i = 0 ; i &lt; contactMethods.length ; i++ ) {\n&gt; m.put( contactMethods[i].getPropertyValue(\n&gt; CONTACT_METHOD_CODE_PROPERTY_NAME ), new BooleanPlaceHolder() );\n&gt;     }\n&gt; }\n&gt;      return m;\n&gt;     }\n\n\n\n\n", 
    "profile": "smg_freeman", 
    "topicId": 4951, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 30618548, 
    "prevInTime": 4950, 
    "contentTrasformed": false, 
    "postDate": "1021200066", 
    "canDelete": false, 
    "nextInTopic": 8766, 
    "prevInTopic": 0, 
    "headers": {
        "messageIdInHeader": "PDAwMzUwMWMxZjlhMSRhNDc1ODJhMCQxMjNiMjdkOUBnYXRld2F5Pg==", 
        "referencesHeader": "PGFiZjN1cys1YzFsQGVHcm91cHMuY29tPg=="
    }
}
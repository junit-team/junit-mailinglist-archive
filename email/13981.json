{
    "numMessagesInTopic": 3, 
    "nextInTime": 13982, 
    "senderId": "3Sdl_1XzAcm2zxw2Fl-5xZgqvt4QClwsmmzwFdd8haeBmYPJtb6g9vl7ZrayZ-FpffxCn_dkyOsrBxvJ__gUnMEZ1PE", 
    "systemMessage": false, 
    "subject": "Re: Advice on TDD&#39;ing a POJO that uses a web service", 
    "from": "&quot;etl_dan&quot; &lt;etl_dan@...&gt;", 
    "authorName": "etl_dan", 
    "msgSnippet": "Sorry, I didn t notice that the code I had lost its format; I ll try once more. I m exposing a method on an interface like this: public WeatherData[]", 
    "msgId": 13981, 
    "profile": "etl_dan", 
    "topicId": 13970, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 86431363, 
    "messageBody": "<div id=\"ygrps-yiv-780160164\">Sorry, I didn&#39;t notice that the code I had lost its format; I&#39;ll try<br/>\nonce more.<br/>\n<br/>\nI&#39;m exposing a method on an interface like this:<br/>\n<br/>\n  public WeatherData[] getForecast(Date startDate, int numDays,<br/>\nBigDecimal latitude, BigDecimal longitude);<br/>\n<br/>\n<br/>\nThe trick is that obtaining the data involves two steps: 1)<br/>\nCommunicating with a web service, and 2) Parsing the returned XML into<br/>\nappropriate model objects.<br/>\n<br/>\nIf I try to directly test getForecast, then I determined that I need<br/>\nto supply a fake web service stub which I can use to verify arguments<br/>\nare being passed correctly, but I also need to pass a fake object that<br/>\nknows how to parse that XML stream.<br/>\n<br/>\n<br/>\nSo in my happy path test, I am testing that:<br/>\n1. the object invokes the right method and parameters on the web<br/>\nservice proxy stub<br/>\n2. the object returns the same items that the parser returns (the<br/>\nparser stub returns some plain fake objects, and the tests assert that<br/>\nthis fake array is the right size and contains the right elements)<br/>\n<br/>\n<br/>\nTest #1 feels OK, but Test #2 feels a little unneccessary, and it<br/>\nmakes my test longer.  Ultimately I need my parser to return some fake<br/>\ndata to prevent an exception (returning null would not test the right<br/>\nbehavior!)<br/>\n<br/>\nAm I going down the right path?<br/>\n<br/>\nAny advice appreciated!<br/>\n<br/>\nThanks,<br/>\nDan<br/>\n<br/>\n<blockquote><span title=\"qreply\"> --- In <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>, &quot;etl_dan&quot; &lt;etl_dan@y...&gt; wrote:<br/>\n&gt; Hi!<br/>\n&gt; <br/>\n&gt; I&#39;m working on a few projects that will obtain data from a web service<br/>\n&gt; using JAX-RPC.  To get my feet wet, I&#39;m building a project that will<br/>\n&gt; get the weather forecast from the NDFDXML web service at weather.gov<br/>\n&gt; and used Axis to generate a client stub.  (<a rel=\"nofollow\" target=\"_blank\" href=\"http://weather.gov/xml/)\">http://weather.gov/xml/)</a><br/>\n&gt; <br/>\n&gt; I am doing OK so far, but I wondered if someone would mind checking to<br/>\n&gt; see if I&#39;m going too far or in the wrong direction?<br/>\n&gt; <br/>\n&gt; <br/>\n&gt; My first approach is to have a service POJO that handles all<br/>\n&gt; communication with the web service via the generated stub classes and<br/>\n&gt; parses response data into more digestible data objects.<br/>\n&gt; <br/>\n&gt; Going the test-first route, I started writing tests for this POJO<br/>\n&gt; service, called NOAAWeatherService.  My first gut was to write a happy<br/>\n&gt; path test to see that the class correctly passes the right arguments.<br/>\n&gt;  To do this, I realized that if my web services consumer object<br/>\n&gt; actually obtained the stub directly, it would be hard for my tests to<br/>\n&gt; substitute in mocks.  I created a method setProxy() which allows tests<br/>\n&gt; and a dependency injection container like Spring to wire it up.  (Here<br/>\n&gt; I pass an object that implements PortType interface generated by Axis&#39;<br/>\n&gt; WSDL2Java tool)<br/>\n&gt; <br/>\n&gt; My next wince came when I wondered what my mock web service stub<br/>\n&gt; implementation could return - the NDFDXML web service at weather.gov<br/>\n&gt; returns their specially prepared XML as a response.  My fake object<br/>\n&gt; would need to return well-formatted XML data that could be correctly<br/>\n&gt; processe!  So, I decided that this class would have too many<br/>\n&gt; responsibilities on its own -- communicating with the web service, and<br/>\n&gt; parsing the XML results.  So I created a setParser() method which I<br/>\n&gt; could fake for these tests and supply a real parser for production.<br/>\n&gt; <br/>\n&gt; <br/>\n&gt; Am I testing at too high a level here, or is this the right way to go?<br/>\n&gt;   Based on this test, it seems like I&#39;m not testing a whole lot -<br/>\n&gt; since the object under test will probably just delegate to other<br/>\n&gt; objects.<br/>\n&gt; <br/>\n&gt; Thanks for the advice!<br/>\n&gt; <br/>\n&gt; -Dan<br/>\n&gt; --<br/>\n&gt; <br/>\n&gt; <br/>\n&gt;     public void testGetCurrentConditions_HappyPath() {<br/>\n&gt;         NOAAWeatherService service = new NOAAWeatherService();<br/>\n&gt;         <br/>\n&gt;         final String webServiceResponse = &quot;Test string&quot;;<br/>\n&gt;         final double latitude = 30.5d;<br/>\n&gt;         final double longitude = -70.0d;<br/>\n&gt; <br/>\n&gt;         // Set a fake proxy to verify the right arguments are passed<br/>\n&gt;         service.setProxy(new NdfdXMLStub() {<br/>\n&gt;             // NDFDgen is a weather.gov method to get forecast data<br/>\n&gt;             public String NDFDgen(BigDecimal latitude, BigDecimal<br/>\n&gt; longitude, String product, Calendar startTime, Calendar endTime,<br/>\n&gt; WeatherParametersType weatherParameters) throws RemoteException {<br/>\n&gt;                 assertEquals(latitude, latitude.doubleValue(), 0.01);<br/>\n&gt;                 assertEquals(longitude, longitude.doubleValue(),<br/>\n&gt; 0.01);<br/>\n&gt;                 ...  // Check ?all? the web service parameters? <br/>\n&gt;                 return webServiceResponse;<br/>\n&gt;             }<br/>\n&gt;         });<br/>\n&gt;         <br/>\n&gt;         // Secondly, create a fake response parser so<br/>\n&gt;         // our tests don&#39;t have to create valid XML...<br/>\n&gt;         // we&#39;re just testing that our code is interacting<br/>\n&gt;         // with the web service correctly...<br/>\n&gt;  <br/>\n&gt;         final WeatherData expected = new WeatherData();<br/>\n&gt;         service.setNdfdXMLResponseParser(new NdfdXMLResponseParser() {<br/>\n&gt;             public WeatherData[] parseNdfdGen(String xml) {<br/>\n&gt;                 assertEquals(webServiceResponse, xml);<br/>\n&gt;                 WeatherData[] response = new WeatherData[1];<br/>\n&gt;                 response[0] = expected;<br/>\n&gt;                 return response;<br/>\n&gt;             }<br/>\n&gt;         });<br/>\n&gt;         <br/>\n&gt;         <br/>\n&gt;         assertEquals(expected, service.getCurrentConditions(latitude,<br/>\n&gt; longitude));<br/>\n&gt;     } </span></blockquote></div>", 
    "prevInTime": 13980, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1119320493", 
    "canDelete": false, 
    "nextInTopic": 13989, 
    "prevInTopic": 13970, 
    "headers": {
        "inReplyToHeader": "PGQ5Mm05OStqZm9nQGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PGQ5N3RqZCsxdHUzQGVHcm91cHMuY29tPg=="
    }
}
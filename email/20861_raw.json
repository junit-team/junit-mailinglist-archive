{
    "numMessagesInTopic": 2, 
    "nextInTime": 20862, 
    "senderId": "7aPyDoYf4wgNKQBUb7VU4gHFT7HBKAp8rQyUHepUEck_QXadQ2uCUGAgOWtUO97wj7Ceg2CnZ15O_Q_orEWpTUtbSTkSus8VL6NO", 
    "systemMessage": true, 
    "subject": "not able to run the junit please help", 
    "from": "Sushil Dodake &lt;sushil_d10@...&gt;", 
    "authorName": "Sushil Dodake", 
    "msgSnippet": "Hi guys... i am trying to write a junit test class for the class which uses the ldap template. i am confued as i cant solve this. can sombody help me here i a", 
    "msgId": 20861, 
    "rawEmail": "Return-Path: &lt;sushil_d10@...&gt;\r\nReceived: (qmail 57405 invoked from network); 10 Sep 2008 17:51:11 -0000\r\nReceived: from unknown (66.218.67.96)\n  by m45.grp.scd.yahoo.com with QMQP; 10 Sep 2008 17:51:11 -0000\r\nReceived: from unknown (HELO n18b.bullet.sp1.yahoo.com) (69.147.64.128)\n  by mta17.grp.scd.yahoo.com with SMTP; 10 Sep 2008 17:51:11 -0000\r\nReceived: from [69.147.65.173] by n18.bullet.sp1.yahoo.com with NNFMP; 10 Sep 2008 17:51:02 -0000\r\nReceived: from [209.73.164.86] by t15.bullet.mail.sp1.yahoo.com with NNFMP; 10 Sep 2008 17:51:02 -0000\r\nReceived: from [66.218.66.89] by t8.bullet.scd.yahoo.com with NNFMP; 10 Sep 2008 17:51:02 -0000\r\nX-Sender: sushil_d10@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nX-Received: (qmail 76182 invoked from network); 10 Sep 2008 15:28:04 -0000\r\nX-Received: from unknown (66.218.67.95)\n  by m53.grp.scd.yahoo.com with QMQP; 10 Sep 2008 15:28:04 -0000\r\nX-Received: from unknown (HELO web31001.mail.mud.yahoo.com) (68.142.200.164)\n  by mta16.grp.scd.yahoo.com with SMTP; 10 Sep 2008 15:28:03 -0000\r\nX-Received: (qmail 27334 invoked by uid 60001); 10 Sep 2008 15:28:03 -0000\r\nX-Received: from [170.92.1.251] by web31001.mail.mud.yahoo.com via HTTP; Wed, 10 Sep 2008 08:28:03 PDT\r\nX-Mailer: YahooMailRC/1096.28 YahooMailWebService/0.7.218.2\r\nDate: Wed, 10 Sep 2008 08:28:03 -0700 (PDT)\r\nTo: junit@yahoogroups.com\r\nMIME-Version: 1.0\r\nMessage-ID: &lt;307465.26762.qm@...&gt;\r\nX-eGroups-Msg-Info: 1:12:0:0:0\r\nFrom: Sushil Dodake &lt;sushil_d10@...&gt;\r\nSubject: not able to run the junit please help\r\nX-Yahoo-Group-Post: member; u=78024148; y=LsCrFRMMAMh-PWQo5opo9VA7bPmttA7FCPi8WlGZkrd23yVaUQ\r\nX-Yahoo-Profile: sushil_d10\r\nContent-Type: text/plain; charset=US-ASCII\r\nContent-Transfer-Encoding: 7bit\r\nX-Yahoo-Newman-Property: groups-system\r\nX-eGroups-Approved-By: mark_l_salter &lt;marksalter@...&gt; via web; 10 Sep 2008 17:51:01 -0000\r\n\r\nHi guys...\ni am trying to write a junit test class for the class which uses the ldap template.\ni am confued as i cant solve this.\ncan sombody help me here\ni a posting my original calss and the test class.\nthe exception i m getting is as below\n\nwhen i debugged the stuff i found out that the ContextSource is not se in the MOCKed LDAP template object. i tried setting it.\ni m new to writing the junit test class.\ni dont know if i am missing anything here.\n\n\ncom.XXX.YYY.reporting.exception.ReportingException: Error getting distributor info from LDAP\n\tat com.XXX.YYY.reporting.dao.LdapDaoImpl.getAllActiveDomesticDistributor(LdapDaoImpl.java:52)\n\tat com.XXX.YYY.reporting.dao.LdapDaoImplTest.testGetAllActiveDomesticDistributor(LdapDaoImplTest.java:43)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat junit.framework.TestCase.runTest(TestCase.java:154)\n\tat org.jmock.core.VerifyingTestCase.runBare(VerifyingTestCase.java:39)\n\tat junit.framework.TestResult$1.protect(TestResult.java:106)\n\tat junit.framework.TestResult.runProtected(TestResult.java:124)\n\tat junit.framework.TestResult.run(TestResult.java:109)\n\tat junit.framework.TestCase.run(TestCase.java:118)\n\tat junit.framework.TestSuite.runTest(TestSuite.java:208)\n\tat junit.framework.TestSuite.run(TestSuite.java:203)\n\tat org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:128)\n\tat org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:460)\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:673)\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386)\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196)\nCaused by: org.jmock.core.DynamicMockError: mockLdapTemplate: unexpected invocation\nInvoked: mockLdapTemplate.search(&quot;&quot;, &quot;(&(ttcUserType=distributor)(ttcgeographicregion=United States))&quot;, &lt;com.XXX.YYY.reporting.dao.LdapDaoImpl$DistributorInfoAttributeMapper@1e12f6d&gt;)\nAllowed:\nexpected once: search( eq(&lt;class java.lang.String&gt;), eq(&lt;class java.lang.String&gt;), eq(&lt;class com.XXX.YYY.reporting.dao.LdapDaoImpl$DistributorInfoAttributeMapper&gt;) ), returns &lt;com.XXX.YYY.reporting.struts.form.DistributorInfo@15428dd&gt;\n\n\tat org.jmock.core.AbstractDynamicMock.mockInvocation(AbstractDynamicMock.java:58)\n\tat org.jmock.cglib.CGLIBCoreMock.intercept(CGLIBCoreMock.java:71)\n\tat org.springframework.ldap.core.LdapTemplate$$EnhancerByCGLIB$$3bfb79d.search(&lt;generated&gt;)\n\tat com.XXX.YYY.reporting.dao.LdapDaoImpl.getAllActiveDomesticDistributor(LdapDaoImpl.java:47)\n\t... 19 morethe actual source file looks as below\n\nCode:\n\t/**\n\t * private logger instance for logging.\n\t */\n\tprivate static final Logger LOG = Logger.getLogger(LdapDaoImpl.class);\n\t\n\tprivate LdapTemplate ldapTemplate;\n\n\t/**\n\t * @param ldapTemplate the ldapTemplate to set\n\t */\n\tpublic void setLdapTemplate(LdapTemplate ldapTemplate) {\n\t\tthis.ldapTemplate = ldapTemplate;\n\t}\n\n\t/**\n\t * This method retreives all domestic distributors from LDAP\n\t * @exception reporting exception\n\t * @return list of distributors with company name and the distributor ID \n\t */\n\tpublic List getAllActiveDomesticDistributor()throws ReportingException{\n\t\tList distList= null;\n\n\t\ttry{\n\t\t\tAndFilter filter = new AndFilter();\n\t\t\tfilter.and(new EqualsFilter(ReportingConstant.TTC_USER_TYPE, ReportingConstant.DISTRIBUTOR));\n\t\t\tfilter.and(new EqualsFilter(ReportingConstant.GEOGRAPHIC_REGION, ReportingConstant.US));\n\t\t\tSystem.out.println(filter.encode());\n\t\t\tdistList = ldapTemplate.search(ReportingConstant.BLANK, filter.encode(), new DistributorInfoAttributeMapper());\n\t\t\tdistList = sanitizeDistributorList(distList);\n\t\t\tLOG.debug(&quot;List Distributor Info retrieved from LDAP&quot;);\n\t\t}catch(Throwable t){\n\t\t\tLOG.error(&quot;Error getting distributor info from LDAP&quot;);\n\t\t\tthrow new ReportingException(&quot;Error getting distributor info from LDAP&quot;, t);\n\t\t}\n\t\treturn distList;\n\t}\n\n\t/**\n\t * Inner Class for the retrived attribute mapper \n\t */\n\tprotected class DistributorInfoAttributeMapper implements AttributesMapper{\n\t\tpublic Object mapFromAttributes(Attributes attri) throws NamingException {\n\t\t\tDistributorInfo distInfo = new DistributorInfo();\n\t\t\tdistInfo.setDistributorId((String)attri.get(ReportingConstant.TTC_CUST_ID).get());\n\t\t\tdistInfo.setCompanyName((String)attri.get(ReportingConstant.TTC_COMPANY_NAME).get());\n\t\t\treturn distInfo;\n\t\t}\n\t}\n\t\n\t/**\n\t * Format the retrived distributor info from LDAP\n\t * prepends 000 to distributor ID also prepends the distributor ID to the company name \n\t */\n\tprivate List sanitizeDistributorList (List distInfo){\n\t\tList distributors = new ArrayList();\n\t\tfor (int i=0; i&lt;distInfo.size(); i++){\n\t\t\tDistributorInfo distributorInfo = (DistributorInfo)distInfo.get(i);\n\t\t\tString distId = distributorInfo.getDistributorId();\n\t\t\tString compName = distributorInfo.getCompanyName();\n\t\t\tif(hasNumber(distId)){\n\t\t\t\tif(Integer.parseInt(distId)&lt; 600){\n\t\t\t\t\tdistributorInfo.setDistributorId(ReportingConstant.TRIPLE_ZERO + distId);\n\t\t\t\t\tdistributorInfo.setCompanyName(distId + ReportingConstant.DASH + compName);\n\t\t\t\t\tdistributors.add(distributorInfo);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn distributors;\n\t}\n\n\t/**\n\t * Verifies if the string has a numbers in it\n\t */\n   private boolean hasNumber(String s) {\n      for (int j = 0;j &lt; s.length();j++) \n         if (!Character.isDigit(s.charAt(j))) return false; \n      return true;\n   }my application context looks as below\n\n\nCode:\n\t&lt;bean id=&quot;ldapDao&quot; class=&quot; com.toro.rebate.reporting.dao.LdapDaoImpl&quot;&gt;\n\t\t&lt;property name=&quot;ldapTemplate&quot; ref=&quot;ldapTemplate&quot;/&gt;\n\t\t\n\t&lt;/bean&gt;\n\t\n\n\t&lt;bean id=&quot;contextSource&quot; class=&quot;org.springframework.ldap.core.support.LdapContextSource&quot;&gt;\n\t\t&lt;property name=&quot;url&quot;&gt;&lt;value&gt;${LDAP.url}&lt;/value&gt;&lt;/property&gt;\n\t\t&lt;property name=&quot;base&quot;&gt;&lt;value&gt;${LDAP.base}&lt;/value&gt;&lt;/property&gt;\t\t\n\t&lt;/bean&gt;\n\t&lt;bean id=&quot;ldapTemplate&quot; class=&quot;org.springframework.ldap.core.LdapTemplate&quot;&gt;\n\t\t&lt;constructor-arg ref=&quot;contextSource&quot; /&gt;\n\t&lt;/bean&gt;\nand my test clas is as below\n\n\nCode:\npublic class LdapDaoImplTest extends MockObjectTestCase{\n\t\n\tprivate LdapDaoImpl ldapDao;\n\tAndFilter filter;\n\tMock andFilterMock;\n\t\n\tLdapTemplate ldapTemplate;\n\tMock ldapTemplateMock;\n\t\n\tprotected void setUp() throws Exception{\n\t\tldapTemplateMock = mock(LdapTemplate.class);\n\t\tldapDao = new LdapDaoImpl();\n\t\tldapTemplate = new LdapTemplate();\n//\t\tldapTemplate.setContextSource(arg0)\n\n\t\t\n\t}\n\t\n\tprotected void tearDown() throws Exception {\n\t\t\n\t}\n\t\n\tpublic void testGetAllActiveDomesticDistributor(){\n\t\tList distributorList = getDistributorList();\n\t\tDistributorInfo distInfo = getDistributorInfo();\n//\t\tldapTemplateMock.expects(once()).method(&quot;search&quot;).with(ANYTHING).will(returnValue(distributorList));\n//\t\tldapTemplateMock.expects(once()).method(&quot;search&quot;).with(eq(String.class), &quot;(&(ttcUserType=distributor)(ttcgeographicregion=United States))&quot;, DistributorInfoAttributeMapper.class);\n\t\tldapTemplateMock.expects(once()).method(&quot;setContextSource&quot;).with(eq(ContextSource.class));\n\t\tldapTemplateMock.expects(once()).method(&quot;search&quot;).with(eq(String.class), eq(String.class), eq(ldapDao.new DistributorInfoAttributeMapper()));\n\t\tldapDao.setLdapTemplate((LdapTemplate)ldapTemplateMock.proxy());\n\t\tList actualDistList = ldapDao.getAllActiveDomesticDistributor();\n\t\tSystem.out.println(actualDistList.size());\n\t}\n\t\n\tpublic List getDistributorList(){\n\t\tList distInfoList = new ArrayList();\n\t\t\n\t\tDistributorInfo distInfo1 = new DistributorInfo();\n\t\tdistInfo1.setCompanyName(&quot;Wsco Turf Supply&quot;);\n\t\tdistInfo1.setDistributorId(&quot;150&quot;);\n\n\t\tDistributorInfo distInfo2 = new DistributorInfo();\n\t\tdistInfo2.setCompanyName(&quot;Test non Domestic DIst&quot;);\n\t\tdistInfo2.setDistributorId(&quot;810&quot;);\n\n\t\tdistInfoList.add(distInfo2);\n\t\treturn distInfoList;\n\t}\n\t\n\tpublic DistributorInfo getDistributorInfo(){\n\t\tList distInfoList = new ArrayList();\n\t\t\n\t\tDistributorInfo distInfo1 = new DistributorInfo();\n\t\tdistInfo1.setCompanyName(&quot;Wsco Turf Supply&quot;);\n\t\tdistInfo1.setDistributorId(&quot;150&quot;);\n\n//\t\tDistributorInfo distInfo2 = new DistributorInfo();\n//\t\tdistInfo2.setCompanyName(&quot;Test non Domestic DIst&quot;);\n//\t\tdistInfo2.setDistributorId(&quot;810&quot;);\n//\n//\t\tdistInfoList.add(distInfo2);\n\t\treturn distInfo1;\n\t}\n\t\n\t private ContextSource getLDAPContextSource() {\n\t        LdapContextSource ldapContextSource = new LdapContextSource();\n\t        ldapContextSource.setUrl(&quot;ldap://ldap-ttcdit.toro.com:389&quot;);\n\t        ldapContextSource.setBase(&quot;ou=Companies,o=ttc&quot;);\n\n\t        try {\n\t            ldapContextSource.afterPropertiesSet();\n\t        } catch (Exception e) {\n\t            e.printStackTrace();\n\t        }\n\t        return ldapContextSource;\n\t    }\n\n}\n\n\n      \n\n[Non-text portions of this message have been removed]\n\n\n", 
    "profile": "sushil_d10", 
    "topicId": 20861, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 78024148, 
    "prevInTime": 20860, 
    "contentTrasformed": false, 
    "postDate": "1221060483", 
    "canDelete": false, 
    "nextInTopic": 20922, 
    "prevInTopic": 0, 
    "headers": {
        "messageIdInHeader": "PDMwNzQ2NS4yNjc2Mi5xbUB3ZWIzMTAwMS5tYWlsLm11ZC55YWhvby5jb20+"
    }
}
{
    "numMessagesInTopic": 8, 
    "nextInTime": 20601, 
    "senderId": "whl1Zz08aU9YH_mMnIJwtkAimOl-LGLbSckhInLnSACUni47b0Wzl1rdt3Wn4S4Z1RZPS2lSqdLzOVQyF9Qp1FMyNdEvS8TR52cNE1ZdeZAd", 
    "systemMessage": false, 
    "subject": "Re: [junit] Testing code that depends on today&#39;s date", 
    "from": "&quot;J. B. Rainsberger&quot; &lt;jbrains762@...&gt;", 
    "authorName": "J. B. Rainsberger", 
    "msgSnippet": "... I m surprised by this. In a typical web application, I d expect a design similar to this: 1. HTTP Request Handler gets current date from system clock or", 
    "msgId": 20600, 
    "rawEmail": "Return-Path: &lt;jbrains762@...&gt;\r\nX-Sender: jbrains762@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nX-Received: (qmail 49897 invoked from network); 18 Jun 2008 23:36:39 -0000\r\nX-Received: from unknown (66.218.67.94)\n  by m57.grp.scd.yahoo.com with QMQP; 18 Jun 2008 23:36:39 -0000\r\nX-Received: from unknown (HELO py-out-1112.google.com) (64.233.166.179)\n  by mta15.grp.scd.yahoo.com with SMTP; 18 Jun 2008 23:36:39 -0000\r\nX-Received: by py-out-1112.google.com with SMTP id b50so244634pyh.30\n        for &lt;junit@yahoogroups.com&gt;; Wed, 18 Jun 2008 16:36:39 -0700 (PDT)\r\nX-Received: by 10.65.72.7 with SMTP id z7mr48165qbk.25.1213832199197;\n        Wed, 18 Jun 2008 16:36:39 -0700 (PDT)\r\nReturn-Path: &lt;jbrains762@...&gt;\r\nX-Received: from ?192.168.16.100? ( [64.93.98.176])\n        by mx.google.com with ESMTPS id q16sm521555qbq.1.2008.06.18.16.36.37\n        (version=TLSv1/SSLv3 cipher=RC4-MD5);\n        Wed, 18 Jun 2008 16:36:38 -0700 (PDT)\r\nMessage-Id: &lt;0C5FD486-5819-4F4D-9312-B5135540FF67@...&gt;\r\nTo: junit@yahoogroups.com\r\nIn-Reply-To: &lt;860D47F8904F6041AEEE55F9B684667F162D46EF05@...&gt;\r\nContent-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes\r\nContent-Transfer-Encoding: 7bit\r\nMime-Version: 1.0 (Apple Message framework v919.2)\r\nDate: Wed, 18 Jun 2008 18:36:35 -0500\r\nReferences: &lt;860D47F8904F6041AEEE55F9B684667F162D46EF05@...&gt;\r\nX-Mailer: Apple Mail (2.919.2)\r\nX-eGroups-Msg-Info: 1:12:0:0:0\r\nFrom: &quot;J. B. Rainsberger&quot; &lt;jbrains762@...&gt;\r\nSubject: Re: [junit] Testing code that depends on today&#39;s date\r\nX-Yahoo-Group-Post: member; u=282027414; y=YTSUsNUyTc40Vt0BsPlj1Bx8qsnHAYQ_k3FnKeWDmKGAQaU\r\nX-Yahoo-Profile: nails762\r\n\r\n\nOn 2008-06-17, at 11:28 , Per Jacobsson wrote:\n\n&gt; Hi,\n&gt; This has been annoying me for a while and I can&#39;t think of a clean  \n&gt; solution for it. Hope this makes sense: I have some code that  \n&gt; returns different results depending on what today&#39;s date is (the  \n&gt; number of days since a user first registered, etc). The simple  \n&gt; approach is to just create a new instance of java.util.Date whenever  \n&gt; I need to know the current date, but that tends to make both unit  \n&gt; and automated functional testing difficult.\n&gt;\n&gt; I&#39;m currently injecting today&#39;s date into the classes that need it,  \n&gt; and then the tests can just use a static date. It gets pretty ugly  \n&gt; though, a lot of times this date has to be dragged along deep into  \n&gt; the domain model.\n&gt;\nI&#39;m surprised by this. In a typical web application, I&#39;d expect a  \ndesign similar to this:\n\n1. HTTP Request Handler gets current date from system clock or HTTP  \nrequest header; calls application request handler (or Controller or  \nService), passing the current date\n\n2. Application request handler determines which model class to invoke;  \ncalls its business method, passing the current date\n\n3. You&#39;ve finished!\n\nBy step 3, I would imagine that model classes are passing the date  \naround, which I find quite normal. You might want to refactor in there  \na little, possibly by introducing a domain class that represents the  \nway you interpret that date.\n&gt; An alternative would be to take the old school approach and have a  \n&gt; static factory that everything that needs to know today&#39;s date  \n&gt; calls, and allow the unit tests to override with a test date. Of  \n&gt; course, then you run into all the other issues that dependency  \n&gt; injection solves.\n&gt;\nI used to do this, and even contributed to the Virtual Clock paper,  \nbut I now favor passing the date around. I call it the Instantaneous  \nRequest pattern: the system pretends that the entire request happens  \nin an instant, by taking a snapshot of the clock upon receiving the  \nrequest, then passing the date along as needed.\n\nOf course, as I read the remaining messages in this thread, I might  \nhave difference advice for you. :)\n----\nJ. B. (Joe) Rainsberger :: http://www.jbrains.ca\nYour guide to software craftsmanship\nJUnit Recipes: Practical Methods for Programmer Testing\n2005 Gordon Pask Award for contributions to Agile Software Practice\n\n\n", 
    "profile": "nails762", 
    "topicId": 20590, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 282027414, 
    "prevInTime": 20599, 
    "contentTrasformed": false, 
    "postDate": "1213832195", 
    "canDelete": false, 
    "nextInTopic": 0, 
    "prevInTopic": 20598, 
    "headers": {
        "inReplyToHeader": "PDg2MEQ0N0Y4OTA0RjYwNDFBRUVFNTVGOUI2ODQ2NjdGMTYyRDQ2RUYwNUBFWENIQU5HRS1WUzEuZWhhcm1vbnkuY29tPg==", 
        "messageIdInHeader": "PDBDNUZENDg2LTU4MTktNEY0RC05MzEyLUI1MTM1NTQwRkY2N0BnbWFpbC5jb20+", 
        "referencesHeader": "PDg2MEQ0N0Y4OTA0RjYwNDFBRUVFNTVGOUI2ODQ2NjdGMTYyRDQ2RUYwNUBFWENIQU5HRS1WUzEuZWhhcm1vbnkuY29tPg=="
    }
}
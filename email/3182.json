{
    "numMessagesInTopic": 52, 
    "nextInTime": 3183, 
    "senderId": "Y3_s9Bsy3CTkUWTCtln047U5NsMStkmRGkFPapk32nhCcEf09RxNS4GcyIVZ_ID7We2UmLpzEVJoGmY8THMgWTzlqtJ-", 
    "systemMessage": false, 
    "subject": "Re: [junit] testing private methods", 
    "from": "Eric Vought &lt;evought@...&gt;", 
    "authorName": "Eric Vought", 
    "msgSnippet": "Typically, the way you accomplish both objectives (hiding functionality and exposing it for unit testing) is to use a Facade. You expose the methods that you", 
    "msgId": 3182, 
    "profile": "eric_vought", 
    "topicId": 3179, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 0, 
    "messageBody": "<div id=\"ygrps-yiv-713017236\">Typically, the way you accomplish both objectives (hiding functionality<br/>\nand exposing it for unit testing) is to use a Facade. You expose the<br/>\nmethods that you want available for testing within the package (package<br/>\nprivate methods and/or classes). You create a public class (the Facade)<br/>\nwhich exposes just the methods (for the package) you want. You hide the<br/>\nactual classes you return from the Facade behind simple interfaces. Your<br/>\ntest classes are declared in the same package as your code and therefore<br/>\nhave access to the package protected functionality.<br/>\n<br/>\nThe second option you suggest runInternalTests(..) is also a good thing to<br/>\ndo. We call our equivalent interface InvariantsChecker and the method<br/>\ncheckInvariants(). We use this method to ensure that an object is in an<br/>\ninternally consistent state (e.g. that a stack&#39;s top index does not<br/>\nexceed the capacity of the underlying array). You can then call this<br/>\nmethod from within your test code:<br/>\n<br/>\nvoid testPop() throws Exception<br/>\n{<br/>\n\td_stack.push(d_item1);<br/>\n\td_stack.checkInvariants();<br/>\n<br/>\n\tObject poppedItem = stack.pop();<br/>\n\td_stack.checkInvariants();<br/>\n<br/>\n\tassertSame(item1, poppedItem);<br/>\n} // testPop()<br/>\n<br/>\nWith a little care, you can have runInternalTests() or checkInvariants()<br/>\nrun recursively to run consistency checks on contained or referenced<br/>\ncomponents. The key is to make sure the checks terminate at some point.<br/>\nWe define a simple InvariantsTracker class which monitors the recursion<br/>\nfor us and ensures that it terminates. InvariantsTracker just keeps a list<br/>\nof object instances that it has already seen. We pass a new<br/>\nInvariantsTracker to the first checkInvariants(..) call which in turn<br/>\npasses the same instance to recursive calls.<br/>\n<br/>\nboolean checkInvariants(InvariantsTracker hitList)<br/>\n{<br/>\n\tif (hitList.alreadyHit(this)) return false;<br/>\n<br/>\n\tAssert.invariant(d_top &lt; d_size);<br/>\n<br/>\n\treturn true;<br/>\n} // checkInvariants(..)<br/>\n<br/>\nIn a subclass, the form is slightly different, since the base class<br/>\nperforms the check:<br/>\n<br/>\nboolean checkInvariants(InvariantsTracker hitList)<br/>\n{<br/>\n\tif (!(super.checkInvariants(hitList))) return false;<br/>\n<br/>\n\t// ...<br/>\n<br/>\n\treturn true;<br/>\n} // checkInvariants(..)<br/>\n<br/>\nThe test code then looks like this:<br/>\n<br/>\nvoid testPop() throws Exception<br/>\n{<br/>\n\td_stack.push(item1);<br/>\n\td_stack.checkInvariants(new InvariantsTracker());<br/>\n<br/>\n\t// ...<br/>\n} // testPop()<br/>\n<br/>\nThis ends up being a very simple and powerful technique. Having the unit<br/>\ntests run the consistency checks in addition to checking external logic<br/>\nallows you to catch many more errors with far fewer tests. You begin to<br/>\ncatch errors early on that don&#39;t normally show up until load or soak<br/>\ntesting and are much harder to diagnose then. Our code is available for<br/>\ndownload if you are interested. There is also a package out<br/>\nthere called iContract which generates invariant checking code based on<br/>\nspecial javadoc comments. iContract has the advantage that the invariants,<br/>\npreconditions, and postconditions are clearly specified in your docs, but<br/>\nits disadvantage is that it is a preprocessor.<br/>\n<br/>\n<blockquote><span title=\"qreply\"> On Tue, 6 Nov 2001 <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:john_naylor@...\">john_naylor@...</a> wrote:<br/>\n<br/>\n&gt; i have been assigned the task of pushing our development team toward<br/>\n&gt; unit testing.  i have been working with junit for a few weeks now but<br/>\n&gt; continue to struggle with one issue.  it seems to me there is tension<br/>\n&gt; between unit testing and my preferred api.  for a given class i would<br/>\n&gt; like to expose only a handful of methods, yet do not want to forfeit<br/>\n&gt; testing my private methods.  my feeling is that i should be concerned<br/>\n&gt; with continually testing those methods, and yet fail to see why i<br/>\n&gt; should expose methods which are meaningless outside the &quot;blackbox&quot;.<br/>\n&gt;<br/>\n&gt; perhaps i am missing something obvious about good design.  in the<br/>\n&gt; mean time i have set up a simple interface which classes i test<br/>\n&gt; internally must implement.<br/>\n&gt;<br/>\n&gt; public interface Testable<br/>\n&gt; {<br/>\n&gt; \tpublic static final boolean INTERNAL_MODE = true;<br/>\n&gt;<br/>\n&gt; \tpublic void runInternalTests() throws Exception;<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt; this allows me to run internal tests and handle assertions by calling<br/>\n&gt; the static methods of Assert.  INTERNAL_MODE must be checked within<br/>\n&gt; runInternalTests().  This allows internal testing to be turned off<br/>\n&gt; for production builds.<br/>\n&gt;<br/>\n&gt; any insight about this dilemna would be appreciated.<br/>\n&gt;<br/>\n&gt;<br/>\n&gt;<br/>\n&gt;<br/>\n&gt; To unsubscribe from this group, send an email to:<br/>\n&gt; <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit-unsubscribe@yahoogroups.com\">junit-unsubscribe@yahoogroups.com</a><br/>\n&gt;<br/>\n&gt;<br/>\n&gt; Your use of Yahoo! Groups is subject to <a rel=\"nofollow\" target=\"_blank\" href=\"http://docs.yahoo.com/info/terms/\">http://docs.yahoo.com/info/terms/</a><br/>\n&gt;<br/>\n&gt;<br/>\n&gt;<br/>\n<br/>\n-- <br/>\nEric Vought<br/>\nChief Technical Officer - QLUE Consulting, Inc.<br/>\n<br/>\n<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:evought@...\">evought@...</a> toll-free: 888-771-3538  RTP area: 919-816-9901 </span></blockquote></div>", 
    "prevInTime": 3181, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1005063670", 
    "canDelete": false, 
    "nextInTopic": 3197, 
    "prevInTopic": 3179, 
    "headers": {
        "inReplyToHeader": "PDlzOG1lYSs0OWdnQGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PFBpbmUuTE5YLjQuMzAuMDExMTA2MTAzMjUzMC4xODY1LTEwMDAwMEBicmFpbi5xbHVlLWxhbj4="
    }
}
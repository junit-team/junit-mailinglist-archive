{
    "numMessagesInTopic": 8, 
    "nextInTime": 17003, 
    "senderId": "E_QqPr0p91gkFmQwEEqHCAIidZBJxE5g09PgBpOW9xz7TLQXaq9KchAUn10G49b_FExjuFOKX3DeiAmtFkIiHQ", 
    "systemMessage": false, 
    "subject": "Re: Mocking libraries and moving parts (was: Re: [junit] unit tes t       case for login())", 
    "from": "David Saff &lt;saff@...&gt;", 
    "authorName": "David Saff", 
    "msgSnippet": "Michael, One tool that works wonders for me in cases like this is to extract a protected helper method in DefaultGroupQualifier named getSession, which you can", 
    "msgId": 17002, 
    "profile": "dsaff", 
    "topicId": 16987, 
    "spamInfo": {
        "reason": "3", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 139771899, 
    "messageBody": "<div id=\"ygrps-yiv-83301726\">Michael,<br/>\n<br/>\nOne tool that works wonders for me in cases like this is to extract a <br/>\nprotected helper method in DefaultGroupQualifier named getSession, which <br/>\nyou can override for the test.  JUnit 4 makes this even easier, because <br/>\nthe test object can subclass DefaultGroupQualifier.  This significantly <br/>\ncuts down on the amount of mocking you need to do, and helps <br/>\nencapsulation.  Whenever I find myself mocking two or three objects <br/>\nbefore I even get to the interesting part of my test, I start looking <br/>\nfor protected query methods to extract.<br/>\n<br/>\nDoes that help?<br/>\n<br/>\n    David Saff<br/>\n<br/>\nmrutherfurd wrote:<br/>\n<blockquote><span title=\"qreply\"> &gt; --- In <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>, &quot;J. B. Rainsberger&quot; &lt;jbrains@...&gt; wrote:<br/>\n&gt;   <br/>\n&gt;&gt; Rutherford, Michael wrote:<br/>\n&gt;&gt;     <br/>\n&gt;&gt;&gt; Yes I&#39;m aware that the various mocking frameworks all provide <br/>\n&gt;&gt;&gt;       <br/>\n&gt; ways to in<br/>\n&gt;   <br/>\n&gt;&gt;&gt; erffect provide stub implementations of a given interface. The <br/>\n&gt;&gt;&gt;       <br/>\n&gt; problerm is<br/>\n&gt;   <br/>\n&gt;&gt;&gt; having to provide the interelationships between the various <br/>\n&gt;&gt;&gt;       <br/>\n&gt; interfaces to<br/>\n&gt;   <br/>\n&gt;&gt;&gt; allow the mock to function adequately. In the simple example <br/>\n&gt;&gt;&gt;       <br/>\n&gt; below I needed<br/>\n&gt;   <br/>\n&gt;&gt;&gt; to provide a mock IDfSession with enough extra code for it to <br/>\n&gt;&gt;&gt;       <br/>\n&gt; produce mock<br/>\n&gt;   <br/>\n&gt;&gt;&gt; IDfGroup and IDfUser objects that could then be resolved against <br/>\n&gt;&gt;&gt;       <br/>\n&gt; each other<br/>\n&gt;   <br/>\n&gt;&gt;&gt; in several variations by the business logic. It was a major <br/>\n&gt;&gt;&gt;       <br/>\n&gt; effort just to<br/>\n&gt;   <br/>\n&gt;&gt;&gt; get the mocks set up. IIRC the test code was significantly larger <br/>\n&gt;&gt;&gt;       <br/>\n&gt; than the<br/>\n&gt;   <br/>\n&gt;&gt;&gt; original class, let alone just the method I was testing.<br/>\n&gt;&gt;&gt;       <br/>\n&gt;&gt; What would have to be true for you to have avoided this extra work? <br/>\n&gt;&gt;     <br/>\n&gt; What <br/>\n&gt;   <br/>\n&gt;&gt; example were you trying to check? I don&#39;t know Documentum well, but <br/>\n&gt;&gt;     <br/>\n&gt; if <br/>\n&gt;   <br/>\n&gt;&gt; your business logic operates on User and Group objects, shouldn&#39;t <br/>\n&gt;&gt;     <br/>\n&gt; you <br/>\n&gt;   <br/>\n&gt;&gt; just invoke your business logic passing in User and Group objects? <br/>\n&gt;&gt;     <br/>\n&gt; This <br/>\n&gt;   <br/>\n&gt;&gt; would remove the need to simulate the Session interface.<br/>\n&gt;&gt;<br/>\n&gt;&gt; I would need to know more to be sure, but I suspect there are <br/>\n&gt;&gt; simplifications we can apply by looking at the tests a little <br/>\n&gt;&gt; differently. If you could share a test (or the essence of it) with <br/>\n&gt;&gt;     <br/>\n&gt; us, <br/>\n&gt;   <br/>\n&gt;&gt; we might be able to help.<br/>\n&gt;&gt;<br/>\n&gt;&gt;     <br/>\n&gt;&gt;&gt; The fact that calls to Documentum super class methods are <br/>\n&gt;&gt;&gt;       <br/>\n&gt; intermingled with<br/>\n&gt;   <br/>\n&gt;&gt;&gt; business logic to a high degree and seperating them would <br/>\n&gt;&gt;&gt;       <br/>\n&gt; complicate the<br/>\n&gt;   <br/>\n&gt;&gt;&gt; class inordinately making it less maintainable is also annoying.<br/>\n&gt;&gt;&gt;       <br/>\n&gt;&gt; I&#39;ll take your word for it, but intermixing business logic with <br/>\n&gt;&gt; integration logic has, in my experience, never been simpler (easier <br/>\n&gt;&gt;     <br/>\n&gt; to <br/>\n&gt;   <br/>\n&gt;&gt; maintain) than separating them from each other.<br/>\n&gt;&gt;<br/>\n&gt;&gt;     <br/>\n&gt;&gt;&gt; Having said that I still haven&#39;t given up, I&#39;m just less <br/>\n&gt;&gt;&gt;       <br/>\n&gt; confident than I<br/>\n&gt;   <br/>\n&gt;&gt;&gt; was. I also reread the holy books regularly <br/>\n&gt;&gt;&gt;       <br/>\n&gt; (&quot;Refactoring&quot;, &quot;Working<br/>\n&gt;   <br/>\n&gt;&gt;&gt; Effectively With Legacy Code&quot;, &quot;JUnit Recipes&quot;, &quot;Design Patterns&quot; <br/>\n&gt;&gt;&gt;       <br/>\n&gt; and<br/>\n&gt;   <br/>\n&gt;&gt;&gt; &quot;Refactoring to Patterns&quot;) trying to get ideas :-)<br/>\n&gt;&gt;&gt;       <br/>\n&gt;&gt; More eyes usually help....<br/>\n&gt;&gt;<br/>\n&gt;&gt; Take care.<br/>\n&gt;&gt;     <br/>\n&gt;<br/>\n&gt; Here&#39;s the user/group example I was referring to... Any suggestions <br/>\n&gt; would be greatly appreciated.<br/>\n&gt;<br/>\n&gt; /**<br/>\n&gt;  * This class allows default group to be used as an additional <br/>\n&gt; scoping type. <br/>\n&gt;  * <br/>\n&gt;  * Add the new qualifier to the the app.xml file to enable the use of <br/>\n&gt; this file.<br/>\n&gt;  * <br/>\n&gt;  * In use the qualifier will return the default group the user <br/>\n&gt; belongs to which can therefore <br/>\n&gt;  * be compared to the scoping value.<br/>\n&gt;  * <br/>\n&gt;  * eg.<br/>\n&gt;  * \t&gt;scope group=&quot;lpc&quot;&lt;<br/>\n&gt;  * <br/>\n&gt;  * @author Michael Rutherfurd<br/>\n&gt;  */<br/>\n&gt; public class DefaultGroupQualifier implements IQualifier {<br/>\n&gt;<br/>\n&gt; \t/**<br/>\n&gt; \t * Returns the name of the group to be used for scoping.<br/>\n&gt; \t * @return scope name<br/>\n&gt; \t */<br/>\n&gt; \tpublic String getScopeName() {<br/>\n&gt; \t\treturn &quot;group&quot;;<br/>\n&gt; \t}<br/>\n&gt;<br/>\n&gt; \tpublic String[] getContextNames() {<br/>\n&gt; \t\treturn null;<br/>\n&gt; \t}<br/>\n&gt;<br/>\n&gt; \tpublic String getScopeValue(QualifierContext context) {<br/>\n&gt; \t\treturn getDefaultGroup();<br/>\n&gt; \t}<br/>\n&gt;<br/>\n&gt; \tpublic String getParentScopeValue(String scopeValue) {<br/>\n&gt; \t\treturn null;<br/>\n&gt; \t}<br/>\n&gt;<br/>\n&gt; \tpublic String[] getAliasScopeValues(String scopeValue) {<br/>\n&gt; \t\treturn null;<br/>\n&gt; \t}<br/>\n&gt; \t<br/>\n&gt; \tprivate String getDefaultGroup() {<br/>\n&gt; \t\t<br/>\n&gt; \t\ttry {<br/>\n&gt; \t\t\tIDfSessionManager sessionManager = <br/>\n&gt; SessionManagerHttpBinding.getSessionManager();<br/>\n&gt; \t\t\t<br/>\n&gt; \t\t\tif (sessionManager == null) {<br/>\n&gt; \t\t\t\tDfLogger.debug(this, &quot;No session <br/>\n&gt; manager available&quot;, null, null);<br/>\n&gt; \t\t\t\treturn &quot;&quot;;<br/>\n&gt; \t\t\t}<br/>\n&gt; \t\t\t<br/>\n&gt; \t\t\tString currentDocbase = <br/>\n&gt; SessionManagerHttpBinding.getCurrentDocbase();<br/>\n&gt; \t\t\t<br/>\n&gt; \t\t\tif (currentDocbase == null) {<br/>\n&gt; \t\t\t\tDfLogger.debug(this, &quot;No docbase <br/>\n&gt; available&quot;, null, null);<br/>\n&gt; \t\t\t\treturn &quot;&quot;;<br/>\n&gt; \t\t\t}<br/>\n&gt; \t\t\t\t\t\t<br/>\n&gt; \t\t\tDfLogger.debug(this, &quot;PrincipalName: &quot; + <br/>\n&gt; sessionManager.getPrincipalName(), null, null);<br/>\n&gt; \t\t\t<br/>\n&gt; \t\t\ttry {<br/>\n&gt; \t\t\t\tIDfSession session = <br/>\n&gt; sessionManager.getSession(currentDocbase);<br/>\n&gt; \t\t\t\t<br/>\n&gt; \t\t\t\tif (session == null) {<br/>\n&gt; \t\t\t\t\tDfLogger.debug(this, &quot;No <br/>\n&gt; session available&quot;, null, null);<br/>\n&gt; \t\t\t\t\treturn &quot;&quot;;<br/>\n&gt; \t\t\t\t}<br/>\n&gt; \t\t\t<br/>\n&gt; \t\t\t\ttry {<br/>\n&gt; \t\t\t\t\tIDfUser user = session.getUser<br/>\n&gt; (null);<br/>\n&gt; \t\t\t\t\t<br/>\n&gt; \t\t\t\t\tDfLogger.debug(this, &quot;User: &quot; <br/>\n&gt; + user.getUserName() + &quot;(&quot; + user.getUserOSDomain() + &quot;&#92;&#92;&quot; + <br/>\n&gt; user.getUserOSName() + &quot;), Default group: &quot; + user.getUserGroupName<br/>\n&gt; (), null, null);<br/>\n&gt; \t\t\t\t\t<br/>\n&gt; \t\t\t\t\treturn user.getUserGroupName<br/>\n&gt; ();<br/>\n&gt; \t<br/>\n&gt; \t\t\t\t} finally {<br/>\n&gt; \t\t\t\t\tsessionManager.release<br/>\n&gt; (session);<br/>\n&gt; \t\t\t\t}<br/>\n&gt; \t\t\t<br/>\n&gt; \t\t\t} catch (DfIdentityException e) {<br/>\n&gt; \t            DfLogger.debug(this, &quot;Failed to get session due <br/>\n&gt; to identity exception&quot;, null, null);<br/>\n&gt; \t\t\t\treturn &quot;&quot;;<br/>\n&gt; \t\t\t}<br/>\n&gt; \t\t\t<br/>\n&gt; \t\t} catch (DfException e) {<br/>\n&gt;             DfLogger.error(this, &quot;Failed to get group&quot;, null, e);<br/>\n&gt; \t\t}<br/>\n&gt; \t\t<br/>\n&gt; \t\treturn &quot;&quot;;<br/>\n&gt; \t}\t<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt;<br/>\n&gt;<br/>\n&gt;<br/>\n&gt;<br/>\n&gt;<br/>\n&gt;<br/>\n&gt;  <br/>\n&gt; Yahoo! Groups Links<br/>\n&gt;<br/>\n&gt;<br/>\n&gt;<br/>\n&gt;  <br/>\n&gt;<br/>\n&gt;<br/>\n&gt; </span></blockquote></div>", 
    "prevInTime": 17001, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1150969426", 
    "canDelete": false, 
    "nextInTopic": 0, 
    "prevInTopic": 17001, 
    "headers": {
        "inReplyToHeader": "PGU3ZGRicytkY3FuQGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PDQ0OUE2NjUyLjQwODAzQG1pdC5lZHU+", 
        "referencesHeader": "PGU3ZGRicytkY3FuQGVHcm91cHMuY29tPg=="
    }
}
{
    "numMessagesInTopic": 5, 
    "nextInTime": 14063, 
    "senderId": "s1cuMeTkvo-lkkpdiEqv12HZqY57XY6-e8XFAmJQp2-tV2uhAHjKxrysvyOOSoKxD5zHUrrs0lkIds5T", 
    "systemMessage": true, 
    "subject": "Re: [junit] Re: Using a Special Class Loader to test a Singleton", 
    "from": "ray@...", 
    "authorName": "ray@allthisisthat.com", 
    "msgSnippet": "Thanks Jeff.  That is very helpful.  It was really driving me up the wall.  I don t understand the point about replacing the private singleton instance", 
    "msgId": 14062, 
    "profile": "raycclough", 
    "topicId": 14046, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 228922213, 
    "messageBody": "<div id=\"ygrps-yiv-1945245292\">Thanks Jeff.  That is very helpful.  It was really driving me up the wall.  I don&#39;t understand the point about replacing the private singleton instance variable, though.  How would that help?  Wouldn&#39;t that ultimately leave me with the same problem, only within the singleton class?<br/>\n<br/>\nThanks,<br/>\nRay Clough<br/>\n<br/>\n<blockquote><span title=\"qreply\"> ----- Original Message -----<br/>\nFrom: &quot;Jeff Grigg&quot; &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:jeffgrigg@...\">jeffgrigg@...</a>&gt;<br/>\nTo: <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a><br/>\nSubject: [junit] Re: Using a Special Class Loader to test a Singleton<br/>\nDate: Tue, 28 Jun 2005 12:42:04 -0000<br/>\n<br/>\n<br/>\n&lt;html&gt;&lt;body&gt;<br/>\n<br/>\n<br/>\n&lt;tt&gt;<br/>\n--- &quot;raycclough&quot; &lt;ray@a...&gt; wrote:&lt;BR&gt;<br/>\n&gt; [...], I created a custom Class Loader, and use Reflection to&lt;BR&gt;<br/>\n&gt; create the object.  It works great (except, of course, where&lt;BR&gt;<br/>\n&gt; it doesn&#39;t).  The reflexively obtained constructor returns an&lt;BR&gt;<br/>\n&gt; object of type &#39;Object&#39;, which the debugger says has the&lt;BR&gt;<br/>\n&gt; correct underlying type, and it contains the correct data,&lt;BR&gt;<br/>\n&gt; but I cannot Cast it to the type it needs to be.  Any hint&lt;BR&gt;<br/>\n&gt; to what I&#39;m doing wrong?  Thanks for any advice you can give&lt;BR&gt;<br/>\n&gt; me on this.&lt;BR&gt;<br/>\n&lt;BR&gt;<br/>\nTo directly answer your question:  You can&#39;t cast the object because &lt;BR&gt;<br/>\nit was created under a different class loader.  You can only &lt;BR&gt;<br/>\ninteract with that class through reflection.  You can&#39;t cast it to &lt;BR&gt;<br/>\ntypes or interfaces -- unless those classes were loaded by a common &lt;BR&gt;<br/>\nclass loader -- IE: the system class loader.&lt;BR&gt;<br/>\n&lt;BR&gt;<br/>\nI worked around this recently by loading the TestCase class itself &lt;BR&gt;<br/>\nunder the new class loader and calling the current test method on &lt;BR&gt;<br/>\nthe new instance, using reflection.  (And setting a flag so that the &lt;BR&gt;<br/>\nnew instance knew it was running under the new class loader.)&lt;BR&gt;<br/>\n&lt;BR&gt;<br/>\nA bit more detail:  The &quot;type&quot; of an instance, its identification, &lt;BR&gt;<br/>\nis the class name *PLUS* the the address of the ClassLoader instance &lt;BR&gt;<br/>\nthat loaded it.  That&#39;s how web servers keep applications separate &lt;BR&gt;<br/>\nfrom each other: They create one ClassLoader instance for each &lt;BR&gt;<br/>\nlogical application &quot;process&quot; they want to keep separate.&lt;BR&gt;<br/>\n&lt;BR&gt;<br/>\nQuestion:&lt;BR&gt;<br/>\nSince you&#39;re already using &#39;.setAccessible(true)&#39; already, why not &lt;BR&gt;<br/>\nuse reflection to replace the static singleton instance field?&lt;BR&gt;<br/>\n&lt;BR&gt;<br/>\n&gt; [...]&lt;BR&gt;<br/>\n&gt;     SpecialClassLoader loader = new SpecialClassLoader();&lt;BR&gt;<br/>\n&gt;     Class ctlrClass = loader.findClass(                  &lt;BR&gt;<br/>\n&gt; &quot;rdyne_rdcs.comm_gateway.controller.DefaultGatewayController&quot;);&lt;BR&gt;<br/>\n&gt;                                                 &lt;BR&gt;<br/>\n&gt;     // instantiate the controller using reflection&lt;BR&gt;<br/>\n&gt;     Class[] paramTypes = { Reader.class };&lt;BR&gt;<br/>\n&gt;     Object[] args = {reader};    // contains the &quot;test data&quot;&lt;BR&gt;<br/>\n&gt;                   &lt;BR&gt;<br/>\n&gt;     Constructor constructor = &lt;BR&gt;<br/>\n&gt; ctlrClass.getDeclaredConstructor(paramTypes);&lt;BR&gt;<br/>\n&gt;     constructor.setAccessible(true);&lt;BR&gt;<br/>\n&gt;     Object o = constructor.newInstance(args);&lt;BR&gt;<br/>\n&gt;                   &lt;BR&gt;<br/>\n&gt;     //Method m = ctlrClass.getMethod(&quot;getController&quot;,paramTypes);&lt;BR&gt;<br/>\n&gt;     //m.setAccessible(true);&lt;BR&gt;<br/>\n&gt;     //Object o = m.invoke(null,args);&lt;BR&gt;<br/>\n&gt;                   &lt;BR&gt;<br/>\n&gt; // TODO  - Figure this out!!!!!!!!!!!!!!!!!!&lt;BR&gt;<br/>\n&gt; // unfortunately somehow the Object may not be cast to the required&lt;BR&gt;<br/>\n&gt; // class &quot;DefaultGatewayController&quot;, or even to its interface.&lt;BR&gt;<br/>\n&gt; // This is true whether the &quot;Constructor&quot; method or the &quot;Method&quot;&lt;BR&gt;<br/>\n&gt; // method is used.  &lt;BR&gt;<br/>\n&gt; &lt;BR&gt;<br/>\n&gt;     if ( DefaultGatewayController.class.isInstance(o) ) {&lt;BR&gt;<br/>\n&gt;         // &quot;o&quot; may safely be cast as a &quot;DefaultGatewayController&quot;&lt;BR&gt;<br/>\n&gt;       System.out.println(&quot;YOWSA&quot;);&lt;BR&gt;<br/>\n&gt;       ctlr = (DefaultGatewayController)o;&lt;BR&gt;<br/>\n&gt;     } else {&lt;BR&gt;<br/>\n&gt;       System.out.println(&quot;OHNO&quot;);&lt;BR&gt;<br/>\n&gt;       System.out.println(&quot;Class: &quot; + o.getClass().getName());&lt;BR&gt;<br/>\n&gt;     }&lt;BR&gt;<br/>\n&gt; [...]&lt;BR&gt;<br/>\n&gt; &lt;BR&gt;<br/>\n&gt; This always goes thru the &quot;OHNO&quot; branch, although the output&lt;BR&gt;<br/>\n&gt; of the class name is what it should be to allow me to cast it.&lt;BR&gt;<br/>\n&gt; I&#39;m fairly new to JUnit, and I&#39;m really new to custom Class&lt;BR&gt;<br/>\n&gt; Loaders, but it seems to me that this should work easily and&lt;BR&gt;<br/>\n&gt; well. [...]&lt;BR&gt;<br/>\n&lt;BR&gt;<br/>\n&lt;BR&gt;<br/>\n&lt;BR&gt;<br/>\n&lt;/tt&gt;<br/>\n<br/>\n<br/>\n&lt;?---- LSpots keywords ?&gt;<br/>\n  &lt;?---- HM ADS ?&gt;<br/>\n  <br/>\n<br/>\n&lt;!-- |**|begin egp html banner|**| --&gt;<br/>\n<br/>\n<br/>\n&lt;br&gt;<br/>\n  &lt;div style=&quot;text-align:center; color:#909090; width:500px;&quot;&gt;<br/>\n  &lt;hr style=&quot;border-bottom:1px; width:500px; text-align:left;&quot;&gt;<br/>\n  &lt;tt&gt;YAHOO! GROUPS LINKS&lt;/tt&gt;<br/>\n&lt;/div&gt;<br/>\n&lt;br&gt;<br/>\n&lt;ul&gt;<br/>\n  &lt;tt&gt;&lt;li type=square&gt; Visit your group &quot;&lt;a href=&quot;<a rel=\"nofollow\" target=\"_blank\" href=\"http://groups.yahoo.com/group/junit&quot;\">http://groups.yahoo.com/group/junit&quot;</a>&gt;junit&lt;/a&gt;&quot; on the web.&lt;br&gt; &lt;/tt&gt;<br/>\n  &lt;tt&gt;&lt;li type=square&gt; To unsubscribe from this group, send an email to:&lt;br&gt; &lt;a href=&quot;mailto:<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit-unsubscribe@yahoogroups.com\">junit-unsubscribe@yahoogroups.com</a>?subject=Unsubscribe&quot;&gt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit-unsubscribe@yahoogroups.com\">junit-unsubscribe@yahoogroups.com</a>&lt;/a&gt;&lt;br&gt; &lt;/tt&gt;<br/>\n  &lt;tt&gt;&lt;li type=square&gt; Your use of Yahoo! Groups is subject to the &lt;a href=&quot;<a rel=\"nofollow\" target=\"_blank\" href=\"http://docs.yahoo.com/info/terms/&quot;\">http://docs.yahoo.com/info/terms/&quot;</a>&gt;Yahoo! Terms of Service&lt;/a&gt;.&lt;/tt&gt;<br/>\n&lt;/ul&gt;<br/>\n&lt;br&gt;<br/>\n&lt;div style=&quot;text-align:center; color:#909090; width:500px;&quot;&gt;<br/>\n  &lt;hr style=&quot;border-bottom:1px; width:500px; text-align:left;&quot;&gt;<br/>\n&lt;/div&gt;<br/>\n&lt;/br&gt;<br/>\n<br/>\n&lt;!-- |**|end egp html banner|**| --&gt;<br/>\n<br/>\n<br/>\n&lt;/body&gt;&lt;/html&gt; </span></blockquote></div>", 
    "prevInTime": 14061, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1119976811", 
    "canDelete": false, 
    "nextInTopic": 14064, 
    "prevInTopic": 14053, 
    "headers": {
        "messageIdInHeader": "PDIwMDUwNjI4MTY0MDExLkNDQTg4OUU3QTBAd3M2LTIudXM0Lm91dGJsYXplLmNvbT4="
    }
}
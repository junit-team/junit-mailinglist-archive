{
    "numMessagesInTopic": 11, 
    "nextInTime": 10497, 
    "senderId": "juh-H85S6BJCcFs5jgb5UPDd2L4sOO8w-aXqz8R4682qVa04-ktnR6V2c3DKKsnExRo9edGde4pTIIhRoZ3jbBSl90SFDzCZaZvwjA", 
    "systemMessage": false, 
    "subject": "Re: Problems testing an InputStream", 
    "from": "&quot;Craig Duncan&quot; &lt;leftymiata@...&gt;", 
    "authorName": "Craig Duncan", 
    "msgSnippet": "Thanks for all the great responses. I did get my unit test to work in ANT by playing around with the getResourceAsStream call. The new code is: InputStream is", 
    "msgId": 10496, 
    "profile": "leftymiata", 
    "topicId": 10290, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 66158715, 
    "messageBody": "<div id=\"ygrps-yiv-690197705\">Thanks for all the great responses.<br/>\n<br/>\nI did get my unit test to work in ANT by playing around with the<br/>\ngetResourceAsStream call.<br/>\n<br/>\nThe new code is:<br/>\nInputStream is = Deal.class.getResourceAsStream(&quot;/RunPOEngineTest.xml&quot;);<br/>\nassertNotNull(is);<br/>\n<br/>\nThe &quot;Deal&quot; class lives in the same jar file as the xml file.  The xml<br/>\nfile is at the root of the jar so I used a slash at the beginning.<br/>\n<br/>\nEven though things are working I am still unclear as to why they are<br/>\nworking.  Scott&#39;s post is very informative but I must confess my<br/>\nignorance as to how class loaders work.  My understanding of what the<br/>\ngetResourceAsStream does is obviously lacking.  The way I thought it<br/>\nworked is that a call to getResourceAsStream will try to locate that<br/>\nfile by searching through your CLASSPATH, similar to how the reference<br/>\nto a class is found by looking through your classpath.  Since I am<br/>\ntrying to locate a resource I get the impression that things work<br/>\ndifferently.<br/>\n<br/>\nThis xml file that I am trying to use is only needed for unit tests,<br/>\nit is not needed in the final production code, therefore I originally<br/>\njust put the file into a jar that contains a bunch of &quot;.java&quot; files. <br/>\nBasically a jar of the source that developers can use as reference.  I<br/>\nended up moving it into the jar that contains the &quot;.class&quot; files.  One<br/>\nof those &quot;.class&quot; files is the Deal class.<br/>\n<br/>\nSo I guess my question is, are there any links online that give a<br/>\nlitte more in-depth explanation of class loaders or would someone like<br/>\nto explain it?<br/>\n<br/>\n<br/>\nThanks for your help,<br/>\n<br/>\nCraig<br/>\n<br/>\n<br/>\n--- In <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>, &quot;Stirling, Scott&quot; &lt;scott.stirling@w...&gt;<br/>\nwrote:<br/>\n<blockquote><span title=\"ireply\"> &gt; &gt; From: Craig Duncan [mailto:leftymiata@y...]<br/>\n&gt; &gt; <br/>\n&gt; &gt; My scenario is that I have an xml file that is inside a jar.  When I<br/>\n&gt; &gt; run the unit test inside Eclipse the file is found and the tests run<br/>\n&gt; &gt; fine.  I even tried removing the jar from Eclipse&#39;s build path to make<br/>\n&gt; &gt; sure it was not finding the file in some other location.  The test<br/>\n&gt; &gt; failed without the jar in the path, so I am pretty sure the unit test<br/>\n&gt; &gt; is finding the file in the jar.<br/>\n&gt; <br/>\n&gt; Where in the jar is the XML file?  In the jar root?  Or in the<br/>\n </span></blockquote>package of the class that&#39;s retrieving it?  If in the root of the jar,<br/>\nprepend a &quot;/&quot; to the resource name.  If it&#39;s packaged in the package<br/>\ndirectory, don&#39;t.<br/>\n<blockquote><span title=\"ireply\"> &gt;  <br/>\n&gt; &gt; Now, when I run the unit tests from ANT I get a NullPointerException<br/>\n&gt; &gt; because the InputStream is Null.  I double checked the classpath that<br/>\n&gt; &gt; is printed out when the unit test runs and the jar file that contains<br/>\n&gt; &gt; the xml file is on the classpath.<br/>\n&gt; &gt; <br/>\n&gt; &gt; Here is the code I am using to read in the xml file.  It is pretty<br/>\n&gt; &gt; much the same as the original poster.<br/>\n&gt; &gt; <br/>\n&gt; &gt; // Get our sample input file.<br/>\n&gt; &gt; InputStream is = <br/>\n&gt; &gt; Class.class.getResourceAsStream(&quot;/RunPOEngineTest.xml&quot;);<br/>\n&gt; &gt; InputStreamReader sr = new InputStreamReader(is);<br/>\n&gt; <br/>\n&gt; Why are you doing Class.class.getResourceAsStream()?  This will<br/>\n </span></blockquote>resolve the resource relative to the classloader that the<br/>\njava.lang.Class class is in, which may or may not be the same as the<br/>\nloader your resource is in, depending on the classloader hierarchy of<br/>\nthe containing application (e.g.., Eclipse, JUnit, Ant) and how your<br/>\njar is loaded.  If everything is all in a standalone main() app and<br/>\neverything is in the system classpath, then using<br/>\nClass.getResourceAsStream() should work, but, in general and<br/>\nespecially in J2EE apps, that&#39;s not a portable way to do it.<br/>\n<blockquote><span title=\"ireply\"> &gt; <br/>\n&gt; As someone else began to say:<br/>\n&gt; <br/>\n&gt; 1. Foo.class.getResourceAsStream(&quot;...&quot;); or<br/>\n </span></blockquote>this.getClass().getResourceAsStream(&quot;...&quot;);<br/>\n<blockquote><span title=\"ireply\"> &gt; <br/>\n&gt; This will look for the resource in the same classloader hierarchy as<br/>\n </span></blockquote>the class calling getResourceAsStream().  getSystemResourceAsStream()<br/>\nshouldn&#39;t ever need to be called if you call getResource/AsStream()<br/>\nbecause the system classloader will call it under the covers if<br/>\nnecessary without you doing anything.<br/>\n<blockquote><span title=\"ireply\"> &gt; <br/>\n&gt; 2.<br/>\n </span></blockquote>Thread.currentThread().getContextClassLoader().getResourceAsStream(&quot;...&quot;);<br/>\n<blockquote><span title=\"ireply\"> &gt; <br/>\n&gt; This fallback will work for when the calling class and the resource<br/>\n </span></blockquote>are in a classloader not in the normal classloader search hierarchy<br/>\n(hope I explained that right).  I&#39;ve used it when I had a system level<br/>\nclass (loaded in the system or other high level classloader) that<br/>\nprovided a util method for finding resources in potentially any<br/>\nclassloader.  In order for the system level class to find resources in<br/>\nlower level classloaders, such as a web app classloader, you have to<br/>\nget the current thread (normally a thread spawned by the app server<br/>\nfor handling web requests and loading web app classes), get its<br/>\nclassloader and retrieve the resource from there.  This is a fallback<br/>\nsince the higher level classloaders should get searched first.<br/>\n<blockquote><span title=\"qreply\"> &gt; <br/>\n&gt; Scott Stirling<br/>\n&gt; Workscape, Inc.<br/>\n&gt; <br/>\n&gt; ***********************************************************************<br/>\n&gt; This message is intended only for the use of the intended recipient and<br/>\n&gt; may contain information that is PRIVILEGED and/or CONFIDENTIAL.  If you<br/>\n&gt; are not the intended recipient, you are hereby notified that any use,<br/>\n&gt; dissemination, disclosure or copying of this communication is strictly<br/>\n&gt; prohibited.  If you have received this communication in error, please<br/>\n&gt; destroy all copies of this message and its attachments and notify us<br/>\n&gt; immediately.<br/>\n&gt; *********************************************************************** </span></blockquote></div>", 
    "prevInTime": 10495, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1077113848", 
    "canDelete": false, 
    "nextInTopic": 10497, 
    "prevInTopic": 10491, 
    "headers": {
        "inReplyToHeader": "PDcyMDY4Mjk4Q0Q5OTEwNEFBRURFMkZERjg5QUMxNjBENEM0QzhDQGF2YW50aS5jb3JwLndvcmtzY2FwZS5uZXQ+", 
        "messageIdInHeader": "PGMwdnM1bys3cG1uQGVHcm91cHMuY29tPg=="
    }
}
{
    "numMessagesInTopic": 10, 
    "nextInTime": 24663, 
    "senderId": "qoaCvysecwRRfR5ZvsnWQ68t5RDzm0j3w2MvPSHN7bzMDmU4FrQhG5_szKcOHdKseYJp4c6St4ORNcB_aRZuW0_joXkFxS0-N46fuuO1gS0", 
    "systemMessage": false, 
    "subject": "Re: [junit] Custom classloader", 
    "from": "Johannes Ernst &lt;johannes.ernst@...&gt;", 
    "authorName": "Johannes Ernst", 
    "msgSnippet": "... Short answer: The code I’m trying to test will be loaded by custom ClassLoaders, and I’d rather unit test it with a setup as close to the run-time", 
    "msgId": 24662, 
    "profile": "r_objects", 
    "topicId": 24651, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 411618599, 
    "messageBody": "<div id=\"ygrps-yiv-897053218\"><html><head></head><div>Some people asked:</div><div><br class=\"ygrps-yiv-897053218\"></div><div><blockquote><span title=\"qreply\"> <blockquote type=\"cite\" class=\"ygrps-yiv-897053218\"><div class=\"ygrps-yiv-897053218\"><div id=\"ygrps-yiv-897053218ygrp-mlmsg\" style=\"font-size:13px;font-family:Arial, helvetica, clean, sans-serif;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:normal;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255, 255, 255);\" class=\"ygrps-yiv-897053218\"><div id=\"ygrps-yiv-897053218ygrp-msg\" style=\"line-height:1.22em;\" class=\"ygrps-yiv-897053218\"><div id=\"ygrps-yiv-897053218ygrp-text\" style=\"line-height:1.22em;font-family:Georgia;\" class=\"ygrps-yiv-897053218\"><div dir=\"ltr\" style=\"line-height:1.22em;\" class=\"ygrps-yiv-897053218\"><div style=\"line-height:1.22em;\" class=\"ygrps-yiv-897053218\">Why do you need custom classloading?</div></div></div></div></div></div></blockquote><br class=\"ygrps-yiv-897053218\"></span></blockquote></div><div>Short answer:</div><div><br class=\"ygrps-yiv-897053218\"></div><div>The code I’m trying to test will be loaded by custom ClassLoaders, and I’d rather unit test it with a setup as close to the run-time setup as possible.</div><div><br class=\"ygrps-yiv-897053218\"></div><div>Longer answer:</div><div><br class=\"ygrps-yiv-897053218\"></div>I’ve created a “module framework” (still looking for a good name; suggestions welcome) that mirrors the maven project hierarchy at runtime. Assume your maven projects look like this:<div class=\"ygrps-yiv-897053218\"><br class=\"ygrps-yiv-897053218\"></div><div class=\"ygrps-yiv-897053218\">MAIN</div><div class=\"ygrps-yiv-897053218\">&nbsp; &nbsp; MODULE_A</div><div class=\"ygrps-yiv-897053218\">&nbsp; &nbsp; &nbsp; &nbsp; MODULE_C</div><div class=\"ygrps-yiv-897053218\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MODULE_D</div><div class=\"ygrps-yiv-897053218\">&nbsp; &nbsp; &nbsp; &nbsp; MODULE_E</div><div class=\"ygrps-yiv-897053218\">&nbsp; &nbsp; MODULE_B</div><div class=\"ygrps-yiv-897053218\">&nbsp; &nbsp; &nbsp; &nbsp; MODULE_C</div><div class=\"ygrps-yiv-897053218\"><div class=\"ygrps-yiv-897053218\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MODULE_D</div><div class=\"ygrps-yiv-897053218\">&nbsp; &nbsp; &nbsp; &nbsp; MODULE_E</div></div><div class=\"ygrps-yiv-897053218\"><br class=\"ygrps-yiv-897053218\"></div><div class=\"ygrps-yiv-897053218\">to run my project, I say:</div><div class=\"ygrps-yiv-897053218\"><br class=\"ygrps-yiv-897053218\"></div><div class=\"ygrps-yiv-897053218\">&gt; java -jar mybootloader.jar -module MAIN</div><div class=\"ygrps-yiv-897053218\"><br class=\"ygrps-yiv-897053218\"></div><div class=\"ygrps-yiv-897053218\">instead of having to create a really long class path that includes all the module jars. The module framework evaluates the pom file inside MAIN.jar, and recursively looks for the jars of submodules in a well-known place (e.g. ~/.m2, or /usr/lib/java), and creates a ClassLoader for each one of them. (In the above example: 6 ClassLoaders) They delegate to each other in a structure that reflects the maven project hierarchy.</div><div class=\"ygrps-yiv-897053218\"><br class=\"ygrps-yiv-897053218\"></div><div class=\"ygrps-yiv-897053218\">This has several advantages:</div><div class=\"ygrps-yiv-897053218\">&nbsp;* isolation — it’s much harder for code in one module with its own ClassLoader to “break out”.&nbsp;</div><div class=\"ygrps-yiv-897053218\">&nbsp;* I can dynamically add modules to a running program without much trouble, simply by adding another delegate ClassLoader to MODULE_C’s ClassLoader, for example. This is useful for dynamic plug-ins such as “oh, this website I just came across references yet another media type”)</div><div class=\"ygrps-yiv-897053218\">&nbsp;* And I really hate distributing gigantic WARs and what have you that contain a ton of code that wasn’t actually updated: this lets me update just the one JAR at the time that was updated. This is a problem I’d like to solve nicely for UBOS <a rel=\"nofollow\" target=\"_blank\" href=\"http://ubos.net/\" class=\"ygrps-yiv-897053218\">http://ubos.net/</a>&nbsp;— if it can be done for all languages, why not also for Java?</div><div class=\"ygrps-yiv-897053218\"><br class=\"ygrps-yiv-897053218\"></div><div class=\"ygrps-yiv-897053218\">Because more things can go wrong with so many ClassLoaders than with only one, I’d like to have the same structure during junit testing.</div><div class=\"ygrps-yiv-897053218\"><br class=\"ygrps-yiv-897053218\"></div><div class=\"ygrps-yiv-897053218\">The code for this currently resides at&nbsp;<a rel=\"nofollow\" target=\"_blank\" href=\"https://github.com/infogrid-org/infogrid-modules\" class=\"ygrps-yiv-897053218\">https://github.com/infogrid-org/infogrid-modules</a>&nbsp;but it will become a separate project, once I figure out a name for it! It works from the command line, and it works in Tomcat 8.</div><div class=\"ygrps-yiv-897053218\"><br class=\"ygrps-yiv-897053218\"></div><div class=\"ygrps-yiv-897053218\"><div class=\"ygrps-yiv-897053218\">Does this make sense?</div></div><div class=\"ygrps-yiv-897053218\"><br class=\"ygrps-yiv-897053218\"></div><div class=\"ygrps-yiv-897053218\">Cheers,</div><div class=\"ygrps-yiv-897053218\"><br class=\"ygrps-yiv-897053218\"></div><div class=\"ygrps-yiv-897053218\"><br class=\"ygrps-yiv-897053218\"></div><div class=\"ygrps-yiv-897053218\"><br class=\"ygrps-yiv-897053218\"></div><div class=\"ygrps-yiv-897053218\">Johannes.</div><div class=\"ygrps-yiv-897053218\"><br class=\"ygrps-yiv-897053218\"></div></html></div>", 
    "prevInTime": 24661, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1432071372", 
    "canDelete": false, 
    "nextInTopic": 24663, 
    "prevInTopic": 24661, 
    "headers": {
        "inReplyToHeader": "PENBTFMxMi1QaWQzVS1qWnZyLTZiSmU4WjgxUll2TWF5d05EdmJkNU9MVlZQa21oPXFkUUBtYWlsLmdtYWlsLmNvbT4=", 
        "messageIdInHeader": "PDFFRTUxM0JCLTdGOUQtNEQ5RC05MzEyLUJGMjQ0QjFEMTZGREBnbWFpbC5jb20+", 
        "referencesHeader": "PG1qM2V1YStqZ3Z2bGRAWWFob29Hcm91cHMuY29tPiA8Q0FNWmVjWG01b1ptS0hYc2RkNzB3Wk9nS3E4KzBGNUVpdnk1Q1pRZzFSeVlVcFVvZlFRQG1haWwuZ21haWwuY29tPiA8QjU0NzgxRTYtQUZBRC00NjlGLTg5QjEtMUI3NDg5QTI3OTEzQGdtYWlsLmNvbT4gPENBTTIxUnQ5WFF5QVhwaG92cD1jRWJLZVlSZ3gxPXRzMGZXb01WTzJlMUcyX0tDZXdxd0BtYWlsLmdtYWlsLmNvbT4gPENBTFMxMi1QaWQzVS1qWnZyLTZiSmU4WjgxUll2TWF5d05EdmJkNU9MVlZQa21oPXFkUUBtYWlsLmdtYWlsLmNvbT4="
    }
}
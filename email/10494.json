{
    "numMessagesInTopic": 8, 
    "nextInTime": 10495, 
    "senderId": "Jid-DxTDgmeN6z3d6971eIC02aKL1gMya6gC5CPXpcQwxwOSzp49zI58COIlmjBfzNoJlyiXi4y7VBvr2NKYsjIF--_9", 
    "systemMessage": false, 
    "subject": "RE: [junit] Re: JUnit & Reflection -  now Clean ClassLoader Environment for Tests.", 
    "from": "&quot;Oisin&quot; &lt;oisin.kim@...&gt;", 
    "authorName": "Oisin", 
    "msgSnippet": "Apologies for the delay, been really busy in work and home, Here is a simple TestCase which will run each test in a clean new classloader. Comments welcome -", 
    "msgId": 10494, 
    "profile": "oisinkim2000", 
    "topicId": 10412, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 93528314, 
    "messageBody": "<div id=\"ygrps-yiv-697630221\">Apologies for the delay, been really busy in work and home,<br/>\n<br/>\nHere is a simple TestCase which will run each test in a clean new<br/>\nclassloader. Comments welcome - perhaps we can improve this to a level<br/>\nwhere it might be useful to others. To give people some background, I&#39;ve<br/>\nsone this to make sure classes are statically initialised at each test<br/>\nmethod invokation,<br/>\n<br/>\n<br/>\nimport java.io.File;<br/>\nimport java.lang.reflect.Constructor;<br/>\nimport java.lang.reflect.Method;<br/>\nimport java.net.MalformedURLException;<br/>\nimport java.net.URL;<br/>\nimport java.net.URLClassLoader;<br/>\nimport java.util.ArrayList;<br/>\nimport java.util.Properties;<br/>\nimport java.util.StringTokenizer;<br/>\nimport junit.framework.Assert;<br/>\nimport junit.framework.TestCase;<br/>\n<br/>\n/**<br/>\n * @author OK<br/>\n */<br/>\npublic class CLTest extends TestCase {<br/>\n<br/>\n  /**<br/>\n   * The classloader the method will run in<br/>\n   */<br/>\n  private ClassLoader classLoader;<br/>\n<br/>\n  private Properties props;<br/>\n<br/>\n  public void runMethod(String methodName) throws Exception {<br/>\n    Class thisClass = classLoader.loadClass(this.getClass().getName());<br/>\n    Method method = thisClass.getDeclaredMethod(methodName, null);<br/>\n    CLTest obj = null;<br/>\n    Constructor constructor = null;<br/>\n    try {<br/>\n      Constructor[] constructors = thisClass.getConstructors();<br/>\n      for (int i = 0; i &lt; constructors.length; i++) {<br/>\n        Constructor temp = constructors[i];<br/>\n        if (temp.getParameterTypes().length == 0) {<br/>\n          constructor = temp;<br/>\n        }<br/>\n      }<br/>\n      obj = (CLTest) constructor.newInstance(null);<br/>\n    } catch (Exception e) {<br/>\n      e.printStackTrace();<br/>\n    }<br/>\n    System.err.print(<br/>\n      &quot;runMethod::Current Classloader is &quot; + classLoader.toString());<br/>\n    System.err.println(&quot; -&gt; invoking method &quot; + method.getName());<br/>\n    method.invoke(obj, null);<br/>\n  }<br/>\n<br/>\n  protected void setUp() {<br/>\n    props = (Properties) System.getProperties().clone();<br/>\n    try {<br/>\n      final String classpath = System.getProperty(&quot;java.class.path&quot;);<br/>\n      final StringTokenizer tokenizer =<br/>\n        new StringTokenizer(classpath, File.pathSeparator);<br/>\n      // extract all items from classpath.<br/>\n      // unsynchronized: This local variable is unsynchronised.<br/>\n      final ArrayList urls = new ArrayList(10);<br/>\n      String element;<br/>\n      while (tokenizer.hasMoreTokens()) {<br/>\n        element = tokenizer.nextToken();<br/>\n        try {<br/>\n          urls.add(new URL(&quot;file://&quot; + element));<br/>\n        } catch (MalformedURLException ex) {<br/>\n          ex.printStackTrace();<br/>\n          throw new RuntimeException(ex.toString());<br/>\n        }<br/>\n      }<br/>\n      final URL[] urlArray = (URL[]) urls.toArray(new URL[urls.size()]);<br/>\n      if (Thread.currentThread().getContextClassLoader() == null) {<br/>\n        System.err.println(<br/>\n          &quot;&#92;n&#92;n&#92;nsetUp:: Classloader thread &quot;<br/>\n            + Thread.currentThread().getContextClassLoader());<br/>\n        final ClassLoader urlClassLoader =<br/>\n          new URLClassLoader(<br/>\n            urlArray,<br/>\n            Thread.currentThread().getContextClassLoader());<br/>\n        classLoader = urlClassLoader;<br/>\n      } else {<br/>\n        System.err.println(<br/>\n          &quot;&#92;n&#92;n&#92;nsetUp:: Classloader  class &quot; +<br/>\nthis.getClass().getClassLoader());<br/>\n        final ClassLoader urlClassLoader =<br/>\n          new URLClassLoader(urlArray, getClass().getClassLoader());<br/>\n        classLoader = urlClassLoader;<br/>\n      }<br/>\n    } catch (SecurityException e) {<br/>\n      e.printStackTrace();<br/>\n    }<br/>\n  }<br/>\n<br/>\n  public void tearDown() throws Exception {<br/>\n    System.err.println(&quot;tearDown::&#92;n&quot;);<br/>\n  }<br/>\n<br/>\n  public void testOne() throws Exception {<br/>\n    runMethod(&quot;doStuff&quot;);<br/>\n  }<br/>\n<br/>\n  public void testTwo() throws Exception {<br/>\n    runMethod(&quot;doStuff&quot;);<br/>\n  }<br/>\n<br/>\n  public void doStuff() throws Exception {<br/>\n    System.err.println(&quot;doStuff::Stuff&quot;);<br/>\n<br/>\n  }<br/>\n<br/>\n<br/>\n<br/>\n  /**<br/>\n   * @param arg0<br/>\n   */<br/>\n  public CLTest(String arg0) {<br/>\n    super(arg0);<br/>\n    // TODO Auto-generated constructor stub<br/>\n  }<br/>\n  public CLTest() {<br/>\n    super(&quot;test&quot;);<br/>\n  }<br/>\n<br/>\n}<br/>\n<br/>\n<br/>\nHere&#39;s the output from the testcase:<br/>\n<br/>\n<br/>\nsetUp:: Classloader  class sun.misc.Launcher$AppClassLoader@1ff5ea7<br/>\nrunMethod::Current Classloader is java.net.URLClassLoader@1034bb5 -&gt;<br/>\ninvoking method doStuff<br/>\ndoStuff::Stuff<br/>\ntearDown::<br/>\n<br/>\n<br/>\n<br/>\n<br/>\nsetUp:: Classloader  class sun.misc.Launcher$AppClassLoader@1ff5ea7<br/>\nrunMethod::Current Classloader is java.net.URLClassLoader@b162d5 -&gt;<br/>\ninvoking method doStuff<br/>\ndoStuff::Stuff<br/>\ntearDown::<br/>\n<br/>\n<br/>\n<blockquote><span title=\"qreply\"> &gt; -----Original Message-----<br/>\n&gt; From: Oisin Kim [mailto:<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:oisin.kim@...\">oisin.kim@...</a>] <br/>\n&gt; Sent: 09 February 2004 09:47<br/>\n&gt; To: <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a><br/>\n&gt; Subject: [junit] Re: JUnit & Reflection - now Clean <br/>\n&gt; ClassLoader Environment for Tests.<br/>\n&gt; <br/>\n&gt; <br/>\n&gt; Hi Again Neil,<br/>\n&gt; <br/>\n&gt; Thanks for your help, I&#39;m not sure if this is overkill, this <br/>\n&gt; solution involves some other packages, the javaassist stuff <br/>\n&gt; from Jboss.org, my code involved simply getting the current <br/>\n&gt; Thread, and replacing the current classloader (I assume this <br/>\n&gt; is possible through the setContextClassLoader method on the <br/>\n&gt; Thread class), which took about 10 lines in the setUp() <br/>\n&gt; method of a test case.<br/>\n&gt; <br/>\n&gt; Saying that, I can see the extra functionality (and <br/>\n&gt; flexibility) in your code and have no doubt I&#39;ll be using it soon!<br/>\n&gt; <br/>\n&gt; Thanks again!<br/>\n&gt; <br/>\n&gt; Oisin<br/>\n&gt; <br/>\n&gt; <br/>\n&gt; &gt; <br/>\n&gt; &gt; I submitted a reloading classloader to the group files section if <br/>\n&gt; &gt; you&#39;re interested.<br/>\n&gt; &gt; <br/>\n&gt; &gt; - Neil Swingler<br/>\n&gt; <br/>\n&gt; <br/>\n&gt; <br/>\n&gt; <br/>\n&gt;  <br/>\n&gt; Yahoo! Groups Links<br/>\n&gt; <br/>\n&gt; <br/>\n&gt; <br/>\n&gt;  <br/>\n&gt; <br/>\n&gt; </span></blockquote></div>", 
    "prevInTime": 10493, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1077059384", 
    "canDelete": false, 
    "nextInTopic": 0, 
    "prevInTopic": 10448, 
    "headers": {
        "inReplyToHeader": "PGMwN2t2MitmajVhQGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PDAwMDQwMWMzZjVhYiQyNGI4ODBmMCQwMzAyYThjMEBvaXNpbj4="
    }
}
{
    "numMessagesInTopic": 10, 
    "nextInTime": 12554, 
    "senderId": "sik49sA4dZISqM9rAuSOgrdTQPvtW2C77VkXAHya_XKR5VSXCgutG-eBM7vxOpSdaL2dTVyNGrIZ6Vi7-Khryv6wqYW9bw", 
    "systemMessage": false, 
    "subject": "Re: [junit] Multithreading: Testing scheduled method invocation?!", 
    "from": "Mike Clark &lt;mike@...&gt;", 
    "authorName": "Mike Clark", 
    "msgSnippet": "... I tried writing some learning tests for Quartz a couple months back. For what it s worth, I ran into the same timing issues. Before reaching for sleep(), I", 
    "msgId": 12553, 
    "profile": "clarkware", 
    "topicId": 12519, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 33026788, 
    "messageBody": "<div id=\"ygrps-yiv-1139869621\">On Dec 21, 2004, at 5:31 PM, Michael Schuerig wrote:<br/>\n<br/>\n<blockquote><span title=\"ireply\"> &gt; I&#39;m working on a class that interacts with the Spring framework&#39;s<br/>\n&gt; application context and the Quartz scheduler. I&#39;m pretty new to the<br/>\n&gt; latter, thus I&#39;m testing my understanding of Quartz just as much as I&#39;m<br/>\n&gt; testing my code. In effect, I can&#39;t (yet) build the fixture for my code<br/>\n&gt; completely with mocks as I have to ascertain what these mocks are<br/>\n&gt; supposed to do first.<br/>\n&gt;<br/>\n&gt; The complication here is that Quartz uses its own &quot;hidden&quot; thread(s) to<br/>\n&gt; fulfill its duties. It is such a thread that effects the change that I<br/>\n&gt; need to check for. As I don&#39;t want to test Quartz, of course, I&#39;m<br/>\n&gt; content with checking that my scheduled job is executed at all. Thus I<br/>\n&gt; schedule it for immediate execution, wait for 2 secs to give Quartz<br/>\n&gt; some time before the fixture is torn down again.<br/>\n&gt;<br/>\n&gt; Now, all this works surprisingly well. Still, I don&#39;t like the part of<br/>\n&gt; waiting some arbitrary time.<br/>\n<br/>\n </span></blockquote>I tried writing some learning tests for Quartz a couple months back.  <br/>\nFor what it&#39;s worth, I ran into the same timing issues.<br/>\n<br/>\nBefore reaching for sleep(), I tried to refactor Quartz innards so that <br/>\nthe internal clock could be programmatically advanced.  Unfortunately, <br/>\na direct call to System.currentTimeMillis() was duplicated in many <br/>\nplaces and even after consolidating all those calls through an <br/>\ninterface I was unable to mock the clock.<br/>\n<br/>\nI resorted to using sleep() with short schedules with the rationale <br/>\nbeing that I was primarily trying to learn how to use the Quartz API to <br/>\nschedule jobs, regardless of when those jobs ran.  Here&#39;s an example <br/>\ntest:<br/>\n<br/>\n     public void testRunEverySecondForTwoSeconds() {<br/>\n<br/>\n         CronTrigger trigger = new CronTrigger(&quot;trigger&quot;, &quot;testGroup&quot;, <br/>\n&quot;0/1 * * * * ?&quot;);<br/>\n         scheduler.scheduleJob(jobDetail, trigger);<br/>\n         scheduler.start();<br/>\n         sleep(2);<br/>\n         assertRanXTimes(2);<br/>\n         boolean waitForJobsToComplete = true;<br/>\n         scheduler.shutdown(waitForJobsToComplete);<br/>\n     }<br/>\n<br/>\n     private void assertRanXTimes(int count) {<br/>\n         assertEquals(count, jobDetail.getJobDataMap().getInt(&quot;count&quot;));<br/>\n         assertTrue(jobDetail.getJobDataMap().getBoolean(&quot;executed?&quot;));<br/>\n     }<br/>\n<br/>\nHope that helps somehow.<br/>\n<br/>\n--<br/>\nMike Clark<br/>\nClarkware Consulting, Inc.<br/>\n<a rel=\"nofollow\" target=\"_blank\" href=\"http://clarkware.com\">http://clarkware.com</a></div>", 
    "prevInTime": 12552, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1104167232", 
    "canDelete": false, 
    "nextInTopic": 12554, 
    "prevInTopic": 12522, 
    "headers": {
        "inReplyToHeader": "PDIwMDQxMjIyMDEzMS4wNTYzOS5taWNoYWVsQHNjaHVlcmlnLmRlPg==", 
        "messageIdInHeader": "PEJGRkNDODgxLTU4MjktMTFEOS05ODM5LTAwMEE5NUE1NDdCQ0BjbGFya3dhcmUuY29tPg==", 
        "referencesHeader": "PDIwMDQxMjIyMDEzMS4wNTYzOS5taWNoYWVsQHNjaHVlcmlnLmRlPg=="
    }
}
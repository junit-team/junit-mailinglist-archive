{
    "numMessagesInTopic": 6, 
    "nextInTime": 8285, 
    "senderId": "Um7IVeKoQjpgHf6F93qFDi6g-Gn8BqYuuB6OCAPjdVwAH1HYzTawbktIh2PPaQO80nfturH3ISOATRFG4EwQQJO5EUwABZmW5OU", 
    "systemMessage": false, 
    "subject": "Re: [junit] singletons and running tests more than once", 
    "from": "Kevin Klinemeier &lt;zipwow@...&gt;", 
    "authorName": "Kevin Klinemeier", 
    "msgSnippet": "Here s some comments on your different approaches. ... This was my first inclination, too.  I ve done similar things, and the approach I ve liked is to make", 
    "msgId": 8284, 
    "profile": "zipwow", 
    "topicId": 8277, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 82914509, 
    "messageBody": "<div id=\"ygrps-yiv-1466120501\">Here&#39;s some comments on your different approaches.<br/>\n<br/>\n<blockquote><span title=\"ireply\"> &gt; a) tearDown() is setting the static ivar which holds the singleton to<br/>\n&gt; null, so that the lazy static sharedInstance() always creates a new <br/>\n&gt; instance and by that always sets the correct System.properties. That <br/>\n&gt; would require to make that ivar set-able from outside the class it&#39;s <br/>\n&gt; declared in.<br/>\n<br/>\n </span></blockquote>This was my first inclination, too.  I&#39;ve done similar things, and the<br/>\napproach I&#39;ve liked is to make the method that does the &quot;dirty work&quot;<br/>\nprotected, then create another class called ClassNameTestAdaptor or<br/>\nsomesuch, which resides only with your testing code, and makes that<br/>\nmethod publicly available.  If there&#39;s logic about when or how to<br/>\n&#39;reset&#39; this object, and you can put it in that xxTestAdaptor class,<br/>\nthat at least nominally separates your actual code from your testing<br/>\nhacks.<br/>\n<br/>\n<blockquote><span title=\"ireply\"> &gt; <br/>\n&gt; b) setUp() is explicitly telling the singleton instance to reload the<br/>\n&gt; properties.<br/>\n<br/>\n </span></blockquote>I assume this isn&#39;t currently a publicly available option?  Perhaps you<br/>\nshould consider making this an option in the public interface.  This is<br/>\nmore straightforward than the &#39;set ref to null&#39;, and could be a<br/>\nreasonable thing to do.<br/>\n<br/>\n<blockquote><span title=\"ireply\"> &gt; <br/>\n&gt; c) The singleton loads the properties and copies the values into<br/>\n&gt; ivars <br/>\n&gt; and uses them instead of System.properties. This would only work if<br/>\n&gt; the <br/>\n&gt; singleton is isolated from other classes that don&#39;t depend on these <br/>\n&gt; System.properties, so it&#39;s not a general solution (and when using <br/>\n&gt; frameworks, it&#39;s not always possible to isolate classes using mocks).<br/>\n<br/>\n </span></blockquote>I&#39;m not sure what you mean when you say that it would only work if the<br/>\nsingleton is isolated.  Are other classes reading the same values from<br/>\nSystem.properties instead of using your singleton?  Should they be?  If<br/>\nnot, can you get them to stop?  I may not understand the full scope of<br/>\nyour project/problem, so of course take my advice with a grain of salt.<br/>\n<br/>\n<blockquote><span title=\"ireply\"> &gt; <br/>\n&gt; d) The singleton&#39;s static sharedInstance() method could check if the <br/>\n&gt; necessary system.properties are set and load them if required. This <br/>\n&gt; would cause a little performance hit because sharedInstance() is used<br/>\n&gt; a <br/>\n&gt; lot. Also, it&#39;s wouldn&#39;t be obvious to the reader of the source why <br/>\n&gt; that is done and would require inline documentation.<br/>\n<br/>\n </span></blockquote>for d-g, I think you&#39;ve described the drawbacks pretty accurately.  I<br/>\nthink I&#39;d lean towards approach b, as it looks like a reasonable<br/>\naddition to the interface.<br/>\n<br/>\nThat said, there are reasons to not expose it publicly, going with<br/>\nsomething like you describe in &#39;a&#39; instead.  If the interface already<br/>\nhas a hojillion methods, you may not want to add one more.  Or, if<br/>\ncalling &#39;reset&#39; anywhere outside of the unit tests would likely break<br/>\neverything, then it isn&#39;t a very helpful method.  <br/>\n<br/>\nAlso something to consider is that the &#39;reset&#39; method may be the thing<br/>\nthat changes this class from immutable to mutable, necessitating some<br/>\nsynchronization, which you may be able to avoid if you&#39;re only using<br/>\nthe reset functionality in unit tests that execute a single thread.*<br/>\n<br/>\nHope this rambling helps..<br/>\n<br/>\nKevin Klinemeier<br/>\n<br/>\n* Apologies if this is old news, but just to help quash a Java myth I<br/>\nwanted to add the following:<br/>\n<br/>\nSynchronization isn&#39;t &quot;50 times slower&quot;.  The overhead of an<br/>\nuncontested lock acquisition is pretty small, and unless its really in<br/>\nthe critical path, will have a negligable affect on performance. <br/>\nContested locks take longer, approaching that dreaded &quot;50 times&quot; limit,<br/>\nbut most of your locks aren&#39;t going to be hotly contested, and the JVM<br/>\ndoes a fair amount of optimization for you, more with each release.<br/>\n<br/>\nAs always, write it correctly first, then analyse, then tune.<br/>\n<br/>\n<a rel=\"nofollow\" target=\"_blank\" href=\"http://www-106.ibm.com/developerworks/library/j-jtp04223.html?ca=dnt-416\">http://www-106.ibm.com/developerworks/library/j-jtp04223.html?ca=dnt-416</a><br/>\n<a rel=\"nofollow\" target=\"_blank\" href=\"http://www-106.ibm.com/developerworks/java/library/j-threads1.html\">http://www-106.ibm.com/developerworks/java/library/j-threads1.html</a><br/>\n<br/>\n__________________________________<br/>\nDo you Yahoo!?<br/>\nYahoo! Calendar - Free online calendar with sync to Outlook(TM).<br/>\n<a rel=\"nofollow\" target=\"_blank\" href=\"http://calendar.yahoo.com\">http://calendar.yahoo.com</a></div>", 
    "prevInTime": 8283, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1054858551", 
    "canDelete": false, 
    "nextInTopic": 8286, 
    "prevInTopic": 8277, 
    "headers": {
        "inReplyToHeader": "PDE5RjYyRTkyLTk3N0EtMTFENy05MTE3LTAwMDM5MzdDMERDQ0BwZWtlbGVyLm9yZz4=", 
        "messageIdInHeader": "PDIwMDMwNjA2MDAxNTUxLjU4Mzg2LnFtYWlsQHdlYjgwNTA2Lm1haWwueWFob28uY29tPg=="
    }
}
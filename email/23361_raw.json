{
    "numMessagesInTopic": 10, 
    "nextInTime": 23362, 
    "senderId": "0ESQyMzrt7xrzC4YVby3ZcmXGaQLSo2aZxiQY6D1iwBwXdYivvoxas66jyuts2ZsBorsUGh9Jg8Titx06vmTi1VMo6Tsa2LsoQum_8JwArV_ZA", 
    "systemMessage": false, 
    "subject": "Re: [junit] Sometimes my tests fail, sometimes not - why?!", 
    "from": "Joakim Ohlrogge &lt;joakim.ohlrogge@...&gt;", 
    "authorName": "Joakim Ohlrogge", 
    "msgSnippet": "It seems from your later mails that you figured out the JUnit internals and eliminated the possibility of threading in JUnit. So, yes, as you know by now A", 
    "msgId": 23361, 
    "rawEmail": "Return-Path: &lt;joakim.ohlrogge@...&gt;\r\nX-Sender: joakim.ohlrogge@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nX-Received: (qmail 26740 invoked from network); 30 Mar 2011 16:53:00 -0000\r\nX-Received: from unknown (66.196.94.107)\n  by m14.grp.re1.yahoo.com with QMQP; 30 Mar 2011 16:53:00 -0000\r\nX-Received: from unknown (HELO mail-px0-f179.google.com) (209.85.212.179)\n  by mta3.grp.re1.yahoo.com with SMTP; 30 Mar 2011 16:53:00 -0000\r\nX-Received: by pxi2 with SMTP id 2so297134pxi.10\n        for &lt;junit@yahoogroups.com&gt;; Wed, 30 Mar 2011 09:52:59 -0700 (PDT)\r\nX-Received: by 10.142.122.8 with SMTP id u8mr1071135wfc.283.1301503979632; Wed,\n 30 Mar 2011 09:52:59 -0700 (PDT)\r\nMIME-Version: 1.0\r\nX-Received: by 10.142.51.14 with HTTP; Wed, 30 Mar 2011 09:52:36 -0700 (PDT)\r\nIn-Reply-To: &lt;4D92F64B.3000103@...&gt;\r\nReferences: &lt;4D924D9E.9060303@...&gt; &lt;AANLkTinwfKN6xEpTc82-dPfLFjxduu8zV2tA31N3Cyuv@...&gt;\n &lt;4D92F64B.3000103@...&gt;\r\nDate: Wed, 30 Mar 2011 18:52:36 +0200\r\nX-Google-Sender-Auth: FPLwu-nCbSKAMPNj1Lrnn48fN6I\r\nMessage-ID: &lt;AANLkTinzWdthX=CKDgGGqC9EY2c5VuU=ieo816BXEOsY@...&gt;\r\nTo: junit@yahoogroups.com\r\nX-eGroups-From: Joakim Ohlrogge &lt;joakim.ohlrogge@...&gt;\r\nFrom: Joakim Ohlrogge &lt;joakim.ohlrogge@...&gt;\r\nReply-To: joakim.ohlrogge@...\r\nSubject: Re: [junit] Sometimes my tests fail, sometimes not - why?!\r\nX-Yahoo-Group-Post: member; u=261856052; y=KQ4PmuouEQNhgvEqjTjwgQ2Rh0ZF8YUuERT-eEqnQ1YDt4Ox\r\nX-Yahoo-Profile: j0hlrogge\r\nContent-Type: text/plain\r\nContent-Transfer-Encoding: quoted-printable\r\n\r\nIt seems from your later mails that you figured out the JUnit internals and=\r\n\neliminated the possibility of threading in JUnit. So, yes, as you know by\n=\r\nnow A ends before B starts with the standard runner.\nIt seems like you ran =\r\ninto a race condition with the GC, the funny thing is\nthat many resources a=\r\nre closed in the finalize method so it happens that an\napplication that is =\r\nsloppy with closing resources actually behaves properly\nmost of the time si=\r\nnce the GC collects the resources and implicitly closes\nthem. Sometimes the=\r\n GC is fast enough, sometimes not. When running unittests\nyou generally pou=\r\nnd the code quite fast so its way more likely that you run\ninto this kind o=\r\nf problems in your tests than if you run the application\nunder normal condi=\r\ntions.\n\nI&#39;m happy you were able to solve your problem. Sounds like it was n=\r\not a\nsimple one to find.\n\n\n------------------------------------------------=\r\n-----\nJoakim Ohlrogge\nAgical AB\nV=E4sterl=E5nggatan 79, 2 tr\n111 29 Stockho=\r\nlm, SWEDEN\n\nMobile: +46-708-754004\nBlog: johlrogge.wordpress.com\nE-mail: jo=\r\nakim.ohlrogge@...\n\n\nOn Wed, Mar 30, 2011 at 11:22 AM, Nils Wilhelm &lt;m=\r\nurphy@...&gt;wrote:\n\n&gt;\n&gt;\n&gt; Hi Joakim,\n&gt;\n&gt; thanks for your mail.\n&gt;=\r\n\n&gt; Am 30.03.2011 08:56, schrieb Joakim Ohlrogge:\n&gt;\n&gt; &gt;\n&gt; &gt; I have had sever=\r\nal issues when working with a the filesystem from unit\n&gt; &gt; tests. In theory=\r\n you cannot expect the tests to be run sequencially as in\n&gt; &gt; test A has al=\r\nways run before test B (someone may request to run just\n&gt; &gt; one of\n&gt; &gt; them=\r\n by rightclicking on the test in eclipse for instance) so that is\n&gt; &gt; a bad=\r\n\n&gt; &gt; assumption. I don&#39;t think that is your problem in this case though. I\n=\r\n&gt; &gt; don&#39;t\n&gt; &gt; know about all the magic that goes on with the filesystem beh=\r\nind the\n&gt; &gt; scenes\n&gt; &gt; but especially on windows I have seen issues when fi=\r\nles are\n&gt; &gt; occationaly not\n&gt; &gt; deleted properly. I don&#39;t remember how I so=\r\nlved it but I would look for\n&gt; &gt; things like wether the files are properly =\r\nclosed and flushed before\n&gt; &gt; you try\n&gt; &gt; to delete them (could be a race c=\r\nondition where the the write stream is\n&gt; &gt; almost always GC:ed and closed i=\r\nn that process but sometimes not) that\n&gt; &gt; would\n&gt; &gt; lock the file for dele=\r\ntion occationall (when the the output stream has\n&gt; not\n&gt; &gt; yet been GC:ed).=\r\n Make sure everything is explicitly closed.\n&gt; &gt; It has happened that I thin=\r\nk everything looks fine but I have problems\n&gt; &gt; anyway. That is when I star=\r\nt imagining that there the issue is related to\n&gt; &gt; pounding on the filesyst=\r\nem too fast... I don&#39;t think that has ever\n&gt; &gt; been the\n&gt; &gt; case though but=\r\n one gets paranoid.\n&gt; &gt;\n&gt; I don&#39;t expected test A to run before test B. But=\r\n i am not sure if two\n&gt; tests can run at the same time or if one test runs,=\r\n ends and after that\n&gt; the next tests starts. Can you give me an answer to =\r\nthis?\n&gt; As you said i will check if all streams are closed. Maybe this is t=\r\nhe\n&gt; point.\n&gt;\n&gt; &gt;\n&gt; &gt;\n&gt; &gt; In general when I have to tests against the file =\r\nsystem I tend to to the\n&gt; &gt; setup a bit in reverse. I use an empty target d=\r\nirectory and recusrively\n&gt; &gt; delete every file in it both in my setUp (@Bef=\r\nore) and my tearDown\n&gt; &gt; (@After).\n&gt; &gt; This way, in case a run gets interup=\r\nted midway and the directory is left\n&gt; &gt; dirty it is cleaned prior to the n=\r\next run.\n&gt; &gt;\n&gt; I use the finally clause. I check if the created files exist=\r\n and delete\n&gt; them. So the next test can expect the source and target folde=\r\nr to be empty.\n&gt;\n&gt; &gt;\n&gt; &gt;\n&gt; &gt; This is not a JUnit issue in any case. In gene=\r\nral avoid using the\n&gt; &gt; filesystem\n&gt; &gt; from your tests will spare you lots =\r\nof grief. Perhaps most of what you\n&gt; &gt; want\n&gt; &gt; to test could be done in me=\r\nmory with\n&gt; &gt; ByteArrayOutputStream/ByteArrayInputStream and only touch the=\r\n\n&gt; &gt; filesystem in\n&gt; &gt; that last case when you know everything works, you j=\r\nust want to see\n&gt; &gt; that you\n&gt; &gt; can replace ByteArrayInput/OutputStream wi=\r\nth FileInputOutputStream.\n&gt; &gt; A neat sideeffect by coding this way is that =\r\nit&#39;s very simple to change\n&gt; &gt; sources/targets (like reading from any URL i=\r\nnstead of the filesystem) or\n&gt; &gt; filtering (like GZipping everything that i=\r\ns written to the target)\n&gt; &gt; which is\n&gt; &gt; not as elegant to do if you pass =\r\naround File objects. By all means\n&gt; &gt; make your\n&gt; &gt; API able to take a file=\r\nname/File instance but make usre that the first\n&gt; &gt; thing\n&gt; &gt; you do with i=\r\nt is creat a FileInputStream/FileOutputStream and pass it\n&gt; &gt; on to\n&gt; &gt; the=\r\n next method (using try finally of course). By running in memory\n&gt; &gt; you ar=\r\ne\n&gt; &gt; also better prepared to run tests in prallell etc.\n&gt; &gt;\n&gt; That&#39;s a goo=\r\nd point. Thank&#39;s!\n&gt;\n&gt; &gt;\n&gt; &gt;\n&gt; &gt; No rock solid advice in here but hopefully =\r\nsomething that helps some...\n&gt; &gt; ------------------------------------------=\r\n-----------\n&gt; &gt; Joakim Ohlrogge\n&gt; &gt; Agical AB\n&gt; &gt; V=E4sterl=E5nggatan 79, 2=\r\n tr\n&gt; &gt; 111 29 Stockholm, SWEDEN\n&gt; &gt;\n&gt; &gt; Mobile: +46-708-754004\n&gt; &gt; Blog: j=\r\nohlrogge.wordpress.com\n&gt; &gt; E-mail: joakim.ohlrogge@... &lt;mailto:joakim=\r\n.ohlrogge%40agical.se&gt;\n&gt;\n&gt; &gt;\n&gt; &gt; On Tue, Mar 29, 2011 at 11:22 PM, Nils Wil=\r\nhelm\n&gt; &gt; &lt;murphy@... &lt;mailto:murphy%40planet-of-art.de&gt;&gt;wrote:=\r\n\n&gt;\n&gt; &gt;\n&gt; &gt; &gt; Hi there,\n&gt; &gt; &gt;\n&gt; &gt; &gt; i have written a simple backup tool and =\r\n10 tests. They all have the\n&gt; same\n&gt; &gt; &gt; structure:\n&gt; &gt; &gt; 1. Create some te=\r\nst files and directories in an directory called\n&gt; &gt; &quot;source&quot;\n&gt; &gt; &gt; 2. Start=\r\n the backup process (to backup the files/dirs in &quot;source&quot; to a\n&gt; &gt; &gt; direct=\r\nory called &quot;target&quot;)\n&gt; &gt; &gt; 3. Check whether all files in &quot;source&quot; exist als=\r\no in &quot;target&quot;\n&gt; &gt; &gt; 4. Remove all files from the &quot;source&quot; and &quot;target&quot; dire=\r\nctory so that\n&gt; the\n&gt; &gt; &gt; directories are empty for the next test.\n&gt; &gt; &gt;\n&gt; =\r\n&gt; &gt; If i execute the whole test set ten times, i have 6-7 successes and 3-4=\r\n\n&gt; &gt; &gt; failures. The error messages say that files in the target directory\n=\r\n&gt; &gt; &gt; could not be created or deleted (in the last step of the tests, see\n&gt;=\r\n &gt; &gt; above) if there is a failure. One possibility i could think of is that=\r\n\n&gt; &gt; &gt; the tests are not run sequentially, so they could have influence at\n=\r\n&gt; each\n&gt; &gt; &gt; other. But as far as i know JUnit runs all tests in separate t=\r\nhreads\n&gt; and\n&gt; &gt; &gt; those sequentially. Is that correct? Does anybody have a=\r\nny suggestions?\n&gt; &gt; &gt;\n&gt; &gt; &gt; I use eclipse helios, JUnit 4.8.1, Java 1.6 and=\r\n AspectJ\n&gt; &gt; &gt;\n&gt; &gt; &gt; Best regards,\n&gt; &gt; &gt;\n&gt; &gt; &gt; Nils\n&gt; &gt; &gt;\n&gt; &gt; &gt;\n&gt; &gt; &gt; -----=\r\n-------------------------------\n&gt; &gt; &gt;\n&gt; &gt; &gt; Yahoo! Groups Links\n&gt; &gt; &gt;\n&gt; &gt; &gt;=\r\n\n&gt; &gt; &gt;\n&gt; &gt; &gt;\n&gt; &gt;\n&gt; &gt; [Non-text portions of this message have been removed]\n=\r\n&gt; &gt;\n&gt; &gt;\n&gt;\n&gt; [Non-text portions of this message have been removed]\n&gt;\n&gt;  \n&gt;\n\n=\r\n\n[Non-text portions of this message have been removed]\n\n\n", 
    "profile": "j0hlrogge", 
    "topicId": 23353, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 261856052, 
    "prevInTime": 23360, 
    "contentTrasformed": false, 
    "postDate": "1301503956", 
    "canDelete": false, 
    "nextInTopic": 23402, 
    "prevInTopic": 23360, 
    "headers": {
        "inReplyToHeader": "PDREOTJGNjRCLjMwMDAxMDNAcGxhbmV0LW9mLWFydC5kZT4=", 
        "messageIdInHeader": "PEFBTkxrVGlueldkdGhYPUNLRGdHR3FDOUVZMmM1VnVVPWllbzgxNkJYRU9zWUBtYWlsLmdtYWlsLmNvbT4=", 
        "referencesHeader": "PDREOTI0RDlFLjkwNjAzMDNAcGxhbmV0LW9mLWFydC5kZT4gPEFBTkxrVGlud2ZLTjZ4RXBUYzgyLWRQZkxGanhkdXU4elYydEEzMU4zQ3l1dkBtYWlsLmdtYWlsLmNvbT4gPDREOTJGNjRCLjMwMDAxMDNAcGxhbmV0LW9mLWFydC5kZT4="
    }
}
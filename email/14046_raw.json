{
    "numMessagesInTopic": 5, 
    "nextInTime": 14047, 
    "senderId": "5XvEJ-elEjSgmLdml8aQ1Y6ZkGUlzf_MP2MaKzrsFV6LJAhX16e-DefumFwhZCdIvnQv1fuYTIrMllbdcw3T0Xdrtb_Fvlmu0KvP", 
    "systemMessage": true, 
    "subject": "Using a Special Class Loader to test a Singleton", 
    "from": "&quot;raycclough&quot; &lt;ray@...&gt;", 
    "authorName": "raycclough", 
    "msgSnippet": "I know that the JUnit community frowns on Singletons.  However I have a piece of code which uses a singleton, and I want to test it.  The singleton takes a", 
    "msgId": 14046, 
    "rawEmail": "Return-Path: &lt;ray@...&gt;\r\nReceived: (qmail 47828 invoked from network); 28 Jun 2005 03:49:28 -0000\r\nReceived: from unknown (66.218.66.218)\n  by m24.grp.scd.yahoo.com with QMQP; 28 Jun 2005 03:49:28 -0000\r\nReceived: from unknown (HELO n18a.bulk.scd.yahoo.com) (66.94.237.47)\n  by mta3.grp.scd.yahoo.com with SMTP; 28 Jun 2005 03:49:28 -0000\r\nComment: DomainKeys? See http://antispam.yahoo.com/domainkeys\r\nReceived: from [66.218.66.59] by n18.bulk.scd.yahoo.com with NNFMP; 28 Jun 2005 03:49:17 -0000\r\nReceived: from [66.218.66.92] by mailer8.bulk.scd.yahoo.com with NNFMP; 28 Jun 2005 03:49:17 -0000\r\nX-Sender: ray@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (qmail 29399 invoked from network); 28 Jun 2005 00:21:08 -0000\r\nReceived: from unknown (66.218.66.218)\n  by m24.grp.scd.yahoo.com with QMQP; 28 Jun 2005 00:21:08 -0000\r\nReceived: from unknown (HELO n6a.bulk.scd.yahoo.com) (66.94.237.40)\n  by mta3.grp.scd.yahoo.com with SMTP; 28 Jun 2005 00:21:08 -0000\r\nComment: DomainKeys? See http://antispam.yahoo.com/domainkeys\r\nReceived: from [66.218.69.1] by n6.bulk.scd.yahoo.com with NNFMP; 28 Jun 2005 00:21:06 -0000\r\nReceived: from [66.218.66.74] by mailer1.bulk.scd.yahoo.com with NNFMP; 28 Jun 2005 00:21:06 -0000\r\nDate: Tue, 28 Jun 2005 00:21:03 -0000\r\nTo: junit@yahoogroups.com\r\nMessage-ID: &lt;d9q55f+765k@...&gt;\r\nUser-Agent: eGroups-EW/0.82\r\nMIME-Version: 1.0\r\nContent-Type: text/plain; charset=ISO-8859-1\r\nContent-Length: 3235\r\nX-Mailer: Yahoo Groups Message Poster\r\nX-Yahoo-Newman-Property: groups-system\r\nX-eGroups-Msg-Info: 1:12:0\r\nFrom: &quot;raycclough&quot; &lt;ray@...&gt;\r\nSubject: Using a Special Class Loader to test a Singleton\r\nX-Yahoo-Group-Post: member; u=228922213; y=3X9TulNlHs4NA0QCvwdWXDDJKEOf2FKxRQQvp2WwacOXJmsWRA\r\nX-Yahoo-Profile: raycclough\r\nX-eGroups-Approved-By: nails762 &lt;jbrains@...&gt; via web; 28 Jun 2005 03:49:15 -0000\r\n\r\nI know that the JUnit community frowns on Singletons.  However I have\na piece of code which uses a singleton, and I want to test it.  The\nsingleton takes a &quot;Reader&quot; in it&#39;s constructor (which may be null, and\nthen it uses a properties file to create its data).  I want to test it\nusing various different data sets.  In line with that, I created a\ncustom Class Loader, and use Reflection to create the object.  It\nworks great (except, of course, where it doesn&#39;t).  The reflexively\nobtained constructor returns an object of type &#39;Object&#39;, which the\ndebugger says has the correct underlying type, and it contains the\ncorrect data, but I cannot Cast it to the type it needs to be.  Any\nhint to what I&#39;m doing wrong?  Thanks for any advice you can give me\non this.\n\nHere&#39;s the relevant code from the JUnit &#39;setUp()&#39; method:\n\t\n//////// start code\t\ntry {\n    // since the Controller is a singleton, and may have been loaded\n    // before with different set-up data, use a ClassLoader to\n    // create a new instance of it.  This requires using Java\n    // Reflection to instantiate the object.  If we just called\n    // &quot;classForName()&quot;, the system class loader would be asked to\n    // return any previously loaded instance of the class.  Since\n    // this is what we want to avoid, a special ClassLoader returns\n    // a new instance of the class.\n    SpecialClassLoader loader = new SpecialClassLoader();\n    Class ctlrClass = loader.findClass(\t\t\t\n&quot;rdyne_rdcs.comm_gateway.controller.DefaultGatewayController&quot;);\n\t\t\t\t\t\t\t\t\n    // instantiate the controller using reflection\n    Class[] paramTypes = { Reader.class };\n    Object[] args = {reader};    // contains the &quot;test data&quot;\n\t\t\t\n    Constructor constructor = \nctlrClass.getDeclaredConstructor(paramTypes);\n    constructor.setAccessible(true);\n    Object o = constructor.newInstance(args);\n\t\t\t\n    //Method m = ctlrClass.getMethod(&quot;getController&quot;,paramTypes);\n    //m.setAccessible(true);\n    //Object o = m.invoke(null,args);\n\t\t\t\n// TODO  - Figure this out!!!!!!!!!!!!!!!!!!\n// unfortunately somehow the Object may not be cast to the required\n// class &quot;DefaultGatewayController&quot;, or even to its interface.\n// This is true whether the &quot;Constructor&quot; method or the &quot;Method&quot;\n// method is used.  \n\n    if ( DefaultGatewayController.class.isInstance(o) ) {\n        // &quot;o&quot; may safely be cast as a &quot;DefaultGatewayController&quot;\n\tSystem.out.println(&quot;YOWSA&quot;);\n\tctlr = (DefaultGatewayController)o;\n    } else {\n\tSystem.out.println(&quot;OHNO&quot;);\n\tSystem.out.println(&quot;Class: &quot; + o.getClass().getName());\n    }\n\n} catch (ClassNotFoundException cnfe) {\n\tcnfe.printStackTrace();\n} catch (NoSuchMethodException nsme) {\n\tnsme.printStackTrace();\n} catch (IllegalAccessException iae) {\n\tiae.printStackTrace();\n} catch (InvocationTargetException ite) {\n\tite.printStackTrace();\n} catch (InstantiationException ie) {\n\tie.printStackTrace(); \n} catch (ClassCastException cce) {\n\tcce.printStackTrace();\n}\n\n//////// end code\n\nThis always goes thru the &quot;OHNO&quot; branch, although the output of the\nclass name is what it should be to allow me to cast it.  I&#39;m fairly\nnew to JUnit, and I&#39;m really new to custom Class Loaders, but it seems\nto me that this should work easily and well.  Thanks,\n- Ray Clough\nray@...\n\n\n\n\n\n", 
    "profile": "raycclough", 
    "topicId": 14046, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 228922213, 
    "prevInTime": 14045, 
    "contentTrasformed": false, 
    "postDate": "1119918063", 
    "canDelete": false, 
    "nextInTopic": 14051, 
    "prevInTopic": 0, 
    "headers": {
        "messageIdInHeader": "PGQ5cTU1Zis3NjVrQGVHcm91cHMuY29tPg=="
    }
}
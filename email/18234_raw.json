{
    "numMessagesInTopic": 45, 
    "nextInTime": 18235, 
    "senderId": "wTIGRRmVajdiZ5JlPBBy-hujIC7ia04Wzlo2MmbOddW3OxOIRJYtvspMPSebdNP4vdaQQhpTlP9eMw0g6BkXi2Ohk_okPqoRvthTr_xDFouTfy4o", 
    "systemMessage": false, 
    "subject": "Re: [junit] Can anyone help me see how to usefully work with JUnit in a big project, please?", 
    "from": "&quot;Joakim Ohlrogge&quot; &lt;joakim.ohlrogge@...&gt;", 
    "authorName": "Joakim Ohlrogge", 
    "msgSnippet": "Hi Tracey, I won t apologize for my long reply ;) First of all my complements to you for hanging in there and trying to figure out what is the cause of your", 
    "msgId": 18234, 
    "rawEmail": "Return-Path: &lt;joakim.ohlrogge@...&gt;\r\nX-Sender: joakim.ohlrogge@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (qmail 4466 invoked from network); 27 Oct 2006 09:02:04 -0000\r\nReceived: from unknown (66.218.66.217)\n  by m33.grp.scd.yahoo.com with QMQP; 27 Oct 2006 09:02:04 -0000\r\nReceived: from unknown (HELO nf-out-0910.google.com) (64.233.182.186)\n  by mta2.grp.scd.yahoo.com with SMTP; 27 Oct 2006 09:02:03 -0000\r\nReceived: by nf-out-0910.google.com with SMTP id y38so1197142nfb\n        for &lt;junit@yahoogroups.com&gt;; Fri, 27 Oct 2006 02:02:02 -0700 (PDT)\r\nReceived: by 10.78.203.15 with SMTP id a15mr3487147hug;\n        Fri, 27 Oct 2006 02:02:02 -0700 (PDT)\r\nReceived: by 10.78.147.18 with HTTP; Fri, 27 Oct 2006 02:01:57 -0700 (PDT)\r\nMessage-ID: &lt;b9ee5e410610270201o709ecbbak5f568b0bbb7c27d@...&gt;\r\nDate: Fri, 27 Oct 2006 11:01:57 +0200\r\nTo: junit@yahoogroups.com\r\nIn-Reply-To: &lt;ehndat+q3cc@...&gt;\r\nMIME-Version: 1.0\r\nReferences: &lt;ehndat+q3cc@...&gt;\r\nX-Google-Sender-Auth: df83fc6defd09e8e\r\nX-eGroups-Msg-Info: 1:0:0:0\r\nX-eGroups-From: &quot;Joakim Ohlrogge&quot; &lt;joakim.ohlrogge@...&gt;\r\nFrom: &quot;Joakim Ohlrogge&quot; &lt;joakim.ohlrogge@...&gt;\r\nReply-To: joakim.ohlrogge@...\r\nSubject: Re: [junit] Can anyone help me see how to usefully work with JUnit in a big project, please?\r\nX-Yahoo-Group-Post: member; u=261856052; y=RsDsunSaKlHsQWOLPxPj9W91EiBz67oWkaij0eI6scisGMmo\r\nX-Yahoo-Profile: j0hlrogge\r\nContent-Type: text/plain; charset=US-ASCII\r\nContent-Transfer-Encoding: 7bit\r\n\r\nHi Tracey,\nI won&#39;t apologize for my long reply ;)\n\nFirst of all my complements to you for hanging in there and trying to figure\nout what is the cause of your headaches. Most people I come across simply\nconclued that &quot;unit testing would be coole in other projects but in my\nparticular situation it is impossible and just slows me down&quot;. I admire\nanyone who does not give up that easilly.\n\nOne part that struck me about your mail was the amount of the setup-code and\nespecially mock-expectations. Also how fragile they seem to be. 200 lines of\nmock-setup is like 5 to 10 times more than &quot;a lot&quot; and I can see how it\nbecomes fragile and more so, hard to see the intent of each test.\nI was involved in a long discussion about this issue on the TDD list (that I\ncan also recomend). James Carr started the disussion by asking: Do\nexpectations on mocks violate encapsulation? That started s lon discussion\nthat James summed up here:\n\nhttp://blog.james-carr.org/?p=34\n\nIt contains all the relevant links to the original discussion and external\nlinks presented in the discussion. Basically I think too many mocks and\nexpectations on them is a code-smell that sais that you are testing too many\nconcerns at once. You said in another reply that you are adding tests after\nthe code is written, that you want to test first but don&#39;t know how. I think\nthis is also why you see less value of the unit-tests especially if you are\nusing mocks.\n\nWhen retrofitting mocks to test something that has already been developed it\neasily becomes nasty. I think dynamic mock frameworks add very little value\nwhen not driving the code you are testing. Indeed that is one of the points:\nsee http://www.mockobjects.com (listening to opinionated software). Doing it\nwrong is supposed to hurt and you are supposed to react by designing the\nthing you test in such a way that it can be tested painlessly. That it hurts\nwhen testing it is simply your code telling you to remove your hand from the\nhot plate. How to do that is something we have to learn, the easiest thing\nthat most do when faced with this pain is just stop writing tests (turning\noff the neural system) and voila! /That/ pain is gone. And things are back\nto normal, sometimes things don&#39;t work as they should and we need to use the\ndebugger more often than not but that is how it used to be so maybe that is\nhow it is supposed to be after all :)\n\nI also found another statement in your post worth commenting on:\n&quot;In the last year of my work, JUnit has shown up a total of 5 actual\nbugs, all bar one of which would have come out immediately in\nfunctional testing, yet has taken maybe a third of my time.&quot;\n\nI think, when doing TDD the main benefit is not to find bugs it is to guide\nyour design. Also, bugs will not be /found/ doing TDD, they will be\n/prevented/. The only way you will ever find bugs with JUnit is when the\ntests are added after the code is written and if they are they didn&#39;t guide\nyour design wich makes you loose much of the benefit of unit-testing in the\nfirst place. I think your frustration lies here, your tests as you are using\nthem now don&#39;t seem add enough value to bear their own weight.\n\nRead through the blog-post I referenced klick on the link to Nat Pryce blog\nand ead through that post aswell. Take a deep breath, see if they make sense\nin your context. Read the books suggested by J.B. and find out how to\nactually get out of the situation you&#39;re in.\n\nI hope this helps and good luck!\n/Joakim Ohlrogge\n\n\n\n\nOn 10/25/06, Tracey Annison &lt;TAnnison@...&gt; wrote:\n&gt;\n&gt;   Hiya! This is an interesting list, full of lots of helpful technical\n&gt; tips - great stuff.\n&gt;\n&gt; I&#39;ve been having a browse around, but I don&#39;t seem to see anyone with\n&gt; the same questions as me... which is probably a sign that I&#39;m on the\n&gt; wrong track somehow! :)\n&gt; I know this is a long post, but I can&#39;t see how to explain it any\n&gt; shorter - sorry.\n&gt;\n&gt; I&#39;m pretty new to programming, and Java terminology isn&#39;t my strong\n&gt; point, so my apologies if I mis-word things badly. I&#39;m working on a\n&gt; fairly large project involving providing web services via SOAP and\n&gt; GUI access via JSP&#39;s to data entities, allowing database input and\n&gt; update on many tables.\n&gt; Here&#39;s how I (roughly) understand it, for a given &quot;Thing&quot; entity :\n&gt; ===========================================\n&gt; * We have a concrete Domain object for our entity, (ConcreteThing)\n&gt; with an interface above it (Thing). This has all the various\n&gt; properties (Name, Number, etc - some entities have 150 or more) and\n&gt; getters & setters for them that do basic validation, and use a DTO to\n&gt; get & set the actual data. The object also has validation methods\n&gt; that cross-check the values against various other entities, using\n&gt; their DAO&#39;s.\n&gt; * Each domain object uses a persistence DTO class (ThingDTO) which\n&gt; holds all the various properties for the Thing, and has simple\n&gt; getters & setters for them. The ConcreteThing class calls these in\n&gt; it&#39;s getters & setters.\n&gt; * Each data entity also has a ThingDAO class, with methods like\n&gt; CreateThing, SaveThing, DeleteThing, etc to actually handle the\n&gt; reading & writing of the data to the database tables, with\n&gt; standardised interfaces to allow easy access. It uses SQLMapClient\n&gt; and SQL scripts to do this, passing around the ThingDTO, and also\n&gt; uses other DAO&#39;s when it creates a new ConcreteThing. The ThingDAO is\n&gt; itself used by other Domain objects, to test validation, etc.\n&gt; * For each Web Service, we have a ThingService class that offers\n&gt; methods to the user, like GetThing, DeleteThing, GetAllThings, etc,\n&gt; using the ThingDAO to do the work. It also uses a simple\n&gt; SOAPBeanThing that is used to return values to them. The\n&gt; SOAPBeanThing holds the Thing&#39;s properties, in a simplified format\n&gt; suitable for sending via SOAP. (ie a Date rather than a YearMonthDay,\n&gt; etc) Using Axis lets us make this easily available to the outside\n&gt; world.\n&gt; * We also have a MVC layer, with FormControllers, Validators,\n&gt; Actions, etc, and JSP&#39;s & such to go along with it, also using the\n&gt; ThingDAO, but it&#39;s all much of a muchness.\n&gt; * We use Spring to tie all this together, injecting the various\n&gt; items where they&#39;re needed, except for the concrete classes, where\n&gt; they&#39;re sent as part of the constructor. And we have all sorts of\n&gt; other cool tools, like Subversion and Ant and CruiseControl for\n&gt; automatic testing and all that, but I don&#39;t think it&#39;s relevant...\n&gt; ===========================================\n&gt; So - this is all cool! Lots of layers, but it all works, and each bit\n&gt; does a nice understandable chunk of work, and they talk to each other\n&gt; fine. Plus we have some tools to help us generate the repetitive\n&gt; stuff, so that speeds it up a bit.\n&gt;\n&gt; So why have I wibbled on about all this? Because we&#39;re using JUnit\n&gt; and JMock, too! And I&#39;m having trouble with it. Technically, it works\n&gt; fine, but it takes ages, is really fragile and doesn&#39;t seem to give\n&gt; me much useful.\n&gt; I&#39;m sure it&#39;s because I&#39;m doing it all wrong somehow...\n&gt;\n&gt; The testing code is much, much larger than the actual code, quite\n&gt; complex, and doesn&#39;t seem to show up a lot of issues for the time &\n&gt; effort it takes to write. Just to get one of these objects to test\n&gt; takes a huge amount of setup code, making & calling in lots of Mock\n&gt; objects (typically DAO&#39;s) and specifying what they should do (with\n&gt; stubs and expects), and so on. To keep it all standardised and down\n&gt; to a minimum, I typically define them all at the start, and make a\n&gt; setUp method to get them built (though I&#39;m told this isn&#39;t a good\n&gt; idea by some) but it&#39;s still very large.\n&gt; In some cases, the setup for a test can be about 200 lines or more at\n&gt; the start, and a setUp method of 400 lines or more as well. To test\n&gt; one Service (under 2,000 lines of code for 7 methods using 80\n&gt; properties) that simply offers a standard set of\n&gt; Get/Create/Update/Delete methods on an entity, the tests run over 5\n&gt; files to a total length of 30,000 lines! In order to get test\n&gt; coverage above 80%, there&#39;s a large amount of test code that simply\n&gt; checks that the gets/sets work... which most of the time they can&#39;t\n&gt; help but do anyway.\n&gt;\n&gt; Tests overall are 5 to 10 times larger than the code they test, and\n&gt; incredibly fragile. The simplest change in the code of one class,\n&gt; often resulting in a tiny change in operation that causes no actual\n&gt; issues, breaks large numbers of tests all over the place.\n&gt; I know that the idea is to test a single class in isolation, but I\n&gt; don&#39;t see how to do that, when they need each other to do their work.\n&gt; For example, I can&#39;t check that the policy number on my new claim is\n&gt; valid without using the policy DAO to check it. I can&#39;t get a new\n&gt; Claim without using the getClaim method on my DAO. So I have to\n&gt; either set it up (almost impossible) or Mock it and specify exactly\n&gt; all the methods I&#39;ll use and all their parameters and their\n&gt; responses, and so on.\n&gt; Changing the type of some commonly used properties in several\n&gt; entities from Integer to BigDecimal took my colleague a fortnight,\n&gt; and a big chunk of this time was fixing JUnits.\n&gt;\n&gt; In the last year of my work, JUnit has shown up a total of 5 actual\n&gt; bugs, all bar one of which would have come out immediately in\n&gt; functional testing, yet has taken maybe a third of my time.\n&gt; I&#39;ve just gotta be doing it wrong... but I don&#39;t know how to do it\n&gt; right!\n&gt;\n&gt; The other problem for me is that I can&#39;t get my head around how to do\n&gt; TDD with this sort of structure.\n&gt;\n&gt; I can&#39;t write a test without having all the objects I need, and\n&gt; knowing exactly what parameters I need in the new methods, and\n&gt; precisely what methods with what parameters will get called on the\n&gt; other objects, and so on & so forth. Which won&#39;t even compile until\n&gt; it&#39;s all there & working. And even then, it&#39;s likely to go through\n&gt; several iterations of changes (oh, no, I need to check this thing as\n&gt; well, using this other DAO, and now I need to work this out as well,\n&gt; using that data from over there, and so on), so that even if I could\n&gt; do it, I&#39;d end up writing this huge thing four times over.\n&gt; I can understand it more from a functional viewpoint than anything\n&gt; else - &quot;this is the result I want, have I got it yet?&quot;. But to set up\n&gt; a JUnit/JMock test doesn&#39;t seem to me to really ask that - it asks\n&gt; more about how (in detail) I got to that result.\n&gt;\n&gt; I&#39;m completely bewildered by how anyone writing anything larger than\n&gt; 100 lines or so gets a benefit from doing this. You clearly ARE, but\n&gt; I just don&#39;t understand how... I must be missing something!\n&gt;\n&gt; So, given the sort of work we&#39;re doing, and the kind of structure\n&gt; I&#39;ve tried to describe, can anyone out there tell me how I&#39;ve gone so\n&gt; far off track here? Or give me some real examples of quick, useful\n&gt; test classes on stuff like this?\n&gt; I just KNOW that I must be doing it all wrong, but I can&#39;t seem to\n&gt; find any real-world examples of how to do it right on this scale. Any\n&gt; help would be gratefully recieved!\n&gt;\n&gt; Thanks VERY much,\n&gt; Cheers,\n&gt; Tracey\n&gt;\n&gt;  \n&gt;\n\n\n[Non-text portions of this message have been removed]\n\n\n", 
    "profile": "j0hlrogge", 
    "topicId": 18213, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 261856052, 
    "prevInTime": 18233, 
    "contentTrasformed": false, 
    "postDate": "1161939717", 
    "canDelete": false, 
    "nextInTopic": 18237, 
    "prevInTopic": 18232, 
    "headers": {
        "inReplyToHeader": "PGVobmRhdCtxM2NjQGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PGI5ZWU1ZTQxMDYxMDI3MDIwMW83MDllY2JiYWs1ZjU2OGIwYmJiN2MyN2RAbWFpbC5nbWFpbC5jb20+", 
        "referencesHeader": "PGVobmRhdCtxM2NjQGVHcm91cHMuY29tPg=="
    }
}
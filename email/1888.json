{
    "numMessagesInTopic": 3, 
    "nextInTime": 1889, 
    "senderId": "d22WFA3GGrs8T_tpF3CFPpoCKvHD3cCwIh9VcnG0-DJgoFZerQdmtDyUSOGS3XQiXGzmvn6LhSbm1mJ__Bu0p1j48U70CzpuIFjdka5LqNE", 
    "systemMessage": false, 
    "subject": "Re: [junit] Log4J, JAXP linkage  issues", 
    "from": "Charlie Woloszynski &lt;chw@...&gt;", 
    "authorName": "Charlie Woloszynski", 
    "msgSnippet": "Yes, add org.apache.log4j to the excluded list. This will put all of the log4j stuff outside of the special class loader and they will be loaded only once. ", 
    "msgId": 1888, 
    "topicId": 1885, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 0, 
    "messageBody": "<div id=\"ygrps-yiv-511287366\">Yes, add org.apache.log4j to the excluded list.<br/>\n<br/>\nThis will put all of the log4j stuff outside of the special class loader and<br/>\nthey will be loaded only once.<br/>\n<br/>\nWorks for me.<br/>\n<br/>\nCharlie<br/>\n<br/>\n<br/>\n&quot;Laird, William&quot; wrote:<br/>\n<br/>\n<blockquote><span title=\"qreply\"> &gt; I&#39;m just getting ready to start using JUnit as well as JAXP and Log4J and<br/>\n&gt; the JUnit extension JUNitPP.<br/>\n&gt;<br/>\n&gt; Scott suggests to add org.w3c.dom.* and org.xml.sax.* to the<br/>\n&gt; excluded.properties to resolve the linkage issues for JAXP developers. Does<br/>\n&gt; anyone have an equally simple solution for the log4J initialization issues<br/>\n&gt; reported in this forum?<br/>\n&gt;<br/>\n&gt; -----Original Message-----<br/>\n&gt; From: Scott Stirling [mailto:<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:sstirling@...\">sstirling@...</a>]<br/>\n&gt; Sent: Tuesday, July 10, 2001 11:32 PM<br/>\n&gt; To: &#39;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:chw@...\">chw@...</a> &#39;; &#39;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a> &#39;<br/>\n&gt; Subject: RE: [junit] Class loader error with junit<br/>\n&gt;<br/>\n&gt; The JUnit TestCaseClassLoader (the reloadable one) has a fundamental problem<br/>\n&gt; that results in frequent LinkageErrors under the following conditions:<br/>\n&gt;<br/>\n&gt; 1. You use the JUnit Swing UI.<br/>\n&gt;<br/>\n&gt; 2.  You use JAXP in your test cases or any classes referenced in your test<br/>\n&gt; cases, or even any &quot;instanceof&quot; expressions that reference JAXP classes.<br/>\n&gt; (By JAXP I mean the whole set of javax.* classes plus the org.w3c.dom.* and<br/>\n&gt; org.xml.sax.* classes)<br/>\n&gt;<br/>\n&gt; I can go into this in depth, but the bottom line problems are that JUnit<br/>\n&gt; loads classes from the same place as the JVM&#39;s system loader; the classpath.<br/>\n&gt; This necessitates the use of an exclusion list to filter out certain class<br/>\n&gt; names that either must be loaded by the system loader, or you would like to<br/>\n&gt; have loaded by the system loader.  The JUnit loader does not always delegate<br/>\n&gt; to the system loader when it should, particularly in the case of JAXP, which<br/>\n&gt; is a weird mix of classes whose names begin with the filtered &quot;javax.*&quot; and<br/>\n&gt; the unfiltered &quot;org.w3c.*&quot; and org.xml.*&quot;.<br/>\n&gt;<br/>\n&gt; JAXP is a special case because it is based on a set of javax.* classes.  All<br/>\n&gt; javax.* classes are excluded from the JUnit loader by default (in the<br/>\n&gt; default excluded.properties file) in junit.jar.  But JAXP, as shipped from<br/>\n&gt; Sun, comes with a bunch of other classes in org.w3c.* and org.xml.*.  The<br/>\n&gt; interesting thing is a direct dependency between javax.* classes and some<br/>\n&gt; other classes not in the usual exclusion list of com.sun.*, javax.*, etc.<br/>\n&gt;<br/>\n&gt; So what can happen, and frequently does when using the JUnit Swing UI with<br/>\n&gt; test cases or other classes, such as Log4J, that use JAXP, is that the JUnit<br/>\n&gt; class loader (properly) delegates javax.xml.* classes it &quot;sees&quot; to the<br/>\n&gt; system loader.  But then the system loader loads up a bunch of org.w3c.dom<br/>\n&gt; and/or org.xml.sax classes as the result of initializing and loading that<br/>\n&gt; JAXP class.  Later, if the JUnit loader comes across some org.w3c/xml class<br/>\n&gt; that it&#39;s never seen before, it tries to load it because the classname<br/>\n&gt; doesn&#39;t match one of the patterns in the exclude list.<br/>\n&gt;<br/>\n&gt; But it&#39;s already been loaded through the &quot;backdoor&quot; as the result of some<br/>\n&gt; other class loaded by the system loader (remember, the JVM keeps classes in<br/>\n&gt; their own namespace by identifying them by their fully qualified name plus<br/>\n&gt; the instance of their _defining_ (not initiating) loader, AND, the JVM will<br/>\n&gt; attempt to assign all unloaded classes referenced by a defined class to that<br/>\n&gt; defining class&#39;s loader).  The JVM&#39;s classresolver routine keeps track of<br/>\n&gt; all these class loading events and &quot;sees&quot; that the JUnit loader is<br/>\n&gt; attempting to define a class that has already been defined by the system<br/>\n&gt; loader.  That&#39;s wrong because according to the rules of loader constraints,<br/>\n&gt; JUnit should delegate this load to the system loader.<br/>\n&gt;<br/>\n&gt; You can hack around this (I did) by catching the LinkageError in<br/>\n&gt; TestCaseClassLoader&#39;s loadClass() method and then making a recovery call to<br/>\n&gt; findSystemClass() -- thereby delegating to the system loader after the fact<br/>\n&gt; (which is OK).  This hack only works some of the time, though, because now<br/>\n&gt; you can have the reverse problem where the JUnit loader loads a host of<br/>\n&gt; org.*.* classes, and then the system loader violates the loader contraints<br/>\n&gt; at some point when it tries to do exactly what I described above with JAXP<br/>\n&gt; because it doesn&#39;t ever delegate to its child (the JUnit loader).<br/>\n&gt; Inevitably, if your test cases use many JAXP and related XML classes, one or<br/>\n&gt; the other ClassLoader will end violating the constraints whatever you do.<br/>\n&gt;<br/>\n&gt; So the solution in the existing JUnit is to definitely add org.w3c.dom.* and<br/>\n&gt; org.xml.sax.* to your excluded.properties if you&#39;re using any JAXP stuff.<br/>\n&gt;<br/>\n&gt; What can we learn from this?  Well, one thing is that it&#39;s a good idea to<br/>\n&gt; have your custom class loaders load classes from repositories other than the<br/>\n&gt; system classpath.  Note that the JVM&#39;s built-in classloaders work that way<br/>\n&gt; (one for the jre/ext dirs, another for the java.class.path).<br/>\n&gt;<br/>\n&gt; Anyway, the excluded.properties fix is just a matter of time before it<br/>\n&gt; becomes standard in JUnit, since JAXP will be a standard part of the 1.4<br/>\n&gt; JDK.  It&#39;ll be just like having org.omg.* excluded.<br/>\n&gt;<br/>\n&gt; Scott Stirling<br/>\n&gt;<br/>\n&gt; -----Original Message-----<br/>\n&gt; From: <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:chw@...\">chw@...</a><br/>\n&gt; To: <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a><br/>\n&gt; Sent: 7/10/01 10:43 PM<br/>\n&gt; Subject: [junit] Class loader error with junit<br/>\n&gt;<br/>\n&gt; Folks:<br/>\n&gt;<br/>\n&gt; I am using Junit (I am a newbie at it) with Log4j (which we use<br/>\n&gt; extensively) and I cannot seem to get the Log4j stuff initialized.<br/>\n&gt;<br/>\n&gt; When I put the DOMConfigurator.configure() call from Log4j in main(),<br/>\n&gt; it is apparently lost when the test cases are run (different class<br/>\n&gt; loader? causing the singleton functions to use a different set<br/>\n&gt; objects?)<br/>\n&gt;<br/>\n&gt; When I put the Log4j config stuff in the setUp(), I get the following.<br/>\n&gt;<br/>\n&gt; Any suggestions what the problem is and how to work around it?<br/>\n&gt;<br/>\n&gt; Thanks<br/>\n&gt;<br/>\n&gt; Charlie<br/>\n&gt;<br/>\n&gt; java.lang.LinkageError: Class org/xml/sax/InputSource violates loader<br/>\n&gt; constraints<br/>\n&gt;         at<br/>\n&gt; org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:<br/>\n&gt; 1169)<br/>\n&gt;         at<br/>\n&gt; org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:<br/>\n&gt; 1039)<br/>\n&gt;         at<br/>\n&gt; org.apache.log4j.xml.DOMConfigurator.configure(DOMConfigurator.java:11<br/>\n&gt; 97)<br/>\n&gt;         at<br/>\n&gt; com.clearmetrix.outreach.datamodel.VisitorExperienceSqlOperationTestCa<br/>\n&gt; se.setUp(VisitorExperienceSqlOperationTestCase.java:38)<br/>\n&gt;<br/>\n&gt; To unsubscribe from this group, send an email to:<br/>\n&gt; <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit-unsubscribe@yahoogroups.com\">junit-unsubscribe@yahoogroups.com</a><br/>\n&gt;<br/>\n&gt;<br/>\n&gt; Your use of Yahoo! Groups is subject to<br/>\n&gt; <a rel=\"nofollow\" target=\"_blank\" href=\"http://docs.yahoo.com/info/terms/\">http://docs.yahoo.com/info/terms/</a><br/>\n&gt;<br/>\n&gt; To unsubscribe from this group, send an email to:<br/>\n&gt; <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit-unsubscribe@yahoogroups.com\">junit-unsubscribe@yahoogroups.com</a><br/>\n&gt;<br/>\n&gt;<br/>\n&gt; Your use of Yahoo! Groups is subject to <a rel=\"nofollow\" target=\"_blank\" href=\"http://docs.yahoo.com/info/terms/\">http://docs.yahoo.com/info/terms/</a><br/>\n&gt;<br/>\n&gt; To unsubscribe from this group, send an email to:<br/>\n&gt; <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit-unsubscribe@yahoogroups.com\">junit-unsubscribe@yahoogroups.com</a><br/>\n&gt;<br/>\n&gt;<br/>\n&gt; Your use of Yahoo! Groups is subject to <a rel=\"nofollow\" target=\"_blank\" href=\"http://docs.yahoo.com/info/terms/\">http://docs.yahoo.com/info/terms/</a> </span></blockquote></div>", 
    "prevInTime": 1887, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "994866702", 
    "canDelete": false, 
    "nextInTopic": 0, 
    "prevInTopic": 1886, 
    "headers": {
        "messageIdInHeader": "PDNCNEM3NjBFLjUwMEVDMjIxQGNsZWFybWV0cml4LmNvbT4=", 
        "referencesHeader": "PEY1MUU3NzY5MkNEM0QzMTE5MEYzMDA1MDhCOEJGQTVFMDExRTdFNDNAbWFleDAyLnNlY3VyaXR5LmNvbT4="
    }
}
{
    "numMessagesInTopic": 23, 
    "nextInTime": 22542, 
    "senderId": "od1qiNPCnQk5DpVC3f7PTi5eV5YWbJEGeYp64VCyyXlXijQYZYJyqM8hBExxhuRgVqo7gPvp8NyjL2C8FExfIyIwwU6lWx0B4EA", 
    "systemMessage": true, 
    "subject": "Re: [junit] Re: @DataPoints called several times for Theories", 
    "from": "Mike Forsberg &lt;bigmike.f@...&gt;", 
    "authorName": "Mike Forsberg", 
    "msgSnippet": "Please feel free to join the mailing list.  I would find the discussion interesting and wish it would not run offline. Big Mike ... [Non-text portions of this", 
    "msgId": 22541, 
    "rawEmail": "Return-Path: &lt;bigmike.f@...&gt;\r\nReceived: (qmail 82167 invoked from network); 14 Mar 2010 16:40:06 -0000\r\nReceived: from unknown (66.196.94.105)\n  by m1.grp.sp2.yahoo.com with QMQP; 14 Mar 2010 16:40:06 -0000\r\nReceived: from unknown (HELO n43d.bullet.mail.sp1.yahoo.com) (66.163.169.157)\n  by mta1.grp.re1.yahoo.com with SMTP; 14 Mar 2010 16:40:04 -0000\r\nDKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yahoogroups.com; s=lima; t=1268583970; bh=duaUjCnmlWm+C7kOBs8DB6IAJ3MH2K1X2RkVGiwyjOY=; h=Received:Received:X-Sender:X-Apparently-To:X-Received:X-Received:X-Received:X-Received:MIME-Version:X-Received:In-Reply-To:References:Date:Message-ID:To:X-Originating-IP:X-eGroups-Msg-Info:From:Subject:X-Yahoo-Group-Post:X-Yahoo-Profile:Content-Type:Content-Transfer-Encoding:X-YGroups-SubInfo:Sender:X-Yahoo-Newman-Property:X-eGroups-Approved-By:X-eGroups-Auth; b=jEic9vRQWcEldUszwF+R0rZ+x1yqcujvCWI38l5/UC+FaMdg3D3ez6lufjI90B3iGNzC2UKcLVy3cOr+wBkd7Te6lv4XCwDENXhXpBRGPd5U+7JRziOyyXY/xmsDVmMM\r\nReceived: from [69.147.65.173] by n43.bullet.mail.sp1.yahoo.com with NNFMP; 14 Mar 2010 16:26:10 -0000\r\nReceived: from [98.137.34.184] by t15.bullet.mail.sp1.yahoo.com with NNFMP; 14 Mar 2010 16:26:10 -0000\r\nX-Sender: bigmike.f@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nX-Received: (qmail 57050 invoked from network); 14 Mar 2010 16:15:23 -0000\r\nX-Received: from unknown (98.137.34.46)\n  by m12.grp.re1.yahoo.com with QMQP; 14 Mar 2010 16:15:23 -0000\r\nX-Received: from unknown (HELO mail-yx0-f197.google.com) (209.85.210.197)\n  by mta3.grp.sp2.yahoo.com with SMTP; 14 Mar 2010 16:15:22 -0000\r\nX-Received: by yxe35 with SMTP id 35so1172286yxe.26\n        for &lt;junit@yahoogroups.com&gt;; Sun, 14 Mar 2010 09:15:22 -0700 (PDT)\r\nMIME-Version: 1.0\r\nX-Received: by 10.101.3.30 with SMTP id f30mr5860646ani.177.1268583322276; Sun, \n\t14 Mar 2010 09:15:22 -0700 (PDT)\r\nIn-Reply-To: &lt;58dba2251003121544p3cd7dd28h1a899ce657f66ad3@...&gt;\r\nReferences: &lt;58dba2251002180943q238dd8dv11ab48736321e178@...&gt;\n\t &lt;hlkif2+3mte@...&gt;\n\t &lt;58dba2251003121544p3cd7dd28h1a899ce657f66ad3@...&gt;\r\nDate: Sun, 14 Mar 2010 11:15:22 -0500\r\nMessage-ID: &lt;a527fddf1003140915l73761ee1r781ba20fc768e42e@...&gt;\r\nTo: junit@yahoogroups.com, Shin Hwei Tan &lt;stan6@...&gt;, \n\tSang Y Baik &lt;sybaik2@...&gt;\r\nX-eGroups-Msg-Info: 1:12:0:0:0\r\nFrom: Mike Forsberg &lt;bigmike.f@...&gt;\r\nSubject: Re: [junit] Re: @DataPoints called several times for Theories\r\nX-Yahoo-Group-Post: member; u=421392598; y=0pTmvWTC7pWAyab2pTdGfAVyE5ze44l45YxZk3wuesXgJ0Gu\r\nX-Yahoo-Profile: bigmike_f\r\nContent-Type: text/plain\r\nContent-Transfer-Encoding: quoted-printable\r\nX-Yahoo-Newman-Property: groups-system\r\nX-eGroups-Approved-By: copabella &lt;joe@...&gt; via web; 14 Mar 2010 16:26:08 -0000\r\n\r\nPlease feel free to join the mailing list.  I would find the discussion\nint=\r\neresting and wish it would not run offline.\n\nBig Mike\n\nOn Fri, Mar 12, 2010=\r\n at 6:44 PM, Brett Daniel &lt;brettdaniel@...&gt; wrote:\n\n&gt;\n&gt;\n&gt; The undergr=\r\nads I am advising recently pushed a patch that addresses the\n&gt; issue of mut=\r\nable data points.\n&gt;\n&gt;\n&gt; http://github.com/stan6/junit/commit/dcfa3c41446c46=\r\n9a4edc7513e9e7a9b610b04020\n&gt;\n&gt; The patch allows developers to define &quot;copy =\r\nstrategies&quot; that duplicate\n&gt; marked data points before every theory executi=\r\non. In this way, every\n&gt; execution receives a pristine data point, which re=\r\nmoves the problems caused\n&gt; when a theory mutates data points. This is orth=\r\nogonal to datapoint\n&gt; (re)creation, but I think copy strategies may help ad=\r\ndress the bug that\n&gt; Berin found.\n&gt;\n&gt; The patch creates a new, optional &quot;co=\r\npyStrategy&quot; parameter for the\n&gt; @DataPoint and @DataPoints annotations. If =\r\nthe developer wants to copy data\n&gt; points, he or she sets the parameter to =\r\na class implementing a new\n&gt; CopyStrategy interface.\n&gt;\n&gt; Here is an example=\r\n:\n&gt;\n&gt; @RunWith(Theories.class)\n&gt; public class TestMutable {\n&gt;\n&gt; @DataPoint(=\r\ncopyStrategy =3D MutableWithCopyStrategy.class)\n&gt; public static Mutable mut=\r\nable =3D new Mutable();\n&gt;\n&gt; @Theory\n&gt; public static testMutate(Mutable a) {=\r\n\n&gt; a.mutate();\n&gt; }\n&gt;\n&gt; @Theory\n&gt; public static testNotMutated(Mutable a) {\n=\r\n&gt; assertFalse(a.isMutated());\n&gt; }\n&gt; }\n&gt;\n&gt; In the current implementation of =\r\nJUnit, the second theory may fail because\n&gt; the first theory mutates the da=\r\ntapoint. With a copy strategy enabled, both\n&gt; theories receive a new value.=\r\n\n&gt;\n&gt; Strategies can do almost anything: clone the data point, call a factor=\r\ny\n&gt; method, or--as in the following implementation--instantaiate a new obje=\r\nct\n&gt; with a copy constructor.\n&gt;\n&gt; public class MutableWithCopyStrategy impl=\r\nements CopyStrategy {\n&gt; public Object copyDataPoint(Object toCopy) throws E=\r\nxception {\n&gt; return new Mutable((Mutable)toCopy);\n&gt; }\n&gt; }\n&gt;\n&gt; There are sev=\r\neral benefits to this implementation. First, the new parameter\n&gt; is complet=\r\nely optional; if it is omitted, the theory runner behaves as it\n&gt; always ha=\r\ns. Second, it doesn&#39;t require modifying the data point&#39;s class\n&gt; (for\n&gt; exa=\r\nmple, to add a copy constructor or clone method). Most importantly, it\n&gt; ma=\r\nkes it clear to the tester that without a copy strategy one theory\n&gt; execut=\r\nion can impact another.\n&gt;\n&gt; I have CC&#39;d the two students in this email. Ple=\r\nase direct any questions to\n&gt; them.\n&gt;\n&gt; Brett\n&gt;\n&gt;\n&gt; On Thu, Feb 18, 2010 at=\r\n 5:28 PM, Berin &lt;berin.loritsch@...&lt;berin.loritsch%40gd-ais.com&gt;&gt;\n&gt; =\r\nwrote:\n&gt;\n&gt; &gt;\n&gt; &gt;\n&gt; &gt; I agree with your prognosis, about fresh data points f=\r\nor testing the\n&gt; &gt; theories. That is precisely why I proposed reading them =\r\nonce, and cloning\n&gt; &gt; them (making a copy) as needed for each theory. With =\r\nthat approach we\n&gt; even\n&gt; &gt; get the protection from mutated data points whe=\r\nn you use the @DataPoint\n&gt; to\n&gt; &gt; mark a static field.\n&gt; &gt;\n&gt; &gt; Cloning is a=\r\n much quicker operation, does not execute any constructors.\n&gt; It\n&gt; &gt; merely=\r\n copies the contents of the object memory verbatim.\n&gt; &gt;\n&gt; &gt; With the curren=\r\nt implementation, if you are not prepared for the\n&gt; &gt; combinatorial affect =\r\nof 60 data points combined with 60 data points for\n&gt; each\n&gt; &gt; theory there =\r\nis a major disconnect. The majority of the overhead in this\n&gt; &gt; particular =\r\nscenario has to do with creating objects (with the additional\n&gt; &gt; overhead =\r\nof doing it by reflection).\n&gt; &gt;\n&gt; &gt; When I created only one instance of eac=\r\nh class instead of two, the\n&gt; &gt; performance was twice as fast (i.e. 37 seco=\r\nnds down to about 16 seconds).\n&gt; &gt;\n&gt; &gt; Essentially the number of times your=\r\n @DataPoints method is called depends\n&gt; &gt; on the number of parameters in yo=\r\nur @Theory and how many theories you\n&gt; have.\n&gt; &gt; Essentially the formula fo=\r\nr my theory (ha, ha) of the execution is like\n&gt; &gt; this:\n&gt; &gt;\n&gt; &gt; N^(p-1) + 1=\r\n\n&gt; &gt;\n&gt; &gt; where:\n&gt; &gt;\n&gt; &gt; N is the number of data points returned by the meth=\r\nod\n&gt; &gt; p is the number of parameters\n&gt; &gt; and the + 1 represents the run whe=\r\nre the data point is read the first\n&gt; time\n&gt; &gt;\n&gt; &gt; So for 60 data points it=\r\n is run 61 times for two parameters. With three\n&gt; &gt; parameters it would be =\r\ncalled 3601 times. I have to verify with three\n&gt; &gt; parameters. The theory i=\r\ns called N^p times for sure and that is expected.\n&gt; &gt;\n&gt; &gt; With the above fo=\r\nrmula, the mapping of number of calls to parameters for\n&gt; 60\n&gt; &gt; data point=\r\ns would be:\n&gt; &gt;\n&gt; &gt; 1 -&gt; 2 (I know this is wrong which gives me doubts on t=\r\nhe formula)\n&gt; &gt; 2 -&gt; 61\n&gt; &gt; 3 -&gt; 3601\n&gt; &gt; 3 -&gt; 216001\n&gt; &gt;\n&gt; &gt; Essentially w=\r\nhen the Assignments class needs to make the combinations, it\n&gt; &gt; will colle=\r\nct the data points initially for each theory. It then calls the\n&gt; &gt; data po=\r\nints again for each existing data point it collected from the\n&gt; first\n&gt; &gt; r=\r\nead. With a third parameter it would take all those combinations again,\n&gt; t=\r\no\n&gt; &gt; add all the permutations for the next round.\n&gt; &gt;\n&gt; &gt; I might be wrong=\r\n and the real formula would be like this:\n&gt; &gt;\n&gt; &gt; N^0 + N^1 ... + N^(p-1)\n&gt;=\r\n &gt;\n&gt; &gt; If this is the correct formula, then if you have 60 data points the\n=\r\n&gt; number\n&gt; &gt; of times the method is called would map to the number of param=\r\neters like\n&gt; &gt; this:\n&gt; &gt;\n&gt; &gt; 1 -&gt; 1\n&gt; &gt; 2 -&gt; 61\n&gt; &gt; 3 -&gt; 3661\n&gt; &gt; 4 -&gt; 2196=\r\n61\n&gt; &gt;\n&gt; &gt;\n&gt; &gt; --- In junit@yahoogroups.com &lt;junit%40yahoogroups.com&gt; &lt;juni=\r\nt%\n&gt; 40yahoogroups.com&gt;, Brett Daniel\n&gt;\n&gt; &gt; &lt;brettdaniel@...&gt; wrote:\n&gt; &gt; &gt;\n=\r\n&gt; &gt; &gt; Berin,\n&gt; &gt; &gt;\n&gt; &gt; &gt; When a theory mutates data points, it might be ben=\r\neficial to recreate\n&gt; &gt; &gt; the data point for every theory invocation. Doing=\r\n so prevents one\n&gt; &gt; &gt; theory execution from affecting others. I wrote abou=\r\nt this issue in\n&gt; &gt; &gt; the following weblog post:\n&gt; &gt; &gt;\n&gt; &gt; &gt; http://www.bre=\r\nttdaniel.com/archives/2009/09/24/200845/\n&gt; &gt; &gt;\n&gt; &gt; &gt; You are correct, thoug=\r\nh, that copying would avoid some of the overhead\n&gt; &gt; &gt; in calling datapoint=\r\n methods. It is interesting you mention this idea,\n&gt; &gt; &gt; because I am curre=\r\nntly overseeing two students who for their senior\n&gt; &gt; &gt; thesis project are =\r\nimplementing framework for copying datapoints. I\n&gt; &gt; &gt; will post more infor=\r\nmation to the mailing list as the project\n&gt; &gt; &gt; continues.\n&gt; &gt; &gt;\n&gt; &gt; &gt; Bret=\r\nt\n&gt; &gt; &gt;\n&gt; &gt;\n&gt; &gt;\n&gt; &gt;\n&gt;\n&gt; [Non-text portions of this message have been remove=\r\nd]\n&gt;\n&gt;  \n&gt;\n\n\n[Non-text portions of this message have been removed]\n\n\n", 
    "profile": "bigmike_f", 
    "topicId": 22425, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 421392598, 
    "prevInTime": 22540, 
    "contentTrasformed": false, 
    "postDate": "1268583322", 
    "canDelete": false, 
    "nextInTopic": 22542, 
    "prevInTopic": 22540, 
    "headers": {
        "inReplyToHeader": "PDU4ZGJhMjI1MTAwMzEyMTU0NHAzY2Q3ZGQyOGgxYTg5OWNlNjU3ZjY2YWQzQG1haWwuZ21haWwuY29tPg==", 
        "messageIdInHeader": "PGE1MjdmZGRmMTAwMzE0MDkxNWw3Mzc2MWVlMXI3ODFiYTIwZmM3NjhlNDJlQG1haWwuZ21haWwuY29tPg==", 
        "referencesHeader": "PDU4ZGJhMjI1MTAwMjE4MDk0M3EyMzhkZDhkdjExYWI0ODczNjMyMWUxNzhAbWFpbC5nbWFpbC5jb20+CSA8aGxraWYyKzNtdGVAZUdyb3Vwcy5jb20+CSA8NThkYmEyMjUxMDAzMTIxNTQ0cDNjZDdkZDI4aDFhODk5Y2U2NTdmNjZhZDNAbWFpbC5nbWFpbC5jb20+"
    }
}
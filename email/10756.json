{
    "numMessagesInTopic": 4, 
    "nextInTime": 10757, 
    "senderId": "dSzUmh-DVECFwYaJBPMG9pgyJuGDBOjQ-gpwJmqhnQqCU-yhejlwObNKHmYrUeUcc8p6X82yrNekJxhed5yEYDFqQiHsGD0q-lIOZVLI", 
    "systemMessage": false, 
    "subject": "Best practice - should I fake, or depend on real world objects?", 
    "from": "Jonathan Oddy &lt;j.oddy@...&gt;", 
    "authorName": "Jonathan Oddy", 
    "msgSnippet": "Dear All, I ve noticed a pattern I have slipped into recently when writing a number of units.  A lot of my work revolves around using immutable data types ", 
    "msgId": 10756, 
    "profile": "jonathanoddy", 
    "topicId": 10756, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 124029770, 
    "messageBody": "<div id=\"ygrps-yiv-799478222\">Dear All,<br/>\n<br/>\nI&#39;ve noticed a pattern I have slipped into recently when writing a number of<br/>\nunits.  A lot of my work revolves around using immutable data types<br/>\n(serialised from some server).  As this project began life in the<br/>\ndim-and-distant past (pre unit testing) there aren&#39;t yet a whole load of<br/>\nunit tests - however their number is growing.  I used to fake the immutable<br/>\nobjects used within some method/behavoiur under test, and I&#39;ve one this<br/>\nusing one (or more) Object Mothers.  This works fine as it makes the test<br/>\ncases easier to understand.<br/>\n<br/>\nRecently, because I&#39;ve needed to fix a couple of faults within one of these<br/>\ntypes I&#39;ve created a small MockObjectInputStream (yes I know I should have<br/>\nused somebodies nMock library - but that&#39;s not important right now...) which<br/>\nallows me to construct/populate these objects from a String.  Since then<br/>\nI&#39;ve started creating &quot;real&quot; immutable objects from &quot;live&quot; data and using<br/>\nthese to test drive my current piece of implementation.  This feels &quot;right&quot;<br/>\nto me, because I&#39;ve been reducing the dependencies on the real world, and<br/>\nusing real world objects - so if they break/change somewhere then I am more<br/>\nlikely to see other unit tests failing, whereas a fake (and I&#39;ve been bitten<br/>\nby this a number of times) can contain inaccurate assumptions which mean<br/>\nthat the code I am test driving is implemented wrongly - because of those<br/>\nassumptions.<br/>\n<br/>\nBy way of clarification here&#39;s my Object Mother for class A, with both old<br/>\nand new factory methods:<br/>\n<br/>\npublic class ObjectMotherForA<br/>\n{<br/>\n  // &quot;old way&quot;<br/>\n  public static A oldCreate(int a, int b, int c...)<br/>\n  {<br/>\n    return new A()<br/>\n    {<br/>\n      public int getX() { return x; }<br/>\n      public int getY() { return y; }<br/>\n      public int getZ() { return z; }<br/>\n      // one problem I keep falling for is <br/>\n      // not overloading equals/hashCode/toString as appriate<br/>\n    }<br/>\n  }<br/>\n<br/>\n  // new way<br/>\n  public static A newCreate(String dataStream)<br/>\n  {<br/>\n    A a = new A();<br/>\n    a.readExternal(MockObjectInputStream(dataStream));<br/>\n    // no problems with equals, hashCode here!<br/>\n    return a;<br/>\n  }<br/>\n}<br/>\n<br/>\nI have two problems with &quot;new&quot; method of construction, firstly my test<br/>\nmethods look less meaning full - most of my immutable objects have *lots* of<br/>\nattributes which lead to less than helpful lines of code, and secondly it is<br/>\nvery easy (finger trouble) to mistype this serialised string (although I&#39;ve<br/>\ntended to use live data from log files for my initial data construction):<br/>\n<br/>\n// example of actual data stream<br/>\nA myA = ObjectMotherForA.newCreate(&quot;180593,OB_221,SK8<br/>\n9DF,2760,42,0,0,11,,SIX_4,0,,862430460,542720,0,0,0,1237,M,318,0,862358400,0<br/>\n,99999999,0,-1,862311600,862358400,0,0,0,0,0,0,0&quot;);<br/>\n<br/>\nI&#39;ve started working this way because when fixing field faults I&#39;ve been<br/>\ngiven various log files containing the serialised contents of these<br/>\nimmutable objects, so I&#39;ve been building tests using the above method<br/>\n(because it contains the erroneous data).  To improve matters my test cases<br/>\ncontain factory methods and/or the data stream broken up to highlight the<br/>\nproblematic (&quot;important&quot;) data, however you still end up with a lot of chaff<br/>\nsurrounding the tests.  For example:<br/>\n<br/>\npublic void testSomething()<br/>\n{<br/>\n  String product = &quot;98-a1&quot;;<br/>\n  String reason = &quot;-38&quot;;<br/>\n<br/>\n  ProductVerifier pv = new ProductVerifier(<br/>\n    createAWithInvalidProductAndReasonCodes(product, reason));<br/>\n  assertFalse(product + &quot;, &quot; + reason, pv.isValid();<br/>\n}<br/>\n<br/>\nprivate A createAWithInvalidStatusCode(String product, String reasonCode)<br/>\n{<br/>\n  String x = &quot;180593,OB_221,SK8 9DF,2760,42,0,0,11,,&quot;;<br/>\n  String y = &quot;,0,,862430460,542720,0,0,0,1237,M,&quot;;<br/>\n  String z =<br/>\n&quot;,0,862358400,0,99999999,0,-1,862311600,862358400,0,0,0,0,0,0,0&quot;;<br/>\n  return ObjectMotherForA.newCreate(x + product + y + reasonCode + z); <br/>\n}<br/>\n<br/>\nDoes this seem like a resonable direction to be going - or am I setting<br/>\nmyself up for an unpleasant (unforseen) fall somewhere later down the track?<br/>\n<br/>\nAny thoughts/criticisms welcome.<br/>\n<br/>\nJonathan<br/>\n<br/>\n--<br/>\nJonathan Oddy<br/>\nSERVICEPower Business Solutions Ltd<br/>\nPetersgate House - St Petersgate - Stockport - SK1 1HE - ENGLAND<br/>\nTel: +44 (0)161 476 2277<br/>\nEmail: <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:j.oddy@...\">j.oddy@...</a> &lt;mailto:<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:j.oddy@...\">j.oddy@...</a>&gt;</div>", 
    "prevInTime": 10755, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1081182168", 
    "canDelete": false, 
    "nextInTopic": 10780, 
    "prevInTopic": 0, 
    "headers": {
        "messageIdInHeader": "PEU1Qzc5MDQ5RDQ2MUQzMTFCODMxMDAwNjI5NTBCNTRBMDEyN0M0NjRAbnQtc3RvYy0wLnNicz4="
    }
}
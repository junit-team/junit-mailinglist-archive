{
    "numMessagesInTopic": 1, 
    "nextInTime": 14050, 
    "senderId": "2iHSJnqMnJE7uirDWz0dWPM-_3HQIO6TD252WVkENkzrxTlAfVT5X-yuTg83lZEhypCbXQVy5CIRst1uhoyB3Kid6w2zYfdJ4LswAEvu", 
    "systemMessage": false, 
    "subject": "Re: [junit] Using a Special Class Loader to test a Singleton", 
    "from": "Neil Swingler &lt;neil@...&gt;", 
    "authorName": "Neil Swingler", 
    "msgSnippet": "... If you are going to use reflection to defeat the private constructor, why bother reloading the class. ... The problem is that", 
    "msgId": 14049, 
    "rawEmail": "Return-Path: &lt;neil@...&gt;\r\nX-Sender: neil@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (qmail 70297 invoked from network); 28 Jun 2005 07:37:48 -0000\r\nReceived: from unknown (66.218.66.167)\n  by m23.grp.scd.yahoo.com with QMQP; 28 Jun 2005 07:37:48 -0000\r\nReceived: from unknown (HELO serv01.neil.swingler.name) (217.162.54.199)\n  by mta6.grp.scd.yahoo.com with SMTP; 28 Jun 2005 07:37:47 -0000\r\nReceived: from localhost\n\t([127.0.0.1] helo=serv01.neil.swingler.name ident=zope)\n\tby serv01.neil.swingler.name with esmtp (Exim 3.35 #1 (Debian))\n\tid 1DnAdU-0007fH-00\n\tfor &lt;junit@yahoogroups.com&gt;; Tue, 28 Jun 2005 09:36:00 +0200\r\ndate: Tue, 28 Jun 2005 09:35:52 +0200\r\nTo: junit@yahoogroups.com\r\nCc: \r\nX-Mailer: WebMailv2 Tice-Universite de Savoie\r\nContent-Transfer-Encoding: quoted-printable\r\nContent-Type: text/plain\r\nMessage-Id: &lt;E1DnAdU-0007fH-00@...&gt;\r\nX-eGroups-Msg-Info: 2:12:4\r\nFrom: Neil Swingler &lt;neil@...&gt;\r\nSubject: =?iso-8859-1?Q?Re:_[junit]_Using_a_Special_Class_Loader_to_test_a_Singleton?=\r\nX-Yahoo-Group-Post: member; u=117993331; y=VSOSvzAZWt21Wvar79_aYdWn0DRi-u8NCHZlIZ9U68r80Xs_P2Uvnw\r\nX-Yahoo-Profile: neil_swingler\r\n\r\n\n\n\n&gt; I know that the JUnit community frowns on Singletons.  However I have\n=\r\n&gt; a piece of code which uses a singleton, and I want to test it.  The\n&gt; sin=\r\ngleton takes a &quot;Reader&quot; in it&#39;s constructor (which may be null, and\n&gt; then =\r\nit uses a properties file to create its data).  I want to test it\n&gt; using v=\r\narious different data sets.  In line with that, I created a\n&gt; custom Class =\r\nLoader, and use Reflection to create the object.  It\n&gt; works great (except,=\r\n of course, where it doesn&#39;t).  The reflexively\n&gt; obtained constructor retu=\r\nrns an object of type &#39;Object&#39;, which the\n&gt; debugger says has the correct u=\r\nnderlying type, and it contains the\n&gt; correct data, but I cannot Cast it to=\r\n the type it needs to be.  Any\n&gt; hint to what I&#39;m doing wrong?  Thanks for =\r\nany advice you can give me\n&gt; on this.\n&gt; \n&gt; Here&#39;s the relevant code from th=\r\ne JUnit &#39;setUp()&#39; method:\n&gt; \t\n&gt; //////// start code\t\n&gt; try {\n\n&gt;     // sinc=\r\ne the Controller is a singleton, and may have been loaded\n&gt;     // before w=\r\nith different set-up data, use a ClassLoader to\n&gt;     // create a new insta=\r\nnce of it.  This requires using Java\n&gt;     // Reflection to instantiate the=\r\n object.  If we just called\n&gt;     // &quot;classForName()&quot;, the system class loa=\r\nder would be asked to\n&gt;     // return any previously loaded instance of the=\r\n class.  Since\n&gt;     // this is what we want to avoid, a special ClassLoade=\r\nr returns\n&gt;     // a new instance of the class.\n&gt;     SpecialClassLoader lo=\r\nader =3D new SpecialClassLoader();\n&gt;     Class ctlrClass =3D loader.findCla=\r\nss(\t\t\t\n&gt; &quot;rdyne_rdcs.comm_gateway.controller.DefaultGatewayController&quot;);\n&gt; =\r\n\t\t\t\t\t\t\t\t\n&gt;     // instantiate the controller using reflection\n&gt;     Class[]=\r\n paramTypes =3D { Reader.class };\n&gt;     Object[] args =3D {reader};    // c=\r\nontains the &quot;test data&quot;\n&gt; \t\t\t\n&gt;     Constructor constructor =3D \n&gt; ctlrClas=\r\ns.getDeclaredConstructor(paramTypes);\n&gt;     constructor.setAccessible(true)=\r\n;\n&gt;     Object o =3D constructor.newInstance(args);\n\nIf you are going to us=\r\ne reflection to defeat the private constructor, why bother reloading the cl=\r\nass.\n\n&gt; \t\t\t\n&gt;     //Method m =3D ctlrClass.getMethod(&quot;getController&quot;,paramT=\r\nypes);\n&gt;     //m.setAccessible(true);\n&gt;     //Object o =3D m.invoke(null,ar=\r\ngs);\n&gt; \t\t\t\n&gt; // TODO  - Figure this out!!!!!!!!!!!!!!!!!!\n&gt; // unfortunatel=\r\ny somehow the Object may not be cast to the required\n&gt; // class &quot;DefaultGat=\r\newayController&quot;, or even to its interface.\n&gt; // This is true whether the &quot;C=\r\nonstructor&quot; method or the &quot;Method&quot;\n&gt; // method is used.  \n&gt; \n&gt;     if ( Def=\r\naultGatewayController.class.isInstance(o) ) {\n&gt;         // &quot;o&quot; may safely b=\r\ne cast as a &quot;DefaultGatewayController&quot;\n&gt; \tSystem.out.println(&quot;YOWSA&quot;);\n&gt; \tc=\r\ntlr =3D (DefaultGatewayController)o;\n\nThe problem is that &quot;DefaultGatewayCo=\r\nntroller.class&quot; is not the same instance as ctlrClass. Although if DefaultG=\r\natewayController had an interface I would expect you to be able to cast it =\r\nto that.\n\n&gt;     } else {\n&gt; \tSystem.out.println(&quot;OHNO&quot;);\n&gt; \tSystem.out.print=\r\nln(&quot;Class: &quot; + o.getClass().getName());\n&gt;     }\n&gt; \n\nsnipped exception handl=\r\ning - why not just declare the test as throws Exception.\n\n&gt; This always goe=\r\ns thru the &quot;OHNO&quot; branch, although the output of the\n&gt; class name is what i=\r\nt should be to allow me to cast it.  I&#39;m fairly\n&gt; new to JUnit, and I&#39;m rea=\r\nlly new to custom Class Loaders, but it seems\n&gt; to me that this should work=\r\n easily and well.  Thanks,\n&gt; - Ray Clough\n&gt; ray@...\n&gt; \n\nThere=\r\n are 2 solutions:\n1) load the entire junit test using your special classloa=\r\nder. This is not easy.\n\n2) Invoke the methods on ctlr using reflection.\n\nIn=\r\n the files section I submitted an example of a classreloader. JB Rainsberge=\r\nr&#39;s JUnit Recipes also contains a recipe on this subject.\n\nI have since com=\r\ne up with a much simpler version of the reloader that you can find in my JI=\r\nsolate project:\nhttp://sourceforge.net/projects/jisolate\n\nNo release avalia=\r\nble yet but if you pull the project from cvs into eclipse you may get some =\r\nideas.\n\n- Neil\n\n", 
    "profile": "neil_swingler", 
    "topicId": 14049, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 117993331, 
    "prevInTime": 14048, 
    "contentTrasformed": false, 
    "postDate": "1119944152", 
    "canDelete": false, 
    "nextInTopic": 0, 
    "prevInTopic": 0, 
    "headers": {
        "messageIdInHeader": "PEUxRG5BZFUtMDAwN2ZILTAwQHNlcnYwMS5uZWlsLnN3aW5nbGVyLm5hbWU+"
    }
}
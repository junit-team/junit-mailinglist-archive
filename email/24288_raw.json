{
    "numMessagesInTopic": 30, 
    "nextInTime": 24289, 
    "senderId": "1wluan7i9IZCJc6v2Iv4bAMv213H4DCoaYaEZE-iVe60F1QEGeg7jcd-vXjgQKAg-2DKumE4hGbDc7Y2rmBCKWl6-S4W", 
    "systemMessage": false, 
    "subject": "Re: [junit] Feedback requested: Impending changes to RunListener", 
    "from": "Bill Venners &lt;bill@...&gt;", 
    "authorName": "Bill Venners", 
    "msgSnippet": "Hi Kevin, I m about to board a plane, but I took a look at the code on the way to the airport. I wonder if you could serialize the events on a separate thread ", 
    "msgId": 24288, 
    "rawEmail": "Return-Path: &lt;bill@...&gt;\r\nX-Sender: bill@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nX-Received: (qmail 42403 invoked from network); 7 Feb 2013 20:35:46 -0000\r\nX-Received: from unknown (10.193.84.135)\n  by m11.grp.bf1.yahoo.com with QMQP; 7 Feb 2013 20:35:46 -0000\r\nX-Received: from unknown (HELO mail-oa0-f53.google.com) (209.85.219.53)\n  by mta1.grp.bf1.yahoo.com with SMTP; 7 Feb 2013 20:35:46 -0000\r\nX-Received: by mail-oa0-f53.google.com with SMTP id m1so3324616oag.12\n        for &lt;junit@yahoogroups.com&gt;; Thu, 07 Feb 2013 12:35:45 -0800 (PST)\r\nX-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;\n        d=google.com; s=20120113;\n        h=mime-version:x-received:in-reply-to:references:date:message-id\n         :subject:from:to:content-type:x-gm-message-state;\n        bh=O+wy8frLq4wshSSFaJWNdq1iHpAFph++sjn3sWVCPPI=;\n        b=mrdLO0njC1rM9gxRpLMOp3AnFfYIFDB/5TbAWXlZ8RmxiHF43AfrlIFfA6lfwrdY5w\n         FEeQfoktWn/O8jUmCb86ropzGmkmr8/q3NYWhk4OO1qjKIqGlYZMfZRHg8wDtB35lEuP\n         hXX0BqQ/pKjuqcacBjwE8pBhP4/hEem0Xc05DWrAGc7J0ebPjtt/uH4Y9U01MGJV071d\n         8H50QRebOmJL8hlECU0t9OEvRIJ6ODPqGTQ9/yUXr9mZQ4OkEzlHXYnHBkHmqS2PXxqc\n         m0dEfyRmIlXjaKtp1zMP6EyLEeCzNN2o9B7hLujPH8pDkriGfgjQsQ5yvS57RRXMVIxi\n         Dfgg==\r\nMIME-Version: 1.0\r\nX-Received: by 10.182.112.34 with SMTP id in2mr2273954obb.80.1360269345778;\n Thu, 07 Feb 2013 12:35:45 -0800 (PST)\r\nX-Received: by 10.182.85.196 with HTTP; Thu, 7 Feb 2013 12:35:45 -0800 (PST)\r\nIn-Reply-To: &lt;CAA3E+eW_Xqm61gPhzEN8PSp79aAjbAx1ZC3prZexc6vzGk8ukA@...&gt;\r\nReferences: &lt;CAA3E+eXqF6DNQc0r5Hekj1gE-PyBnvj4_TNbVgRUo+Eekxwhjw@...&gt;\n\t&lt;CAO_RykoJ1vQskNCkRyZbDiqSiUN__E8YaYzWssTEh7VGx1uupw@...&gt;\n\t&lt;CAA3E+eW_Xqm61gPhzEN8PSp79aAjbAx1ZC3prZexc6vzGk8ukA@...&gt;\r\nDate: Thu, 7 Feb 2013 12:35:45 -0800\r\nMessage-ID: &lt;CAO_Rykp7MHPz_=_9405by3oWOERJqR+dPYWLO=Y7rhYwp73ccw@...&gt;\r\nTo: junit@yahoogroups.com\r\nX-Gm-Message-State: ALoCoQndNXqxslwrMZJ4LahdY3wGkvoRzG9NEpg9R2nCDN/QZ6LZ0WIXhRi6/TTKs2K67JiQ5PPk\r\nX-eGroups-Msg-Info: 1:12:0:0:0\r\nFrom: Bill Venners &lt;bill@...&gt;\r\nSubject: Re: [junit] Feedback requested: Impending changes to RunListener\r\nX-Yahoo-Group-Post: member; u=416990097; y=c_8-gLnhzsfhQmJcmCi7O8FBQct_nEArzJ3VRXl5xYA6VXKn6Dk\r\nX-Yahoo-Profile: billvenners\r\nContent-Type: text/plain\r\nContent-Transfer-Encoding: quoted-printable\r\n\r\nHi Kevin,\n\nI&#39;m about to board a plane, but I took a look at the code on the=\r\n way to the\nairport. I wonder if you could serialize the events on a separa=\r\nte thread\nthat is the only thread that writes to the RunListeners. Multiple=\r\n threads\ncould deposit events in a concurrent collection. The lone dedicate=\r\nd thread\ncould take events out and one one thread write them to listeners. =\r\nI do\nsomething like that in ScalaTest in this class:\n\nhttp://code.google.co=\r\nm/p/scalatest/source/browse/trunk/src/main/scala/org/scalatest/DispatchRepo=\r\nrter.scala\n\nIn the case of RunNotifier, it is a bit more complicated becaus=\r\ne the\nlisteners to report to can change over time whereas in my case this i=\r\ns\nimmutable. But still I think you could use a similar technique. I&#39;m not\nf=\r\namiliar with what ParallelComputer is, so maybe this wouldn&#39;t work. But I\nt=\r\nhought I&#39;d suggest it.\n\nBill\n\nOn Wed, Feb 6, 2013 at 3:38 PM, Kevin Cooney =\r\n&lt;kcooney@...&gt; wrote:\n\n&gt; **\n&gt;\n&gt;\n&gt; Currently the RunListener code stor=\r\nes the listeners in a synchronized list,\n&gt; and has a large synchronized blo=\r\nck where it calls all of the listeners:\n&gt;\n&gt;\n&gt; https://github.com/junit-team=\r\n/junit/blob/master/src/main/java/org/junit/runner/notification/RunNotifier.=\r\njava#L54\n&gt;\n&gt; -- Kevin\n&gt;\n&gt;\n&gt; On Wed, Feb 6, 2013 at 1:30 PM, Bill Venners bi=\r\nll@...&gt; wrote:\n&gt;\n&gt; &gt; Hi Kevin,\n&gt; &gt;\n&gt; &gt; Can you clarify what the perf=\r\normance issue was? Is the problem that you\n&gt; &gt; have events coming possibly =\r\nin parallel via different threads, and you\n&gt; want\n&gt; &gt; to send them all to a=\r\n user-specified RunListener? Because you don&#39;t know\n&gt; &gt; whether a RunListen=\r\ner is thread safe, currently you are serializing those\n&gt; &gt; events somehow t=\r\nhat&#39;s slow?\n&gt; &gt;\n&gt; &gt; Bill\n&gt; &gt;\n&gt; &gt; On Wed, Feb 6, 2013 at 9:06 AM, Kevin Coon=\r\ney kcooney@...&gt; wrote:\n&gt; &gt;\n&gt; &gt; &gt; **\n&gt;\n&gt; &gt; &gt;\n&gt; &gt; &gt;\n&gt; &gt; &gt; Hello, every=\r\none\n&gt; &gt; &gt;\n&gt; &gt; &gt; Short version: we are thinking of adding an optional depend=\r\nency from\n&gt; &gt; JUnit\n&gt; &gt; &gt; to jcip-annotations and are soliciting feedback.\n=\r\n&gt; &gt; &gt;\n&gt; &gt; &gt; A few people have noticed that when you use ParallelComputer, y=\r\nou got\n&gt; &gt; poor\n&gt; &gt; &gt; performance because calls to registered RunListeners =\r\nare synchronized.\n&gt; We\n&gt; &gt; &gt; would like to fix this in the next release of =\r\nJUnit.\n&gt; &gt; &gt;\n&gt; &gt; &gt; In order to prevent affecting existing users, we are pro=\r\nposing having\n&gt; an\n&gt; &gt; &gt; annotation that can be added to RunListener implem=\r\nentations that can\n&gt; &gt; safely\n&gt; &gt; &gt; be called concurrently from multiple th=\r\nreads. If a RunListener passed\n&gt; to\n&gt; &gt; a\n&gt; &gt; &gt; RunNotifier is not annotate=\r\nd with this annotation, JUnit will wrap it\n&gt; &gt; with\n&gt; &gt; &gt; a decorator that =\r\ndoes synchronization.\n&gt; &gt; &gt;\n&gt; &gt; &gt; We would appreciate feedback on this new =\r\nannotation.\n&gt; &gt; &gt;\n&gt; &gt; &gt; We have two options:\n&gt; &gt; &gt;\n&gt; &gt; &gt; a. Create our own =\r\nannotation for this\n&gt; &gt; &gt; b. Use ThreadSafe (\n&gt; &gt; &gt;\n&gt; &gt; &gt;\n&gt; &gt;\n&gt; http://grep=\r\ncode.com/file/repo1.maven.org/maven2/net.jcip/jcip-annotations/1.0/net/jcip=\r\n/annotations/ThreadSafe.java\n&gt; &gt; &gt; )\n&gt; &gt; &gt;\n&gt; &gt; &gt; The advantages to option b=\r\n are:\n&gt; &gt; &gt;\n&gt; &gt; &gt; 1. It&#39;s a well-known annotation\n&gt; &gt; &gt; 2. Users that use J=\r\nUnit can add this annotation to their thread-safe\n&gt; &gt; &gt; RunListener impleme=\r\nntations today and get the benefits &quot;for free&quot;\n&gt; later.\n&gt; &gt; &gt;\n&gt; &gt; &gt; Note we=\r\n can do this without requiring that all users of JUnit have the\n&gt; &gt; &gt; jcip-=\r\nannotations jar in their classpath as of JDK 1.5.0_06 (see\n&gt; &gt; &gt;\n&gt; &gt; &gt;\n&gt; &gt;\n=\r\n&gt; http://stackoverflow.com/questions/3567413/why-doesnt-a-missing-annotatio=\r\nn-cause-a-classnotfoundexception-at-runtime\n&gt; &gt; &gt; ).\n&gt; &gt; &gt; If jcip-annotati=\r\nons is not on the classpath then all RunListener\n&gt; &gt; &gt; implementations will=\r\n be treated as not thread-safe.\n&gt; &gt; &gt;\n&gt; &gt; &gt; As a specific example, the Mave=\r\nn Surefire plugin would use this\n&gt; &gt; dependency\n&gt; &gt; &gt; and include jcip-anno=\r\ntations.\n&gt; &gt; &gt;\n&gt; &gt; &gt; Currently, JUnit only depends on one third-party libra=\r\nry (Hamcrest).\n&gt; This\n&gt; &gt; &gt; has caused us some pain in the past when the Ha=\r\nmcrest code changed in\n&gt; &gt; ways\n&gt; &gt; &gt; that broke existing users of JUnit. W=\r\ne believe this will not be an\n&gt; issue\n&gt; &gt; &gt; with jcip-annotations because t=\r\nhe JAR only contains annotations, not\n&gt; any\n&gt; &gt; &gt; code.\n&gt; &gt; &gt;\n&gt; &gt; &gt; One pos=\r\nsible concern would be with other open source libraries that\n&gt; &gt; provide\n&gt; =\r\n&gt; &gt; RunListener implementations (they would need to add jcip-annotations to=\r\n\n&gt; &gt; &gt; their compile-time classpath if they have thread-safe annotations, a=\r\nnd\n&gt; &gt; &gt; document this to their users).\n&gt; &gt; &gt;\n&gt; &gt; &gt; Thoughts?\n&gt; &gt; &gt;\n&gt; &gt; &gt; -=\r\n- Kevin\n&gt; &gt; &gt;\n&gt; &gt; &gt; [Non-text portions of this message have been removed]\n&gt;=\r\n &gt; &gt;\n&gt; &gt; &gt;\n&gt; &gt; &gt;\n&gt; &gt;\n&gt; &gt;\n&gt; &gt;\n&gt; &gt; --\n&gt; &gt; Bill Venners\n&gt; &gt; Artima, Inc.\n&gt; &gt; h=\r\nttp://www.artima.com\n&gt; &gt;\n&gt; &gt;\n&gt; &gt; [Non-text portions of this message have be=\r\nen removed]\n&gt; &gt;\n&gt; &gt;\n&gt; &gt;\n&gt; &gt; ------------------------------------\n&gt; &gt;\n&gt; &gt; Ya=\r\nhoo! Groups Links\n&gt;\n&gt; &gt;\n&gt; &gt;\n&gt; &gt;\n&gt; &gt;\n&gt;\n&gt; [Non-text portions of this message =\r\nhave been removed]\n&gt;\n&gt;  \n&gt;\n\n\n\n-- \nBill Venners\nArtima, Inc.\nhttp://www.arti=\r\nma.com\n\n\n[Non-text portions of this message have been removed]\n\n\n", 
    "profile": "billvenners", 
    "topicId": 24274, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 416990097, 
    "prevInTime": 24287, 
    "contentTrasformed": false, 
    "postDate": "1360269345", 
    "canDelete": false, 
    "nextInTopic": 24289, 
    "prevInTopic": 24287, 
    "headers": {
        "inReplyToHeader": "PENBQTNFK2VXX1hxbTYxZ1BoekVOOFBTcDc5YUFqYkF4MVpDM3ByWmV4YzZ2ekdrOHVrQUBtYWlsLmdtYWlsLmNvbT4=", 
        "messageIdInHeader": "PENBT19SeWtwN01IUHpfPV85NDA1Ynkzb1dPRVJKcVIrZFBZV0xPPVk3cmhZd3A3M2Njd0BtYWlsLmdtYWlsLmNvbT4=", 
        "referencesHeader": "PENBQTNFK2VYcUY2RE5RYzByNUhla2oxZ0UtUHlCbnZqNF9UTmJWZ1JVbytFZWt4d2hqd0BtYWlsLmdtYWlsLmNvbT4JPENBT19SeWtvSjF2UXNrTkNrUnlaYkRpcVNpVU5fX0U4WWFZeldzc1RFaDdWR3gxdXVwd0BtYWlsLmdtYWlsLmNvbT4JPENBQTNFK2VXX1hxbTYxZ1BoekVOOFBTcDc5YUFqYkF4MVpDM3ByWmV4YzZ2ekdrOHVrQUBtYWlsLmdtYWlsLmNvbT4="
    }
}
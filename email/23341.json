{
    "numMessagesInTopic": 4, 
    "nextInTime": 23342, 
    "senderId": "klFr5gkF909hshxPWaAdFelCCF4E0G5anCedgZprd31Fv7LRrf13mR0IS9-PNX1t2U7shhJek4z9OsOedGIsMRGtJOhHm67uzqH4f4FxFGJfhg", 
    "systemMessage": false, 
    "subject": "Re: [junit] Unit Testing with Spring", 
    "from": "Joakim Ohlrogge &lt;joakim.ohlrogge@...&gt;", 
    "authorName": "Joakim Ohlrogge", 
    "msgSnippet": "Yes it s ironic that testing spring stuff is so painful given that testability is one of the selling points (but it seems that applies to the parts, not the", 
    "msgId": 23341, 
    "profile": "j0hlrogge", 
    "topicId": 23340, 
    "spamInfo": {
        "reason": "4", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 261856052, 
    "messageBody": "<div id=\"ygrps-yiv-809903200\">Yes it&#39;s ironic that testing spring stuff is so painful given that<br/>\ntestability is one of the selling points (but it seems that applies to the<br/>\nparts, not the wireing of the parts). The biggest issues I have had are:<br/>\n<br/>\n1) Contexts are slow to load<br/>\n2) Programatically replacing stuff in an already loaded conext is not<br/>\nstraight forward<br/>\n3) Having different xml-setups for testing and production soon becomes a<br/>\nnightmare.<br/>\n<br/>\nWhen it comes to 1 I have come to break the rule of test isolation. I<br/>\nbasically load the context beforeClass or even as a *gasp* singleton to only<br/>\nbe hit once by the load time. This makes it crucial to be careful about<br/>\nmutable state and side effects in the tests for obvious reasons. It is a bit<br/>\nlike juggling with knives but reloading the context for each test is simply<br/>\nnot practical.<br/>\n<br/>\nThe funny part is that spring sort of encourages mutability by prefering<br/>\nsetters over constructors.<br/>\n<br/>\nTo some extent you can have a &quot;global&quot; parent context and programatically<br/>\ncreate child contexts on top of that but I have forgotten how but it&#39;s a<br/>\nproblem that is solvable within a day or so.<br/>\n<br/>\nIf you keep the parts immutable and involve an in memory DB running tests in<br/>\ntransactions really help.<br/>\n<br/>\nWhen it comes to 2 it is difficult, not impossible but if you go with the<br/>\nglobal context approach it quickly becomes nasty. Again for obvious<br/>\nreasons...<br/>\n<br/>\nWhen it comes to 3 it sort of forces you to solve 2 and deal with the<br/>\nconsequences in combination with 1.<br/>\n<br/>\nThis is one of the reasons why people have started considering dependency<br/>\ninjection to be evil. Guice however is a completely different story. Modules<br/>\nare lightning fast to load and while guice solves the same problem as spring<br/>\nit does it in a completely different way. Guice is more about defining the<br/>\nrules of wiring rather than the actual wiring and it makes a world of<br/>\ndifference.<br/>\n<br/>\nI understand you&#39;re stuck with spring now and that guice is not really an<br/>\noption for you. I just mention that so that you see that the experience with<br/>\ndependency injection frameworks doesn&#39;t have to be very similar at all to<br/>\nthe spring experience we you will later advice people to avoid DIP<br/>\nframeworks entirely when you really mean avoid Spring :)<br/>\n<br/>\nIn contrast to spring guice is actually very helpful when unittesting and it<br/>\nbecomes much easier to add and remove dependencies. In spring the philosophy<br/>\nis more to be explicit about stuff and that XML stuff... well, I rest my<br/>\ncase.<br/>\n<br/>\nLong story short: loading times of contexts is the biggest issue IMO. My<br/>\nworkaround for them is to break test isolation and load once, not many. To<br/>\ndeal with that I try to eliminate or at least isolate side effects as much<br/>\nas possible. I can imagine that in an existing system that is not really the<br/>\nstate of things...<br/>\n<br/>\nSpring has a lot of good stuff in it too like JDBCTemplates etc, I still use<br/>\nthose but I wire manually, or if motivated with guice.<br/>\n<br/>\nI don&#39;t think, but hope, this helps some :)<br/>\n<br/>\n-----------------------------------------------------<br/>\nJoakim Ohlrogge<br/>\nAgical AB<br/>\nV�sterl�nggatan 79, 2 tr<br/>\n111 29 Stockholm, SWEDEN<br/>\n<br/>\nMobile: +46-708-754004<br/>\nBlog: johlrogge.wordpress.com<br/>\nE-mail: <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:joakim.ohlrogge@...\">joakim.ohlrogge@...</a><br/>\n<br/>\n<br/>\n<blockquote><span title=\"qreply\"> On Fri, Mar 18, 2011 at 4:25 PM, Mark Levison &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:mark@...\">mark@...</a>&gt; wrote:<br/>\n<br/>\n&gt;<br/>\n&gt;<br/>\n&gt; I&#39;m working with a client who&#39;re using Spring extensively. When I look at<br/>\n&gt; their Unit Test code I realize that I&#39;m looking at a heap<br/>\n&gt; of integration tests and not real Unit Tests. In part it seems to come from<br/>\n&gt; the autowiring of Spring. In addition I&#39;ve been told that creating new<br/>\n&gt; contexts on the fly in Spring can (in their case) really slow the running<br/>\n&gt; of<br/>\n&gt; the unit tests.<br/>\n&gt;<br/>\n&gt; I realize that we can bypass Spring completely but the point was made that<br/>\n&gt; in that case we&#39;re testing without the Spring Security Context and other<br/>\n&gt; rules, which means we&#39;re not really testing how the code behaves in real<br/>\n&gt; life.<br/>\n&gt;<br/>\n&gt; I&#39;m wondering if any one has good writing on Unit Testing with Spring so I<br/>\n&gt; can get my head wrapped around what it looks when its done well?<br/>\n&gt;<br/>\n&gt; Cheers<br/>\n&gt; Mark Levison<br/>\n&gt;<br/>\n&gt; [image: Mark] &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"http://www.flickr.com/photos/36331075@N00/3833840021/\">http://www.flickr.com/photos/36331075@N00/3833840021/</a>&gt;*Mark<br/>\n&gt; Levison* | Agile Pain Relief Consulting &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"http://agilepainrelief.com/\">http://agilepainrelief.com/</a>&gt; |<br/>\n&gt; Certified Scrum Trainer<br/>\n&gt; Agile Editor @ InfoQ &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"http://www.infoq.com/about.jsp\">http://www.infoq.com/about.jsp</a>&gt; |<br/>\n&gt; Blog&lt;<a rel=\"nofollow\" target=\"_blank\" href=\"http://www.notesfromatooluser.com/\">http://www.notesfromatooluser.com/</a>&gt;|<br/>\n&gt; Twitter &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"http://twitter.com/mlevison\">http://twitter.com/mlevison</a>&gt; | Office: (613) 862-2538<br/>\n&gt; Recent Entries: Story Slicing How Small is Small<br/>\n&gt; Enough&lt;<br/>\n&gt; <a rel=\"nofollow\" target=\"_blank\" href=\"http://agilepainrelief.com/notesfromatooluser/2010/09/story-slicing-how-small-is-enough.html\">http://agilepainrelief.com/notesfromatooluser/2010/09/story-slicing-how-small-is-enough.html</a><br/>\n&gt; &gt;,<br/>\n&gt; Why use an Agile<br/>\n&gt; Coach&lt;<br/>\n&gt; <a rel=\"nofollow\" target=\"_blank\" href=\"http://www.notesfromatooluser.com/2009/11/why-use-an-agile-coach.html\">http://www.notesfromatooluser.com/2009/11/why-use-an-agile-coach.html</a>&gt;<br/>\n&gt;<br/>\n&gt; [Non-text portions of this message have been removed]<br/>\n&gt;<br/>\n&gt;  <br/>\n&gt;<br/>\n<br/>\n<br/>\n[Non-text portions of this message have been removed] </span></blockquote></div>", 
    "prevInTime": 23340, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1300464687", 
    "canDelete": false, 
    "nextInTopic": 23342, 
    "prevInTopic": 23340, 
    "headers": {
        "inReplyToHeader": "PEFBTkxrVGlrY0o3bzVkTzBOYUwydjhzUUctLWF4T1U4TlBEVjgrMnVZb0V4VUBtYWlsLmdtYWlsLmNvbT4=", 
        "messageIdInHeader": "PEFBTkxrVGltcW9GckxnM2lRYm8wUTBhaG16MlB2Vlc1cGtCY0VxUFBjMTc1akBtYWlsLmdtYWlsLmNvbT4=", 
        "referencesHeader": "PEFBTkxrVGlrY0o3bzVkTzBOYUwydjhzUUctLWF4T1U4TlBEVjgrMnVZb0V4VUBtYWlsLmdtYWlsLmNvbT4="
    }
}
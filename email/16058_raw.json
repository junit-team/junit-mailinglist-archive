{
    "numMessagesInTopic": 5, 
    "nextInTime": 16059, 
    "senderId": "WVn_9BD7Gx3QpN4s_yPJ24fRe8L7jZERHDLubCdDj3WRwgzIMwdf0OcXTlXPJ_mD2VztiK3PveRaexhWWGyJLemMcmQ9oVYMP75qug", 
    "systemMessage": false, 
    "subject": "[PATCH] filter stack traces in junit", 
    "from": "&quot;Ben Maurer&quot; &lt;bmaurer@...&gt;", 
    "authorName": "Ben Maurer", 
    "msgSnippet": "Hey guys, As I mentioned in my previous email, one of the issues with junit is that I have to manually filter out harness stack frames from exceptions. The", 
    "msgId": 16058, 
    "rawEmail": "Return-Path: &lt;bmaurer@...&gt;\r\nX-Sender: bmaurer@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (qmail 75123 invoked from network); 10 Feb 2006 04:52:04 -0000\r\nReceived: from unknown (66.218.67.34)\n  by m25.grp.scd.yahoo.com with QMQP; 10 Feb 2006 04:52:04 -0000\r\nReceived: from unknown (HELO n29a.bullet.scd.yahoo.com) (209.73.160.86)\n  by mta8.grp.scd.yahoo.com with SMTP; 10 Feb 2006 04:52:04 -0000\r\nComment: DomainKeys? See http://antispam.yahoo.com/domainkeys\r\nReceived: from [66.218.66.59] by n29.bullet.scd.yahoo.com with NNFMP; 09 Feb 2006 22:54:53 -0000\r\nReceived: from [66.218.66.92] by t8.bullet.scd.yahoo.com with NNFMP; 10 Feb 2006 04:52:00 -0000\r\nDate: Fri, 10 Feb 2006 04:52:00 -0000\r\nTo: junit@yahoogroups.com\r\nMessage-ID: &lt;dsh65g+oa5u@...&gt;\r\nUser-Agent: eGroups-EW/0.82\r\nMIME-Version: 1.0\r\nContent-Type: text/plain; charset=&quot;ISO-8859-1&quot;\r\nContent-Transfer-Encoding: quoted-printable\r\nX-Mailer: Yahoo Groups Message Poster\r\nX-Yahoo-Newman-Property: groups-compose\r\nX-eGroups-Msg-Info: 1:12:0:0\r\nFrom: &quot;Ben Maurer&quot; &lt;bmaurer@...&gt;\r\nSubject: [PATCH] filter stack traces in junit\r\nX-Yahoo-Group-Post: member; u=256083789; y=3rNyAqf7vTMW-uqf4vtPgfTkkpRIRBhXJWr5a9sPS8_Pd3_ZPCOGETlJQt6kjg\r\nX-Yahoo-Profile: benjamindavidmaurer\r\n\r\nHey guys,\n\nAs I mentioned in my previous email, one of the issues with juni=\r\nt is\nthat I have to manually filter out harness stack frames from\nexception=\r\ns. The current approach to this is generally to just filter\nout lines with =\r\nsome specific prefixes. However, this is not ideal. For\nexample, ant filter=\r\ns out some sun.reflect stack frames. But these can\noccur *inside* a test ca=\r\nse&#39;s stack trace.\n\nThe following patch solves the issue by using the\nInvoca=\r\ntionTargetException generated by Method.invoke to figure out\nwhich stack fr=\r\names come from JUnit. It then removes these frames from\nthe trace. This pro=\r\ncess is transparent to consumers of the junit\nframework.\n\nIssues:\n\n1) I&#39;m n=\r\not sure if the place I located the filter is the most ideal\nplace in the fr=\r\namework. Other ideas would be greatly appreciated\n\n2) I need test cases (I =\r\nhaven&#39;t yet gotten to bite the bullet and\nwrite tests before I develop ;-).=\r\n\n\nSince this list doesn&#39;t allow attachments, I&#39;ve copied and pasted this\nin=\r\n the main text. Since this will probably be hard to apply, I&#39;ve also\nposted=\r\n on my dorm computer:\n\nhttp://omega.res.cmu.edu/~benm/junit-stacktrace.patc=\r\nh\n\n-- Ben\n\n\n\n\n\n\n\n\nIndex: org/junit/internal/runners/TestMethodRunner.java\n=\r\n=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=\r\n=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=\r\n=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D\nRCS file:\n/cvsroot/juni=\r\nt/junit/org/junit/internal/runners/Attic/TestMethodRunner.java,v\nretrieving=\r\n revision 1.1.2.6\ndiff -u -r1.1.2.6 TestMethodRunner.java\n--- org/junit/int=\r\nernal/runners/TestMethodRunner.java\t6 Feb 2006\n04:09:17 -0000\t1.1.2.6\n+++ o=\r\nrg/junit/internal/runners/TestMethodRunner.java\t10 Feb 2006\n04:44:42 -0000\n=\r\n@@ -81,7 +81,10 @@\n \t\t\tif (expectsException())\n \t\t\t\taddFailure(new Assertio=\r\nnError(&quot;Expected exception: &quot; +\nexpectedException().getName()));\n \t\t} catch=\r\n (InvocationTargetException e) {\n-\t\t\tThrowable actual=3D e.getTargetExcepti=\r\non();\n+\t\t\tThrowable actual=3D e.getTargetException ();\n+\t\t\t// It&#39;s importan=\r\nt that we filter here. This way, we\n+\t\t\t// cut the sun.reflect.* out of the=\r\n stack trace.\n+\t\t\tStackTraceFilter.filter (actual, e);\n \t\t\tif (!expectsExce=\r\nption())\n \t\t\t\taddFailure(actual);\n \t\t\telse if (isUnexpected(actual)) {\nInde=\r\nx: org/junit/internal/runners/StackTraceFilter.java\n=3D=3D=3D=3D=3D=3D=3D=\r\n=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=\r\n=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=\r\n=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D\nRCS file: org/junit/internal/runners/StackTr=\r\naceFilter.java\ndiff -N org/junit/internal/runners/StackTraceFilter.java\n---=\r\n /dev/null\t1 Jan 1970 00:00:00 -0000\n+++ org/junit/internal/runners/StackTr=\r\naceFilter.java\t1 Jan 1970\n00:00:00 -0000\n@@ -0,0 +1,64 @@\n+package org.juni=\r\nt.internal.runners;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n=\r\n+\n+/**\n+ * Methods for filtering out irrelevant stack frames from\n+ * a Thr=\r\nowable.\n+ * \n+ * @author Ben Maurer &lt;bmaurer@...&gt;\n+ */\n+public c=\r\nlass StackTraceFilter {\n+\n+\t/**\n+\t * Removes items from a stack trace that =\r\nit shares with another trace.\n+\t * @param trace The trace to filter out\n+\t =\r\n* @param base The base trace\n+\t * @return trace with items at the end that =\r\nit shares with base removed\n+\t */\n+\tstatic StackTraceElement [] doFilter (S=\r\ntackTraceElement [] trace,\nStackTraceElement [] base)\n+\t{\n+\t\tList&lt;StackTrac=\r\neElement&gt; filtered =3D new ArrayList&lt;StackTraceElement&gt; ();\n+\t\tfor (StackTr=\r\naceElement ele : trace)\n+\t\t\tfiltered.add (ele);\n+\n+\t\tfor (int i =3D base.le=\r\nngth - 1; i &gt;=3D 0 && filtered.size () &gt; 0; i--) {\n+\t\t\tif (!filtered.get (f=\r\niltered.size () - 1).equals (base [i]))\n+\t\t\t\tbreak;\n+\n+\t\t\tfiltered.remove (=\r\nfiltered.size () - 1);\n+\t\t}\n+\n+\t\treturn filtered.toArray (new StackTraceEle=\r\nment [] {});\n+\n+\t}\n+\n+\t/**\n+\t * Filters the stack trace components that toF=\r\nilter shares\n+\t * with the threads current stack trace.\n+\t */\n+\tpublic stat=\r\nic void filter (Throwable toFilter)\n+\t{\n+\t\tfilter (toFilter, Thread.current=\r\nThread ().getStackTrace ());\n+\t}\n+\n+\t/**\n+\t * Filters the stack trace compo=\r\nnents that toFilter shares\n+\t * with baseException.\n+\t */\n+\tpublic static v=\r\noid filter (Throwable toFilter, Throwable baseException)\n+\t{\n+\t\tfilter (toF=\r\nilter, baseException.getStackTrace ());\n+\t}\n+\n+\t/**\n+\t * Filters the stack =\r\ntrace components that toFilter shares\n+\t * with base.\n+\t */\n+\tpublic static=\r\n void filter (Throwable toFilter, StackTraceElement []\nbase)\n+\t{\n+\t\tfor (Th=\r\nrowable t =3D toFilter; t !=3D null; t =3D t.getCause ())\n+\t\t\tt.setStackTra=\r\nce (doFilter (t.getStackTrace (), base));\n+\t}\n+}\n\n\n\n\n\n", 
    "profile": "benjamindavidmaurer", 
    "topicId": 16058, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 256083789, 
    "prevInTime": 16057, 
    "contentTrasformed": false, 
    "postDate": "1139547120", 
    "canDelete": false, 
    "nextInTopic": 16066, 
    "prevInTopic": 0, 
    "headers": {
        "messageIdInHeader": "PGRzaDY1ZytvYTV1QGVHcm91cHMuY29tPg=="
    }
}
{
    "numMessagesInTopic": 43, 
    "nextInTime": 19661, 
    "senderId": "8HnzEAsHX0514n-gqwt6xPbRzyNZsma99hHPg4elb5PbK_WW2MWxAbOsyofF47hr2-TRDpMj6h6_hILcWBhUHUPIVTz6GwjPiQo9Uy5464fQuw", 
    "systemMessage": false, 
    "subject": "Re: [junit] Testing singleton patterns", 
    "from": "Michael Feathers &lt;mfeathers@...&gt;", 
    "authorName": "Michael Feathers", 
    "msgSnippet": "... Testing singletons can be hard, but the harder problem is testing code that uses singletons. The problem with singletons is that they are classes which", 
    "msgId": 19660, 
    "rawEmail": "Return-Path: &lt;mfeathers@...&gt;\r\nX-Sender: mfeathers@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (qmail 60682 invoked from network); 30 Jul 2007 19:22:45 -0000\r\nReceived: from unknown (66.218.67.36)\n  by m43.grp.scd.yahoo.com with QMQP; 30 Jul 2007 19:22:45 -0000\r\nReceived: from unknown (HELO elasmtp-banded.atl.sa.earthlink.net) (209.86.89.70)\n  by mta10.grp.scd.yahoo.com with SMTP; 30 Jul 2007 19:22:45 -0000\r\nReceived: from [66.32.127.248] (helo=[192.168.2.9])\n\tby elasmtp-banded.atl.sa.earthlink.net with asmtp (Exim 4.34)\n\tid 1IFaoc-0001JN-JC\n\tfor junit@yahoogroups.com; Mon, 30 Jul 2007 15:22:02 -0400\r\nMessage-ID: &lt;46AE3A57.1090900@...&gt;\r\nDate: Mon, 30 Jul 2007 15:21:59 -0400\r\nUser-Agent: Mozilla Thunderbird 1.0 (Windows/20041206)\r\nX-Accept-Language: en-us, en\r\nMIME-Version: 1.0\r\nTo: junit@yahoogroups.com\r\nReferences: &lt;46AB416C.2040400@...&gt;\t &lt;46ADEF51.8060407@...&gt; &lt;b86b6a9c0707300903j7a345ebeh1bf977610185bd79@...&gt;\r\nIn-Reply-To: &lt;b86b6a9c0707300903j7a345ebeh1bf977610185bd79@...&gt;\r\nContent-Type: text/plain; charset=UTF-8; format=flowed\r\nContent-Transfer-Encoding: 8bit\r\nX-ELNK-Trace: dfc3550eb2f12a8d819ed13a7e3bf8f140683398e744b8a49858ea19756640d028ab765e1cd8b580350badd9bab72f9c350badd9bab72f9c350badd9bab72f9c\r\nX-eGroups-Msg-Info: 2:3:4:0\r\nFrom: Michael Feathers &lt;mfeathers@...&gt;\r\nReply-To: mfeathers@...\r\nSubject: Re: [junit] Testing singleton patterns\r\nX-Yahoo-Group-Post: member; u=78021826; y=mv07gjW3cplHSbml48Ze8FG8STP4sPE6JAOkj4jSnLleFhoxwTQw\r\nX-Yahoo-Profile: mfeathers256\r\n\r\n\nCédric Beust ♔ wrote:\n\n&gt;On 7/30/07, jason r tibbetts &lt;tibbettj@...&gt; wrote:\n&gt;\n&gt;I don&#39;t see how this helps...  How would you test the following code:\n&gt;\n&gt;public void hardToTest() {\n&gt;  TheOneTrueFoo.getInstance().blah();\n&gt;}\n&gt;\n&gt;  \n&gt;\nTesting singletons can be hard, but the harder problem is testing code \nthat uses singletons.\n\nThe problem with singletons is that they are classes which arrogate to \nthemselves the ability to determine a system-wide constraint: there will \nbe only one instance per system. That can be fine in production, but in \ntesting, each test is an independent system.\n\nHowever, sometimes it&#39;s not a problem. If you have a singleton with \nimmutable state, chances are, it will be easily testable and it will do \nokay in tests of classes that use it. If, on the other hand, it has \nmutable state and that state can affect the results of other tests, or \nif your singleton has unpleasant side effects on the outside world, the \nsingle instance constraint probably interferes with testing.\n\nThere are a bunch of ways to handle this. In some cases, it can be as \neasy as adding a resetForTesting method to your singleton:\n\npublic static void resetForTesting() {\ninstance = null;\n}\n\nYou can call this method in your setUp and in your tearDown to \nre-initialize the singleton.\n\nIn other cases, you can make testing easier for classes that use \nsingletons by using &#39;Extract and Override Getter&#39; on the class you want \nto test:\n\nAs an example, if you have a class like this:\n\npublic class A {\npublic doSomething() {\n...\nThingDoer.getInstance().doThing();\n}\n}\n\nYou can refactor to this:\n\npublic class A {\npublic doSomething() {\n...\ngetThingDoer().doThing();\n}\n\nprotected ThingDoer getThingDoer() {\nreturn ThingDoer.getInstance();\n}\n}\n\nIf you want to testing class A now, you subclass it and override \ngetThingDoer() to return a test double. When you do this, you have at \nleast three choices when making your test double, you can:\n1) Extract an interface for ThingDoer and have getInstance return an \nobject of the interface type, or\n2) Use &#39;Extract Implementer&#39; by calling the interface ThingDoer and \npushing all of its implementation down to a subclass. The advantage here \nis that every use of the name &#39;ThingDoer&#39; in your application now refers \nto an interface, or\n3) Make the constructor of ThingDoer protected, and subclass ThingDoer, \noverriding only the methods you need to make ThingDoer cooperate well in \nyour test.\n\nIn each of these cases, you&#39;ll have to raise the visibility of the \nconstructor.\n\nThese are pragmatic choices. What you do depends upon the style you want \nto have in your application along with the particular circumstance.\n\nIf you don&#39;t want to go the &#39;Extract and Override Getter&#39; route, you can \nuse &#39;Introduce Static Setter.&#39; This is simply adding a setter to the \nsingleton which you can use to replace the instance while under test. \nThe nice thing about it, is that it allows you to fake the singleton in \nall of your tests. You just have to remember to call the static setter \nin all of your setUp and tearDown methods. And, you do have to choice \namong the three options I mentioned above for creating test doubles.\n\nIf you&#39;re working in fresh code, you have more options. However, those \nare some of the common approaches people take when attempting to get \ntests in place in code where someone has used singleton.\n\nMichael Feathers\nhttp://www.objectmentor.com\nhttp://beautifulcode.oreillynet.com/\n\n\n", 
    "profile": "mfeathers256", 
    "topicId": 19636, 
    "spamInfo": {
        "reason": "3", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 78021826, 
    "prevInTime": 19659, 
    "contentTrasformed": false, 
    "postDate": "1185823319", 
    "canDelete": false, 
    "nextInTopic": 19661, 
    "prevInTopic": 19658, 
    "headers": {
        "inReplyToHeader": "PGI4NmI2YTljMDcwNzMwMDkwM2o3YTM0NWViZWgxYmY5Nzc2MTAxODViZDc5QG1haWwuZ21haWwuY29tPg==", 
        "messageIdInHeader": "PDQ2QUUzQTU3LjEwOTA5MDBAbWluZHNwcmluZy5jb20+", 
        "referencesHeader": "PDQ2QUI0MTZDLjIwNDA0MDBAcGZhcnJlbGwuY29tPgkgPDQ2QURFRjUxLjgwNjA0MDdAdmVyZGkuaWlzZC5zcmEuY29tPiA8Yjg2YjZhOWMwNzA3MzAwOTAzajdhMzQ1ZWJlaDFiZjk3NzYxMDE4NWJkNzlAbWFpbC5nbWFpbC5jb20+"
    }
}
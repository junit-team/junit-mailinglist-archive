{
    "numMessagesInTopic": 6, 
    "nextInTime": 24400, 
    "senderId": "HJF-0XAMZ-qxfiOzlCyCrnNFgTY5uetkmR2YcQtRYuoGNNsa4it8YPUMnCTVMZWfFt_RWjy3cGjujHeOeMFNrBAMpQ", 
    "systemMessage": false, 
    "subject": "Re: [junit] Re: Timed Tests and Thread Safety", 
    "from": "David Saff &lt;saff@...&gt;", 
    "authorName": "David Saff", 
    "msgSnippet": "Thanks, Steve. I m tracking your suggestion at https://github.com/junit-team/junit/issues/686 ... [Non-text portions of this message have been removed]", 
    "msgId": 24399, 
    "profile": "saffatgoogle", 
    "topicId": 24388, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 525765722, 
    "messageBody": "<div id=\"ygrps-yiv-354343190\">Thanks, Steve.<br/>\n<br/>\nI&#39;m tracking your suggestion at<br/>\n<a rel=\"nofollow\" target=\"_blank\" href=\"https://github.com/junit-team/junit/issues/686\">https://github.com/junit-team/junit/issues/686</a><br/>\n<br/>\n<br/>\n<blockquote><span title=\"qreply\"> On Fri, May 24, 2013 at 9:29 PM, s_soloff &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:s_soloff@...\">s_soloff@...</a>&gt; wrote:<br/>\n<br/>\n&gt; **<br/>\n&gt;<br/>\n&gt;<br/>\n&gt; --- In <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>, Kevin Cooney &lt;kcooney@...&gt; wrote:<br/>\n&gt; &gt; Note the Timeout rule will call @Before and @After methods in the<br/>\n&gt; &gt; same thread as the test. The test class is created before rules are<br/>\n&gt; &gt; applied, so if your test class initializes fields at declaration<br/>\n&gt; &gt; time, that execution would happen in a different thread than the<br/>\n&gt; &gt; test.<br/>\n&gt; &gt;<br/>\n&gt; &gt; I also believe that @After methods would not be called for tests<br/>\n&gt; &gt; methods that timeout in classes that use the Timeout rule.<br/>\n&gt;<br/>\n&gt; @Kevin: I feel like a fool. I actually &quot;discovered&quot; rules during this<br/>\n&gt; exercise and spent some time changing legacy @Test(timeout = ...) tests to<br/>\n&gt; use a fixture-level Timeout @Rule. However, I just assumed that the<br/>\n&gt; threading behavior between the two was the same. :( Based on your<br/>\n&gt; information, I ran some more tests to nail down on which thread the various<br/>\n&gt; parts of the fixture are executed using both models. The results are<br/>\n&gt; summarized below (from JUnit 4.8.2).<br/>\n&gt;<br/>\n&gt; @Test with timeout element:<br/>\n&gt; A1. ctor run on main thread<br/>\n&gt; A2. @BeforeClass, @Before, @After, @AfterClass run on main thread<br/>\n&gt; A3. @Test run on worker thread<br/>\n&gt; A4. @After, @AfterClass run on main thread if test times out<br/>\n&gt;<br/>\n&gt; Timeout @Rule:<br/>\n&gt; B1. ctor run on main thread<br/>\n&gt; B2. @BeforeClass, @AfterClass run on main thread<br/>\n&gt; B3. @Before, @Test, @After run on worker thread<br/>\n&gt; B4. @After NOT run if test times out<br/>\n&gt; B5. @AfterClass run on main thread if test times out<br/>\n&gt;<br/>\n&gt; Given these results, using Timeout @Rules satisfies my concerns about<br/>\n&gt; thread safety and gives me even more motivation to use them over<br/>\n&gt; @Test(timeout = ...). Thanks! (Note sure if item [B4] is intentional, but I<br/>\n&gt; can live with it for now.)<br/>\n&gt;<br/>\n&gt;<br/>\n&gt; --- In <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>, David Saff &lt;saff@...&gt; wrote:<br/>\n&gt; &gt; The biggest payoff would probably be to make sure that the<br/>\n&gt; &gt; documentation we have makes it easy to avoid any unexpected<br/>\n&gt; &gt; behavior. Can you suggest an edit to that effect?<br/>\n&gt;<br/>\n&gt; @David: Your suggestion for updating the documentation is probably the<br/>\n&gt; best solution based on the preferred behavior of the Timeout @Rule. Below<br/>\n&gt; is my cut at a second paragraph I&#39;d add to the Javadocs for the @Test<br/>\n&gt; annotation&#39;s timeout element. Please edit as you see fit.<br/>\n&gt;<br/>\n&gt; THREAD SAFETY WARNING. Test methods with a timeout parameter are run in a<br/>\n&gt; thread other than the thread which runs the fixture&#39;s @Before and @After<br/>\n&gt; methods. This may yield different behavior for code that is not thread safe<br/>\n&gt; when compared to the same test method without a timeout parameter. Consider<br/>\n&gt; using the org.junit.rules.Timeout rule instead, which ensures a test method<br/>\n&gt; is run on the same thread as the fixture&#39;s @Before and @After methods.<br/>\n&gt;<br/>\n&gt; Thanks again for all the feedback,<br/>\n&gt; Steve<br/>\n&gt;<br/>\n&gt;  <br/>\n&gt;<br/>\n<br/>\n<br/>\n[Non-text portions of this message have been removed] </span></blockquote></div>", 
    "prevInTime": 24398, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1369858696", 
    "canDelete": false, 
    "nextInTopic": 0, 
    "prevInTopic": 24393, 
    "headers": {
        "inReplyToHeader": "PGtucDQ0dCtrMXR0QGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PENBTHJ3LVB4R3gxYTNHbStMc0J2WDRNMVZuMnh2NktRa1ZDQTh6ZW44Kzg0ZlhaMThOd0BtYWlsLmdtYWlsLmNvbT4=", 
        "referencesHeader": "PENBQTNFK2VWcldwSktWMjFqdVN2dFlUUVRQM28tMTR1c0VhZnNwQlJhWjEtRmdHWjRMUUBtYWlsLmdtYWlsLmNvbT4gPGtucDQ0dCtrMXR0QGVHcm91cHMuY29tPg=="
    }
}
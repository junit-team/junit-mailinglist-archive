{
    "topicId": 1943, 
    "postDate": "995317917", 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "from": "Scott Stirling &lt;sstirling@...&gt;", 
    "canDelete": false, 
    "replyTo": "LIST", 
    "senderId": "McYPAazd9R3ZLTfpb0Yj13xLCB0vhk5Xu3Dq-yCFV-7Bgl4UAj_iRAd5--cLTHnyM3Boy8zwgKwN4DErAe16BG6pEq0C7IEl7X18F46TKBI", 
    "nextInTime": 1949, 
    "userId": 0, 
    "prevInTime": 1947, 
    "prevInTopic": 1946, 
    "headers": {
        "messageIdInHeader": "PEM3QUJBMzE1MjA1Q0Q0MTE4Q0U2MDA1MDhCOTUyRDk2NTVGQjYzQHNhbHNhLmFsbGFpcmUuY29tPg=="
    }, 
    "authorName": "Scott Stirling", 
    "numMessagesInTopic": 9, 
    "msgSnippet": "Interestingly, calls to javax.rmi.PortableRemoteObject are delegated to an implementation of javax.rmi.CORBA.PortableRemoteObjectDelegate, which in Sun s 1.3.1", 
    "contentTrasformed": false, 
    "msgId": 1948, 
    "nextInTopic": 1949, 
    "systemMessage": false, 
    "rawEmail": "Return-Path: &lt;sstirling@...&gt;\r\nX-Sender: sstirling@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (EGP: mail-7_2_0); 16 Jul 2001 21:13:15 -0000\r\nReceived: (qmail 26851 invoked from network); 16 Jul 2001 21:12:06 -0000\r\nReceived: from unknown (10.1.10.26) by l10.egroups.com with QMQP; 16 Jul 2001 21:12:06 -0000\r\nReceived: from unknown (HELO s0001exc0011.allaire.com) (63.109.193.187) by mta1 with SMTP; 16 Jul 2001 21:12:05 -0000\r\nReceived: by S0001EXC0011 with Internet Mail Service (5.5.2650.21) id &lt;MXX4N1VY&gt;; Mon, 16 Jul 2001 17:12:05 -0400\r\nMessage-ID: &lt;C7ABA315205CD4118CE600508B952D9655FB63@...&gt;\r\nTo: &quot;&#39;junit@yahoogroups.com&#39;&quot; &lt;junit@yahoogroups.com&gt;\r\nSubject: RE: [junit] ClassCastException only using swing/awt ui\r\nDate: Mon, 16 Jul 2001 17:11:57 -0400\r\nMIME-Version: 1.0\r\nX-Mailer: Internet Mail Service (5.5.2650.21)\r\nContent-Type: text/plain; charset=&quot;iso-8859-1&quot;\r\nFrom: Scott Stirling &lt;sstirling@...&gt;\r\n\r\nInterestingly, calls to javax.rmi.PortableRemoteObject are delegated to an\nimplementation of javax.rmi.CORBA.PortableRemoteObjectDelegate, which in\nSun&#39;s 1.3.1 JDK is com.sun.corba.se.internal.javax.rmi.PortableRemoteObject.\nThat doesn&#39;t explain anything -- I just thought it was just kinda\ninteresting how buried that reference was.\n\nAnyway, this is another problem inherent to JUnit&#39;s Swingui&#39;s\nTestCaseClassLoader architecture.  Similar to the LinkageErrors with JAXP\nand the org.xml and org.w3c classes, but with a different result here.\nWe&#39;ve seen it here with EJB lookups too, but we mostly use the Ant runner so\nit&#39;s not usually a problem.\n\nSo why a ClassCastException when you narrow() in a TestCase?  \n\nHere&#39;s John Pletka&#39;s test code:\n\nPoint point;\nPointHome pointHome;\n\n//The next line works in textui, but throws \n//ClassCastException in swingui\npointHome =\n(PointHome)PortableRemoteObject.narrow(ctx.lookup(&quot;base/PointHome&quot;),PointHom\ne.class);\n\nRecall that in Java 2 an object&#39;s class (aka &quot;runtime type&quot;) is identified\nin the JVM as &lt;fully-qualified-classname;definingClassLoaderInstance&gt; or\n&lt;C;L&gt;.  That is, the defining loader is part of the runtime name identifying\nthat class (there&#39;s a subtle distinction in Java between &#39;class&#39; and &#39;type&#39;\nI won&#39;t go into).  Also recall that the JVM will ask a class&#39;s defining\nloader to load all unloaded classes referenced by the classes it loads.\n\nMy hypothesis (I just tested it here and proved it) is that the ctx.lookup()\nreturns an object that was loaded through the JVM&#39;s system classloader\n(sun.misc.Launcher$AppClassLoader), but the PointHome.class type is loaded\nby JUnit&#39;s TestCaseClassLoader.  In the narrow, the two fully qualified\nclass names are the same, but the defining classloaders for the two are\ndifferent so you get the exception because the JVM doesn&#39;t see them as being\nthe same &lt;C;L&gt; class/type.\n\nThe solution would be to exclude your EJB&#39;s interface classes from being\nloaded by the JUnit custom class loader by adding them to the\nexcluded.properties in junit.jar.  Granted, not a very nice solution unless,\nperhaps, it were easier to modify the exclusion list.  I hear in JUnit 4.0\nthat one idea is to make it easy to define exclusions in TestCases\nthemselves.\n\nYou can find out more about which loader loaded which class by doing this:\n\nSystem.out.println(ctx.lookup(&quot;base/PointHome&quot;));\nSystem.out.println(PointHome.class.getClassLoader());\n\nI bet you&#39;ll find when using the Swing UI that the PointHome type is defined\nby the JUnit TestCaseClassLoader and the object returned from ctx.lookup()\nwas defined through the JVM&#39;s system class loader.  When using the textui\nthey&#39;ll both load through the system loader.\n\nScott Stirling\nJRun QA\nMacromedia\n\n&gt; -----Original Message-----\n&gt; From: Mike Lepine [mailto:mike.lepine@...]\n&gt; Sent: Monday, July 16, 2001 2:45 PM\n&gt; To: junit@yahoogroups.com\n&gt; Subject: RE: [junit] ClassCastException only using swing/awt ui\n&gt; \n&gt; \n&gt; Thank goodness. I did finally come to the same conclusion that the\n&gt; swingui.TestRunner was responsible (and not the JNDI code) for the\n&gt; ClassCastExceptions I was getting when retrieving an object \n&gt; from JNDI. I\n&gt; haven&#39;t looked through the TestRunner source to determine why \n&gt; this occurs\n&gt; but am also interested to know the answer.\n\n", 
    "subject": "RE: [junit] ClassCastException only using swing/awt ui"
}
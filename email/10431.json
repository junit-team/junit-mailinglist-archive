{
    "numMessagesInTopic": 8, 
    "nextInTime": 10432, 
    "senderId": "qNrLBFX4ZcxxV_fv9muv7Nv7rpdC2sRwdOGMv9-EUATQ1buQ5Guqb1wUo6r7EnpwXgyMoYzjTa-pHkhkVTbplBDb9RMnhqq8NA", 
    "systemMessage": false, 
    "subject": "Re: JUnit & Reflection -  now Clean ClassLoader Environment for Tests.", 
    "from": "&quot;Oisin Kim&quot; &lt;oisin.kim@...&gt;", 
    "authorName": "Oisin Kim", 
    "msgSnippet": "Hi J.B and thanks for your reply, I ve fixed the problem here which was due to a Custom ClassLoader which was written and didn t behave as it was expected to,", 
    "msgId": 10431, 
    "profile": "oisinkim2000", 
    "topicId": 10412, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 93528314, 
    "messageBody": "<div id=\"ygrps-yiv-366131307\">Hi J.B and thanks for your reply,<br/>\n<br/>\nI&#39;ve fixed the problem here which was due to a Custom ClassLoader<br/>\nwhich was written and didn&#39;t behave as it was expected to, I&#39;ve<br/>\ninherited this code, its used to proved a clean classloader<br/>\nenvironment to tests, so that test methods have clean static instances<br/>\nfor every test run.<br/>\n<br/>\nSince I&#39;ve fixed the problem, I thought I&#39;d post the &quot;fix&quot; for review,<br/>\n  I&#39;m simply here trying to give each test method call a clean<br/>\nenvironment and allow it to initialize everything itself<br/>\n<br/>\n//variable to hold constructor instance for each test - setUp()<br/>\npopulates this<br/>\n<br/>\nprivate Constructor constructor;<br/>\n<br/>\n<br/>\n//use setUp to create a new classloader and get a clean instance of<br/>\nthe test class<br/>\npublic void setUp() {<br/>\n    try {<br/>\n      ClassLoader loader = null;<br/>\n      loader = ITDTestClassLoader.newInstance();<br/>\n      final Class clazz =<br/>\n        loader.findClass(&quot;xxx.util.test.core.RunReflectedTest&quot;);<br/>\n      constructor =<br/>\n        clazz.getConstructor(new Class[] { TestCase.class,<br/>\nString.class });<br/>\n    } catch (NoSuchMethodException ex) {<br/>\n      fail(&quot;Unable instantiate test. Constructor doesn&#39;t exist.&quot;);<br/>\n    } catch (Exception ex) {<br/>\n      ex.printStackTrace();<br/>\n      fail(&quot;Unable to create classloader:&quot; + ex);<br/>\n    }<br/>\n  }<br/>\n}<br/>\n<br/>\n /**<br/>\n   * Executes test itself<br/>\n   * @param testName - name of the test to be executed<br/>\n   * @throws Throwable when test fails or an error occur<br/>\n   */<br/>\n  private void runTest(final String testName) throws Throwable {<br/>\n    final RunTest runTest =<br/>\n      (RunTest) constructor.newInstance(new Object[] { this, testName });<br/>\n    runTest.run();<br/>\n<br/>\n<br/>\nIn this case the test methods etc are in a separate class, not sure<br/>\nwhat benefit this gives, a sample test method would look like:<br/>\n<br/>\n /**<br/>\n   * runs specified test.<br/>\n   * @see xxx.util.test.core.RunReflectedTest<br/>\n   */<br/>\n  public void testName() throws Throwable {<br/>\n    this.runTest(&quot;testName&quot;);<br/>\n  }<br/>\n<br/>\n<br/>\nThe RunReflectedTest class holds the test methods, and also uses the<br/>\nsetUp() and tearDown() methods to get a copy of the inital system<br/>\nproperties and reset them in the tearDown.<br/>\n<br/>\nComments are welcome, how can we improve this?<br/>\n<br/>\nThanks again to J.B. for your help and input, I hope someone finds<br/>\nthis helpful!<br/>\n<br/>\nKind Regards,<br/>\n<br/>\nOisin<br/>\n<br/>\n<blockquote><span title=\"qreply\"> --- In <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>, &quot;J. B. Rainsberger&quot; &lt;jbrains@r...&gt; wrote:<br/>\n&gt; Oisin Kim wrote:<br/>\n&gt; <br/>\n&gt; &gt; Hi All,<br/>\n&gt; &gt; I&#39;ve searched the archives (& Google) for something like this but<br/>\n&gt; &gt; didn&#39;t find anything so here goes:<br/>\n&gt; &gt; <br/>\n&gt; &gt; a test method will run fine if ran by itself in a plain class which<br/>\n&gt; &gt; extends TestCase, it includes a section like this:<br/>\n&gt; &gt; String expectedExceptionMessage = &quot;someException&quot;;<br/>\n&gt; &gt; String actualExceptionMessage = null;<br/>\n&gt; &gt; try {<br/>\n&gt; &gt;   SomeClass.someStaticMethod();<br/>\n&gt; &gt;   AssetFail(&quot;Never Should have got here&quot;);<br/>\n&gt; &gt; } catch (Throwable t) {<br/>\n&gt; &gt;   actualExceptionMessage = t.getMessage();<br/>\n&gt; &gt; }<br/>\n&gt; &gt; assertEquals(expectedExceptionMessage, actualExceptionMessage);<br/>\n&gt; &gt; <br/>\n&gt; &gt; what happens is that if this snippet is run from a regular test case,<br/>\n&gt; &gt; everything is fine, but if run via reflection like (shown below) it<br/>\n&gt; &gt; gives me something like:<br/>\n&gt; &gt; <br/>\n&gt; &gt; [junit] Testcase: testName took 8.407 sec<br/>\n&gt; &gt; [junit]     Caused an ERROR<br/>\n&gt; &gt; [junit] null<br/>\n&gt; &gt; [junit] java.lang.reflect.InvocationTargetException<br/>\n&gt; &gt; <br/>\n&gt; &gt; The test method is called as follows :<br/>\n&gt; &gt; <br/>\n&gt; &gt; final Method[] methods = this.getClass().getDeclaredMethods();<br/>\n&gt; &gt;   final int size = methods.length;<br/>\n&gt; &gt;   for (int i = 0; i &lt; size; i++) {<br/>\n&gt; &gt;     method = methods[i];<br/>\n&gt; &gt;     if (method.getName().startsWith(&quot;test&quot;)<br/>\n&gt; &gt;       && method.getParameterTypes().length == 0) {<br/>\n&gt; &gt;       this.setUp();<br/>\n&gt; &gt;       try {<br/>\n&gt; <br/>\n&gt; &gt;         method.invoke(RunResourcesTest.class, null);<br/>\n&gt; <br/>\n&gt; Doesn&#39;t this only work when invoking a class-level (static) method? I <br/>\n&gt; assume your test*() methods are not class-level.<br/>\n&gt; <br/>\n&gt; When you invoke an instance-level method, you need an instance of the <br/>\n&gt; underlying class somewhere, and I don&#39;t see that.<br/>\n&gt; <br/>\n&gt; Finally, why are you duplicating code in JUnit&#39;s test runner?<br/>\n&gt; -- <br/>\n&gt; J. B. Rainsberger,<br/>\n&gt; Diaspar Software Services<br/>\n&gt; <a rel=\"nofollow\" target=\"_blank\" href=\"http://www.diasparsoftware.com\">http://www.diasparsoftware.com</a> :: +1 416 791-8603<br/>\n&gt; Let&#39;s write software that people understand </span></blockquote></div>", 
    "prevInTime": 10430, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1076059106", 
    "canDelete": false, 
    "nextInTopic": 10436, 
    "prevInTopic": 10422, 
    "headers": {
        "inReplyToHeader": "PDQwMjI5QTkyLjUwMDA0MDdAcm9nZXJzLmNvbT4=", 
        "messageIdInHeader": "PGJ2dm01MitjYjE5QGVHcm91cHMuY29tPg=="
    }
}
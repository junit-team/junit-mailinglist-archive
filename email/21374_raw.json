{
    "numMessagesInTopic": 22, 
    "nextInTime": 21375, 
    "senderId": "q8rBtvA5YXUaMwHz1LhwcaWae-gVsm9o36BQ6iRPR5cx1malWBZwRnYStxf4qu7JEt8JEa4zcdmx3DqN2XkCS0GEovgu144RnKBuxzUK", 
    "systemMessage": false, 
    "subject": "Re: [junit] Re: Runner for non static inner class in JUnit 4.x", 
    "from": "Lasse Koskela &lt;lasse.koskela@...&gt;", 
    "authorName": "Lasse Koskela", 
    "msgSnippet": "Love it :) Lasse On Thu, Feb 12, 2009 at 8:36 PM, tuomaskarkkainenri", 
    "msgId": 21374, 
    "rawEmail": "Return-Path: &lt;lasse.koskela@...&gt;\r\nX-Sender: lasse.koskela@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nX-Received: (qmail 51769 invoked from network); 18 Feb 2009 19:06:07 -0000\r\nX-Received: from unknown (66.218.67.95)\n  by m43.grp.scd.yahoo.com with QMQP; 18 Feb 2009 19:06:07 -0000\r\nX-Received: from unknown (HELO rv-out-0506.google.com) (209.85.198.233)\n  by mta16.grp.scd.yahoo.com with SMTP; 18 Feb 2009 19:06:07 -0000\r\nX-Received: by rv-out-0506.google.com with SMTP id k40so57920rvb.5\n        for &lt;junit@yahoogroups.com&gt;; Wed, 18 Feb 2009 11:06:07 -0800 (PST)\r\nMIME-Version: 1.0\r\nX-Received: by 10.141.2.18 with SMTP id e18mr4101881rvi.142.1234983967364; Wed, \n\t18 Feb 2009 11:06:07 -0800 (PST)\r\nIn-Reply-To: &lt;gn1q6h+qn14@...&gt;\r\nReferences: &lt;4f7da6b90902040715v7d8f4f45t9524d37579550f32@...&gt;\n\t &lt;gn1q6h+qn14@...&gt;\r\nDate: Wed, 18 Feb 2009 21:06:07 +0200\r\nMessage-ID: &lt;3975e2d10902181106r22b673dcr8e8ca27d8d83dd88@...&gt;\r\nTo: junit@yahoogroups.com\r\nContent-Type: text/plain; charset=ISO-8859-1\r\nContent-Transfer-Encoding: 7bit\r\nX-eGroups-Msg-Info: 2:4:8:0:2\r\nFrom: Lasse Koskela &lt;lasse.koskela@...&gt;\r\nSubject: Re: [junit] Re: Runner for non static inner class in JUnit 4.x\r\nX-Yahoo-Group-Post: member; u=190530936; y=mo61GG-jqW7UTezX3MzzjEqkrIZTUvDpOz0SkCoXv7ojMHSPJJKL\r\nX-Yahoo-Profile: lassekoskela\r\n\r\nLove it :)\n\nLasse\n\nOn Thu, Feb 12, 2009 at 8:36 PM, tuomaskarkkainenri\n&lt;tuomaskarkkainenri@...&gt; wrote:\n&gt; David,\n&gt;\n&gt; I rewrote my patch into AnnotatedBuilder.\n&gt; I wrote it in such a way that it decreases the complexity of the\n&gt; original AnnotatedBuilder. The net effect of adding JDave support is\n&gt; thus a reduction in complexity.\n&gt;\n&gt; What do you think?\n&gt;\n&gt; Best regards,\n&gt; Tuomas\n&gt;\n&gt; AnnotatedBuilder.java:\n&gt;\n&gt; package org.junit.internal.builders;\n&gt;\n&gt; import static java.util.Arrays.asList;\n&gt;\n&gt; import java.lang.reflect.Constructor;\n&gt; import java.lang.reflect.Modifier;\n&gt; import java.util.List;\n&gt;\n&gt; import org.junit.runner.RunWith;\n&gt; import org.junit.runner.Runner;\n&gt; import org.junit.runners.model.InitializationError;\n&gt; import org.junit.runners.model.RunnerBuilder;\n&gt;\n&gt; public class AnnotatedBuilder extends RunnerBuilder {\n&gt; private static final String CONSTRUCTOR_ERROR_FORMAT= &quot;Custom runner\n&gt; class %1$s should have a public constructor with signature %1$s(Class\n&gt; testClass) or %1$s(Class testClass, RunnerBuilder builder)&quot;;\n&gt;\n&gt; private final RunnerBuilder fSuiteBuilder;\n&gt;\n&gt; public AnnotatedBuilder(final RunnerBuilder suiteBuilder) {\n&gt; fSuiteBuilder= suiteBuilder;\n&gt; }\n&gt;\n&gt; @Override\n&gt; public Runner runnerForClass(final Class&lt;?&gt; testClass) throws Exception {\n&gt; final RunWith annotation= getRunWithAnnotation(testClass);\n&gt; if (annotation != null) {\n&gt; return buildRunner(annotation.value(), testClass);\n&gt; }\n&gt; return null;\n&gt; }\n&gt;\n&gt; private RunWith getRunWithAnnotation(final Class&lt;?&gt; testClass) {\n&gt; if (testClass.isAnnotationPresent(RunWith.class)) {\n&gt; return testClass.getAnnotation(RunWith.class);\n&gt; }\n&gt; if (testClassIsANonStaticInnerClass(testClass)) {\n&gt; return testClass.getDeclaringClass().getAnnotation(RunWith.class);\n&gt; }\n&gt; return null;\n&gt; }\n&gt;\n&gt; private boolean testClassIsANonStaticInnerClass(final Class&lt;?&gt;\n&gt; testClass) {\n&gt; return testClass.isMemberClass()\n&gt; && !Modifier.isStatic(testClass.getModifiers());\n&gt; }\n&gt;\n&gt; private &lt;T extends Runner&gt; T buildRunner(final Class&lt;T&gt; runnerClass,\n&gt; final Class&lt;?&gt; testClass) throws Exception {\n&gt; return new InternalBuilder&lt;T&gt;(runnerClass,\n&gt; fSuiteBuilder).build(testClass);\n&gt; }\n&gt;\n&gt; private static class InternalBuilder&lt;T extends Runner&gt; {\n&gt; private final RunnerBuilder suiteBuilder;\n&gt;\n&gt; private final Class&lt;T&gt; runnerClass;\n&gt;\n&gt; public InternalBuilder(final Class&lt;T&gt; runnerClass,\n&gt; final RunnerBuilder suiteBuilder) {\n&gt; this.runnerClass= runnerClass;\n&gt; this.suiteBuilder= suiteBuilder;\n&gt;\n&gt; }\n&gt;\n&gt; private T build(final Class&lt;?&gt; testClass) throws Exception {\n&gt; if (hasValidConstructor()) {\n&gt; return instantiateRunner(testClass);\n&gt; }\n&gt; throw new InitializationError(String.format(\n&gt; CONSTRUCTOR_ERROR_FORMAT, runnerClass.getSimpleName()));\n&gt; }\n&gt;\n&gt; private T instantiateRunner(final Class&lt;?&gt; testClass) throws Exception {\n&gt; if (hasSimpleConstructor()) {\n&gt; return getSimpleConstructor().newInstance(testClass);\n&gt; }\n&gt; return getConstructorWithSuite(runnerClass).newInstance(testClass,\n&gt; suiteBuilder);\n&gt; }\n&gt;\n&gt; private boolean hasValidConstructor() {\n&gt; return hasSimpleConstructor()\n&gt; || hasConstructorWithSuite();\n&gt; }\n&gt;\n&gt; private boolean hasSimpleConstructor() {\n&gt; return getSimpleConstructor() != null;\n&gt; }\n&gt;\n&gt; private boolean hasConstructorWithSuite() {\n&gt; return getConstructorWithSuite(runnerClass) != null;\n&gt; }\n&gt;\n&gt; private Constructor&lt;T&gt; getSimpleConstructor() {\n&gt; for (final Constructor&lt;T&gt; constructor : getConstructors()) {\n&gt; final List&lt;Class&lt;?&gt;&gt; parameters= asList(constructor\n&gt; .getParameterTypes());\n&gt; if (parameters.equals(asList(Class.class))) {\n&gt; return constructor;\n&gt; }\n&gt; }\n&gt; return null;\n&gt; }\n&gt;\n&gt; private Constructor&lt;T&gt; getConstructorWithSuite(\n&gt; final Class&lt;T&gt; runnerClass) {\n&gt; for (final Constructor&lt;T&gt; constructor : getConstructors()) {\n&gt; final List&lt;Class&lt;?&gt;&gt; parameters= asList(constructor\n&gt; .getParameterTypes());\n&gt; if (parameters.equals(asList(Class.class, RunnerBuilder.class))) {\n&gt; return constructor;\n&gt; }\n&gt; }\n&gt; return null;\n&gt; }\n&gt;\n&gt; @SuppressWarnings(&quot;unchecked&quot;)\n&gt; private List&lt;Constructor&lt;T&gt;&gt; getConstructors() {\n&gt; return asList((Constructor&lt;T&gt;[]) runnerClass.getConstructors());\n&gt; }\n&gt;\n&gt; }\n&gt; }\n&gt;\n&gt; AnnotatedBuilderTest.java:\n&gt;\n&gt; package org.junit.tests.running.classes;\n&gt;\n&gt; import static org.hamcrest.core.Is.is;\n&gt; import static org.junit.Assert.assertThat;\n&gt; import org.hamcrest.core.IsNull;\n&gt; import org.junit.Test;\n&gt; import org.junit.internal.builders.AnnotatedBuilder;\n&gt; import org.junit.runner.Description;\n&gt; import org.junit.runner.RunWith;\n&gt; import org.junit.runner.Runner;\n&gt; import org.junit.runner.notification.RunNotifier;\n&gt; import org.junit.runners.model.InitializationError;\n&gt; import org.junit.runners.model.RunnerBuilder;\n&gt;\n&gt; public class AnnotatedBuilderTest {\n&gt; @Test\n&gt; public void aClassWithARunWithAnnotationHasRunnerBuilt() throws\n&gt; Exception {\n&gt; final Runner runner= new AnnotatedBuilder(null)\n&gt; .runnerForClass(ClassWithRunWithAnnotation.class);\n&gt; assertThat(runner, is(FakeRunner.class));\n&gt; }\n&gt;\n&gt; @Test\n&gt; public void\n&gt; aClassWithARunWithAnnotationThatRequiresASuiteBuilderHasRunnerBuilt()\n&gt; throws Exception {\n&gt; final Runner runner= new AnnotatedBuilder(null)\n&gt;\n&gt; .runnerForClass(ClassWithRunWithAnnotationWhereTheRunnerRequiresASuiteBuilder.class);\n&gt; assertThat(runner, is(FakeRunnerThatRequiresSuiteBuilder.class));\n&gt;\n&gt; }\n&gt;\n&gt; @Test\n&gt; public void aClassWithoutARunWithAnnotationReturnsNull() throws\n&gt; Exception {\n&gt; final Runner runner= new AnnotatedBuilder(null)\n&gt; .runnerForClass(ClassWithoutRunWithAnnotation.class);\n&gt; assertThat(runner, is(IsNull.&lt;Runner&gt; nullValue()));\n&gt;\n&gt; }\n&gt;\n&gt; @Test\n&gt; public void\n&gt; aNonStaticInnerClassWithARunWithAnnotationOnTheDeclaringClassHasRunnerBuilt()\n&gt; throws Exception {\n&gt; final Runner runner= new AnnotatedBuilder(null)\n&gt;\n&gt; .runnerForClass(DeclaringClassWithRunWithAnnotation.NonStaticInnerClass.class);\n&gt; assertThat(runner, is(FakeRunner.class));\n&gt; }\n&gt;\n&gt; @Test\n&gt; public void aStaticInnerClassWithARunWithAnnotationHasRunnerBuilt()\n&gt; throws Exception {\n&gt; final Runner runner= new AnnotatedBuilder(null)\n&gt;\n&gt; .runnerForClass(DeclaringClassWithRunWithAnnotation.StaticInnerClassWithRunWithAnnotation.class);\n&gt; assertThat(runner, is(FakeRunner.class));\n&gt; }\n&gt;\n&gt; @Test\n&gt; public void\n&gt; aStaticInnerClassWithARunWithAnnotationOnTheDeclaringClassReturnsNull()\n&gt; throws Exception {\n&gt; final Runner runner= new AnnotatedBuilder(null)\n&gt;\n&gt; .runnerForClass(DeclaringClassWithRunWithAnnotation.StaticInnerClass.class);\n&gt; assertThat(runner, is(IsNull.&lt;Runner&gt; nullValue()));\n&gt; }\n&gt;\n&gt; @Test(expected= InitializationError.class)\n&gt; public void\n&gt; aClassWithARunWithAnnotationThatSpecifiesAnInvalidRunnerThrowsException()\n&gt; throws Exception {\n&gt; final Runner runner= new AnnotatedBuilder(null)\n&gt;\n&gt; .runnerForClass(ClassWithRunWithAnnotationThatSpecifiesAndInvalidRunner.class);\n&gt; assertThat(runner, is(IsNull.&lt;Runner&gt; nullValue()));\n&gt; }\n&gt;\n&gt; @RunWith(FakeRunner.class)\n&gt; private static class ClassWithRunWithAnnotation {\n&gt; }\n&gt;\n&gt; @RunWith(InvalidRunner.class)\n&gt; private static class\n&gt; ClassWithRunWithAnnotationThatSpecifiesAndInvalidRunner {\n&gt; }\n&gt;\n&gt; @RunWith(FakeRunnerThatRequiresSuiteBuilder.class)\n&gt; private static class\n&gt; ClassWithRunWithAnnotationWhereTheRunnerRequiresASuiteBuilder {\n&gt; }\n&gt;\n&gt; private static class ClassWithoutRunWithAnnotation {\n&gt; }\n&gt;\n&gt; @RunWith(FakeRunner.class)\n&gt; private static class DeclaringClassWithRunWithAnnotation {\n&gt;\n&gt; public class NonStaticInnerClass {\n&gt; }\n&gt;\n&gt; public static class StaticInnerClass {\n&gt; }\n&gt;\n&gt; @RunWith(FakeRunner.class)\n&gt; public static class StaticInnerClassWithRunWithAnnotation {\n&gt; }\n&gt;\n&gt; }\n&gt;\n&gt; public static class InvalidRunner extends Runner {\n&gt;\n&gt; @Override\n&gt; public Description getDescription() {\n&gt; return Description.EMPTY;\n&gt; }\n&gt;\n&gt; @Override\n&gt; public void run(final RunNotifier notifier) {\n&gt; }\n&gt; }\n&gt;\n&gt; public static class FakeRunner extends Runner {\n&gt; public FakeRunner(final Class&lt;?&gt; testClass) {\n&gt; }\n&gt;\n&gt; @Override\n&gt; public Description getDescription() {\n&gt; return Description.EMPTY;\n&gt; }\n&gt;\n&gt; @Override\n&gt; public void run(final RunNotifier notifier) {\n&gt; }\n&gt; }\n&gt;\n&gt; public static class FakeRunnerThatRequiresSuiteBuilder extends Runner {\n&gt; public FakeRunnerThatRequiresSuiteBuilder(final Class&lt;?&gt; testClass,\n&gt; final RunnerBuilder suiteBilder) {\n&gt; }\n&gt;\n&gt; @Override\n&gt; public Description getDescription() {\n&gt; return Description.EMPTY;\n&gt; }\n&gt;\n&gt; @Override\n&gt; public void run(final RunNotifier notifier) {\n&gt; }\n&gt; }\n&gt; }\n&gt;\n&gt; And RunWithTest.java, I fixed the error message to:\n&gt;\n&gt; @Test\n&gt; public void characterizeErrorMessageFromBadRunner() {\n&gt; assertEquals(\n&gt; &quot;Custom runner class BadRunner should have a public constructor\n&gt; with signature BadRunner(Class testClass) or BadRunner(Class\n&gt; testClass, RunnerBuilder builder)&quot;,\n&gt; JUnitCore.runClasses(Empty.class).getFailures().get(0)\n&gt; .getMessage());\n&gt; }\n&gt;\n&gt; --- In junit@yahoogroups.com, David Saff &lt;david@...&gt; wrote:\n&gt;&gt;\n&gt;&gt; I&#39;m unexcited about bumping up the JUnit complexity for a single\n&gt; feature.\n&gt;&gt; Again, I love JDave, but I&#39;d love a feature suggestion that used one\n&gt; stone\n&gt;&gt; to kill at least two birds.\n&gt;&gt;\n&gt;&gt; David Saff\n&gt;&gt;\n&gt;&gt; On Tue, Feb 3, 2009 at 11:33 AM, tuomaskarkkainenri &lt;\n&gt;&gt; tuomaskarkkainenri@...&gt; wrote:\n&gt;&gt;\n&gt;&gt; &gt; Hi David, Kent,\n&gt;&gt; &gt;\n&gt;&gt; &gt; Did you guys decide on what to do with this issue?\n&gt;&gt; &gt;\n&gt;&gt; &gt; Best regards,\n&gt;&gt; &gt; Tuomas\n\n", 
    "profile": "lassekoskela", 
    "topicId": 21238, 
    "spamInfo": {
        "reason": "4", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 190530936, 
    "prevInTime": 21373, 
    "contentTrasformed": false, 
    "postDate": "1234983967", 
    "canDelete": false, 
    "nextInTopic": 21429, 
    "prevInTopic": 21349, 
    "headers": {
        "inReplyToHeader": "PGduMXE2aCtxbjE0QGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PDM5NzVlMmQxMDkwMjE4MTEwNnIyMmI2NzNkY3I4ZThjYTI3ZDhkODNkZDg4QG1haWwuZ21haWwuY29tPg==", 
        "referencesHeader": "PDRmN2RhNmI5MDkwMjA0MDcxNXY3ZDhmNGY0NXQ5NTI0ZDM3NTc5NTUwZjMyQG1haWwuZ21haWwuY29tPgkgPGduMXE2aCtxbjE0QGVHcm91cHMuY29tPg=="
    }
}
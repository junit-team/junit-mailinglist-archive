{
    "numMessagesInTopic": 29, 
    "nextInTime": 20670, 
    "senderId": "wQQ3Q_TScgfvz0wkZu4Zo5rjgMuaJaGKKHH3wWnaIUNDZqnI85ykEcaawIhmYOm_qohKTOwGW2t6r4MP3FemqfgH_ClBVMW3d-cmlA", 
    "systemMessage": true, 
    "subject": "Re: Junit 3 suite setup tear down", 
    "from": "&quot;toalexsmail&quot; &lt;toalexsmail@...&gt;", 
    "authorName": "toalexsmail", 
    "msgSnippet": "... TC. , ... I think that there is some related thread on this topic, but never mind. * There are @Before and @After annotation that are equivalent of use of", 
    "msgId": 20669, 
    "profile": "toalexsmail", 
    "topicId": 20668, 
    "spamInfo": {
        "reason": "6", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 340165037, 
    "messageBody": "<div id=\"ygrps-yiv-178466622\">--- In <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>, &quot;lars&quot; &lt;lars.carlsson@...&gt; wrote:<br/>\n<blockquote><span title=\"ireply\"> &gt;<br/>\n&gt; Hi <br/>\n&gt; At my company we have alot of automated test cases and in all our<br/>\n&gt; suite we have a setup testcase and a teardown test case where we setup<br/>\n&gt; network connection that takes some time and can not be done in every<br/>\n </span></blockquote>TC. ,<br/>\n<blockquote><span title=\"ireply\"> &gt; But i think that there should exist a suite setup and a teardown and<br/>\n&gt; not be in a setup/teardown TC.<br/>\n&gt; Are there any why of doing this or how could i best be solve this by<br/>\n&gt; extending TestSuite?<br/>\n&gt; <br/>\n&gt; Regards Lars<br/>\n&gt;<br/>\n </span></blockquote>I think that there is some related thread on this topic, but never mind.<br/>\n<br/>\n* There are @Before and @After annotation that are equivalent of use<br/>\nof setUp() and tearDown().<br/>\n* There are @BeforeClass and @AfterClass annotation that are supposed<br/>\nto substitute the use of TestSuite. In fact, this method is called<br/>\nonce per class. You can see on it as your TestSuite was just a single<br/>\nclass. AFAIK, there is no build in support for TestSuite that is not<br/>\nso trivial.<br/>\n<br/>\nI had similar requirement, namely I wanted to ensure that JDK 1.4+<br/>\nassert statement are on, I wanted to start JBoss microcontainer at the<br/>\nbeginning and shutdown it at the end.<br/>\n<br/>\nLets start from the simplest one. <br/>\n*  I wanted to ensure that JDK 1.4+ assert statement are on.<br/>\nI created class with name BaseTestCase and all my test classes<br/>\ninherits from it. In this class I put the following method:<br/>\n<br/>\n<br/>\n@BeforeClass<br/>\npublic static void oneTimeSetup(){<br/>\n\t// do your one time set-up here!<br/>\n\tlog.info(&quot;BaseTestCase.oneTimeSetup()&quot;);<br/>\n\tlog.debug(&quot;Going to check whether asserts are enabled&quot;);<br/>\n\tboolean assertsEnabled = false;<br/>\n\tassert (assertsEnabled = true); // Intentional side effect!!!<br/>\n\tif (!assertsEnabled) {<br/>\n\t\tthrow new AssertionError(&quot;Asserts must be enabled!&quot;);<br/>\n\t\t}<br/>\n\t}<br/>\n}<br/>\n<br/>\nBecause all my test classes inherit from BaseTestCase and has their<br/>\nbase class BaseTestCase, it is guaranteed that first thing that will<br/>\nbe run (beside JUnit itself) is oneTimeSetup() method.<br/>\n\t<br/>\n* I wanted to start JBoss microcontainer at the beginning and shutdown<br/>\nit at the end.<br/>\n<br/>\nEvery test class inherit from some base test class, say<br/>\nBaseHelloWorldEJBTest  (that eventually inherit from BaseTestCase). In<br/>\nBaseHelloWorldEJBTest  there is method <br/>\n<br/>\n@BeforeClass<br/>\npublic static void setUpClass() throws Exception ;<br/>\n<br/>\nThis method basically does the following:<br/>\n<br/>\nfinal Bootstrap jbossInstance =  Bootstrap.getInstance();<br/>\nif (!jbossInstance.isStarted()) {\t\t<br/>\n\tlog.debug(&quot;starting JBoss microcontainer&quot;);<br/>\n\tjbossInstance.bootstrap();<br/>\n\tlog.debug(&quot;JBoss microcontainer is up&quot;);<br/>\n<br/>\n\tlog.debug(&quot;Going to deploy scanClasspath&quot;);<br/>\n\tdeploy(scanClasspath);<br/>\n\tlog.debug(&quot;End of deploy scanClasspath&quot;);<br/>\n\t... &lt;HERE there is more code&gt;\t<br/>\n}<br/>\n<br/>\nUntil now everything is pretty straight-forward. But how can I stop<br/>\nJBoss when I finished testing? I don&#39;t want to stop it after every<br/>\nclass, but after whole TestSuite is done. I didn&#39;t find something<br/>\nbuilt-in, so I use ShutdownHook...<br/>\n<br/>\nIn the above setUpClass() mehtod in the place that noted as &quot;&lt;HERE<br/>\nthere is more code&gt;&quot; I have:<br/>\n<br/>\nlog.debug(&quot;Now add hook to shutdown server&quot;);<br/>\nRuntime.getRuntime().addShutdownHook(new Thread() {<br/>\n public void run() {<br/>\n assert lRunnables!=null;<br/>\n Runnable runnable =null;<br/>\n String runnableI = null;<br/>\n try {<br/>\n  for(int i=0;i&lt;lRunnables.length;i++){<br/>\n  \trunnable = lRunnables[i];<br/>\n  \trunnableI = &quot;runnable &quot;+i;<br/>\n  \tlog.debug(&quot;Going to run &quot;+runnableI);<br/>\n  \tif(runnable==null){<br/>\n  \t\t  log.warn(runnableI+&quot; is null, skipping&quot;);<br/>\n\t} else {<br/>\n\t   try {<br/>\n\t    runnable.run();<br/>\n\t    log.debug(runnableI+&quot; ends run succesfully&quot;);<br/>\n\t    }<br/>\n\t   catch(Throwable e){log.error(runnableI+&quot; fails&quot;, e);}<br/>\n\t     <br/>\n\t   }<br/>\n\t}<br/>\n\t\t\t            \t<br/>\n  }<br/>\n<br/>\n  catch(Throwable e){<br/>\n    log.error(&quot;This should never happened. Some runnables Throwable<br/>\n(exception) propogates outside the loop&quot;, e);<br/>\n   }<br/>\n\t\t            \t<br/>\n\t\t            \t<br/>\n   synchronized (jbossInstance) {<br/>\n       \tjbossInstance.shutdown();<br/>\n   }<br/>\n String junitStatus = junitStatusOs.toString();<br/>\n log.debug(junitStatus);<br/>\n\t\t               <br/>\n  }<br/>\n});<br/>\nI will talk about junitStatusPs a bit later. What is actually is done<br/>\nhere that in @BeforeClass that it is before running every class, there<br/>\nis check whether JBoss is run or no. If it is run nothing special is<br/>\ndone. If it is not run, and this will be true only first time this<br/>\ncheck will be done, JBoss is started and ShutDownHook is added. Take a<br/>\nlook on the JavaDoc on ShutDownHook, but basically, on the call on<br/>\nSystem.exit() JVM will be run your hook. In that shutdown hook I make<br/>\njbossInstance.shutdown(). <br/>\n<br/>\n<br/>\nThere is one issue here. One JBoss is shutting down it write some<br/>\nthing to the log. What is happen, that I see JUnit report (90000<br/>\ntested passes, 100 fails, and 10 ignored) and after this report I see<br/>\nthe output from shitting down process. This happen, because the<br/>\nshutdown hook happens after last JUnit class finished to run. <br/>\nI found some work around. In the BaseTestCase I have:<br/>\n       // the logger<br/>\n\tprivate static final Log log = LogFactory.getLog(BaseTestCase.class);<br/>\n\tprotected static final OutputStream junitStatusOs = new<br/>\nByteArrayOutputStream(16*1024);<br/>\n\t<br/>\nThis junitStatusPs is actually passed to as PrintStream (instead<br/>\nSystem.out) to the JUnit classes. Note, that I have <br/>\n<br/>\n String junitStatus = junitStatusOs.toString();<br/>\n log.debug(junitStatus);<br/>\n\t\t               <br/>\nas the last row of the shutdown hook. This ensure, that I will see the<br/>\noutput of the shutdown hook first, and the JUnit report will be the<br/>\nlast rows in the standard output. <br/>\nAnd the last issue is:<br/>\n<br/>\nIf I want to do some other thing I just wrap it as lRunnables and pass<br/>\nto the method mentioned above. It is looks like this:<br/>\n<br/>\n    \t//we want to call cleanUp() method that ear application calls<br/>\n    \t//moment before we shutting down JBoss<br/>\n        Runnable runnable = new Runnable(){<br/>\n        \tpublic void run() {<br/>\n        \t\ttry {<br/>\n       \t\t\t\tcleanUp();        \t\t\t\t<br/>\n        \t\t}<br/>\n        \t\tcatch(HelloWorldException e){<br/>\n        \t\t\tlog.error(&quot;Failed to cleanUp&quot;, e);<br/>\n        \t\t} \t\t<br/>\n        \t}<br/>\n        };<br/>\n    \t<br/>\n        setUpClass(System.getProperty(&quot;user.dir&quot;) + &quot;/target/classes&quot;,<br/>\nrunnable);        <br/>\n<br/>\nIn order to shutdown JBoss we use<br/>\n        @AfterClass<br/>\n\tpublic static void tearDownClass() throws Exception {<br/>\n       \tlog.info(&quot;one time tearDownClass()&quot;);<br/>\n\t\tundeploy();<br/>\n\t\tBootstrap.getInstance().shutdown();<br/>\n\t}</div>", 
    "prevInTime": 20668, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1215632862", 
    "canDelete": false, 
    "nextInTopic": 20670, 
    "prevInTopic": 20668, 
    "headers": {
        "inReplyToHeader": "PGc1MW44ZStmdTRyQGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PGc1MzRrdStvZnN0QGVHcm91cHMuY29tPg=="
    }
}
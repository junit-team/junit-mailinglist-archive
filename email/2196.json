{
    "numMessagesInTopic": 11, 
    "nextInTime": 2197, 
    "senderId": "13vxwr-2nDZeI7vo35ydOHbhKJA_X1iEYsOTJ-hZjY15rktdahg-CPnlcg-0xxGqSkj3RsgTiAvoX8V9ziM3pe80DoUGETkabrH3G6FV", 
    "systemMessage": false, 
    "subject": "Re: [junit] testing database operation", 
    "from": "&quot;Mathieu Gervais&quot; &lt;egoine_@...&gt;", 
    "authorName": "Mathieu Gervais", 
    "msgSnippet": "... I think you are right, altought I m not expert in locking models . Another important point is that you can have code that insist on commiting, for example", 
    "msgId": 2196, 
    "topicId": 2136, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 0, 
    "messageBody": "<div id=\"ygrps-yiv-210854939\"><blockquote><span title=\"ireply\">&gt;This technique, however, is dependant on your locking model.<br/>\n<br/>\n </span></blockquote>I think you are right, altought I&#39;m not expert in &quot;locking models&quot;.<br/>\n<br/>\nAnother important point is that you can have code that insist on commiting,<br/>\nfor example an entity EJB that you test in the real container environment.<br/>\nOr code that do multi-transaction, so need to commit in between.<br/>\n<br/>\nIn that case, you can not do the real neat trick of autoCommit false.<br/>\n<br/>\nI once dreamed a system where every affected row would be rolled back.<br/>\n<br/>\nI investigated many options :<br/>\n<br/>\nGlossary:<br/>\n-&quot;stable data&quot; means data you no is ok and that should be the baseline for<br/>\nthe tests, i.e. before the tests are runned, the DB contains that baseline<br/>\nstable data. Note that if your tables are all emtpy (i.e. no baseline data)<br/>\nbefore runnning the tests, everything is much simpler, you just do a<br/>\ntruncate/delete on all tables after every test and you don&#39;t need to read on<br/>\n:)<br/>\n<br/>\nOption 1 - Data refresh:  refresh data after/before every test.<br/>\n...from a copy of the baseline data somewhere.<br/>\nReally impossible due to performance. If you think not, let me know how.<br/>\n<br/>\nOption 2 - Data Re-initialize: every test case clean up it&#39;s data in<br/>\ntearDown()<br/>\nPointed out by David Roussel also.<br/>\nThat&#39;s one of the strategy we use. Works well but you got to be carefull<br/>\nwriting your cleanup code.<br/>\nImpossible to use if you are changing stable data rows: only work if just<br/>\njust add rows.<br/>\n<br/>\nOption 3 - use mock objects to fake the DB.<br/>\nDicussed in the mailing list archives.<br/>\nWhen you want to test DB code, (SQL, transactions, etc), does not really<br/>\napply since you fake the part you want to test.<br/>\nOnly applies if the actual DB is outside the &quot;unit&quot; under test, which isnot<br/>\nalways the case.<br/>\n<br/>\nOption 4 - Data Reset: reverse the changes via some generic black-magic<br/>\nafter every test.<br/>\nThe dream! Fast, efficient, generic! :)<br/>\nI&#39;ve spent some time trying to find a neat DB trick do to that one. Never<br/>\nreally got the time to find a complete solution and implement it.<br/>\n<br/>\n4a) Journalling<br/>\nUse some sort of journalling provided by the database to replay in backward<br/>\ndirection all the changes made. Is this even possible/supported?<br/>\n<br/>\n4b) DB tricks, triggers and al.<br/>\nYou need a DB that is a copy of your baseline stable data. (Might be in the<br/>\nsame DB, but with table names prefixed with &#39;STBL&#39;(stable)).<br/>\n(You could use &#39;create table like&#39; to ease making baseline table with the<br/>\nsame structure.)<br/>\n<br/>\nEvery table as a flag column name BASELINE to keep track of what happens to<br/>\nthe line. For your baseline data, set the flag to &#39;Y&#39;(es).<br/>\nDefault on insert for this column in &#39;N&#39; (New, Not part of baseline). A<br/>\ntrigger on update changes the flag to &#39;U&#39;(updated).<br/>\nA trigger on delete (only effective on a row marked &#39;Y&#39; or &#39;U&#39;)  marks the<br/>\ncorresponding row in the baseline copy with &#39;D&#39;(deleted)<br/>\n<br/>\nAfter a test:<br/>\n-drop all lines with &#39;N&#39;,<br/>\n-if a line is U, refresh it from the baseline copy. (resetting the flag to<br/>\n&#39;Y&#39;).<br/>\n-Add all the rows marked &#39;D&#39; in the baseline copy to the working copy.<br/>\n<br/>\nDaily or weekly, refresh from scratch your working copy from the baseline<br/>\ncopy. Do this also if a test case fail and it should really worked and you<br/>\nsuspects the code that revert changes to have somehow failed.<br/>\n<br/>\nBeware of autoincrement columns, they will cause re-adding a deleted row to<br/>\nbreak the system because the column(possibly a key) will change.<br/>\nAny trigger used in the system needs to be analysed to see if it would work<br/>\nwith this system (e.g. a trigger that sets a column to the current time will<br/>\nmake re-adding a delete row fail, i.e. the time will have changed. This<br/>\nmight be ok or not).<br/>\nSpecial treatment should be done for views also. (Don&#39;t run the reversing<br/>\ncode on them)<br/>\n(You might also have to drop the integrity constraints while doing this if<br/>\nyou don&#39;t want to have to do it in the right order respecting integrity<br/>\nconstraints).<br/>\n<br/>\nOption 5 - Data Roll forward:  don&#39;t do anything!<br/>\nJust start the next test without cleaning the junk of the previous one.<br/>\nMight work in some case (i.e. obvious read-only DB case) but is not really a<br/>\n&quot;solution&quot;.<br/>\n<br/>\nOption 6 - Auto commit = false ...<br/>\n...and rollback in tearDown().<br/>\nPointed out by Neil Swingler also.<br/>\nVery good solution if applicable (see top of this email for reasons why it<br/>\nwould not always apply).<br/>\nYour code should allow this, and your DB also (&quot;locking model&quot;), see email<br/>\nbelow from David Roussel.<br/>\n<br/>\n<br/>\nIf you ever implement 4b, or have any comments or solution, please let me<br/>\nknow! :)<br/>\n<br/>\nmathieu<br/>\n<br/>\n<blockquote><span title=\"qreply\"> ----- Original Message -----<br/>\nFrom: David Roussel<br/>\nTo: <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a><br/>\nSent: Friday, July 27, 2001 4:12 AM<br/>\nSubject: RE: [junit] testing database operation<br/>\n<br/>\n<br/>\nThat sounds like a very good idea.  That would get around the concerns I<br/>\nhave of running to DB tests too many times on a live DB for fear of<br/>\nrunning out of primary (a pretty daft fear I might add).<br/>\n<br/>\nThis technique, however, is dependant on your locking model.  If you ran<br/>\non a database that used optimistic locking (Oracle) you could find that<br/>\neverything worked ok.  But if you had committed then problems would have<br/>\noccurred.  I guess this would be pretty rare and only occur when<br/>\nmultiple updates are occurring at the same time.  That is stress testing<br/>\nand not the job of Junit.  It&#39;s worth being aware of the limitations<br/>\nthough.<br/>\n<br/>\nDave<br/>\n<br/>\n-----Original Message-----<br/>\nFrom: Neil Swingler [mailto:<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:nswingler@...\">nswingler@...</a>]<br/>\nSent: 27 July 2001 09:01<br/>\nTo: <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a><br/>\nSubject: RE: [junit] testing database operation<br/>\n<br/>\n<br/>\nThe easiest way to clean up the database is to ensure nothing ever gets<br/>\ncommited. I aquire my connection in setUp (no autoCommit) and rollback<br/>\nin<br/>\ntearDown().<br/>\n<br/>\n&gt; -----Original Message-----<br/>\n&gt; From: Simon Evans [mailto:<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:sevans@...\">sevans@...</a>]<br/>\n&gt; Sent: 26 July 2001 19:29<br/>\n&gt; To: <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a><br/>\n&gt; Subject: [junit] testing database operation<br/>\n&gt;<br/>\n&gt;<br/>\n&gt; i am trying to test objects that use the database. in order to leave<br/>\nthe<br/>\n&gt; database in the same state after the test, one test method has to do a<br/>\n&gt; store, load and delete. is this normal? or is there a way to test each<br/>\n&gt; method (store, load, delete) separately, maybe using the setUp() and<br/>\n&gt; tearDown() methods? is there a standard pattern for this?<br/>\n&gt;<br/>\n&gt; also the assert methods do not throw anything...do they throw a<br/>\n&gt; RuntimeException or somethnig when they fail? because if i want to do<br/>\nsome<br/>\n&gt; clean up in a certain test method using a try-catch-finally<br/>\n&gt; block, do i have<br/>\n&gt; to catch a specific runtime exception? or should all cleanup for<br/>\n&gt; all methods<br/>\n&gt; be done in the tearDown() method?<br/>\n&gt;<br/>\n<br/>\n<br/>\n<br/>\nTo unsubscribe from this group, send an email to:<br/>\n<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit-unsubscribe@yahoogroups.com\">junit-unsubscribe@yahoogroups.com</a><br/>\n<br/>\n<br/>\nYour use of Yahoo! Groups is subject to<br/>\n<a rel=\"nofollow\" target=\"_blank\" href=\"http://docs.yahoo.com/info/terms/\">http://docs.yahoo.com/info/terms/</a><br/>\n<br/>\n<br/>\n<br/>\nYahoo! Groups Sponsor<br/>\nADVERTISEMENT<br/>\n<br/>\n<br/>\n<br/>\n<br/>\nTo unsubscribe from this group, send an email to:<br/>\n<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit-unsubscribe@yahoogroups.com\">junit-unsubscribe@yahoogroups.com</a><br/>\n<br/>\n<br/>\nYour use of Yahoo! Groups is subject to the Yahoo! Terms of Service. </span></blockquote></div>", 
    "prevInTime": 2195, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "996260088", 
    "canDelete": false, 
    "nextInTopic": 2197, 
    "prevInTopic": 2147, 
    "headers": {
        "messageIdInHeader": "PE9FNDlRaEV4a2l5UG9IWmd6RGcwMDAwMzdkM0Bob3RtYWlsLmNvbT4=", 
        "referencesHeader": "PEM2RDFCRDQzMDRCMDdGNEU5NjQyMjNCQUU1RDQ1RTJCMDZFQzI3QGhlcm1lcy5ianNzLmNvLnVrPg=="
    }
}
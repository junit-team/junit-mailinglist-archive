{
    "numMessagesInTopic": 8, 
    "nextInTime": 10495, 
    "senderId": "Ll0gVzXuJ1quprNa2sS5kqnuy7euBgBDTEw4rAsOjzSOl0fe8J0afl0lm6vIJFCrzRTAnyTlkwNNaZepYp165MBRJp9e", 
    "systemMessage": false, 
    "subject": "RE: [junit] Re: JUnit & Reflection -  now Clean ClassLoader Environment for Tests.", 
    "from": "&quot;Oisin&quot; &lt;oisin.kim@...&gt;", 
    "authorName": "Oisin", 
    "msgSnippet": "Apologies for the delay, been really busy in work and home, Here is a simple TestCase which will run each test in a clean new classloader. Comments welcome -", 
    "msgId": 10494, 
    "rawEmail": "Return-Path: &lt;oisin.kim@...&gt;\r\nReceived: (qmail 48752 invoked from network); 17 Feb 2004 23:52:37 -0000\r\nReceived: from unknown (66.218.66.216)\n  by m8.grp.scd.yahoo.com with QMQP; 17 Feb 2004 23:52:37 -0000\r\nReceived: from unknown (HELO n4.grp.scd.yahoo.com) (66.218.66.88)\n  by mta1.grp.scd.yahoo.com with SMTP; 17 Feb 2004 23:52:37 -0000\r\nX-eGroups-Return: oisin.kim@...\r\nReceived: from [66.218.67.161] by n4.grp.scd.yahoo.com with NNFMP; 17 Feb 2004 23:52:31 -0000\r\nX-Sender: oisin.kim@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (qmail 94817 invoked from network); 17 Feb 2004 23:09:55 -0000\r\nReceived: from unknown (66.218.66.172)\n  by m18.grp.scd.yahoo.com with QMQP; 17 Feb 2004 23:09:55 -0000\r\nReceived: from unknown (HELO aurium.net) (217.114.171.24)\n  by mta4.grp.scd.yahoo.com with SMTP; 17 Feb 2004 23:09:55 -0000\r\nReceived: from oisin (dsl-35-243.dsl.netsource.ie [213.79.35.243])\n\tby aurium.net (8.12.10/8.11.2) with ESMTP id i1HN9j0x003849\n\tfor &lt;junit@yahoogroups.com&gt;; Tue, 17 Feb 2004 23:09:54 GMT\r\nX-Authentication-Warning: aurium.net: aurium owned process doing -bs\r\nTo: &lt;junit@yahoogroups.com&gt;\r\nDate: Tue, 17 Feb 2004 23:09:44 -0000\r\nMessage-ID: &lt;000401c3f5ab$24b880f0$0302a8c0@oisin&gt;\r\nMIME-Version: 1.0\r\nContent-Type: text/plain;\n\tcharset=&quot;us-ascii&quot;\r\nContent-Transfer-Encoding: 7bit\r\nX-Priority: 3 (Normal)\r\nX-MSMail-Priority: Normal\r\nX-Mailer: Microsoft Outlook, Build 10.0.2627\r\nX-MimeOLE: Produced By Microsoft MimeOLE V6.00.2727.1300\r\nImportance: Normal\r\nIn-Reply-To: &lt;c07kv2+fj5a@...&gt;\r\nX-eGroups-Remote-IP: 217.114.171.24\r\nFrom: &quot;Oisin&quot; &lt;oisin.kim@...&gt;\r\nSubject: RE: [junit] Re: JUnit & Reflection -  now Clean ClassLoader Environment for Tests.\r\nX-Yahoo-Group-Post: member; u=93528314\r\nX-Yahoo-Profile: oisinkim2000\r\nX-eGroups-Approved-By: vbossica &lt;vladimir@...&gt; via web; 17 Feb 2004 23:52:30 -0000\r\nX-eGroups-Remote-IP: 66.218.66.88\r\n\r\nApologies for the delay, been really busy in work and home,\n\nHere is a simple TestCase which will run each test in a clean new\nclassloader. Comments welcome - perhaps we can improve this to a level\nwhere it might be useful to others. To give people some background, I&#39;ve\nsone this to make sure classes are statically initialised at each test\nmethod invokation,\n\n\nimport java.io.File;\nimport java.lang.reflect.Constructor;\nimport java.lang.reflect.Method;\nimport java.net.MalformedURLException;\nimport java.net.URL;\nimport java.net.URLClassLoader;\nimport java.util.ArrayList;\nimport java.util.Properties;\nimport java.util.StringTokenizer;\nimport junit.framework.Assert;\nimport junit.framework.TestCase;\n\n/**\n * @author OK\n */\npublic class CLTest extends TestCase {\n\n  /**\n   * The classloader the method will run in\n   */\n  private ClassLoader classLoader;\n\n  private Properties props;\n\n  public void runMethod(String methodName) throws Exception {\n    Class thisClass = classLoader.loadClass(this.getClass().getName());\n    Method method = thisClass.getDeclaredMethod(methodName, null);\n    CLTest obj = null;\n    Constructor constructor = null;\n    try {\n      Constructor[] constructors = thisClass.getConstructors();\n      for (int i = 0; i &lt; constructors.length; i++) {\n        Constructor temp = constructors[i];\n        if (temp.getParameterTypes().length == 0) {\n          constructor = temp;\n        }\n      }\n      obj = (CLTest) constructor.newInstance(null);\n    } catch (Exception e) {\n      e.printStackTrace();\n    }\n    System.err.print(\n      &quot;runMethod::Current Classloader is &quot; + classLoader.toString());\n    System.err.println(&quot; -&gt; invoking method &quot; + method.getName());\n    method.invoke(obj, null);\n  }\n\n  protected void setUp() {\n    props = (Properties) System.getProperties().clone();\n    try {\n      final String classpath = System.getProperty(&quot;java.class.path&quot;);\n      final StringTokenizer tokenizer =\n        new StringTokenizer(classpath, File.pathSeparator);\n      // extract all items from classpath.\n      // unsynchronized: This local variable is unsynchronised.\n      final ArrayList urls = new ArrayList(10);\n      String element;\n      while (tokenizer.hasMoreTokens()) {\n        element = tokenizer.nextToken();\n        try {\n          urls.add(new URL(&quot;file://&quot; + element));\n        } catch (MalformedURLException ex) {\n          ex.printStackTrace();\n          throw new RuntimeException(ex.toString());\n        }\n      }\n      final URL[] urlArray = (URL[]) urls.toArray(new URL[urls.size()]);\n      if (Thread.currentThread().getContextClassLoader() == null) {\n        System.err.println(\n          &quot;&#92;n&#92;n&#92;nsetUp:: Classloader thread &quot;\n            + Thread.currentThread().getContextClassLoader());\n        final ClassLoader urlClassLoader =\n          new URLClassLoader(\n            urlArray,\n            Thread.currentThread().getContextClassLoader());\n        classLoader = urlClassLoader;\n      } else {\n        System.err.println(\n          &quot;&#92;n&#92;n&#92;nsetUp:: Classloader  class &quot; +\nthis.getClass().getClassLoader());\n        final ClassLoader urlClassLoader =\n          new URLClassLoader(urlArray, getClass().getClassLoader());\n        classLoader = urlClassLoader;\n      }\n    } catch (SecurityException e) {\n      e.printStackTrace();\n    }\n  }\n\n  public void tearDown() throws Exception {\n    System.err.println(&quot;tearDown::&#92;n&quot;);\n  }\n\n  public void testOne() throws Exception {\n    runMethod(&quot;doStuff&quot;);\n  }\n\n  public void testTwo() throws Exception {\n    runMethod(&quot;doStuff&quot;);\n  }\n\n  public void doStuff() throws Exception {\n    System.err.println(&quot;doStuff::Stuff&quot;);\n\n  }\n\n\n\n  /**\n   * @param arg0\n   */\n  public CLTest(String arg0) {\n    super(arg0);\n    // TODO Auto-generated constructor stub\n  }\n  public CLTest() {\n    super(&quot;test&quot;);\n  }\n\n}\n\n\nHere&#39;s the output from the testcase:\n\n\nsetUp:: Classloader  class sun.misc.Launcher$AppClassLoader@1ff5ea7\nrunMethod::Current Classloader is java.net.URLClassLoader@1034bb5 -&gt;\ninvoking method doStuff\ndoStuff::Stuff\ntearDown::\n\n\n\n\nsetUp:: Classloader  class sun.misc.Launcher$AppClassLoader@1ff5ea7\nrunMethod::Current Classloader is java.net.URLClassLoader@b162d5 -&gt;\ninvoking method doStuff\ndoStuff::Stuff\ntearDown::\n\n\n&gt; -----Original Message-----\n&gt; From: Oisin Kim [mailto:oisin.kim@...] \n&gt; Sent: 09 February 2004 09:47\n&gt; To: junit@yahoogroups.com\n&gt; Subject: [junit] Re: JUnit & Reflection - now Clean \n&gt; ClassLoader Environment for Tests.\n&gt; \n&gt; \n&gt; Hi Again Neil,\n&gt; \n&gt; Thanks for your help, I&#39;m not sure if this is overkill, this \n&gt; solution involves some other packages, the javaassist stuff \n&gt; from Jboss.org, my code involved simply getting the current \n&gt; Thread, and replacing the current classloader (I assume this \n&gt; is possible through the setContextClassLoader method on the \n&gt; Thread class), which took about 10 lines in the setUp() \n&gt; method of a test case.\n&gt; \n&gt; Saying that, I can see the extra functionality (and \n&gt; flexibility) in your code and have no doubt I&#39;ll be using it soon!\n&gt; \n&gt; Thanks again!\n&gt; \n&gt; Oisin\n&gt; \n&gt; \n&gt; &gt; \n&gt; &gt; I submitted a reloading classloader to the group files section if \n&gt; &gt; you&#39;re interested.\n&gt; &gt; \n&gt; &gt; - Neil Swingler\n&gt; \n&gt; \n&gt; \n&gt; \n&gt;  \n&gt; Yahoo! Groups Links\n&gt; \n&gt; \n&gt; \n&gt;  \n&gt; \n&gt; \n\n\n\n\n", 
    "profile": "oisinkim2000", 
    "topicId": 10412, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 93528314, 
    "prevInTime": 10493, 
    "contentTrasformed": false, 
    "postDate": "1077059384", 
    "canDelete": false, 
    "nextInTopic": 0, 
    "prevInTopic": 10448, 
    "headers": {
        "inReplyToHeader": "PGMwN2t2MitmajVhQGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PDAwMDQwMWMzZjVhYiQyNGI4ODBmMCQwMzAyYThjMEBvaXNpbj4="
    }
}
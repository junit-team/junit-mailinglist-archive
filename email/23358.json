{
    "numMessagesInTopic": 10, 
    "nextInTime": 23359, 
    "senderId": "zCtDu4eDJLc65HKQ9dSDRk0cvGFTIAPsZVwZiVoBNKu_tDKRlXL8aVSVPEU1Gn2SRsIYsx3Bjw82Y0eAM2LM9j9k2-soBfRcYlUqiB4", 
    "systemMessage": false, 
    "subject": "Re: [junit] Sometimes my tests fail, sometimes not - why?!", 
    "from": "Nils Wilhelm &lt;murphy@...&gt;", 
    "authorName": "Nils Wilhelm", 
    "msgSnippet": "Hi Joakim, thanks for your mail. ... I don t expected test A to run before test B. But i am not sure if two tests can run at the same time or if one test runs,", 
    "msgId": 23358, 
    "topicId": 23353, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 478556816, 
    "messageBody": "<div id=\"ygrps-yiv-1341675832\">Hi Joakim,<br/>\n<br/>\nthanks for your mail.<br/>\n<br/>\nAm 30.03.2011 08:56, schrieb Joakim Ohlrogge:<br/>\n<blockquote><span title=\"ireply\"> &gt;<br/>\n&gt; I have had several issues when working with a the filesystem from unit<br/>\n&gt; tests. In theory you cannot expect the tests to be run sequencially as in<br/>\n&gt; test A has always run before test B (someone may request to run just <br/>\n&gt; one of<br/>\n&gt; them by rightclicking on the test in eclipse for instance) so that is <br/>\n&gt; a bad<br/>\n&gt; assumption. I don&#39;t think that is your problem in this case though. I <br/>\n&gt; don&#39;t<br/>\n&gt; know about all the magic that goes on with the filesystem behind the <br/>\n&gt; scenes<br/>\n&gt; but especially on windows I have seen issues when files are <br/>\n&gt; occationaly not<br/>\n&gt; deleted properly. I don&#39;t remember how I solved it but I would look for<br/>\n&gt; things like wether the files are properly closed and flushed before <br/>\n&gt; you try<br/>\n&gt; to delete them (could be a race condition where the the write stream is<br/>\n&gt; almost always GC:ed and closed in that process but sometimes not) that <br/>\n&gt; would<br/>\n&gt; lock the file for deletion occationall (when the the output stream has not<br/>\n&gt; yet been GC:ed). Make sure everything is explicitly closed.<br/>\n&gt; It has happened that I think everything looks fine but I have problems<br/>\n&gt; anyway. That is when I start imagining that there the issue is related to<br/>\n&gt; pounding on the filesystem too fast... I don&#39;t think that has ever <br/>\n&gt; been the<br/>\n&gt; case though but one gets paranoid.<br/>\n&gt;<br/>\n </span></blockquote>I don&#39;t expected test A to run before test B. But i am not sure if two <br/>\ntests can run at the same time or if one test runs, ends and after that <br/>\nthe next tests starts. Can you give me an answer to this?<br/>\nAs you said i will check if all streams are closed. Maybe this is the point.<br/>\n<blockquote><span title=\"ireply\"> &gt;<br/>\n&gt;<br/>\n&gt; In general when I have to tests against the file system I tend to to the<br/>\n&gt; setup a bit in reverse. I use an empty target directory and recusrively<br/>\n&gt; delete every file in it both in my setUp (@Before) and my tearDown <br/>\n&gt; (@After).<br/>\n&gt; This way, in case a run gets interupted midway and the directory is left<br/>\n&gt; dirty it is cleaned prior to the next run.<br/>\n&gt;<br/>\n </span></blockquote>I use the finally clause. I check if the created files exist and delete <br/>\nthem. So the next test can expect the source and target folder to be empty.<br/>\n<blockquote><span title=\"ireply\"> &gt;<br/>\n&gt;<br/>\n&gt; This is not a JUnit issue in any case. In general avoid using the <br/>\n&gt; filesystem<br/>\n&gt; from your tests will spare you lots of grief. Perhaps most of what you <br/>\n&gt; want<br/>\n&gt; to test could be done in memory with<br/>\n&gt; ByteArrayOutputStream/ByteArrayInputStream and only touch the <br/>\n&gt; filesystem in<br/>\n&gt; that last case when you know everything works, you just want to see <br/>\n&gt; that you<br/>\n&gt; can replace ByteArrayInput/OutputStream with FileInputOutputStream.<br/>\n&gt; A neat sideeffect by coding this way is that it&#39;s very simple to change<br/>\n&gt; sources/targets (like reading from any URL instead of the filesystem) or<br/>\n&gt; filtering (like GZipping everything that is written to the target) <br/>\n&gt; which is<br/>\n&gt; not as elegant to do if you pass around File objects. By all means <br/>\n&gt; make your<br/>\n&gt; API able to take a filename/File instance but make usre that the first <br/>\n&gt; thing<br/>\n&gt; you do with it is creat a FileInputStream/FileOutputStream and pass it <br/>\n&gt; on to<br/>\n&gt; the next method (using try finally of course). By running in memory <br/>\n&gt; you are<br/>\n&gt; also better prepared to run tests in prallell etc.<br/>\n&gt;<br/>\n </span></blockquote>That&#39;s a good point. Thank&#39;s!<br/>\n<blockquote><span title=\"ireply\"> &gt;<br/>\n&gt;<br/>\n&gt; No rock solid advice in here but hopefully something that helps some...<br/>\n&gt; -----------------------------------------------------<br/>\n&gt; Joakim Ohlrogge<br/>\n&gt; Agical AB<br/>\n&gt; Västerlånggatan 79, 2 tr<br/>\n&gt; 111 29 Stockholm, SWEDEN<br/>\n&gt;<br/>\n&gt; Mobile: +46-708-754004<br/>\n&gt; Blog: johlrogge.wordpress.com<br/>\n&gt; E-mail: <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:joakim.ohlrogge@...\">joakim.ohlrogge@...</a> &lt;mailto:joakim.ohlrogge%40agical.se&gt;<br/>\n&gt;<br/>\n&gt; On Tue, Mar 29, 2011 at 11:22 PM, Nils Wilhelm <br/>\n&gt; &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:murphy@...\">murphy@...</a> &lt;mailto:murphy%40planet-of-art.de&gt;&gt;wrote:<br/>\n&gt;<br/>\n&gt; &gt; Hi there,<br/>\n&gt; &gt;<br/>\n&gt; &gt; i have written a simple backup tool and 10 tests. They all have the same<br/>\n&gt; &gt; structure:<br/>\n&gt; &gt; 1. Create some test files and directories in an directory called <br/>\n&gt; &quot;source&quot;<br/>\n&gt; &gt; 2. Start the backup process (to backup the files/dirs in &quot;source&quot; to a<br/>\n&gt; &gt; directory called &quot;target&quot;)<br/>\n&gt; &gt; 3. Check whether all files in &quot;source&quot; exist also in &quot;target&quot;<br/>\n&gt; &gt; 4. Remove all files from the &quot;source&quot; and &quot;target&quot; directory so that the<br/>\n&gt; &gt; directories are empty for the next test.<br/>\n&gt; &gt;<br/>\n&gt; &gt; If i execute the whole test set ten times, i have 6-7 successes and 3-4<br/>\n&gt; &gt; failures. The error messages say that files in the target directory<br/>\n&gt; &gt; could not be created or deleted (in the last step of the tests, see<br/>\n&gt; &gt; above) if there is a failure. One possibility i could think of is that<br/>\n&gt; &gt; the tests are not run sequentially, so they could have influence at each<br/>\n&gt; &gt; other. But as far as i know JUnit runs all tests in separate threads and<br/>\n&gt; &gt; those sequentially. Is that correct? Does anybody have any suggestions?<br/>\n&gt; &gt;<br/>\n&gt; &gt; I use eclipse helios, JUnit 4.8.1, Java 1.6 and AspectJ<br/>\n&gt; &gt;<br/>\n&gt; &gt; Best regards,<br/>\n&gt; &gt;<br/>\n&gt; &gt; Nils<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt; ------------------------------------<br/>\n&gt; &gt;<br/>\n&gt; &gt; Yahoo! Groups Links<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt;<br/>\n&gt; [Non-text portions of this message have been removed]<br/>\n&gt;<br/>\n&gt; <br/>\n<br/>\n<br/>\n<br/>\n<br/>\n </span></blockquote>[Non-text portions of this message have been removed]</div>", 
    "prevInTime": 23357, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1301476939", 
    "canDelete": false, 
    "nextInTopic": 23359, 
    "prevInTopic": 23357, 
    "headers": {
        "inReplyToHeader": "PEFBTkxrVGlud2ZLTjZ4RXBUYzgyLWRQZkxGanhkdXU4elYydEEzMU4zQ3l1dkBtYWlsLmdtYWlsLmNvbT4=", 
        "messageIdInHeader": "PDREOTJGNjRCLjMwMDAxMDNAcGxhbmV0LW9mLWFydC5kZT4=", 
        "referencesHeader": "PDREOTI0RDlFLjkwNjAzMDNAcGxhbmV0LW9mLWFydC5kZT4gPEFBTkxrVGlud2ZLTjZ4RXBUYzgyLWRQZkxGanhkdXU4elYydEEzMU4zQ3l1dkBtYWlsLmdtYWlsLmNvbT4="
    }
}
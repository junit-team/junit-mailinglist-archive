{
    "topicId": 1885, 
    "postDate": "994865501", 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "from": "Scott Stirling &lt;sstirling@...&gt;", 
    "canDelete": false, 
    "replyTo": "LIST", 
    "senderId": "WmdTvN0bkcrVMqCUJugp2I-hfOPRJcLsO5T-SR1LhFuctlSsr6ZSaPf8xZSs7Gw9krOBTcF8CyVzxaHA6bc3e-heDOgXC7_u0zoo88Mhd9A", 
    "nextInTime": 1887, 
    "userId": 0, 
    "prevInTime": 1885, 
    "prevInTopic": 1885, 
    "headers": {
        "messageIdInHeader": "PEMzODQzQkQxQjgzREQyMTE5RDc5MDAwMDkyQTdCQUQ0MDczQkIyMTdAcGxhdGludW0uYWxsYWlyZS5jb20+"
    }, 
    "authorName": "Scott Stirling", 
    "numMessagesInTopic": 3, 
    "msgSnippet": "I think it s the same problem.  The Log4J-related classload that failed with a LinkageError (at least the one stack trace that was posted), was ", 
    "contentTrasformed": false, 
    "msgId": 1886, 
    "nextInTopic": 1888, 
    "systemMessage": false, 
    "rawEmail": "Return-Path: &lt;sstirling@...&gt;\r\nX-Sender: sstirling@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (EGP: mail-7_2_0); 11 Jul 2001 15:48:32 -0000\r\nReceived: (qmail 4031 invoked from network); 11 Jul 2001 15:32:04 -0000\r\nReceived: from unknown (10.1.10.27) by m8.onelist.org with QMQP; 11 Jul 2001 15:32:04 -0000\r\nReceived: from unknown (HELO uscamexcp005.allaire.com) (63.109.193.183) by mta2 with SMTP; 11 Jul 2001 15:32:03 -0000\r\nReceived: by smtp.allaire.com with Internet Mail Service (5.5.2650.21) id &lt;3FPPT46N&gt;; Wed, 11 Jul 2001 11:31:48 -0400\r\nMessage-ID: &lt;C3843BD1B83DD2119D79000092A7BAD4073BB217@...&gt;\r\nTo: &quot;&#39;Laird, William&#39;&quot; &lt;blaird@...&gt;, &quot;&#39;junit@yahoogroups.com&#39;&quot; &lt;junit@yahoogroups.com&gt;, Scott Stirling &lt;sstirling@...&gt;\r\nSubject: RE: Log4J, JAXP linkage  issues\r\nDate: Wed, 11 Jul 2001 11:31:41 -0400\r\nMIME-Version: 1.0\r\nX-Mailer: Internet Mail Service (5.5.2650.21)\r\nContent-Type: text/plain; charset=&quot;iso-8859-1&quot;\r\nFrom: Scott Stirling &lt;sstirling@...&gt;\r\n\r\nI think it&#39;s the same problem.  The Log4J-related classload that failed with\na LinkageError (at least the one stack trace that was posted), was\norg.xml.sax.InputSource. \n\nScott Stirling\nJRun QA\nMacromedia\n\n&gt; -----Original Message-----\n&gt; From: Laird, William [mailto:blaird@...]\n&gt; Sent: Wednesday, July 11, 2001 11:45 AM\n&gt; To: &#39;junit@yahoogroups.com&#39;; &#39;sstirling@...&#39;\n&gt; Subject: Log4J, JAXP linkage issues\n&gt; \n&gt; \n&gt; I&#39;m just getting ready to start using JUnit as well as JAXP \n&gt; and Log4J and\n&gt; the JUnit extension JUNitPP. \n&gt; \n&gt; Scott suggests to add org.w3c.dom.* and org.xml.sax.* to the\n&gt; excluded.properties to resolve the linkage issues for JAXP \n&gt; developers. Does\n&gt; anyone have an equally simple solution for the log4J \n&gt; initialization issues\n&gt; reported in this forum? \n&gt; \n&gt; \n&gt; \n&gt; -----Original Message-----\n&gt; From: Scott Stirling [mailto:sstirling@...]\n&gt; Sent: Tuesday, July 10, 2001 11:32 PM\n&gt; To: &#39;chw@... &#39;; &#39;junit@yahoogroups.com &#39;\n&gt; Subject: RE: [junit] Class loader error with junit\n&gt; \n&gt; \n&gt; The JUnit TestCaseClassLoader (the reloadable one) has a \n&gt; fundamental problem\n&gt; that results in frequent LinkageErrors under the following conditions:\n&gt; \n&gt; 1. You use the JUnit Swing UI.\n&gt; \n&gt; 2.  You use JAXP in your test cases or any classes referenced \n&gt; in your test\n&gt; cases, or even any &quot;instanceof&quot; expressions that reference \n&gt; JAXP classes.\n&gt; (By JAXP I mean the whole set of javax.* classes plus the \n&gt; org.w3c.dom.* and\n&gt; org.xml.sax.* classes)\n&gt; \n&gt; I can go into this in depth, but the bottom line problems are \n&gt; that JUnit\n&gt; loads classes from the same place as the JVM&#39;s system loader; \n&gt; the classpath.\n&gt; This necessitates the use of an exclusion list to filter out \n&gt; certain class\n&gt; names that either must be loaded by the system loader, or you \n&gt; would like to\n&gt; have loaded by the system loader.  The JUnit loader does not \n&gt; always delegate\n&gt; to the system loader when it should, particularly in the case \n&gt; of JAXP, which\n&gt; is a weird mix of classes whose names begin with the filtered \n&gt; &quot;javax.*&quot; and\n&gt; the unfiltered &quot;org.w3c.*&quot; and org.xml.*&quot;.\n&gt; \n&gt; JAXP is a special case because it is based on a set of \n&gt; javax.* classes.  All\n&gt; javax.* classes are excluded from the JUnit loader by default (in the\n&gt; default excluded.properties file) in junit.jar.  But JAXP, as \n&gt; shipped from\n&gt; Sun, comes with a bunch of other classes in org.w3c.* and \n&gt; org.xml.*.  The\n&gt; interesting thing is a direct dependency between javax.* \n&gt; classes and some\n&gt; other classes not in the usual exclusion list of com.sun.*, \n&gt; javax.*, etc.\n&gt; \n&gt; So what can happen, and frequently does when using the JUnit \n&gt; Swing UI with\n&gt; test cases or other classes, such as Log4J, that use JAXP, is \n&gt; that the JUnit\n&gt; class loader (properly) delegates javax.xml.* classes it &quot;sees&quot; to the\n&gt; system loader.  But then the system loader loads up a bunch \n&gt; of org.w3c.dom\n&gt; and/or org.xml.sax classes as the result of initializing and \n&gt; loading that\n&gt; JAXP class.  Later, if the JUnit loader comes across some \n&gt; org.w3c/xml class\n&gt; that it&#39;s never seen before, it tries to load it because the classname\n&gt; doesn&#39;t match one of the patterns in the exclude list.  \n&gt; \n&gt; But it&#39;s already been loaded through the &quot;backdoor&quot; as the \n&gt; result of some\n&gt; other class loaded by the system loader (remember, the JVM \n&gt; keeps classes in\n&gt; their own namespace by identifying them by their fully \n&gt; qualified name plus\n&gt; the instance of their _defining_ (not initiating) loader, \n&gt; AND, the JVM will\n&gt; attempt to assign all unloaded classes referenced by a \n&gt; defined class to that\n&gt; defining class&#39;s loader).  The JVM&#39;s classresolver routine \n&gt; keeps track of\n&gt; all these class loading events and &quot;sees&quot; that the JUnit loader is\n&gt; attempting to define a class that has already been defined by \n&gt; the system\n&gt; loader.  That&#39;s wrong because according to the rules of \n&gt; loader constraints,\n&gt; JUnit should delegate this load to the system loader.\n&gt; \n&gt; You can hack around this (I did) by catching the LinkageError in\n&gt; TestCaseClassLoader&#39;s loadClass() method and then making a \n&gt; recovery call to\n&gt; findSystemClass() -- thereby delegating to the system loader \n&gt; after the fact\n&gt; (which is OK).  This hack only works some of the time, \n&gt; though, because now\n&gt; you can have the reverse problem where the JUnit loader loads \n&gt; a host of\n&gt; org.*.* classes, and then the system loader violates the \n&gt; loader contraints\n&gt; at some point when it tries to do exactly what I described \n&gt; above with JAXP\n&gt; because it doesn&#39;t ever delegate to its child (the JUnit loader).\n&gt; Inevitably, if your test cases use many JAXP and related XML \n&gt; classes, one or\n&gt; the other ClassLoader will end violating the constraints \n&gt; whatever you do.\n&gt; \n&gt; So the solution in the existing JUnit is to definitely add \n&gt; org.w3c.dom.* and\n&gt; org.xml.sax.* to your excluded.properties if you&#39;re using any \n&gt; JAXP stuff.\n&gt; \n&gt; What can we learn from this?  Well, one thing is that it&#39;s a \n&gt; good idea to\n&gt; have your custom class loaders load classes from repositories \n&gt; other than the\n&gt; system classpath.  Note that the JVM&#39;s built-in classloaders \n&gt; work that way\n&gt; (one for the jre/ext dirs, another for the java.class.path).\n&gt; \n&gt; Anyway, the excluded.properties fix is just a matter of time before it\n&gt; becomes standard in JUnit, since JAXP will be a standard part \n&gt; of the 1.4\n&gt; JDK.  It&#39;ll be just like having org.omg.* excluded.\n&gt; \n&gt; Scott Stirling\n&gt; \n&gt; -----Original Message-----\n&gt; From: chw@...\n&gt; To: junit@yahoogroups.com\n&gt; Sent: 7/10/01 10:43 PM\n&gt; Subject: [junit] Class loader error with junit\n&gt; \n&gt; Folks:\n&gt; \n&gt; I am using Junit (I am a newbie at it) with Log4j (which we use \n&gt; extensively) and I cannot seem to get the Log4j stuff initialized.  \n&gt; \n&gt; When I put the DOMConfigurator.configure() call from Log4j in main(), \n&gt; it is apparently lost when the test cases are run (different class \n&gt; loader? causing the singleton functions to use a different set \n&gt; objects?)\n&gt; \n&gt; When I put the Log4j config stuff in the setUp(), I get the \n&gt; following.  \n&gt; \n&gt; Any suggestions what the problem is and how to work around it? \n&gt; \n&gt; Thanks\n&gt; \n&gt; Charlie\n&gt; \n&gt; \n&gt; java.lang.LinkageError: Class org/xml/sax/InputSource violates loader \n&gt; constraints\n&gt; \tat \n&gt; org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:\n&gt; 1169)\n&gt; \tat \n&gt; org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:\n&gt; 1039)\n&gt; \tat \n&gt; org.apache.log4j.xml.DOMConfigurator.configure(DOMConfigurator.java:11\n&gt; 97)\n&gt; \tat \n&gt; com.clearmetrix.outreach.datamodel.VisitorExperienceSqlOperationTestCa\n&gt; se.setUp(VisitorExperienceSqlOperationTestCase.java:38)\n&gt; \n&gt; \n&gt; \n&gt; To unsubscribe from this group, send an email to:\n&gt; junit-unsubscribe@yahoogroups.com\n&gt;  \n&gt; \n&gt; Your use of Yahoo! Groups is subject to\n&gt; http://docs.yahoo.com/info/terms/ \n&gt; \n&gt; \n&gt; To unsubscribe from this group, send an email to:\n&gt; junit-unsubscribe@yahoogroups.com\n&gt;  \n&gt; \n&gt; Your use of Yahoo! Groups is subject to \nhttp://docs.yahoo.com/info/terms/ \n\n", 
    "subject": "RE: Log4J, JAXP linkage  issues"
}
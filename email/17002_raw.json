{
    "numMessagesInTopic": 8, 
    "nextInTime": 17003, 
    "senderId": "ljnkujWIkpcl-ucf8kjA_rW9nVlQvf0klv35O6UWoi4d4-U5ddNEbu99fWPwcqc-aq-7vtVWVy7J4V3Ht7ydAQ", 
    "systemMessage": false, 
    "subject": "Re: Mocking libraries and moving parts (was: Re: [junit] unit tes t       case for login())", 
    "from": "David Saff &lt;saff@...&gt;", 
    "authorName": "David Saff", 
    "msgSnippet": "Michael, One tool that works wonders for me in cases like this is to extract a protected helper method in DefaultGroupQualifier named getSession, which you can", 
    "msgId": 17002, 
    "rawEmail": "Return-Path: &lt;saff@...&gt;\r\nX-Sender: saff@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (qmail 45351 invoked from network); 22 Jun 2006 09:44:22 -0000\r\nReceived: from unknown (66.218.66.167)\n  by m40.grp.scd.yahoo.com with QMQP; 22 Jun 2006 09:44:22 -0000\r\nReceived: from unknown (HELO rozz.csail.mit.edu) (128.30.2.16)\n  by mta6.grp.scd.yahoo.com with SMTP; 22 Jun 2006 09:44:22 -0000\r\nReceived: from c-65-96-183-74.hsd1.ma.comcast.net ([65.96.183.74] helo=[192.168.0.102])\n\tby rozz.csail.mit.edu with esmtpsa (TLSv1:AES256-SHA:256)\n\t(Exim 4.50)\n\tid 1FtLj1-0001Fe-BD\n\tfor junit@yahoogroups.com; Thu, 22 Jun 2006 05:43:47 -0400\r\nMessage-ID: &lt;449A6652.40803@...&gt;\r\nDate: Thu, 22 Jun 2006 05:43:46 -0400\r\nUser-Agent: Thunderbird 1.5.0.4 (Windows/20060516)\r\nMIME-Version: 1.0\r\nTo: junit@yahoogroups.com\r\nReferences: &lt;e7ddbs+dcqn@...&gt;\r\nIn-Reply-To: &lt;e7ddbs+dcqn@...&gt;\r\nContent-Type: text/plain; charset=ISO-8859-1; format=flowed\r\nContent-Transfer-Encoding: 7bit\r\nX-eGroups-Msg-Info: 2:3:4:0\r\nFrom: David Saff &lt;saff@...&gt;\r\nSubject: Re: Mocking libraries and moving parts (was: Re: [junit] unit tes\n t       case for login())\r\nX-Yahoo-Group-Post: member; u=139771899; y=ODlxTySmCFOEScln8LtkPzJhhkeflNR9niQZWxcA6s0\r\nX-Yahoo-Profile: dsaff\r\n\r\nMichael,\n\nOne tool that works wonders for me in cases like this is to extract a \nprotected helper method in DefaultGroupQualifier named getSession, which \nyou can override for the test.  JUnit 4 makes this even easier, because \nthe test object can subclass DefaultGroupQualifier.  This significantly \ncuts down on the amount of mocking you need to do, and helps \nencapsulation.  Whenever I find myself mocking two or three objects \nbefore I even get to the interesting part of my test, I start looking \nfor protected query methods to extract.\n\nDoes that help?\n\n    David Saff\n\nmrutherfurd wrote:\n&gt; --- In junit@yahoogroups.com, &quot;J. B. Rainsberger&quot; &lt;jbrains@...&gt; wrote:\n&gt;   \n&gt;&gt; Rutherford, Michael wrote:\n&gt;&gt;     \n&gt;&gt;&gt; Yes I&#39;m aware that the various mocking frameworks all provide \n&gt;&gt;&gt;       \n&gt; ways to in\n&gt;   \n&gt;&gt;&gt; erffect provide stub implementations of a given interface. The \n&gt;&gt;&gt;       \n&gt; problerm is\n&gt;   \n&gt;&gt;&gt; having to provide the interelationships between the various \n&gt;&gt;&gt;       \n&gt; interfaces to\n&gt;   \n&gt;&gt;&gt; allow the mock to function adequately. In the simple example \n&gt;&gt;&gt;       \n&gt; below I needed\n&gt;   \n&gt;&gt;&gt; to provide a mock IDfSession with enough extra code for it to \n&gt;&gt;&gt;       \n&gt; produce mock\n&gt;   \n&gt;&gt;&gt; IDfGroup and IDfUser objects that could then be resolved against \n&gt;&gt;&gt;       \n&gt; each other\n&gt;   \n&gt;&gt;&gt; in several variations by the business logic. It was a major \n&gt;&gt;&gt;       \n&gt; effort just to\n&gt;   \n&gt;&gt;&gt; get the mocks set up. IIRC the test code was significantly larger \n&gt;&gt;&gt;       \n&gt; than the\n&gt;   \n&gt;&gt;&gt; original class, let alone just the method I was testing.\n&gt;&gt;&gt;       \n&gt;&gt; What would have to be true for you to have avoided this extra work? \n&gt;&gt;     \n&gt; What \n&gt;   \n&gt;&gt; example were you trying to check? I don&#39;t know Documentum well, but \n&gt;&gt;     \n&gt; if \n&gt;   \n&gt;&gt; your business logic operates on User and Group objects, shouldn&#39;t \n&gt;&gt;     \n&gt; you \n&gt;   \n&gt;&gt; just invoke your business logic passing in User and Group objects? \n&gt;&gt;     \n&gt; This \n&gt;   \n&gt;&gt; would remove the need to simulate the Session interface.\n&gt;&gt;\n&gt;&gt; I would need to know more to be sure, but I suspect there are \n&gt;&gt; simplifications we can apply by looking at the tests a little \n&gt;&gt; differently. If you could share a test (or the essence of it) with \n&gt;&gt;     \n&gt; us, \n&gt;   \n&gt;&gt; we might be able to help.\n&gt;&gt;\n&gt;&gt;     \n&gt;&gt;&gt; The fact that calls to Documentum super class methods are \n&gt;&gt;&gt;       \n&gt; intermingled with\n&gt;   \n&gt;&gt;&gt; business logic to a high degree and seperating them would \n&gt;&gt;&gt;       \n&gt; complicate the\n&gt;   \n&gt;&gt;&gt; class inordinately making it less maintainable is also annoying.\n&gt;&gt;&gt;       \n&gt;&gt; I&#39;ll take your word for it, but intermixing business logic with \n&gt;&gt; integration logic has, in my experience, never been simpler (easier \n&gt;&gt;     \n&gt; to \n&gt;   \n&gt;&gt; maintain) than separating them from each other.\n&gt;&gt;\n&gt;&gt;     \n&gt;&gt;&gt; Having said that I still haven&#39;t given up, I&#39;m just less \n&gt;&gt;&gt;       \n&gt; confident than I\n&gt;   \n&gt;&gt;&gt; was. I also reread the holy books regularly \n&gt;&gt;&gt;       \n&gt; (&quot;Refactoring&quot;, &quot;Working\n&gt;   \n&gt;&gt;&gt; Effectively With Legacy Code&quot;, &quot;JUnit Recipes&quot;, &quot;Design Patterns&quot; \n&gt;&gt;&gt;       \n&gt; and\n&gt;   \n&gt;&gt;&gt; &quot;Refactoring to Patterns&quot;) trying to get ideas :-)\n&gt;&gt;&gt;       \n&gt;&gt; More eyes usually help....\n&gt;&gt;\n&gt;&gt; Take care.\n&gt;&gt;     \n&gt;\n&gt; Here&#39;s the user/group example I was referring to... Any suggestions \n&gt; would be greatly appreciated.\n&gt;\n&gt; /**\n&gt;  * This class allows default group to be used as an additional \n&gt; scoping type. \n&gt;  * \n&gt;  * Add the new qualifier to the the app.xml file to enable the use of \n&gt; this file.\n&gt;  * \n&gt;  * In use the qualifier will return the default group the user \n&gt; belongs to which can therefore \n&gt;  * be compared to the scoping value.\n&gt;  * \n&gt;  * eg.\n&gt;  * \t&gt;scope group=&quot;lpc&quot;&lt;\n&gt;  * \n&gt;  * @author Michael Rutherfurd\n&gt;  */\n&gt; public class DefaultGroupQualifier implements IQualifier {\n&gt;\n&gt; \t/**\n&gt; \t * Returns the name of the group to be used for scoping.\n&gt; \t * @return scope name\n&gt; \t */\n&gt; \tpublic String getScopeName() {\n&gt; \t\treturn &quot;group&quot;;\n&gt; \t}\n&gt;\n&gt; \tpublic String[] getContextNames() {\n&gt; \t\treturn null;\n&gt; \t}\n&gt;\n&gt; \tpublic String getScopeValue(QualifierContext context) {\n&gt; \t\treturn getDefaultGroup();\n&gt; \t}\n&gt;\n&gt; \tpublic String getParentScopeValue(String scopeValue) {\n&gt; \t\treturn null;\n&gt; \t}\n&gt;\n&gt; \tpublic String[] getAliasScopeValues(String scopeValue) {\n&gt; \t\treturn null;\n&gt; \t}\n&gt; \t\n&gt; \tprivate String getDefaultGroup() {\n&gt; \t\t\n&gt; \t\ttry {\n&gt; \t\t\tIDfSessionManager sessionManager = \n&gt; SessionManagerHttpBinding.getSessionManager();\n&gt; \t\t\t\n&gt; \t\t\tif (sessionManager == null) {\n&gt; \t\t\t\tDfLogger.debug(this, &quot;No session \n&gt; manager available&quot;, null, null);\n&gt; \t\t\t\treturn &quot;&quot;;\n&gt; \t\t\t}\n&gt; \t\t\t\n&gt; \t\t\tString currentDocbase = \n&gt; SessionManagerHttpBinding.getCurrentDocbase();\n&gt; \t\t\t\n&gt; \t\t\tif (currentDocbase == null) {\n&gt; \t\t\t\tDfLogger.debug(this, &quot;No docbase \n&gt; available&quot;, null, null);\n&gt; \t\t\t\treturn &quot;&quot;;\n&gt; \t\t\t}\n&gt; \t\t\t\t\t\t\n&gt; \t\t\tDfLogger.debug(this, &quot;PrincipalName: &quot; + \n&gt; sessionManager.getPrincipalName(), null, null);\n&gt; \t\t\t\n&gt; \t\t\ttry {\n&gt; \t\t\t\tIDfSession session = \n&gt; sessionManager.getSession(currentDocbase);\n&gt; \t\t\t\t\n&gt; \t\t\t\tif (session == null) {\n&gt; \t\t\t\t\tDfLogger.debug(this, &quot;No \n&gt; session available&quot;, null, null);\n&gt; \t\t\t\t\treturn &quot;&quot;;\n&gt; \t\t\t\t}\n&gt; \t\t\t\n&gt; \t\t\t\ttry {\n&gt; \t\t\t\t\tIDfUser user = session.getUser\n&gt; (null);\n&gt; \t\t\t\t\t\n&gt; \t\t\t\t\tDfLogger.debug(this, &quot;User: &quot; \n&gt; + user.getUserName() + &quot;(&quot; + user.getUserOSDomain() + &quot;&#92;&#92;&quot; + \n&gt; user.getUserOSName() + &quot;), Default group: &quot; + user.getUserGroupName\n&gt; (), null, null);\n&gt; \t\t\t\t\t\n&gt; \t\t\t\t\treturn user.getUserGroupName\n&gt; ();\n&gt; \t\n&gt; \t\t\t\t} finally {\n&gt; \t\t\t\t\tsessionManager.release\n&gt; (session);\n&gt; \t\t\t\t}\n&gt; \t\t\t\n&gt; \t\t\t} catch (DfIdentityException e) {\n&gt; \t            DfLogger.debug(this, &quot;Failed to get session due \n&gt; to identity exception&quot;, null, null);\n&gt; \t\t\t\treturn &quot;&quot;;\n&gt; \t\t\t}\n&gt; \t\t\t\n&gt; \t\t} catch (DfException e) {\n&gt;             DfLogger.error(this, &quot;Failed to get group&quot;, null, e);\n&gt; \t\t}\n&gt; \t\t\n&gt; \t\treturn &quot;&quot;;\n&gt; \t}\t\n&gt; }\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;\n&gt;  \n&gt; Yahoo! Groups Links\n&gt;\n&gt;\n&gt;\n&gt;  \n&gt;\n&gt;\n&gt;   \n\n\n", 
    "profile": "dsaff", 
    "topicId": 16987, 
    "spamInfo": {
        "reason": "3", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 139771899, 
    "prevInTime": 17001, 
    "contentTrasformed": false, 
    "postDate": "1150969426", 
    "canDelete": false, 
    "nextInTopic": 0, 
    "prevInTopic": 17001, 
    "headers": {
        "inReplyToHeader": "PGU3ZGRicytkY3FuQGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PDQ0OUE2NjUyLjQwODAzQG1pdC5lZHU+", 
        "referencesHeader": "PGU3ZGRicytkY3FuQGVHcm91cHMuY29tPg=="
    }
}
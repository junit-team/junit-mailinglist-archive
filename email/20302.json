{
    "numMessagesInTopic": 2, 
    "nextInTime": 20303, 
    "senderId": "ym1GJONqz40RGI65UIoPXXDb46elzLLWdAgTRw_JKTTPPyDleWYOewE5kXHYjEBIS5GomrzvU7mXsCeK5_ZI5hNJCRn4MvxQXy-MbA4", 
    "systemMessage": true, 
    "subject": "Re: Regarding &quot;Annotated descriptions&quot; of new improvements in version 4.4", 
    "from": "&quot;Francesco&quot; &lt;won_espylacopa@...&gt;", 
    "authorName": "Francesco", 
    "msgSnippet": "... Well, in the meanwhile I solved my needs picking directly the source code of the Ant JUnit task and patching :p So if my little patch solution can be", 
    "msgId": 20302, 
    "profile": "won_espylacopa", 
    "topicId": 20301, 
    "spamInfo": {
        "reason": "6", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 108575068, 
    "messageBody": "<div id=\"ygrps-yiv-1694692927\">--- In <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>, &quot;Francesco&quot; &lt;won_espylacopa@...&gt; wrote:<br/>\n<blockquote><span title=\"ireply\"> &gt;<br/>\n&gt; Hello Everyone,<br/>\n&gt; <br/>\n&gt; I am interested if the &quot;annotated description&quot; feature can get the<br/>\n&gt; javadoc method description and adding a textual description to its<br/>\n&gt; relative generated report. Please can you point me on the right doc or<br/>\n&gt; give me some sample of this new improvement usage?<br/>\n&gt; <br/>\n&gt; Thank You<br/>\n&gt;<br/>\n<br/>\n </span></blockquote>Well, in the meanwhile I solved my needs picking directly the source<br/>\ncode of the Ant JUnit task and patching :p<br/>\n<br/>\nSo if my little patch solution can be useful for other newbies like<br/>\nme, I put here my solution as simple sample. Serious disclaimer: pick<br/>\nand use it but don&#39;t claim any nuclear disaster :) <br/>\n<br/>\n<br/>\n*** As note for who can help me, I noticed that a nice thing which I<br/>\ncould do, would be to pick directly the test info content directly<br/>\nfrom the source javadoc code method, but I am still searching the<br/>\nright way to do it :), anyone could point me into the right direction?<br/>\nThanks :) ***<br/>\n<br/>\n<br/>\nHowever, here It follows all steps to print out a title and a description:<br/>\n<br/>\n1) download last Ant sources and unpack it, then find XMLConstants,<br/>\nJUnitVersionHelper, XMLJUnitResultFormatter classes and modify them as<br/>\nthe followings<br/>\n<br/>\n===org.apache.tools.ant.taskdefs.optional.junit.XMLConstants===<br/>\n+++&gt;<br/>\n<br/>\n[...]<br/>\n<br/>\n    /**<br/>\n     * title attribute for testcase element<br/>\n     * @author rigel alias zetatau <br/>\n     * TODO:<br/>\n     */<br/>\n    String ATTR_TITLE = &quot;title&quot;;<br/>\n<br/>\n    /**<br/>\n     * desc attribute for testcase element<br/>\n     * @author rigel alias zetatau <br/>\n     * TODO:<br/>\n     */<br/>\n    String ATTR_DESC = &quot;desc&quot;;<br/>\n<br/>\n[...]<br/>\n<br/>\n&lt;+++ <br/>\n<br/>\n<br/>\n===org.apache.tools.ant.taskdefs.optional.junit.JUnitVersionHelper===<br/>\n+++&gt;<br/>\n<br/>\n[...]<br/>\n<br/>\npublic static String getTestCaseTitle(Test test, String<br/>\nannotationMatch, String annotationParameter) {<br/>\n    if (test != null) {<br/>\n    \tif (test.getClass().getName().equals(JUNIT_TESTFACADE))<br/>\n\t\t\treturn<br/>\nhelperMethodInvoke(test,annotationMatch,annotationParameter,UNKNOWN);<br/>\n    \telse<br/>\n\t\t\treturn &quot;&quot;;<br/>\n    }<br/>\n\treturn UNKNOWN;<br/>\n}<br/>\n<br/>\npublic static String getTestCaseDesc(Test test, String<br/>\nannotationMatch, String annotationParameter) {<br/>\n    if (test != null) {<br/>\n    \tif (test.getClass().getName().equals(JUNIT_TESTFACADE))<br/>\n\t\t\treturn<br/>\nhelperMethodInvoke(test,annotationMatch,annotationParameter,UNKNOWN);<br/>\n\t\telse<br/>\n\t\t\treturn &quot;&quot;;<br/>\n    }<br/>\n\treturn UNKNOWN;<br/>\n}<br/>\n<br/>\n<br/>\nprivate static Iterator helperDescriptorCollection(Test facade) {<br/>\n\tfinal String <br/>\n\t\tjunitDescription=&quot;org.junit.runner.Description&quot;,<br/>\n\t\tmethodOnFacade=&quot;getDescription&quot;,<br/>\n\t\tmethodOnItem=&quot;getAnnotations&quot;;<br/>\n\t\t\t<br/>\n\tArrayList empty = new ArrayList();<br/>\n\tif (!facade.getClass().getName().equals(JUNIT_TESTFACADE))<br/>\n\t\treturn empty.iterator();<br/>\n\ttry {<br/>\n\t<br/>\nClass.forName(junitDescription,false,ClassLoader.getSystemClassLoader());<br/>\n\t\t\t// otherwise throw an exception<br/>\n\t\tMethod m = facade.getClass().getMethod(methodOnFacade, new Class[0]);<br/>\n\t\tObject itemInstance = m.invoke(facade, new Object[0]);<br/>\n\t\tif<br/>\n(itemInstance!=null&&junitDescription.equals(itemInstance.getClass().getName())){<br/>\n\t\t\tMethod m1 = itemInstance.getClass().getMethod(methodOnItem, new<br/>\nClass[0]);<br/>\n\t\t\tObject rtObj = m1.invoke(itemInstance, new Object[0]);<br/>\n\t\t\tif (rtObj instanceof Collection)<br/>\n\t\t\t\treturn ((Collection)rtObj).iterator();<br/>\n\t\t\treturn empty.iterator();<br/>\n\t\t} else return empty.iterator();<br/>\n\t} catch (ClassNotFoundException e) {<br/>\n\t} catch (SecurityException e) {<br/>\n\t} catch (IllegalArgumentException e) {<br/>\n\t} catch (NoSuchMethodException e) {<br/>\n\t} catch (IllegalAccessException e) {<br/>\n\t} catch (InvocationTargetException e) {<br/>\n\t}<br/>\n\treturn empty.iterator();<br/>\n}<br/>\n<br/>\nprivate static Object helperAnnotation(Test faÃ§ade, String<br/>\nannotationMatch) {<br/>\n\tfinal String methodOnAnnotation=&quot;annotationType&quot;;<br/>\n\tObject item=null;<br/>\n\tIterator it = helperDescriptorCollection(faÃ§ade);<br/>\n\twhile (it.hasNext()) {<br/>\n\t\tObject a = (Object)it.next();<br/>\n\t\tString match = &quot;&quot;;<br/>\n\t\ttry {<br/>\n\t\t\tMethod m = a.getClass().getMethod(methodOnAnnotation, new Class[0]);<br/>\n\t\t\tClass out = (Class)m.invoke(a, new Object[0]);<br/>\n\t\t\tmatch=String.valueOf(out.getName());<br/>\n\t\t} catch (SecurityException e) {<br/>\n\t\t} catch (NoSuchMethodException e) {<br/>\n\t\t} catch (IllegalArgumentException e) {<br/>\n\t\t} catch (IllegalAccessException e) {<br/>\n\t\t} catch (InvocationTargetException e) {<br/>\n\t\t}<br/>\n\t\tif (annotationMatch.equals(match)) {<br/>\n\t\t\titem=a;<br/>\n\t\t\tbreak;<br/>\n\t\t}<br/>\n\t}<br/>\n\treturn item;<br/>\n}<br/>\n<br/>\nprivate static String helperMethodInvoke(Test instance, String<br/>\nannotationMatch, String methodName, String defaultValue) {<br/>\n\ttry {<br/>\n// ANNOTATIONS WORKS ONLY ABOVE JDK 1.5<br/>\n//\t\t\tIterator it =<br/>\n((junit.framework.JUnit4TestCaseFacade)instance).getDescription().getAnnotations().iterator();<br/>\n//\t\t\tjava.lang.annotation.Annotation item=null;<br/>\n//    \t\twhile (it.hasNext()) {<br/>\n//    \t\t\tjava.lang.annotation.Annotation a =<br/>\n(java.lang.annotation.Annotation)it.next();<br/>\n//    \t\t\tif (annotationMatch.equals(a.annotationType().getName())) {<br/>\n//    \t\t\t\titem=a;<br/>\n//    \t\t\t\tbreak;<br/>\n//    \t\t\t}<br/>\n//    \t\t}<br/>\n\t\tObject item = helperAnnotation(instance, annotationMatch);<br/>\n\t\t/* No appropriate annotation was found so returns defaultValue */<br/>\n\t\tif (item==null)<br/>\n\t\t\treturn defaultValue;<br/>\n\t\t<br/>\n\t\tMethod m = item.getClass().getMethod(methodName, new Class[0]);<br/>\n\t\tObject oOut = m.invoke(item, new Object[0]);<br/>\n\t\tif (oOut instanceof String) {<br/>\n\t\t\tString sOut = String.valueOf(oOut);<br/>\n\t\t\tif (&quot;&quot;.equals(sOut)||sOut==null)<br/>\n\t\t\t\treturn defaultValue;<br/>\n\t\t\telse<br/>\n\t\t\t\treturn sOut;<br/>\n\t\t} else {<br/>\n\t\t\treturn defaultValue;<br/>\n\t\t}<br/>\n\t} catch (SecurityException e) {<br/>\n\t} catch (IllegalArgumentException e) {<br/>\n\t} catch (NoSuchMethodException e) {<br/>\n\t} catch (IllegalAccessException e) {<br/>\n\t} catch (InvocationTargetException e) {<br/>\n\t}<br/>\n\treturn defaultValue;<br/>\n}<br/>\n<br/>\n<br/>\n[...]<br/>\n<br/>\n&lt;+++<br/>\n<br/>\n<br/>\n<br/>\n===org.apache.tools.ant.taskdefs.optional.junit.XMLJUnitResultFormatter===<br/>\n+++&gt;<br/>\npublic void endTest(Test test) {<br/>\n<br/>\n[...]<br/>\n<br/>\n/* <br/>\n * This adds additional info to the generated XML test case data,<br/>\nunfortunately I don&#39;t<br/>\n * know what ant helper class can give me some params from XML build,<br/>\n */<br/>\nString sTitle =<br/>\nJUnitVersionHelper.getTestCaseTitle(test,&quot;test.TestInfo&quot;,&quot;title&quot;);<br/>\nString sDesc =<br/>\nJUnitVersionHelper.getTestCaseDesc(test,&quot;test.TestInfo&quot;,&quot;desc&quot;);<br/>\ncurrentTest.setAttribute(ATTR_TITLE,UNKNOWN.equals(sTitle) ? &quot;&quot; : sTitle);<br/>\ncurrentTest.setAttribute(ATTR_DESC,UNKNOWN.equals(sDesc) ? &quot;&quot; : sDesc);<br/>\n<br/>\n}<br/>\n<br/>\n[...]<br/>\n<br/>\n&lt;+++ <br/>\n<br/>\n<br/>\n2) Now build all Ant sources and replace in your default Ant library<br/>\nenvironment the old &quot;ant-junit.jar&quot; with the new one. <br/>\n<br/>\n<br/>\n3) Now you can create an annotation class like this, the name is<br/>\nimportant because in the previous class &quot;XMLJUnitResultFormatter&quot; is<br/>\nliterally wired as &quot;test.TestInfo&quot;, and if you found a way to retrieve<br/>\neasily params from build.xml it could be easily parameterized:<br/>\n<br/>\n===test.TestInfo===<br/>\n<br/>\n===&gt;<br/>\npackage test;<br/>\n<br/>\nimport java.lang.annotation.ElementType;<br/>\nimport java.lang.annotation.Retention;<br/>\nimport java.lang.annotation.RetentionPolicy;<br/>\nimport java.lang.annotation.Target;<br/>\n<br/>\n/**<br/>\n *<br/>\n * @author rigel alias zetatau<br/>\n *<br/>\n */<br/>\n@Retention(RetentionPolicy.RUNTIME)<br/>\n@Target({ElementType.METHOD})<br/>\npublic @interface TestInfo {<br/>\n\t/**<br/>\n\t * Optionally specify test &lt;code&gt;title&lt;/code&gt;<br/>\n\t */<br/>\n\tpublic String title() default &quot;Default test title&quot;;<br/>\n<br/>\n\t/**<br/>\n\t * Optionally specify test &lt;code&gt;description&lt;/code&gt;<br/>\n\t */<br/>\n\tpublic String desc() default &quot;Default test description&quot;;<br/>\n\t<br/>\n\t/**<br/>\n\t * Optionally specify test &lt;code&gt;error message descriptor&lt;/code&gt;<br/>\n\t */<br/>\n\tpublic String errorMessage() default &quot;Default error message descriptor&quot;;<br/>\n\t  <br/>\n}<br/>\n&lt;===<br/>\n<br/>\n<br/>\n4) Last step is your class under test, add a TestInfo annotation and<br/>\nit&#39;s all done for the XML testcase data generation (apart xml dtd<br/>\nanother step would be to patch the junit-frames.xsl to show your new<br/>\nattributes):<br/>\n<br/>\n===SomeClassUnderTest===<br/>\n<br/>\n+++&gt;<br/>\n<br/>\n[...]<br/>\n\t/** <br/>\n\t * This test probes if a null argument causes a NPE<br/>\n\t * @... <br/>\n\t */<br/>\n\t@Test(expected=NullPointerException.class)<br/>\n\t@TestInfo(title=&quot;Null argument&quot;,<br/>\n\t\t\t\tdesc=&quot;This test probes if a null argument causes a NPE&quot;)<br/>\n\tpublic final void beginTest1() {<br/>\n\t\t[...]<br/>\n\t}<br/>\n<br/>\n[...]<br/>\n<br/>\n&lt;+++<br/>\n<br/>\n<br/>\n<br/>\n-- <br/>\nFrancesco V.</div>", 
    "prevInTime": 20301, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1202455118", 
    "canDelete": false, 
    "nextInTopic": 0, 
    "prevInTopic": 20301, 
    "headers": {
        "inReplyToHeader": "PGZvZzMwZysyZWZlQGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PGZvZ3ZvZitjM2ZxQGVHcm91cHMuY29tPg=="
    }
}
{
    "numMessagesInTopic": 6, 
    "nextInTime": 8285, 
    "senderId": "zP7PxEr-1yRuqPFp6kAwqrh1WUvyVoeGrBnvgAMk3JIc8Biuu43o0JnInxfnau2TFuSEI9_vOwcpSrEAVSOn3y1ZG8r7sG-Dbjc", 
    "systemMessage": false, 
    "subject": "Re: [junit] singletons and running tests more than once", 
    "from": "Kevin Klinemeier &lt;zipwow@...&gt;", 
    "authorName": "Kevin Klinemeier", 
    "msgSnippet": "Here s some comments on your different approaches. ... This was my first inclination, too.  I ve done similar things, and the approach I ve liked is to make", 
    "msgId": 8284, 
    "rawEmail": "Return-Path: &lt;zipwow@...&gt;\r\nX-Sender: zipwow@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (qmail 13691 invoked from network); 6 Jun 2003 00:15:51 -0000\r\nReceived: from unknown (66.218.66.216)\n  by m4.grp.scd.yahoo.com with QMQP; 6 Jun 2003 00:15:51 -0000\r\nReceived: from unknown (HELO web80506.mail.yahoo.com) (66.218.79.76)\n  by mta1.grp.scd.yahoo.com with SMTP; 6 Jun 2003 00:15:51 -0000\r\nMessage-ID: &lt;20030606001551.58386.qmail@...&gt;\r\nReceived: from [207.14.29.3] by web80506.mail.yahoo.com via HTTP; Thu, 05 Jun 2003 17:15:51 PDT\r\nDate: Thu, 5 Jun 2003 17:15:51 -0700 (PDT)\r\nSubject: Re: [junit] singletons and running tests more than once\r\nTo: junit@yahoogroups.com\r\nIn-Reply-To: &lt;19F62E92-977A-11D7-9117-0003937C0DCC@...&gt;\r\nMIME-Version: 1.0\r\nContent-Type: text/plain; charset=us-ascii\r\nFrom: Kevin Klinemeier &lt;zipwow@...&gt;\r\nX-Yahoo-Group-Post: member; u=82914509\r\nX-Yahoo-Profile: zipwow\r\n\r\nHere&#39;s some comments on your different approaches.\n\n&gt; a) tearDown() is setting the static ivar which holds the singleton to\n&gt; null, so that the lazy static sharedInstance() always creates a new \n&gt; instance and by that always sets the correct System.properties. That \n&gt; would require to make that ivar set-able from outside the class it&#39;s \n&gt; declared in.\n\nThis was my first inclination, too.  I&#39;ve done similar things, and the\napproach I&#39;ve liked is to make the method that does the &quot;dirty work&quot;\nprotected, then create another class called ClassNameTestAdaptor or\nsomesuch, which resides only with your testing code, and makes that\nmethod publicly available.  If there&#39;s logic about when or how to\n&#39;reset&#39; this object, and you can put it in that xxTestAdaptor class,\nthat at least nominally separates your actual code from your testing\nhacks.\n\n&gt; \n&gt; b) setUp() is explicitly telling the singleton instance to reload the\n&gt; properties.\n\nI assume this isn&#39;t currently a publicly available option?  Perhaps you\nshould consider making this an option in the public interface.  This is\nmore straightforward than the &#39;set ref to null&#39;, and could be a\nreasonable thing to do.\n\n&gt; \n&gt; c) The singleton loads the properties and copies the values into\n&gt; ivars \n&gt; and uses them instead of System.properties. This would only work if\n&gt; the \n&gt; singleton is isolated from other classes that don&#39;t depend on these \n&gt; System.properties, so it&#39;s not a general solution (and when using \n&gt; frameworks, it&#39;s not always possible to isolate classes using mocks).\n\nI&#39;m not sure what you mean when you say that it would only work if the\nsingleton is isolated.  Are other classes reading the same values from\nSystem.properties instead of using your singleton?  Should they be?  If\nnot, can you get them to stop?  I may not understand the full scope of\nyour project/problem, so of course take my advice with a grain of salt.\n\n&gt; \n&gt; d) The singleton&#39;s static sharedInstance() method could check if the \n&gt; necessary system.properties are set and load them if required. This \n&gt; would cause a little performance hit because sharedInstance() is used\n&gt; a \n&gt; lot. Also, it&#39;s wouldn&#39;t be obvious to the reader of the source why \n&gt; that is done and would require inline documentation.\n\nfor d-g, I think you&#39;ve described the drawbacks pretty accurately.  I\nthink I&#39;d lean towards approach b, as it looks like a reasonable\naddition to the interface.\n\nThat said, there are reasons to not expose it publicly, going with\nsomething like you describe in &#39;a&#39; instead.  If the interface already\nhas a hojillion methods, you may not want to add one more.  Or, if\ncalling &#39;reset&#39; anywhere outside of the unit tests would likely break\neverything, then it isn&#39;t a very helpful method.  \n\nAlso something to consider is that the &#39;reset&#39; method may be the thing\nthat changes this class from immutable to mutable, necessitating some\nsynchronization, which you may be able to avoid if you&#39;re only using\nthe reset functionality in unit tests that execute a single thread.*\n\nHope this rambling helps..\n\nKevin Klinemeier\n\n* Apologies if this is old news, but just to help quash a Java myth I\nwanted to add the following:\n\nSynchronization isn&#39;t &quot;50 times slower&quot;.  The overhead of an\nuncontested lock acquisition is pretty small, and unless its really in\nthe critical path, will have a negligable affect on performance. \nContested locks take longer, approaching that dreaded &quot;50 times&quot; limit,\nbut most of your locks aren&#39;t going to be hotly contested, and the JVM\ndoes a fair amount of optimization for you, more with each release.\n\nAs always, write it correctly first, then analyse, then tune.\n\nhttp://www-106.ibm.com/developerworks/library/j-jtp04223.html?ca=dnt-416\nhttp://www-106.ibm.com/developerworks/java/library/j-threads1.html\n\n__________________________________\nDo you Yahoo!?\nYahoo! Calendar - Free online calendar with sync to Outlook(TM).\nhttp://calendar.yahoo.com\n\n", 
    "profile": "zipwow", 
    "topicId": 8277, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 82914509, 
    "prevInTime": 8283, 
    "contentTrasformed": false, 
    "postDate": "1054858551", 
    "canDelete": false, 
    "nextInTopic": 8286, 
    "prevInTopic": 8277, 
    "headers": {
        "inReplyToHeader": "PDE5RjYyRTkyLTk3N0EtMTFENy05MTE3LTAwMDM5MzdDMERDQ0BwZWtlbGVyLm9yZz4=", 
        "messageIdInHeader": "PDIwMDMwNjA2MDAxNTUxLjU4Mzg2LnFtYWlsQHdlYjgwNTA2Lm1haWwueWFob28uY29tPg=="
    }
}
{
    "numMessagesInTopic": 29, 
    "nextInTime": 20674, 
    "senderId": "oEJU6vsNEoHglZ7Revshjvzk0R2BcbJKVjWwolezlVnDK-trfZ1gMscXC-G10eF-UV81IaNaYDta8Lsvoe_9ix4nCpjXmG98nQl9qH2z9oqDx0NvSNPojSSCudfse_k", 
    "systemMessage": false, 
    "subject": "Re: [junit] Re: Junit 3 suite setup tear down", 
    "from": "=?UTF-8?B?Q8OpZHJpYyBCZXVzdCDimZQ=?= &lt;cbeust@...&gt;", 
    "authorName": "Cédric Beust ♔", 
    "msgSnippet": "That s a lot of work and therefore a good candidate for a new feature: @BeforeSuite/@AfterSuite. -- Cédric ... [Non-text portions of this message have been", 
    "msgId": 20673, 
    "profile": "cbeust", 
    "topicId": 20668, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 199443513, 
    "messageBody": "<div id=\"ygrps-yiv-2035321424\">That&#39;s a lot of work and therefore a good candidate for a new feature:<br/>\n@BeforeSuite/@AfterSuite.<br/>\n<br/>\n-- <br/>\nCédric<br/>\n<br/>\n<br/>\n<blockquote><span title=\"qreply\"> On Wed, Jul 9, 2008 at 12:47 PM, toalexsmail &lt;<a rel=\"nofollow\" target=\"_blank\" href=\"mailto:toalexsmail@...\">toalexsmail@...</a>&gt; wrote:<br/>\n<br/>\n&gt;   --- In <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a> &lt;junit%40yahoogroups.com&gt;, &quot;lars&quot;<br/>\n&gt; &lt;lars.carlsson@...&gt; wrote:<br/>\n&gt; &gt;<br/>\n&gt; &gt; Hi<br/>\n&gt; &gt; At my company we have alot of automated test cases and in all our<br/>\n&gt; &gt; suite we have a setup testcase and a teardown test case where we setup<br/>\n&gt; &gt; network connection that takes some time and can not be done in every<br/>\n&gt; TC. ,<br/>\n&gt; &gt; But i think that there should exist a suite setup and a teardown and<br/>\n&gt; &gt; not be in a setup/teardown TC.<br/>\n&gt; &gt; Are there any why of doing this or how could i best be solve this by<br/>\n&gt; &gt; extending TestSuite?<br/>\n&gt; &gt;<br/>\n&gt; &gt; Regards Lars<br/>\n&gt; &gt;<br/>\n&gt; I think that there is some related thread on this topic, but never mind.<br/>\n&gt;<br/>\n&gt; * There are @Before and @After annotation that are equivalent of use<br/>\n&gt; of setUp() and tearDown().<br/>\n&gt; * There are @BeforeClass and @AfterClass annotation that are supposed<br/>\n&gt; to substitute the use of TestSuite. In fact, this method is called<br/>\n&gt; once per class. You can see on it as your TestSuite was just a single<br/>\n&gt; class. AFAIK, there is no build in support for TestSuite that is not<br/>\n&gt; so trivial.<br/>\n&gt;<br/>\n&gt; I had similar requirement, namely I wanted to ensure that JDK 1.4+<br/>\n&gt; assert statement are on, I wanted to start JBoss microcontainer at the<br/>\n&gt; beginning and shutdown it at the end.<br/>\n&gt;<br/>\n&gt; Lets start from the simplest one.<br/>\n&gt; * I wanted to ensure that JDK 1.4+ assert statement are on.<br/>\n&gt; I created class with name BaseTestCase and all my test classes<br/>\n&gt; inherits from it. In this class I put the following method:<br/>\n&gt;<br/>\n&gt; @BeforeClass<br/>\n&gt; public static void oneTimeSetup(){<br/>\n&gt; // do your one time set-up here!<br/>\n&gt; log.info(&quot;BaseTestCase.oneTimeSetup()&quot;);<br/>\n&gt; log.debug(&quot;Going to check whether asserts are enabled&quot;);<br/>\n&gt; boolean assertsEnabled = false;<br/>\n&gt; assert (assertsEnabled = true); // Intentional side effect!!!<br/>\n&gt; if (!assertsEnabled) {<br/>\n&gt; throw new AssertionError(&quot;Asserts must be enabled!&quot;);<br/>\n&gt; }<br/>\n&gt; }<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt; Because all my test classes inherit from BaseTestCase and has their<br/>\n&gt; base class BaseTestCase, it is guaranteed that first thing that will<br/>\n&gt; be run (beside JUnit itself) is oneTimeSetup() method.<br/>\n&gt;<br/>\n&gt; * I wanted to start JBoss microcontainer at the beginning and shutdown<br/>\n&gt; it at the end.<br/>\n&gt;<br/>\n&gt; Every test class inherit from some base test class, say<br/>\n&gt; BaseHelloWorldEJBTest (that eventually inherit from BaseTestCase). In<br/>\n&gt; BaseHelloWorldEJBTest there is method<br/>\n&gt;<br/>\n&gt; @BeforeClass<br/>\n&gt; public static void setUpClass() throws Exception ;<br/>\n&gt;<br/>\n&gt; This method basically does the following:<br/>\n&gt;<br/>\n&gt; final Bootstrap jbossInstance = Bootstrap.getInstance();<br/>\n&gt; if (!jbossInstance.isStarted()) {<br/>\n&gt; log.debug(&quot;starting JBoss microcontainer&quot;);<br/>\n&gt; jbossInstance.bootstrap();<br/>\n&gt; log.debug(&quot;JBoss microcontainer is up&quot;);<br/>\n&gt;<br/>\n&gt; log.debug(&quot;Going to deploy scanClasspath&quot;);<br/>\n&gt; deploy(scanClasspath);<br/>\n&gt; log.debug(&quot;End of deploy scanClasspath&quot;);<br/>\n&gt; ... &lt;HERE there is more code&gt;<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt; Until now everything is pretty straight-forward. But how can I stop<br/>\n&gt; JBoss when I finished testing? I don&#39;t want to stop it after every<br/>\n&gt; class, but after whole TestSuite is done. I didn&#39;t find something<br/>\n&gt; built-in, so I use ShutdownHook...<br/>\n&gt;<br/>\n&gt; In the above setUpClass() mehtod in the place that noted as &quot;&lt;HERE<br/>\n&gt; there is more code&gt;&quot; I have:<br/>\n&gt;<br/>\n&gt; log.debug(&quot;Now add hook to shutdown server&quot;);<br/>\n&gt; Runtime.getRuntime().addShutdownHook(new Thread() {<br/>\n&gt; public void run() {<br/>\n&gt; assert lRunnables!=null;<br/>\n&gt; Runnable runnable =null;<br/>\n&gt; String runnableI = null;<br/>\n&gt; try {<br/>\n&gt; for(int i=0;i&lt;lRunnables.length;i++){<br/>\n&gt; runnable = lRunnables[i];<br/>\n&gt; runnableI = &quot;runnable &quot;+i;<br/>\n&gt; log.debug(&quot;Going to run &quot;+runnableI);<br/>\n&gt; if(runnable==null){<br/>\n&gt; log.warn(runnableI+&quot; is null, skipping&quot;);<br/>\n&gt; } else {<br/>\n&gt; try {<br/>\n&gt; runnable.run();<br/>\n&gt; log.debug(runnableI+&quot; ends run succesfully&quot;);<br/>\n&gt; }<br/>\n&gt; catch(Throwable e){log.error(runnableI+&quot; fails&quot;, e);}<br/>\n&gt;<br/>\n&gt; }<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt; catch(Throwable e){<br/>\n&gt; log.error(&quot;This should never happened. Some runnables Throwable<br/>\n&gt; (exception) propogates outside the loop&quot;, e);<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt;<br/>\n&gt; synchronized (jbossInstance) {<br/>\n&gt; jbossInstance.shutdown();<br/>\n&gt; }<br/>\n&gt; String junitStatus = junitStatusOs.toString();<br/>\n&gt; log.debug(junitStatus);<br/>\n&gt;<br/>\n&gt; }<br/>\n&gt; });<br/>\n&gt; I will talk about junitStatusPs a bit later. What is actually is done<br/>\n&gt; here that in @BeforeClass that it is before running every class, there<br/>\n&gt; is check whether JBoss is run or no. If it is run nothing special is<br/>\n&gt; done. If it is not run, and this will be true only first time this<br/>\n&gt; check will be done, JBoss is started and ShutDownHook is added. Take a<br/>\n&gt; look on the JavaDoc on ShutDownHook, but basically, on the call on<br/>\n&gt; System.exit() JVM will be run your hook. In that shutdown hook I make<br/>\n&gt; jbossInstance.shutdown().<br/>\n&gt;<br/>\n&gt; There is one issue here. One JBoss is shutting down it write some<br/>\n&gt; thing to the log. What is happen, that I see JUnit report (90000<br/>\n&gt; tested passes, 100 fails, and 10 ignored) and after this report I see<br/>\n&gt; the output from shitting down process. This happen, because the<br/>\n&gt; shutdown hook happens after last JUnit class finished to run.<br/>\n&gt; I found some work around. In the BaseTestCase I have:<br/>\n&gt; // the logger<br/>\n&gt; private static final Log log = LogFactory.getLog(BaseTestCase.class);<br/>\n&gt; protected static final OutputStream junitStatusOs = new<br/>\n&gt; ByteArrayOutputStream(16*1024);<br/>\n&gt;<br/>\n&gt; This junitStatusPs is actually passed to as PrintStream (instead<br/>\n&gt; System.out) to the JUnit classes. Note, that I have<br/>\n&gt;<br/>\n&gt; String junitStatus = junitStatusOs.toString();<br/>\n&gt; log.debug(junitStatus);<br/>\n&gt;<br/>\n&gt; as the last row of the shutdown hook. This ensure, that I will see the<br/>\n&gt; output of the shutdown hook first, and the JUnit report will be the<br/>\n&gt; last rows in the standard output.<br/>\n&gt; And the last issue is:<br/>\n&gt;<br/>\n&gt; If I want to do some other thing I just wrap it as lRunnables and pass<br/>\n&gt; to the method mentioned above. It is looks like this:<br/>\n&gt;<br/>\n&gt; //we want to call cleanUp() method that ear application calls<br/>\n&gt; //moment before we shutting down JBoss<br/>\n&gt; Runnable runnable = new Runnable(){<br/>\n&gt; public void run() {<br/>\n&gt; try {<br/>\n&gt; cleanUp();<br/>\n&gt; }<br/>\n&gt; catch(HelloWorldException e){<br/>\n&gt; log.error(&quot;Failed to cleanUp&quot;, e);<br/>\n&gt; }<br/>\n&gt; }<br/>\n&gt; };<br/>\n&gt;<br/>\n&gt; setUpClass(System.getProperty(&quot;user.dir&quot;) + &quot;/target/classes&quot;,<br/>\n&gt; runnable);<br/>\n&gt;<br/>\n&gt; In order to shutdown JBoss we use<br/>\n&gt; @AfterClass<br/>\n&gt; public static void tearDownClass() throws Exception {<br/>\n&gt; log.info(&quot;one time tearDownClass()&quot;);<br/>\n&gt; undeploy();<br/>\n&gt; Bootstrap.getInstance().shutdown();<br/>\n&gt; }<br/>\n&gt;<br/>\n&gt;  <br/>\n&gt;<br/>\n<br/>\n<br/>\n[Non-text portions of this message have been removed] </span></blockquote></div>", 
    "prevInTime": 20672, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1215643526", 
    "canDelete": false, 
    "nextInTopic": 20675, 
    "prevInTopic": 20670, 
    "headers": {
        "inReplyToHeader": "PGc1MzRrdStvZnN0QGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PGI4NmI2YTljMDgwNzA5MTU0NWo3N2I3MjZmZWhhMTE4ZWM2NDhiYTg2MjI3QG1haWwuZ21haWwuY29tPg==", 
        "referencesHeader": "PGc1MW44ZStmdTRyQGVHcm91cHMuY29tPiA8ZzUzNGt1K29mc3RAZUdyb3Vwcy5jb20+"
    }
}
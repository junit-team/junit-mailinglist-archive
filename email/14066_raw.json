{
    "numMessagesInTopic": 4, 
    "nextInTime": 14067, 
    "senderId": "r25APZepYftapR_zY5LnOVa0iglIvgNPkFXEZ0kjEmn0ht7eUd41F5lRU5QL_RiWRv24RVh-dgItG2-LfxUBGh1CMw", 
    "systemMessage": false, 
    "subject": "Re: [junit] Testing memory usage", 
    "from": "twall &lt;twall@...&gt;", 
    "authorName": "twall", 
    "msgSnippet": "... There s the standard hack for measuring the size of individual objects.  I use this to keep the size of individual objects within reason.  Of course, it", 
    "msgId": 14066, 
    "rawEmail": "Return-Path: &lt;twall@...&gt;\r\nX-Sender: twall@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (qmail 79620 invoked from network); 30 Jun 2005 13:38:38 -0000\r\nReceived: from unknown (66.218.66.167)\n  by m26.grp.scd.yahoo.com with QMQP; 30 Jun 2005 13:38:38 -0000\r\nReceived: from unknown (HELO mail00.oculustech.com) (64.1.226.147)\n  by mta6.grp.scd.yahoo.com with SMTP; 30 Jun 2005 13:38:38 -0000\r\nReceived: by mail00.oculustech.com (Postfix, from userid 1011)\n\tid 0EC4C17F80; Thu, 30 Jun 2005 09:38:36 -0400 (EDT)\r\nReceived: from http01.int.oculustech.com (http01.int.oculustech.com [192.168.100.10])\n\tby mail00.oculustech.com (Postfix) with ESMTP id 4BE9617F80\n\tfor &lt;junit@yahoogroups.com&gt;; Thu, 30 Jun 2005 09:38:35 -0400 (EDT)\r\nReceived: (from nobody@localhost)\n\tby http01.int.oculustech.com (8.11.6/8.9.3) id j5UDcaD25087\n\tfor junit@yahoogroups.com; Thu, 30 Jun 2005 09:38:36 -0400\r\nMessage-Id: &lt;200506301338.j5UDcaD25087@...&gt;\r\nX-Authentication-Warning: http01.int.oculustech.com: nobody set sender to twall@... using -f\r\nDate: Thu, 30 Jun 2005 09:38:36 -0400\r\nX-Mailer: JAW::Mail jawmail-2.0.1\r\nTo: &lt;junit@yahoogroups.com&gt;\r\nMIME-Version: 1.0\r\nContent-Type: text/plain; charset=UTF-8\r\nContent-Transfer-Encoding: QUOTED-PRINTABLE\r\nContent-Disposition: inline\r\nX-Spam-Checker-Version: SpamAssassin 3.0.1 (2004-10-22) on \n\tmail00.int.oculustech.com\r\nX-Spam-Level: \r\nX-Spam-Status: No, score=-5.9 required=4.5 tests=ALL_TRUSTED,AWL,BAYES_00 \n\tautolearn=ham version=3.0.1\r\nX-eGroups-Msg-Info: 1:12:0\r\nFrom: twall &lt;twall@...&gt;\r\nSubject: Re: [junit] Testing memory usage\r\nX-Yahoo-Group-Post: member; u=106503903; y=7Z7HIAdaIpUGXGx2OIOBdL18p7lL0XU5R3878fPeNogsJDHz-2jW\r\nX-Yahoo-Profile: timothyrwall\r\n\r\nOn Thu, 30 Jun 2005 at 09:29:46, Elliotte Harold wrote:\n\n&gt; Has anyone done =\r\nany work on unit test for memory usage of objects?\n&gt; \n\nThere&#39;s the standard=\r\n hack for measuring the size of individual objects.  I use this to keep the=\r\n size of \nindividual objects within reason.  Of course, it doesn&#39;t get anyw=\r\nhere near measuring operational usage \nor groups of allocations...\n\nThe fol=\r\nlowing class does a &quot;sizeof&quot; calculation given either a class with no-args =\r\nctor or an object which \ncreates instances of the desired class:\n\npackage t=\r\nest;\n\nimport java.lang.ref.*;\nimport java.util.*;\n\npublic class SizeOf {\n\n =\r\n   /** For use with constructors which require arguments. */\n    public sta=\r\ntic interface ObjectCreator {\n        Object create();\n    }\n\n    private s=\r\ntatic class ClassCreator implements ObjectCreator {\n        private Class c=\r\nls;\n        public ClassCreator(Class cls) {\n            this.cls =3D cls;\n=\r\n        }\n        public Object create() {\n            try {\n              =\r\n  return cls.newInstance();\n            }\n            catch(IllegalAccessEx=\r\nception e) {\n                String msg =3D &quot;No-argument constructor is &quot;\n =\r\n                   + &quot;private for &quot; + cls;\n                throw new Illega=\r\nlArgumentException(msg);\n            }\n            catch(InstantiationExcep=\r\ntion e) {\n                String msg =3D &quot;Can&#39;t create an instance of &quot; + c=\r\nls;\n                throw new IllegalArgumentException(msg);\n            }\n=\r\n            catch(Exception e) {\n                e.printStackTrace();\n     =\r\n           String msg =3D &quot;Can&#39;t obtain size of &quot; + cls;\n                th=\r\nrow new IllegalArgumentException(msg);\n            }\n        }\n    }\n\n    p=\r\nrivate static final int GCCOUNT =3D 2;\n\n    private static void gc() {\n    =\r\n    try {\n            System.gc(); Thread.sleep(100);\n            System.ru=\r\nnFinalization(); Thread.sleep(100);\n        }\n        catch(InterruptedExce=\r\nption e) {\n        }\n    }\n\n    private static void gc(int n) {\n        for=\r\n (int i=3D0;i &lt; n;i++) { gc(); }\n    }\n\n    public static long getMemoryUse=\r\n() {\n        gc(GCCOUNT);\n        long total =3D Runtime.getRuntime().total=\r\nMemory();\n        long free =3D Runtime.getRuntime().freeMemory();\n        =\r\nreturn total - free;\n    }\n    /** Return the approximate size in bytes of =\r\nthe object returned by the\n        given ObjectCreator.\n    */\n    public s=\r\ntatic long sizeof(ObjectCreator oc) {\n        final int SIZE =3D 1000;\n    =\r\n    ArrayList list =3D new ArrayList(SIZE);\n        long before =3D getMemo=\r\nryUse();\n        for (int i=3D0;i &lt; SIZE;i++) {\n            list.add(oc.cre=\r\nate());\n        }\n        long after =3D getMemoryUse();\n        return (af=\r\nter - before) / SIZE;\n    }\n\n    /** Return the approximate size in bytes o=\r\nf an instance of the given\n        class.  The class &lt;em&gt;must&lt;/em&gt; provide =\r\na no-args constructor.\n    */\n    public static long sizeof(Class cls) {\n  =\r\n      return sizeof(new ClassCreator(cls));\n    }\n\n    /** Display the appr=\r\noximate size (in bytes) of the class given in the\n        first argument.\n =\r\n   */\n    public static void main(String[] args) {\n        try {\n          =\r\n  if (args.length !=3D 1) {\n                System.err.println(&quot;Use with a =\r\nsingle class name argument&quot;);\n                System.exit(1);\n            }=\r\n\n            Class cls =3D Class.forName(args[0]);\n            System.out.p=\r\nrintln(&quot;Class &quot; + cls.getName()\n                               + &quot; size is =\r\n&quot; + sizeof(cls) + &quot; bytes&quot;);\n        }\n        catch(Throwable e) {\n       =\r\n     e.printStackTrace();\n            System.exit(1);\n        }\n    }\n}\n\n", 
    "profile": "timothyrwall", 
    "topicId": 14065, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 106503903, 
    "prevInTime": 14065, 
    "contentTrasformed": false, 
    "postDate": "1120138716", 
    "canDelete": false, 
    "nextInTopic": 14068, 
    "prevInTopic": 14065, 
    "headers": {
        "messageIdInHeader": "PDIwMDUwNjMwMTMzOC5qNVVEY2FEMjUwODdAaHR0cDAxLmludC5vY3VsdXN0ZWNoLmNvbT4="
    }
}
{
    "numMessagesInTopic": 5, 
    "nextInTime": 14054, 
    "senderId": "sf7ug47KE0-7jY3NTu2zMt5l9P6ouD6o7oT9VuDUpOAkNKOCEYEzdxo0OrNd4jJRKNk-YJqN4SZamN_s8Tfd0re4U4fZGN-kI6sy", 
    "systemMessage": false, 
    "subject": "Re: Using a Special Class Loader to test a Singleton", 
    "from": "&quot;Jeff Grigg&quot; &lt;jeffgrigg@...&gt;", 
    "authorName": "Jeff Grigg", 
    "msgSnippet": "... To directly answer your question:  You can t cast the object because it was created under a different class loader.  You can only interact with that class", 
    "msgId": 14053, 
    "rawEmail": "Return-Path: &lt;jeffgrigg@...&gt;\r\nX-Sender: jeffgrigg@...\r\nX-Apparently-To: junit@yahoogroups.com\r\nReceived: (qmail 90071 invoked from network); 28 Jun 2005 12:43:07 -0000\r\nReceived: from unknown (66.218.66.167)\n  by m28.grp.scd.yahoo.com with QMQP; 28 Jun 2005 12:43:07 -0000\r\nReceived: from unknown (HELO n10.bulk.dcn.yahoo.com) (216.155.201.63)\n  by mta6.grp.scd.yahoo.com with SMTP; 28 Jun 2005 12:43:06 -0000\r\nComment: DomainKeys? See http://antispam.yahoo.com/domainkeys\r\nReceived: from [216.155.201.64] by n10.bulk.dcn.yahoo.com with NNFMP; 28 Jun 2005 12:42:05 -0000\r\nReceived: from [66.218.69.2] by mailer1.bulk.dcn.yahoo.com with NNFMP; 28 Jun 2005 12:42:05 -0000\r\nReceived: from [66.218.66.81] by mailer2.bulk.scd.yahoo.com with NNFMP; 28 Jun 2005 12:42:05 -0000\r\nDate: Tue, 28 Jun 2005 12:42:04 -0000\r\nTo: junit@yahoogroups.com\r\nMessage-ID: &lt;d9rgis+jjiu@...&gt;\r\nIn-Reply-To: &lt;d9q55f+765k@...&gt;\r\nUser-Agent: eGroups-EW/0.82\r\nMIME-Version: 1.0\r\nContent-Type: text/plain; charset=ISO-8859-1\r\nContent-Length: 3080\r\nX-Mailer: Yahoo Groups Message Poster\r\nX-Yahoo-Newman-Property: groups-compose\r\nX-eGroups-Msg-Info: 1:12:0\r\nFrom: &quot;Jeff Grigg&quot; &lt;jeffgrigg@...&gt;\r\nSubject: Re: Using a Special Class Loader to test a Singleton\r\nX-Yahoo-Group-Post: member; u=139880894; y=OBXP-UbmeQnhav0xy-gWkzlBWnQvgsEhU-1aaGyd2lMvGMkqGMNJNJk\r\nX-Yahoo-Profile: jeffgrigg63132\r\n\r\n--- &quot;raycclough&quot; &lt;ray@a...&gt; wrote:\n&gt; [...], I created a custom Class Loader, and use Reflection to\n&gt; create the object.  It works great (except, of course, where\n&gt; it doesn&#39;t).  The reflexively obtained constructor returns an\n&gt; object of type &#39;Object&#39;, which the debugger says has the\n&gt; correct underlying type, and it contains the correct data,\n&gt; but I cannot Cast it to the type it needs to be.  Any hint\n&gt; to what I&#39;m doing wrong?  Thanks for any advice you can give\n&gt; me on this.\n\nTo directly answer your question:  You can&#39;t cast the object because \nit was created under a different class loader.  You can only \ninteract with that class through reflection.  You can&#39;t cast it to \ntypes or interfaces -- unless those classes were loaded by a common \nclass loader -- IE: the system class loader.\n\nI worked around this recently by loading the TestCase class itself \nunder the new class loader and calling the current test method on \nthe new instance, using reflection.  (And setting a flag so that the \nnew instance knew it was running under the new class loader.)\n\nA bit more detail:  The &quot;type&quot; of an instance, its identification, \nis the class name *PLUS* the the address of the ClassLoader instance \nthat loaded it.  That&#39;s how web servers keep applications separate \nfrom each other: They create one ClassLoader instance for each \nlogical application &quot;process&quot; they want to keep separate.\n\nQuestion:\nSince you&#39;re already using &#39;.setAccessible(true)&#39; already, why not \nuse reflection to replace the static singleton instance field?\n\n&gt; [...]\n&gt;     SpecialClassLoader loader = new SpecialClassLoader();\n&gt;     Class ctlrClass = loader.findClass(\t\t\t\n&gt; &quot;rdyne_rdcs.comm_gateway.controller.DefaultGatewayController&quot;);\n&gt; \t\t\t\t\t\t\t\t\n&gt;     // instantiate the controller using reflection\n&gt;     Class[] paramTypes = { Reader.class };\n&gt;     Object[] args = {reader};    // contains the &quot;test data&quot;\n&gt; \t\t\t\n&gt;     Constructor constructor = \n&gt; ctlrClass.getDeclaredConstructor(paramTypes);\n&gt;     constructor.setAccessible(true);\n&gt;     Object o = constructor.newInstance(args);\n&gt; \t\t\t\n&gt;     //Method m = ctlrClass.getMethod(&quot;getController&quot;,paramTypes);\n&gt;     //m.setAccessible(true);\n&gt;     //Object o = m.invoke(null,args);\n&gt; \t\t\t\n&gt; // TODO  - Figure this out!!!!!!!!!!!!!!!!!!\n&gt; // unfortunately somehow the Object may not be cast to the required\n&gt; // class &quot;DefaultGatewayController&quot;, or even to its interface.\n&gt; // This is true whether the &quot;Constructor&quot; method or the &quot;Method&quot;\n&gt; // method is used.  \n&gt; \n&gt;     if ( DefaultGatewayController.class.isInstance(o) ) {\n&gt;         // &quot;o&quot; may safely be cast as a &quot;DefaultGatewayController&quot;\n&gt; \tSystem.out.println(&quot;YOWSA&quot;);\n&gt; \tctlr = (DefaultGatewayController)o;\n&gt;     } else {\n&gt; \tSystem.out.println(&quot;OHNO&quot;);\n&gt; \tSystem.out.println(&quot;Class: &quot; + o.getClass().getName());\n&gt;     }\n&gt; [...]\n&gt; \n&gt; This always goes thru the &quot;OHNO&quot; branch, although the output\n&gt; of the class name is what it should be to allow me to cast it.\n&gt; I&#39;m fairly new to JUnit, and I&#39;m really new to custom Class\n&gt; Loaders, but it seems to me that this should work easily and\n&gt; well. [...]\n\n\n\n\n", 
    "profile": "jeffgrigg63132", 
    "topicId": 14046, 
    "spamInfo": {
        "reason": "12", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 139880894, 
    "prevInTime": 14052, 
    "contentTrasformed": false, 
    "postDate": "1119962524", 
    "canDelete": false, 
    "nextInTopic": 14062, 
    "prevInTopic": 14051, 
    "headers": {
        "inReplyToHeader": "PGQ5cTU1Zis3NjVrQGVHcm91cHMuY29tPg==", 
        "messageIdInHeader": "PGQ5cmdpcytqaml1QGVHcm91cHMuY29tPg=="
    }
}
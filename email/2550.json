{
    "numMessagesInTopic": 4, 
    "nextInTime": 2551, 
    "senderId": "rfLpr8DdB9ZAAz3_Tn8IHMTc8s-7ZV8GAfn_sk7ZT5vcls1dyLRf7rDPVw5d4WXDUOCLgnRjLz0-Lnk4QwWNCwjNM_pcrXwenqCUr-7aK7gE", 
    "systemMessage": false, 
    "subject": "Re: [junit] database testing with JTA/JTS", 
    "from": "&quot;Bruce Vinchon&quot; &lt;bruce.vinchon@...&gt;", 
    "authorName": "Bruce Vinchon", 
    "msgSnippet": "hi all, As richard said, there could be several approach to test a database : 1) I just want to make some test and rollback (autoCommit(false) in setup() and", 
    "msgId": 2550, 
    "topicId": 2537, 
    "spamInfo": {
        "reason": "0", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 0, 
    "messageBody": "<div id=\"ygrps-yiv-226755315\"><br><font size=\"2\" face=\"sans-serif\">hi all,</font>\n<br>\n<br><font size=\"2\" face=\"sans-serif\">As richard said, there could be several approach to test a database :</font>\n<br>\n<br><font size=\"2\" face=\"sans-serif\">1) I just want to make some test and rollback (autoCommit(false) in setup() and rollback() in tearDown()). It allows to insert, update, delete in my database during my tests and rollback all operations to let the database clean. If you do a lot of tests (testSuite), you could just have independant tests (as it should be). If you want to chain tests that uses the same connection and to rollback all operations at the end, you probably should developed a transaction object. Eric describes it. You can control autoCommit and rollback and inhibit their standard behavior. a testSuite can control commit and rollback through other methods in the transaction class (globalCommit() and globalRollback() called in the body of your testSuite ?) as each test methods call inactive autoCommit(), commit() and rollback() methods.</font>\n<br>\n<br><font size=\"2\" face=\"sans-serif\">2) you don&#39;t want to borrow about it and want to manage nested transactions. well... JTS specification allows nested transaction (spec 1.0 says : &quot;not required&quot; but you can find JTS compliant platforms that support it) :</font>\n<br>\n<table width=\"100%\">\n<tr valign=\"top\">\n<td width=\"100%\"><font size=\"2\" face=\"Verdana\">&quot;A JTS transaction manager must support flat transactions; support of nested transactions is optional. If a client begins a transaction, and within that transaction begins another transaction, the latter operation will throw a NotSupportedException if the JTS implementation does not support nested transactions. Keep in mind that even if the JTS implementation supports nested transactions, this transaction manager-level support does not guarantee support for nested transactions in an application. For example, the EJB 1.1 specification does not support nested transactions.&quot;... [find on jGuru]</font>\n<br>\n<br><font size=\"2\" face=\"Verdana\">but EJB 2.0 supports it ! (http://www.wap-shareware.com/sjug/ejb/index.shtml - see point 6).</font></table>\n<br>\n<br><font size=\"2\" face=\"sans-serif\">so where is the problem ? you should find a database that supports it and a transaction server that is JTS compliant. DB2 and SQL Server seems not to support nested transactions (perhaps directly ?). Oracle 8i does... with a little trick : the save points.</font>\n<br>\n<br><font size=\"2\" face=\"sans-serif\">3) With save points, you could simulate nested transactions. Oracle 8i allows it in PL/SQL procedure that you could call through JDBC (not good for simple tests !) (see http://www.inquiry.com/techtips/oracle_pro/10min/10min1100.asp). [Informix Universe 9.4 supports the same thing : see http://www.inactsys.com/universe.htm]. </font>\n<br>\n<br><font size=\"2\" face=\"sans-serif\">Where to find some transaction application server that allows it ? Some products like PowerTiers provides setSavePoints() methods (you can read here for an explanation : http://www.persistence.com/powertier/devpit/documentation/programming/directt5.htm). But you should use it with an appropriate database.</font>\n<br>\n<br><font size=\"2\" face=\"sans-serif\">Conclusion : as it seems not quite easy to find a cool platform where nested transactions are automatically supported, the first solution seems the best approach actually.</font>\n<br>\n<br><font size=\"2\" face=\"sans-serif\">Any comments or ideas ?</font>\n<br>\n<br><font size=\"2\" face=\"sans-serif\">regards,</font>\n<br>\n<br><font size=\"2\" face=\"sans-serif\">Bruce Vinchon<br>\n</font>\n<br>\n<br><font size=\"2\"><tt>A while ago I had an email conversation with Bruce Vinchon regarding<br>\ndatabase testing. I said I&#39;d mention something we discussed on this mailing<br>\nlist so here goes (and apologies to Bruce if I&#39;ve misrepresented his thoughts).<br>\n</tt></font>\n<br><font size=\"2\"><tt>Bruce mentioned using the &quot;auto commit off&quot; trick to make database testing<br>\neasier. &nbsp; I.e., you do something like turn auto commit off during setUp()<br>\nand do an rollback/abort in tearDown(), so you can write to a test database<br>\nand not have to worry about cleaning it up. Something like that.<br>\n</tt></font>\n<br><font size=\"2\"><tt>I replied talking about the problems when you have methods which are<br>\nthemselves transactions (i.e., methods which<br>\nstart transactions, write to various tables, then commit). &nbsp;How can you use<br>\nthe &quot;auto commit off&quot; trick in those situations?<br>\n</tt></font>\n<br><font size=\"2\"><tt>Bruce suggested that you may be able to get something to work with nested<br>\ntransactions, perhaps using a transaction service such as JTA/JTS. &nbsp;Sounds<br>\ngood to me, but I haven&#39;t had the opportunity to investigate this idea or<br>\nthe Java Transaction APIs.<br>\n</tt></font>\n<br><font size=\"2\"><tt>Can anyone comment on this approach?<br>\n</tt></font>\n<br><font size=\"2\"><tt>Regards<br>\nRichard<br>\n</tt></font>\n<br>\n<br></div>", 
    "prevInTime": 2549, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "999510392", 
    "canDelete": false, 
    "nextInTopic": 0, 
    "prevInTopic": 2539, 
    "headers": {
        "messageIdInHeader": "PE9GN0IyNkU5RTguQ0FDRTg3MzUtT05DMTI1NkFCQy4wMDMwOTRDM0BmcmFuY2UuaWJtLmNvbT4="
    }
}
{
    "numMessagesInTopic": 12, 
    "nextInTime": 23792, 
    "senderId": "RCLLycj7dQE4YIAg94MocZhLusPvM7ggIk4zsNX9LOj6bqRKQ44dAloLUn-vhtj-fVpMLoA3CWA-rPdVkw", 
    "systemMessage": false, 
    "subject": "Re: Runner for maven", 
    "from": "kristian@...", 
    "authorName": "kristian@rosenvold.com", 
    "msgSnippet": "maven-surefire now also supports concurrent forks, and they don t have any of the interaction problems you describe - as you know. Since surefire is an", 
    "msgId": 23791, 
    "profile": "krosenvold", 
    "topicId": 23785, 
    "spamInfo": {
        "reason": "6", 
        "isSpam": false
    }, 
    "replyTo": "LIST", 
    "userId": 403861045, 
    "messageBody": "<div id=\"ygrps-yiv-286464299\">maven-surefire now also supports concurrent forks, and they don&#39;t have any of the interaction problems you describe - as you know. Since surefire is an all-purpose runner, we try to support any &quot;sensible&quot; mode of execution, and there are good use cases for both models of execution.<br/>\n<br/>\nYour first suggestion seems to work quite well, using the Computer I just wrap the created runner in another runner that attaches the testclass to the thread (and delegates on to the target Runner), which we pick up in reporting.<br/>\n<br/>\nSurefire does all the other stuff already, but I&#39;m thinking we might<br/>\nbe deprecating &quot;both&quot; mode threading support because it becomes <br/>\nsuch a pain to do correctly, at least it requires a tight collaboration between the RunListener and the Computer.<br/>\n<br/>\n<br/>\nKristian<br/>\n<br/>\n<blockquote><span title=\"qreply\"> --- In <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>, Dawid Weiss &lt;dawid.weiss@...&gt; wrote:<br/>\n&gt;<br/>\n&gt; Hi Kristian,<br/>\n&gt; <br/>\n&gt; We had a similar issue. I was debating for a longer while if it makes sense<br/>\n&gt; to run parallel tests within the same VM. In many situations this speeds<br/>\n&gt; things a lot and has a nice memory conserving footprint but you cannot<br/>\n&gt; guarantee tests won&#39;t interact with each other (in the simplest case via<br/>\n&gt; mutating system properties). Finally the decision was to do it like Apache<br/>\n&gt; Lucene did it -- split tests into parallel slave VMs with repeatable suite<br/>\n&gt; execution order and sequential test execution within a single VM. This is<br/>\n&gt; implemented in an ANT task called junit4 here.<br/>\n&gt; <br/>\n&gt; <a rel=\"nofollow\" target=\"_blank\" href=\"https://github.com/carrotsearch/randomizedtesting/tree/master/ant-junit4\">https://github.com/carrotsearch/randomizedtesting/tree/master/ant-junit4</a><br/>\n&gt; <br/>\n&gt; JUnit tests inside will give you a hint how to use it, the code is still<br/>\n&gt; very fresh so documentation is scarce.<br/>\n&gt; <br/>\n&gt; Now... this was a digression. Back to your question (because we did go that<br/>\n&gt; route as well, only backed up), one possible solution to isolating<br/>\n&gt; sysout/syserrs of parallel tests in a single VM is:<br/>\n&gt; <br/>\n&gt; 1) isolate each suite (for @BeforeClass/ @AfterClass hooks) into a separate<br/>\n&gt; thread which you have under control. This can be either a custom @Runner or<br/>\n&gt; a Computer, many ways to achieve it.<br/>\n&gt; <br/>\n&gt; 2) write a PrintStream implementation that redirects to a thread-local<br/>\n&gt; buffer. This gist implements a similar idea to demux multiple thread<br/>\n&gt; streams so that each one&#39;s output appears on a single line; you&#39;ll get the<br/>\n&gt; idea I&#39;m sure.<br/>\n&gt; <br/>\n&gt; <a rel=\"nofollow\" target=\"_blank\" href=\"https://gist.github.com/1561833\">https://gist.github.com/1561833</a><br/>\n&gt; <br/>\n&gt; 3) once you have the above the rest is easy: replace default<br/>\n&gt; System.out/System.err (I assume no security manager is present or it allows<br/>\n&gt; such replacement), clear the buffer before suite, run your suite, flush the<br/>\n&gt; buffer. The buffer&#39;s content will be your thread&#39;s output even though<br/>\n&gt; system.* are singletons.<br/>\n&gt; <br/>\n&gt; Like I said though -- I would consider using multiple jvms for running<br/>\n&gt; parallel tests instead.<br/>\n&gt; <br/>\n&gt; Dawid<br/>\n&gt; <br/>\n&gt; On Wed, Jan 4, 2012 at 7:51 AM, &lt;kristian@...&gt; wrote:<br/>\n&gt; <br/>\n&gt; &gt; **<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt; Sorry, I was doing just what I sometimes dislike of our own users ;)<br/>\n&gt; &gt;<br/>\n&gt; &gt; The real problem I want to solve is associating console output from a<br/>\n&gt; &gt; running thread to a given test-case (for parallel runs). We have this<br/>\n&gt; &gt; fairly well covered already and we manage to capture everything that<br/>\n&gt; &gt; happens within a given test-case for that test-case.<br/>\n&gt; &gt;<br/>\n&gt; &gt; The real problem is that the RunListener API does not demarcate<br/>\n&gt; &gt; test-classes properly, so I am unable to distinguish console output<br/>\n&gt; &gt; happening in @AfterClass of one test with @BeforeClass on the test-class on<br/>\n&gt; &gt; the same thread.<br/>\n&gt; &gt;<br/>\n&gt; &gt; This problem has been in the corner of my eye for quite some time and I&#39;ve<br/>\n&gt; &gt; been trying to find a decent angle to solve it from. I promise not to do<br/>\n&gt; &gt; anything that is frowned upon, which is why I asked ;)<br/>\n&gt; &gt;<br/>\n&gt; &gt; Kristian<br/>\n&gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt; --- In <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>, Matthew Farwell &lt;matthew@&gt; wrote:<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; Kristian,<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; In reading your original mail, I was also confused as to what you wanted<br/>\n&gt; &gt; to<br/>\n&gt; &gt; &gt; achieve. Could you expand a little please?<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; Thanks.<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; Matthew Farwell.<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; Le 3 janvier 2012 22:45, hkaipe &lt;hkaipe@&gt; a Ã©crit :<br/>\n&gt; &gt;<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; **<br/>\n&gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; Hi Kristian<br/>\n&gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; Do you really want a transition from RunListener?<br/>\n&gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; To an outside observer - a JUnit Runner &quot;describes&quot; its test-executions<br/>\n&gt; &gt; &gt; &gt; and reports their outcome to the RunNotifier, which forward the info to<br/>\n&gt; &gt; &gt; &gt; RunListener, which is the interface that 3rd-party test-running<br/>\n&gt; &gt; &gt; &gt; applications (e.g. IDEs, Maven-Surefire etc) are expected to use.<br/>\n&gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; I have seen IDE-project test-extensions try to go beyond<br/>\n&gt; &gt; &gt; &gt; RunListener/RunNotifier and start to joggle with Runner internals (e.g.<br/>\n&gt; &gt; &gt; &gt; test-instance creation/setup, method-executions etc) and the result is<br/>\n&gt; &gt; &gt; &gt; something I don&#39;t like much. It works for simple cases but with<br/>\n&gt; &gt; customized<br/>\n&gt; &gt; &gt; &gt; Runner-classes and new JUnit-features (e.g. the introduction of<br/>\n&gt; &gt; &gt; &gt; JUnit-Rules) the result is usually bad and it discourages the IDE users<br/>\n&gt; &gt; &gt; &gt; (i.e. the developers) from taking full advantage of JUnit!<br/>\n&gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; However, Maven (versions 2.0-2.2) and its Surefire-plugin has handled<br/>\n&gt; &gt; the<br/>\n&gt; &gt; &gt; &gt; JUnit-integration wonderfully, as far as I know, so your post worries<br/>\n&gt; &gt; me a<br/>\n&gt; &gt; &gt; &gt; little. What is it that you want to accomplish by moving away from the<br/>\n&gt; &gt; &gt; &gt; successful(!) &quot;Junitcore+RunListener based approach&quot;?<br/>\n&gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; Henrik<br/>\n&gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; --- In <a rel=\"nofollow\" target=\"_blank\" href=\"mailto:junit@yahoogroups.com\">junit@yahoogroups.com</a>, kristian@ wrote:<br/>\n&gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; Hi,<br/>\n&gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; I maintain the junit provider for maven-surefire, and I&#39;m looking<br/>\n&gt; &gt; into<br/>\n&gt; &gt; &gt; &gt; transitioning from a Junitcore+RunListener based approach to an<br/>\n&gt; &gt; approach<br/>\n&gt; &gt; &gt; &gt; based on something like BlockJUnit4ClassRunner.<br/>\n&gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; Unfortunately I cannot subclass the BlockJUnit4ClassRunner since the<br/>\n&gt; &gt; &gt; &gt; client code itself may need to do that, so I&#39;d somehow need to put &quot;my&quot;<br/>\n&gt; &gt; &gt; &gt; &gt; Runner in front of the client-supplied one, maybe something proxy<br/>\n&gt; &gt; like.<br/>\n&gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; Anyone have any tips on this, maybe some existing code that does<br/>\n&gt; &gt; this ?<br/>\n&gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt; &gt; Kristian<br/>\n&gt; &gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt; &gt;<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt; &gt; [Non-text portions of this message have been removed]<br/>\n&gt; &gt; &gt;<br/>\n&gt; &gt;<br/>\n&gt; &gt;  <br/>\n&gt; &gt;<br/>\n&gt; <br/>\n&gt; <br/>\n&gt; [Non-text portions of this message have been removed]<br/>\n&gt; </span></blockquote></div>", 
    "prevInTime": 23790, 
    "specialLinks": [], 
    "contentTrasformed": false, 
    "postDate": "1325763374", 
    "canDelete": false, 
    "nextInTopic": 23792, 
    "prevInTopic": 23790, 
    "headers": {
        "inReplyToHeader": "PENBTTIxUnQ4VHJqU1VzT1pVND0zbWRWdkdBOUxla01ENT05YzJ3aG9BMHNZVTd2TG1MQUBtYWlsLmdtYWlsLmNvbT4=", 
        "messageIdInHeader": "PGplNDF2ZStnNXNlQGVHcm91cHMuY29tPg=="
    }
}